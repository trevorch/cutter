import{E as ne,i as we}from"./element-plus-CRGBzuq5.js";import{f as G,g as W,B as be,l as Ce,w as Te,Q as Se}from"./@element-plus-By79ymwD.js";import{r as k,j as ie,c as Y,o as R,a as z,M as A,u,d as ce,k as ye,ag as b,aq as ze,I as ge,G as ue,H as s,P as e,L as x,S as Ee,w as xe,J as fe,O as de,a6 as he,D as Me,n as De,X as Pe,Q as Ie,at as je}from"./@vue-C01xNfPK.js";import{d as me,c as Le}from"./pinia-CKuVeK4o.js";import{P as Oe}from"./plyr-CZIZ1zVJ.js";import{H as re}from"./hls.js-DWnTp5j0.js";import{f as ve}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))_(a);new MutationObserver(a=>{for(const v of a)if(v.type==="childList")for(const j of v.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&_(j)}).observe(document,{childList:!0,subtree:!0});function d(a){const v={};return a.integrity&&(v.integrity=a.integrity),a.referrerPolicy&&(v.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?v.credentials="include":a.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function _(a){if(a.ep)return;a.ep=!0;const v=d(a);fetch(a.href,v)}})();function He(p,o="未知错误"){if(p instanceof Error)return p.message;if(typeof p=="string")return p;if(typeof p=="object"&&p!==null&&"message"in p&&typeof p.message=="string")return p.message;try{return JSON.stringify(p)}catch{return o}}const le={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},se=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function q(p,o){const d=He(p),_=o?`${o}: ${d}`:d;ne.error({...le,message:`
    <div ${se}>
      ${_}
    </div>
    `})}function P(p){ne.error({...le,message:`
    <div ${se}>
      ${p}
    </div>
    `})}function Ue(p){ne.info({...le,message:`
    <div ${se}>
      ${p}
    </div>
    `})}function J(p){ne.success({...le,message:`
    <div ${se}>
      ${p}
    </div>
    `})}const X=p=>{try{const[o,d]=p.split("."),[_,a,v]=o.split(":").map(Number),j=d?parseInt(d.padEnd(3,"0")):0;return _*3600+a*60+v+j/1e3}catch{return 0}},L=p=>{const o=Math.round(p%1*1e3),d=Math.floor(p),_=Math.floor(d/3600),a=Math.floor(d%3600/60),v=d%60;return`${String(_).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String(v).padStart(2,"0")}.${String(o).padStart(3,"0")}`},Z=me("player",()=>{const p=k(""),o=k(null),d=k(null),_=k(null),a=k(null),v=k(null),j=r=>{o.value=new Oe(r,{hideControls:!1,controls:["play-large","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},E=r=>{a.value=r,p.value=r.date;const f=r.urls[0],h={type:"video",sources:[{src:f,type:V(f)}]};H(h).then(()=>{var S;return(S=o.value)==null?void 0:S.play()})},V=r=>r.includes(".m3u8")?"application/x-mpegURL":r.includes(".flv")?"video/x-flv":"video/mp4",H=async r=>{var h,S,M;(h=d.value)==null||h.destroy(),d.value=null,(S=_.value)==null||S.destroy(),_.value=null;const f=r.sources[0].src.includes(".m3u8")?"hls":r.sources[0].src.includes(".flv")?"flv":"html5";try{f!==v.value&&await((M=o.value)==null?void 0:M.stop()),o.value.source=r,f==="hls"&&re.isSupported()?await U(r.sources[0].src):f==="flv"&&ve.isSupported()&&await K(r.sources[0].src),v.value=f}catch(I){console.error("源切换失败:",I)}},U=async r=>new Promise(f=>{d.value=new re,d.value.loadSource(r),d.value.attachMedia(o.value.media),d.value.on(re.Events.MANIFEST_PARSED,f)}),K=async r=>{_.value=ve.createPlayer({type:"flv",url:r}),_.value.attachMediaElement(o.value.media),_.value.load(),await _.value.play()},O=k(!1);return{player:o,initPlayer:j,switchSource:H,playStream:E,title:p,data:a,autoPlay:O,jumpTo:r=>{const f=X(r);if(o.value&&f>0)try{o.value.currentTime=f,O.value?o.value.play():o.value.pause()}catch(h){q(h,"跳转播放失败，请检查播放器状态")}}}}),Ve={class:"video-wrapper"},Re={class:"title"},Ke={class:"plyr-container"},Ne={__name:"Player",setup(p){const o=Z(),d=k(null);return ie(()=>{o.initPlayer(d.value)}),(_,a)=>(R(),Y("div",Ve,[z("h3",Re,A(u(o).title),1),z("div",Ke,[z("video",{class:"player",ref_key:"videoRef",ref:d,playsinline:""},null,512)])]))}},pe=me("editor",()=>{const p=k(!1),o=k(!1),d=k(""),_=k(null),a=5e3,v=k(a),j=r=>{o.value=!0,_.value=r,d.value=r.date,g()},E=k([]),V=r=>{try{const[f,h]=r.split("."),[S,M,I]=f.split(":").map(Number);return S*3600+M*60+I}catch(f){console.error(f)}},H=k(new Map),U=()=>{H.value.clear(),E.value.forEach((r,f)=>{try{const h=V(r.time);H.value.has(h)||H.value.set(h,f)}catch(h){console.error(`错误处理时间戳 ${r.time}（索引 ${f}）: ${h}`)}})},K=r=>{if(!E.value)return;const f=v.value+r;v.value=Math.max(f,0);const h=r/1e3;E.value=E.value.map(S=>{const I=X(S.time)+h;return{...S,time:L(Math.max(I,0))}}),U()},O=()=>{if(!E.value)return;const f=(v.value-a)/1e3;E.value=E.value.map(h=>{const M=X(h.time)-f;return{...h,time:L(Math.max(M,0))}}),v.value=a,U()},g=async()=>{var r;p.value=!0;try{const f=await fetch(`srts/${(r=_.value)==null?void 0:r.id}`);if(!f.ok)throw new Error(`HTTP error! status: ${f.status}`);E.value=await f.json();const h=v.value/1e3;E.value=E.value.map(S=>{const I=X(S.time)+h;return{...S,time:L(Math.max(I,0))}}),U()}catch(f){console.error("数据获取失败:",f),q(f,"字幕数据加载失败，请稍后重试"),E.value=[]}finally{p.value=!1}};return{open:o,title:d,edit:j,data:_,timelineData:E,loading:p,shiftCount:v,shiftSubtitles:K,timeToSeconds:X,secondsToTime:L,resetSubtitles:O,timeMap:H,timeToKey:V}}),Ae=["onClick"],Fe=["onClick"],Be={style:{display:"flex",gap:"0","justify-content":"flex-end"}},qe=ce({__name:"Playlist",setup(p){const o=Z(),d=pe(),_=k(""),a=k(!0),v=k([]),j=async()=>{try{const g=await fetch("video.json");if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);v.value=await g.json()}catch(g){q(g,"数据加载失败")}finally{a.value=!1}},E=ye(()=>{const g=_.value.toLowerCase();return v.value.filter(r=>r.id.toLowerCase().includes(g)||r.date.toLowerCase().includes(g))}),V=async g=>{var r;((r=g.urls)==null?void 0:r.length)>0?await U(g.urls[0],"链接已复制到剪贴板","链接复制失败"):P("该记录没有可用的链接")},H=async g=>{g.id?await U(g.id,"ID已复制到剪贴板","ID复制失败"):P("该记录没有可用的ID")},U=async(g,r,f)=>{try{await navigator.clipboard.writeText(g),J(r)}catch(h){q(h,f)}},K=g=>{var r;(r=g.urls)!=null&&r.length&&(g.urls[0],o.playStream(g),d.edit(g))},O=g=>{var r;(r=g.urls)!=null&&r.length&&(g.urls[0],o.playStream(g))};return ie(()=>{j()}),(g,r)=>{const f=b("el-table-column"),h=b("el-input"),S=b("el-button"),M=b("el-table"),I=ze("loading");return ge((R(),ue(M,{data:E.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:s(()=>[e(f,{fixed:"",label:"日期",prop:"date",sortable:"",width:"140"},{default:s(D=>[z("span",{class:"clickable-text",onClick:m=>V(D.row)},A(D.row.date),9,Ae)]),_:1}),e(f,{fixed:"",label:"标识",prop:"id",width:"180"},{default:s(D=>[z("span",{class:"clickable-text",onClick:m=>H(D.row)},A(D.row.id),9,Fe)]),_:1}),e(f,{fixed:"right",align:"right",width:"115"},{header:s(()=>[e(h,{modelValue:_.value,"onUpdate:modelValue":r[0]||(r[0]=D=>_.value=D),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:s(D=>{var m,t;return[z("div",Be,[e(S,{plain:"",size:"small",onClick:l=>K(D.row),type:D.row.hasSrt?"success":"warning",disabled:!D.row.hasSrt},{default:s(()=>r[1]||(r[1]=[x(" 编辑 ")])),_:2},1032,["onClick","type","disabled"]),e(S,{plain:"",size:"small",onClick:l=>O(D.row),type:(m=D.row.urls)!=null&&m.length?"success":"warning",disabled:!((t=D.row.urls)!=null&&t.length)},{default:s(()=>r[2]||(r[2]=[x(" 播放 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[I,a.value]])}}}),$e=me("picker",()=>{const p=k(!1),o=k(!1),d=k("");return k(null),k(0),{open:o,title:d,loading:p}}),Je={style:{display:"flex",gap:"0","justify-content":"flex-start"}},Ye={key:0,class:"loading-state"},Qe={class:"time-label"},Ge=["onClick"],We={key:1,class:"empty-state"},Xe={class:"footer-container"},Ze={class:"time-shift-controls"},et={class:"time-shift-controls"},ee=50,te=5e3,tt=ce({__name:"Editor",setup(p){const o=pe(),d=Z(),_=$e(),a=k(1e3),v=m=>{const t=a.value+m;a.value=Math.max(ee,Math.min(te,t))},j=k(["你好","晚上好","拜拜","再见"]),E=m=>j.value.some(t=>m.includes(t)),V=ye(()=>o.timelineData.map((m,t)=>({text:m.text,index:t})).filter(({text:m})=>E(m)).map(({index:m})=>m).sort((m,t)=>m-t)),H=()=>{const m=V.value;if(m.length===0){P("未找到包含关键字的字幕行");return}let t=0,l=m.length-1,n=-1;for(;t<=l;){const i=Math.floor((t+l)/2);m[i]<r.value?(n=m[i],t=i+1):l=i-1}n===-1&&(n=m[m.length-1]),h(n)},U=()=>{const m=V.value;if(m.length===0){P("未找到包含关键字的字幕行");return}let t=0,l=m.length-1,n=-1;for(;t<=l;){const i=Math.floor((t+l)/2);m[i]>r.value?(n=m[i],l=i-1):t=i+1}n===-1&&(n=m[0]),h(n)},K=k(),O=k([]),g=m=>{m instanceof HTMLElement&&O.value.push(m)},r=k(0),f=async()=>{if(!d.player)return;const m=d.player.currentTime,t=L(m),l=o.timeToKey(t),n=o.timeMap.get(l);typeof n=="number"&&n!==r.value&&(r.value=n,await De(),setTimeout(()=>h(n),50))},h=m=>{const t=K.value,l=O.value[m];if(l instanceof HTMLElement&&t){const i=l.offsetTop-t.clientHeight/2;t.scrollTo({top:i,behavior:"smooth"})}},S=k(595),M=k();let I=null;ie(()=>{M.value=document.querySelector(".grid-section.bottom"),M.value&&(I=new ResizeObserver(m=>{for(const t of m){const{height:l}=t.contentRect;S.value=l}}),I.observe(M.value)),d.player.on("timeupdate",f)}),Ee(()=>{I&&M.value&&I.unobserve(M.value),d.player.off("timeupdate",f),O.value=[]}),xe(()=>o.timelineData,()=>{O.value=[]});const D=async()=>{var m,t;try{const l=(m=d.player)==null?void 0:m.media;if(!(l instanceof HTMLVideoElement)){P("无法获取视频元素");return}const n=document.createElement("canvas");n.width=l.videoWidth,n.height=l.videoHeight;const i=n.getContext("2d");if(!i){q("无法创建画布上下文");return}i.drawImage(l,0,0,n.width,n.height);const $=n.toDataURL("image/jpeg",.9),C=document.createElement("a"),w=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);C.download=`capture_${(t=o.data)==null?void 0:t.id}_${w}.jpg`,C.href=$,document.body.appendChild(C),C.click(),document.body.removeChild(C),J("截图已保存")}catch(l){q(`截图失败: ${l instanceof Error?l.message:l}`)}};return(m,t)=>{const l=b("Expand"),n=b("el-icon"),i=b("el-button"),$=b("Top"),C=b("Bottom"),w=b("Camera"),N=b("el-text"),F=b("Minus"),B=b("el-drawer");return R(),ue(B,{modelValue:u(o).open,"onUpdate:modelValue":t[12]||(t[12]=c=>u(o).open=c),direction:"btt",modal:!1,size:S.value,onOpened:t[13]||(t[13]=c=>u(o).shiftSubtitles(0))},{header:s(()=>[z("div",Je,[e(i,{size:"small",type:u(_).open?"success":"",circle:""},{default:s(()=>[e(n,{onClick:t[0]||(t[0]=c=>u(_).open=!u(_).open)},{default:s(()=>[e(l)]),_:1})]),_:1},8,["type"]),e(i,{onClick:t[1]||(t[1]=c=>u(d).autoPlay=!u(d).autoPlay),type:u(d).autoPlay?"success":"",size:"small",circle:""},{default:s(()=>t[14]||(t[14]=[x("A")])),_:1},8,["type"]),e(i,{size:"small",circle:""},{default:s(()=>[e(n,{onClick:H},{default:s(()=>[e($)]),_:1})]),_:1}),e(i,{size:"small",circle:""},{default:s(()=>[e(n,{onClick:U},{default:s(()=>[e(C)]),_:1})]),_:1}),e(i,{size:"small",circle:""},{default:s(()=>[e(n,{onClick:D},{default:s(()=>[e(w)]),_:1})]),_:1}),e(N,{class:"mx-1",type:"warning"},{default:s(()=>{var c;return[x(A((c=u(o).data)==null?void 0:c.id),1)]}),_:1})])]),default:s(()=>[z("div",{class:"timeline-container",ref_key:"containerRef",ref:K},[u(o).loading?(R(),Y("div",Ye,[e(n,{class:"is-loading",color:"#409EFF",size:20},{default:s(()=>[e(u(Ce))]),_:1}),t[15]||(t[15]=z("span",null,"正在加载字幕数据...",-1))])):fe("",!0),(R(!0),Y(de,null,he(u(o).timelineData,(c,y)=>(R(),Y("div",{key:y,class:"timeline-item",ref_for:!0,ref:g},[z("span",Qe,A(c.time),1),z("span",{class:Me(["content-text",{highlight:y==r.value,keyword:E(c.text)}]),onClick:T=>u(d).jumpTo(c.time)},A(c.text),11,Ge)]))),128)),!u(o).loading&&u(o).timelineData.length===0?(R(),Y("div",We,[e(n,null,{default:s(()=>[e(u(Te))]),_:1}),t[16]||(t[16]=z("span",null,"暂无字幕数据",-1))])):fe("",!0)],512)]),footer:s(()=>[z("div",Xe,[z("div",Ze,[e(i,{onClick:t[2]||(t[2]=c=>v(-1e3)),disabled:a.value<=ee,size:"small"},{default:s(()=>[e(n,null,{default:s(()=>[e(u(G))]),_:1}),e(n,null,{default:s(()=>[e(u(G))]),_:1}),e(n,null,{default:s(()=>[e(u(G))]),_:1})]),_:1},8,["disabled"]),e(i,{onClick:t[3]||(t[3]=c=>v(-500)),disabled:a.value<=ee,size:"small"},{default:s(()=>[e(n,null,{default:s(()=>[e(u(G))]),_:1}),e(n,null,{default:s(()=>[e(u(G))]),_:1})]),_:1},8,["disabled"]),e(i,{onClick:t[4]||(t[4]=c=>v(-50)),disabled:a.value<=ee,size:"small"},{default:s(()=>[e(n,null,{default:s(()=>[e(u(G))]),_:1})]),_:1},8,["disabled"]),z("span",{class:"count",onClick:t[5]||(t[5]=c=>a.value=50)},A(a.value),1),e(i,{onClick:t[6]||(t[6]=c=>v(50)),disabled:a.value>=te,size:"small"},{default:s(()=>[e(n,null,{default:s(()=>[e(u(W))]),_:1})]),_:1},8,["disabled"]),e(i,{onClick:t[7]||(t[7]=c=>v(500)),disabled:a.value>=te,size:"small"},{default:s(()=>[e(n,null,{default:s(()=>[e(u(W))]),_:1}),e(n,null,{default:s(()=>[e(u(W))]),_:1})]),_:1},8,["disabled"]),e(i,{onClick:t[8]||(t[8]=c=>v(1e3)),disabled:a.value>=te,size:"small"},{default:s(()=>[e(n,null,{default:s(()=>[e(u(W))]),_:1}),e(n,null,{default:s(()=>[e(u(W))]),_:1}),e(n,null,{default:s(()=>[e(u(W))]),_:1})]),_:1},8,["disabled"])]),z("div",et,[e(i,{onClick:t[9]||(t[9]=c=>u(o).shiftSubtitles(-a.value)),disabled:u(o).shiftCount===0},{default:s(()=>[e(n,null,{default:s(()=>[e(F)]),_:1})]),_:1},8,["disabled"]),z("span",{class:"count",onClick:t[10]||(t[10]=(...c)=>u(o).resetSubtitles&&u(o).resetSubtitles(...c))},A(u(o).shiftCount),1),e(i,{onClick:t[11]||(t[11]=c=>u(o).shiftSubtitles(a.value))},{default:s(()=>[e(n,null,{default:s(()=>[e(u(be))]),_:1})]),_:1})])])]),_:1},8,["modelValue","size"])}}}),nt={class:"segment-container"},lt={class:"time-controls"},st={class:"time-controls"},ot={class:"time-controls"},at={class:"card-footer"},rt=ce({__name:"Picker",setup(p){const o=Z(),d=$e(),_=pe(),a=Pe([v()]);function v(){return{id:crypto.randomUUID(),startTime:0,endTime:0,duration:0,isK:!1}}const j=t=>{a.splice(t+1,0,v())},E=t=>{a.length>1&&a.splice(t,1)},V=t=>{if(t>0){const l=a.splice(t,1)[0];a.splice(t-1,0,l)}},H=t=>{if(t<a.length-1){const l=a.splice(t,1)[0];a.splice(t+1,0,l)}};function U(t){if(!o.player)return;const l=o.player.currentTime,n=a[t];n.startTime=l}function K(t){if(!o.player)return;const l=o.player.currentTime,n=a[t];n.endTime=l}function O(t,l){var Q;const n=a[t],i=n.isK?"-k":"";let $=(Q=o.data)==null?void 0:Q.urls[0];if(!$)throw P("请先播放视频"),new Error("请先播放视频");const C=$.match(/\/([^\/]+)\.mp4$/),w=C?C[1]:(()=>{const ae=new Date;return`${ae.getFullYear()}${(ae.getMonth()+1).toString().padStart(2,"0")}${ae.getDate().toString().padStart(2,"0")}`})();if(!n.startTime||!n.endTime)throw P("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const N=L(n.startTime),F=L(n.endTime),B=N.replace(/:/g,"."),c=F.replace(/:/g,".");let y="yt-dlp --no-check-certificate";y=`${y} --download-sections "*${N}-${F}"`,y=`${y} --force-keyframes-at-cuts`;const T="~/storage/downloads/Reqable/";return l=="video"&&(y=`${y} --merge-output-format mp4 -o "${T}${w}_${B}-${c}.mp4"`),l=="audio"&&(y=`${y} ${i} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${T}${w}_${B}-${c}.mp3"`),y=`${y} '${$}' `,y}function g(t,l){var T;const n=a[t],i=n.isK?"-k":"";let $=(T=o.data)==null?void 0:T.urls[0];if(!$)throw P("请先播放视频"),new Error("请先播放视频");const C=$.match(/\/([^\/]+)\.mp4$/),w=C?C[1]:(()=>{const Q=new Date;return`${Q.getFullYear()}${(Q.getMonth()+1).toString().padStart(2,"0")}${Q.getDate().toString().padStart(2,"0")}`})();if(!n.startTime||!n.endTime)throw P("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const N=L(n.startTime),F=L(n.endTime),B=N.replace(/:/g,"."),c=F.replace(/:/g,".");let y=`--download-sections "*${N}-${F}"`;return l=="video"&&(y=`${y} --merge-output-format mp4 -o "${w}_${B}-${c}.mp4"`),l=="audio"&&(y=`${y} ${i} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${w}_${B}-${c}.mp3"`),y}async function r(){var l;const t=(l=o.data)==null?void 0:l.urls[0];if(!t){P("请先播放视频");return}try{await navigator.clipboard.writeText(t),J(`链接已复制：${t}`)}catch(n){console.error(n),P("复制失败，请手动复制")}}async function f(){var l;const t=(l=o.data)==null?void 0:l.id;if(!t){P("请先播放视频");return}try{await navigator.clipboard.writeText(t),J(`ID已复制：${t}`)}catch(n){console.error(n),P("ID失败，请手动复制")}}async function h(t,l,n){let i="";switch(l){case"dlp":i=O(t,n);break;case"seal":i=g(t,n);break}try{await navigator.clipboard.writeText(i),J(`命令已复制：${i}`)}catch($){console.error($),P("复制失败，请手动复制")}}const S=async t=>{const l=[];a.forEach((n,i)=>{console.log(`Index: ${i}`,n),l.push(O(i,t))});try{await navigator.clipboard.writeText(l.join(`
`)),J(`命令已复制：${l.join("<br/>")}`)}catch(n){console.error(n),P("复制失败，请手动复制")}},M=k(!1);async function I(){var C;let t=(C=o.data)==null?void 0:C.urls[0];if(!t){P("请先播放视频");return}const l=t.match(/\/([^\/]+)\.mp4$/),n=l?l[1]:(()=>{const w=new Date;return`${w.getFullYear()}${(w.getMonth()+1).toString().padStart(2,"0")}${w.getDate().toString().padStart(2,"0")}`})(),i=a.filter(w=>w.startTime<w.endTime).map((w,N)=>`${L(w.startTime)}-${L(w.endTime)}`);if(!i.length){P("请先至少设置一个开始和结束时间");return}const $=`dlp ${M.value?"keep":"delete"} '${t}' ${n} ${i.join(" ")}`;try{D($),await navigator.clipboard.writeText($),J(`命令已复制：${$}`)}catch(w){console.error(w),q(w,"复制失败，请手动复制")}}async function D(t){try{const l=await fetch("http://localhost:8080/run",{method:"POST",headers:{"Content-Type":"text/plain"},body:t});if(!l.ok)throw new Error(`HTTP 错误: ${l.status}`);const i=(await l.json()).task_id;m(i)}catch(l){q(l,"请求失败: ")}}function m(t){const l=setInterval(async()=>{var n;try{const i=await fetch(`http://localhost:8080/progress/${t}`);if(!i.ok)throw new Error(`进度查询失败: ${i.status}`);const $=await i.json(),C=(n=$.recent_log)!=null&&n.length?`

最近日志:
`+$.recent_log.join(`
`):"";Ue(C),$.status==="completed"&&(clearInterval(l),J(`处理完成✅ (状态: ${$.status})${C}`)),$.status==="failed"&&(clearInterval(l),P(`处理完成✅ (状态: ${$.status})${C}`))}catch(i){clearInterval(l),q(i,"监控失败: ")}},1e3)}return(t,l)=>{const n=b("el-button"),i=b("el-input"),$=b("el-icon"),C=b("CaretLeft"),w=b("CaretRight"),N=b("Minus"),F=b("Plus"),B=b("el-card");return ge((R(),ue(B,{class:"segment-control-card"},{footer:s(()=>[z("div",at,[e(n,{size:"small",onClick:r},{default:s(()=>l[11]||(l[11]=[x("复制链接")])),_:1}),e(n,{size:"small",onClick:f},{default:s(()=>l[12]||(l[12]=[x("复制ID")])),_:1}),e(n,{size:"small",onClick:I},{default:s(()=>l[13]||(l[13]=[x("下载片段")])),_:1}),e(n,{size:"small",onClick:l[0]||(l[0]=c=>S("video"))},{default:s(()=>l[14]||(l[14]=[x("复制命令")])),_:1})])]),default:s(()=>[z("div",nt,[(R(!0),Y(de,null,he(a,(c,y)=>(R(),Y("div",{key:c.id,class:"segment-item"},[z("div",lt,[e(n,{type:"primary",size:"small",onClick:T=>h(y,"seal","audio")},{default:s(()=>l[1]||(l[1]=[x("SA")])),_:2},1032,["onClick"]),e(n,{type:"primary",size:"small",onClick:T=>h(y,"seal","video")},{default:s(()=>l[2]||(l[2]=[x("SV")])),_:2},1032,["onClick"]),e(n,{type:"primary",size:"small",onClick:T=>h(y,"dlp","audio")},{default:s(()=>l[3]||(l[3]=[x("DA")])),_:2},1032,["onClick"]),e(n,{type:"primary",size:"small",onClick:T=>h(y,"dlp","video")},{default:s(()=>l[4]||(l[4]=[x("DV")])),_:2},1032,["onClick"]),e(i,{"model-value":u(_).secondsToTime(c.endTime-c.startTime),size:"small",readonly:""},null,8,["model-value"]),e(n,{size:"small",type:c.isK?"success":"info",onClick:T=>c.isK=!c.isK},{default:s(()=>[x(A(c.isK?"-k开":"-k关"),1)]),_:2},1032,["type","onClick"]),e(n,{size:"small",circle:"",type:"success"},{default:s(()=>[e($,null,{default:s(()=>[x(A(y+1),1)]),_:2},1024)]),_:2},1024)]),z("div",st,[e(n,{type:"success",size:"small",onClick:T=>U(y)},{default:s(()=>l[5]||(l[5]=[x("S")])),_:2},1032,["onClick"]),e(n,{type:"success",size:"small",onClick:T=>u(o).jumpTo(u(L)(c.startTime))},{default:s(()=>l[6]||(l[6]=[x("J")])),_:2},1032,["onClick"]),e(n,{type:"success",size:"small",onClick:T=>c.startTime=c.startTime-.5},{default:s(()=>[e($,null,{default:s(()=>[e(C)]),_:1})]),_:2},1032,["onClick"]),e(n,{type:"success",size:"small",onClick:T=>c.startTime=c.startTime+.5},{default:s(()=>[e($,null,{default:s(()=>[e(w)]),_:1})]),_:2},1032,["onClick"]),e(i,{"model-value":u(L)(c.startTime),size:"small",readonly:""},null,8,["model-value"]),e(n,{size:"small",onClick:T=>V(y),disabled:y===0||a.length===1},{default:s(()=>l[7]||(l[7]=[x("↑")])),_:2},1032,["onClick","disabled"]),e(n,{size:"small",onClick:T=>E(y),disabled:a.length===1},{default:s(()=>[e($,null,{default:s(()=>[e(N)]),_:1})]),_:2},1032,["onClick","disabled"])]),z("div",ot,[e(n,{type:"danger",size:"small",onClick:T=>K(y)},{default:s(()=>l[8]||(l[8]=[x("E")])),_:2},1032,["onClick"]),e(n,{type:"danger",size:"small",onClick:T=>u(o).jumpTo(u(L)(c.endTime))},{default:s(()=>l[9]||(l[9]=[x("J")])),_:2},1032,["onClick"]),e(n,{type:"danger",size:"small",onClick:T=>c.endTime=c.endTime-.5},{default:s(()=>[e($,null,{default:s(()=>[e(C)]),_:1})]),_:2},1032,["onClick"]),e(n,{type:"danger",size:"small",onClick:T=>c.endTime=c.endTime+.5},{default:s(()=>[e($,null,{default:s(()=>[e(w)]),_:1})]),_:2},1032,["onClick"]),e(i,{type:"danger","model-value":u(L)(c.endTime),size:"small",readonly:""},null,8,["model-value"]),e(n,{size:"small",onClick:T=>H(y),disabled:y===a.length-1||a.length===1},{default:s(()=>l[10]||(l[10]=[x("↓")])),_:2},1032,["onClick","disabled"]),e(n,{size:"small",onClick:T=>j(y)},{default:s(()=>[e($,null,{default:s(()=>[e(F)]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1},512)),[[Ie,u(d).open]])}}}),ke=(p,o)=>{const d=p.__vccOpts||p;for(const[_,a]of o)d[_]=a;return d},_e=ke(rt,[["__scopeId","data-v-cc931b1d"]]),it={__name:"App",setup(p){return Z(),(o,d)=>{const _=b("el-col"),a=b("el-row"),v=b("el-container");return R(),Y(de,null,[e(_e),e(v,{style:{height:"100vh"}},{default:s(()=>[e(a,{class:"grid-container"},{default:s(()=>[e(_,{class:"grid-section top"},{default:s(()=>[e(Ne)]),_:1}),e(_,{class:"grid-section bottom"},{default:s(()=>[e(qe),e(tt),e(_e)]),_:1})]),_:1})]),_:1})],64)}}},ct=ke(it,[["__scopeId","data-v-d44e3bc6"]]),oe=je(ct);oe.use(Le());oe.use(we);for(const[p,o]of Object.entries(Se))oe.component(p,o);oe.mount("#app");
