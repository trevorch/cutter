import{E as de,i as xe}from"./element-plus-DRLPWQh5.js";import{B as ze,l as Ee,w as Pe,Q as Me,R as De,S as Ie}from"./@element-plus-Dp6MuveI.js";import{r as y,j as pe,c as Z,o as G,a as D,M as Q,u as g,d as me,k as be,ag as z,aq as je,I as ue,G as Ce,H as s,P as t,L as M,S as Le,w as Ve,J as $e,O as se,a6 as Te,D as Oe,n as Ue,X as He,Q as he,at as Ke}from"./@vue-C01xNfPK.js";import{d as fe,c as Re}from"./pinia-CKuVeK4o.js";import{P as Ne}from"./plyr-CZIZ1zVJ.js";import{H as ie}from"./hls.js-DWnTp5j0.js";import{f as ke}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))_(a);new MutationObserver(a=>{for(const $ of a)if($.type==="childList")for(const I of $.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&_(I)}).observe(document,{childList:!0,subtree:!0});function i(a){const $={};return a.integrity&&($.integrity=a.integrity),a.referrerPolicy&&($.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?$.credentials="include":a.crossOrigin==="anonymous"?$.credentials="omit":$.credentials="same-origin",$}function _(a){if(a.ep)return;a.ep=!0;const $=i(a);fetch(a.href,$)}})();function Ae(m,n="未知错误"){if(m instanceof Error)return m.message;if(typeof m=="string")return m;if(typeof m=="object"&&m!==null&&"message"in m&&typeof m.message=="string")return m.message;try{return JSON.stringify(m)}catch{return n}}const ve={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},ye=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function te(m,n){const i=Ae(m),_=n?`${n}: ${i}`:i;de.error({...ve,message:`
    <div ${ye}>
      ${_}
    </div>
    `})}function H(m){de.error({...ve,message:`
    <div ${ye}>
      ${m}
    </div>
    `})}function ee(m){de.success({...ve,message:`
    <div ${ye}>
      ${m}
    </div>
    `})}const ne=m=>{try{const[n,i]=m.split("."),[_,a,$]=n.split(":").map(Number),I=i?parseInt(i.padEnd(3,"0")):0;return _*3600+a*60+$+I/1e3}catch{return 0}},K=m=>{const n=Math.round(m%1*1e3),i=Math.floor(m),_=Math.floor(i/3600),a=Math.floor(i%3600/60),$=i%60;return`${String(_).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String($).padStart(2,"0")}.${String(n).padStart(3,"0")}`},le=fe("player",()=>{const m=y(""),n=y(null),i=y(null),_=y(null),a=y(null),$=y(null),I=r=>{n.value=new Ne(r,{hideControls:!1,controls:["play","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},E=r=>{a.value=r,m.value=r.date;const v=r.urls[0],f={type:"video",sources:[{src:v,type:B(v)}]};R(f).then(()=>{var k;return(k=n.value)==null?void 0:k.play()})},B=r=>r.includes(".m3u8")?"application/x-mpegURL":r.includes(".flv")?"video/x-flv":"video/mp4",R=async r=>{var f,k,V;(f=i.value)==null||f.destroy(),i.value=null,(k=_.value)==null||k.destroy(),_.value=null;const v=r.sources[0].src.includes(".m3u8")?"hls":r.sources[0].src.includes(".flv")?"flv":"html5";try{v!==$.value&&await((V=n.value)==null?void 0:V.stop()),n.value.source=r,v==="hls"&&ie.isSupported()?await A(r.sources[0].src):v==="flv"&&ke.isSupported()&&await W(r.sources[0].src),$.value=v}catch(N){console.error("源切换失败:",N)}},A=async r=>new Promise(v=>{i.value=new ie,i.value.loadSource(r),i.value.attachMedia(n.value.media),i.value.on(ie.Events.MANIFEST_PARSED,v)}),W=async r=>{_.value=ke.createPlayer({type:"flv",url:r}),_.value.attachMediaElement(n.value.media),_.value.load(),await _.value.play()},q=y(!1);return{player:n,initPlayer:I,switchSource:R,playStream:E,title:m,data:a,autoPlay:q,jumpTo:r=>{const v=ne(r);if(n.value&&v>0)try{n.value.currentTime=v,q.value?n.value.play():n.value.pause()}catch(f){te(f,"跳转播放失败，请检查播放器状态")}}}}),Fe={class:"video-wrapper"},Be={class:"title"},qe={class:"plyr-container"},Je={__name:"Player",setup(m){const n=le(),i=y(null);return pe(()=>{n.initPlayer(i.value)}),(_,a)=>(G(),Z("div",Fe,[D("h3",Be,Q(g(n).title),1),D("div",qe,[D("video",{class:"player",ref_key:"videoRef",ref:i,playsinline:""},null,512)])]))}},ge=fe("editor",()=>{const m=y(!1),n=y(!1),i=y(""),_=y(null),a=5e3,$=y(a),I=v=>{n.value=!0,_.value=v,i.value=v.date,h()},E=y([]),B=v=>{try{const[f,k]=v.split("."),[V,N,w]=f.split(":").map(Number);return V*3600+N*60+w}catch(f){console.error(f)}},R=y(new Map),A=()=>{R.value.clear(),E.value.forEach((v,f)=>{try{const k=B(v.time);R.value.has(k)||R.value.set(k,f)}catch(k){console.error(`错误处理时间戳 ${v.time}（索引 ${f}）: ${k}`)}})},W=v=>{if(!E.value)return;const f=$.value+v;$.value=Math.max(f,0);const k=v/1e3;E.value=E.value.map(V=>{const w=ne(V.time)+k;return{...V,time:K(Math.max(w,0))}}),A()},q=()=>{if(!E.value)return;const f=($.value-a)/1e3;E.value=E.value.map(k=>{const N=ne(k.time)-f;return{...k,time:K(Math.max(N,0))}}),$.value=a,A()},h=async()=>{var v;m.value=!0;try{const f=await fetch(`srts/${(v=_.value)==null?void 0:v.id}`);if(!f.ok)throw new Error(`HTTP error! status: ${f.status}`);E.value=await f.json();const k=$.value/1e3;E.value=E.value.map(V=>{const w=ne(V.time)+k;return{...V,time:K(Math.max(w,0))}}),A()}catch(f){console.error("数据获取失败:",f),te(f,"字幕数据加载失败，请稍后重试"),E.value=[]}finally{m.value=!1}};return{open:n,title:i,edit:I,data:_,timelineData:E,loading:m,shiftCount:$,shiftSubtitles:W,timeToSeconds:ne,secondsToTime:K,resetSubtitles:q,timeMap:R,timeToKey:B,getSubtitles:(v,f)=>{var p;const k=y([]);if(!((p=E.value)!=null&&p.length))return console.error("时间轴数据未加载"),k;const V=B(K(v)),N=B(K(f)),w=R.value.get(V),O=R.value.get(N);if(typeof w!="number"||typeof O!="number")return console.error("无法匹配有效的时间段"),k;const J=Math.max(0,w),u=Math.min(E.value.length-1,O),[l,b]=J<=u?[J,u]:[u,J];return k.value=E.value.slice(l,b+1),k}}}),Ye=["onClick"],Qe=["onClick"],Ge={style:{display:"flex",gap:"0","justify-content":"flex-end"}},We=me({__name:"Playlist",setup(m){const n=le(),i=ge(),_=y(""),a=y(!0),$=y([]),I=async()=>{try{const h=await fetch("video.json");if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);$.value=await h.json()}catch(h){te(h,"数据加载失败")}finally{a.value=!1}},E=be(()=>{const h=_.value.toLowerCase();return $.value.filter(r=>r.id.toLowerCase().includes(h)||r.date.toLowerCase().includes(h))}),B=async h=>{var r;((r=h.urls)==null?void 0:r.length)>0?await A(h.urls[0],"链接已复制到剪贴板","链接复制失败"):H("该记录没有可用的链接")},R=async h=>{h.id?await A(h.id,"ID已复制到剪贴板","ID复制失败"):H("该记录没有可用的ID")},A=async(h,r,v)=>{try{await navigator.clipboard.writeText(h),ee(r)}catch(f){te(f,v)}},W=h=>{var r;(r=h.urls)!=null&&r.length&&(h.urls[0],n.playStream(h),i.edit(h))},q=h=>{var r;(r=h.urls)!=null&&r.length&&(h.urls[0],n.playStream(h))};return pe(()=>{I()}),(h,r)=>{const v=z("el-table-column"),f=z("el-input"),k=z("el-button"),V=z("el-table"),N=je("loading");return ue((G(),Ce(V,{data:E.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:s(()=>[t(v,{fixed:"",label:"日期",prop:"date",sortable:"",width:"140"},{default:s(w=>[D("span",{class:"clickable-text",onClick:O=>B(w.row)},Q(w.row.date),9,Ye)]),_:1}),t(v,{fixed:"",label:"标识",prop:"id",width:"180"},{default:s(w=>[D("span",{class:"clickable-text",onClick:O=>R(w.row)},Q(w.row.id),9,Qe)]),_:1}),t(v,{fixed:"right",align:"right",width:"115"},{header:s(()=>[t(f,{modelValue:_.value,"onUpdate:modelValue":r[0]||(r[0]=w=>_.value=w),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:s(w=>{var O,J;return[D("div",Ge,[t(k,{plain:"",size:"small",onClick:u=>W(w.row),type:w.row.hasSrt?"success":"warning",disabled:!w.row.hasSrt},{default:s(()=>r[1]||(r[1]=[M(" 切片 ")])),_:2},1032,["onClick","type","disabled"]),t(k,{plain:"",size:"small",onClick:u=>q(w.row),type:(O=w.row.urls)!=null&&O.length?"success":"warning",disabled:!((J=w.row.urls)!=null&&J.length)},{default:s(()=>r[2]||(r[2]=[M(" 播放 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[N,a.value]])}}}),_e=(m,n)=>{const i=m.__vccOpts||m;for(const[_,a]of n)i[_]=a;return i},Xe=_e(We,[["__scopeId","data-v-27e0b204"]]),Se=fe("picker",()=>{const m=y(!1),n=y(!1),i=y("");return y(null),y(0),{open:n,title:i,loading:m}}),Ze={style:{display:"flex",gap:"0","justify-content":"flex-start"}},et={key:0,class:"loading-state"},tt={class:"srt-time"},nt=["onClick"],lt={key:1,class:"empty-state"},st={class:"footer-container"},ot={class:"time-shift-controls"},at={class:"time-shift-controls"},it={class:"time-shift-controls"},re=100,ce=5e3,rt=me({__name:"Editor",setup(m){const n=ge(),i=le(),_=Se(),a=y(!1),$=()=>{i.player&&(i.player.playing?i.player.pause():i.player.play())},I=y(1e3),E=u=>{const l=I.value+u;I.value=Math.max(re,Math.min(ce,l))},B=y(["你好","晚上好","拜拜","再见"]),R=u=>B.value.some(l=>u.includes(l)),A=be(()=>n.timelineData.map((u,l)=>({text:u.text,index:l})).filter(({text:u})=>R(u)).map(({index:u})=>u).sort((u,l)=>u-l)),W=()=>{const u=A.value;if(u.length===0){H("未找到包含关键字的字幕行");return}let l=0,b=u.length-1,p=-1;for(;l<=b;){const S=Math.floor((l+b)/2);u[S]<f.value?(p=u[S],l=S+1):b=S-1}p===-1&&(p=u[u.length-1]),V(p)},q=()=>{const u=A.value;if(u.length===0){H("未找到包含关键字的字幕行");return}let l=0,b=u.length-1,p=-1;for(;l<=b;){const S=Math.floor((l+b)/2);u[S]>f.value?(p=u[S],b=S-1):l=S+1}p===-1&&(p=u[0]),V(p)},h=y(),r=y([]),v=u=>{u instanceof HTMLElement&&r.value.push(u)},f=y(0),k=async u=>{const l=K(u),b=n.timeToKey(l),p=n.timeMap.get(b);typeof p=="number"&&p!==f.value&&(f.value=p,await Ue(),setTimeout(()=>V(p),50))},V=u=>{const l=h.value,b=r.value[u];if(b instanceof HTMLElement&&l){const S=b.offsetTop-l.clientHeight/2;l.scrollTo({top:S,behavior:"smooth"})}},N=y(595),w=y();let O=null;pe(()=>{w.value=document.querySelector(".grid-section.bottom"),w.value&&(O=new ResizeObserver(u=>{for(const l of u){const{height:b}=l.contentRect;N.value=b}}),O.observe(w.value)),i.player.on("timeupdate",()=>{k(i.player.currentTime)}),i.player.on("play",()=>{a.value=!0}),i.player.on("pause",()=>{a.value=!1})}),Le(()=>{O&&w.value&&O.unobserve(w.value),i.player.off("timeupdate",k),r.value=[]}),Ve(()=>n.timelineData,()=>{r.value=[]});const J=async()=>{var u,l;try{const b=(u=i.player)==null?void 0:u.media;if(!(b instanceof HTMLVideoElement)){H("无法获取视频元素");return}const p=document.createElement("canvas");p.width=b.videoWidth,p.height=b.videoHeight;const S=p.getContext("2d");if(!S){te("无法创建画布上下文");return}S.drawImage(b,0,0,p.width,p.height);const c=p.toDataURL("image/jpeg",.9),e=document.createElement("a"),o=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);e.download=`capture_${(l=n.data)==null?void 0:l.id}_${o}.jpg`,e.href=c,document.body.appendChild(e),e.click(),document.body.removeChild(e),ee("截图已保存")}catch(b){te(`截图失败: ${b instanceof Error?b.message:b}`)}};return(u,l)=>{const b=z("Camera"),p=z("el-icon"),S=z("el-button"),c=z("el-text"),e=z("Top"),o=z("Bottom"),C=z("el-space"),P=z("el-affix"),x=z("Expand"),L=z("Minus"),Y=z("el-drawer");return G(),Ce(Y,{modelValue:g(n).open,"onUpdate:modelValue":l[10]||(l[10]=T=>g(n).open=T),direction:"btt",modal:!1,size:N.value,onOpened:l[11]||(l[11]=T=>g(n).shiftSubtitles(0))},{header:s(()=>[D("div",Ze,[t(S,{onClick:J,size:"small",circle:""},{default:s(()=>[t(p,null,{default:s(()=>[t(b)]),_:1})]),_:1}),t(c,{class:"mx-1",type:"warning"},{default:s(()=>{var T,F;return[M(Q((T=g(n).data)==null?void 0:T.date)+" - "+Q((F=g(n).data)==null?void 0:F.id),1)]}),_:1})])]),default:s(()=>[D("div",{class:"timeline-container",ref_key:"containerRef",ref:h},[g(n).loading?(G(),Z("div",et,[t(p,{class:"is-loading",color:"#409EFF",size:20},{default:s(()=>[t(g(Ee))]),_:1}),l[12]||(l[12]=D("span",null,"正在加载字幕数据...",-1))])):$e("",!0),(G(!0),Z(se,null,Te(g(n).timelineData,(T,F)=>(G(),Z("div",{key:F,class:"timeline-item",ref_for:!0,ref:v},[D("span",tt,Q(T.time),1),D("span",{class:Oe(["srt-text",{highlight:F==f.value,keyword:R(T.text)}]),onClick:X=>{k(g(ne)(T.time)),g(i).jumpTo(T.time)}},Q(T.text),11,nt)]))),128)),!g(n).loading&&g(n).timelineData.length===0?(G(),Z("div",lt,[t(p,null,{default:s(()=>[t(g(Pe))]),_:1}),l[13]||(l[13]=D("span",null,"暂无字幕数据",-1))])):$e("",!0)],512),t(P,{class:"floating-btn",position:"bottom",offset:200},{default:s(()=>[t(C,{direction:"vertical"},{default:s(()=>[t(S,{onClick:l[0]||(l[0]=T=>g(i).autoPlay=!g(i).autoPlay),type:g(i).autoPlay?"success":""},{default:s(()=>[t(p,null,{default:s(()=>l[14]||(l[14]=[M("A")])),_:1})]),_:1},8,["type"]),t(S,{onClick:W},{default:s(()=>[t(p,null,{default:s(()=>[t(e)]),_:1})]),_:1}),t(S,{onClick:q},{default:s(()=>[t(p,null,{default:s(()=>[t(o)]),_:1})]),_:1}),t(S,{onClick:$,icon:a.value?g(Me):g(De)},null,8,["icon"])]),_:1})]),_:1})]),footer:s(()=>[D("div",st,[D("div",ot,[t(S,{size:"small",type:g(_).open?"success":""},{default:s(()=>[t(p,{onClick:l[1]||(l[1]=T=>g(_).open=!g(_).open)},{default:s(()=>[t(x)]),_:1})]),_:1},8,["type"])]),D("div",at,[t(S,{plain:"",type:"danger",onClick:l[2]||(l[2]=T=>E(-1e3)),disabled:I.value<=re,size:"small"},{default:s(()=>l[15]||(l[15]=[M(" <<1000 ")])),_:1},8,["disabled"]),t(S,{plain:"",type:"danger",onClick:l[3]||(l[3]=T=>E(-100)),disabled:I.value<=re,size:"small"},{default:s(()=>l[16]||(l[16]=[M(" <100 ")])),_:1},8,["disabled"]),D("span",{class:"count",onClick:l[4]||(l[4]=T=>I.value=1e3)},Q(I.value),1),t(S,{plain:"",type:"success",onClick:l[5]||(l[5]=T=>E(100)),disabled:I.value>=ce,size:"small"},{default:s(()=>l[17]||(l[17]=[M(" 100> ")])),_:1},8,["disabled"]),t(S,{plain:"",type:"success",onClick:l[6]||(l[6]=T=>E(1e3)),disabled:I.value>=ce,size:"small"},{default:s(()=>l[18]||(l[18]=[M(" 1000>> ")])),_:1},8,["disabled"])]),D("div",it,[t(S,{onClick:l[7]||(l[7]=T=>g(n).shiftSubtitles(-I.value)),disabled:g(n).shiftCount===0,size:"small"},{default:s(()=>[t(p,null,{default:s(()=>[t(L)]),_:1})]),_:1},8,["disabled"]),D("span",{class:"count",onClick:l[8]||(l[8]=(...T)=>g(n).resetSubtitles&&g(n).resetSubtitles(...T))},Q(g(n).shiftCount),1),t(S,{onClick:l[9]||(l[9]=T=>g(n).shiftSubtitles(I.value)),size:"small"},{default:s(()=>[t(p,null,{default:s(()=>[t(g(ze))]),_:1})]),_:1})])])]),_:1},8,["modelValue","size"])}}}),ct={class:"prompt-controls",style:{display:"flex",gap:"5px",margin:"5px","align-items":"center"}},ut={class:"segment-container"},dt={class:"time-controls"},pt={class:"time-controls"},mt={class:"time-controls"},ft={class:"card-footer"},vt=`
总结上面的对话内容，并参考下面的标题，为上面的对话内容起一个吸睛接地气的标题，同时给出建议标签，标签要每行一个，标题和标签要方便复制：
1、心智阳光健康，本科大二学生，聊天很是投缘，大冰不舍挂断
2、人为什么需要亲密关系？大冰深度分析，看完人都通透了
3、主动要礼物！聊天高端局，“泄露天机”太多，大冰“索要”礼物
4、如何把事情处理得圆润得体？大冰深度教学，家庭职场都受用
5、情侣裂痕是如何产生的？大冰深度分析，值得反复观看
6、光长年龄不长心智是一种什么体验？大冰对话32岁女画师，表现惊掉你下巴
7、颠覆你的认知：如何炼成顶级倾听力？大冰独家分享！带你突破沟通瓶颈！
8、如何把握相处的底层逻辑？大冰深度分析，职场婚姻都受用
9、精神未断奶是一种什么体验？大冰对话女硕士，思维表现大跌眼镜
10、如何克服自我否定的毛病？大冰深度教学，看完终身受益
`,yt=`
从上面的对话提取有关_P_方面的内容，并给出出现的开始时间
`,gt=me({__name:"Picker",setup(m){const n=le(),i=Se(),_=ge(),a=He([$()]);function $(){return{id:crypto.randomUUID(),startTime:0,endTime:0,duration:0,isK:!1}}const I=c=>{a.splice(c+1,0,$())},E=c=>{a.length>1&&a.splice(c,1)},B=c=>{if(c>0){const e=a.splice(c,1)[0];a.splice(c-1,0,e)}},R=c=>{if(c<a.length-1){const e=a.splice(c,1)[0];a.splice(c+1,0,e)}};function A(c){if(!n.player)return;const e=n.player.currentTime,o=a[c];o.startTime=e}function W(c){if(!n.player)return;const e=n.player.currentTime,o=a[c];o.endTime=e}function q(c,e){var j;const o=a[c],C=o.isK?"-k":"";let P=(j=n.data)==null?void 0:j.urls[0];if(!P)throw H("请先播放视频"),new Error("请先播放视频");const x=P.match(/\/([^\/]+)\.mp4$/),L=x?x[1]:(()=>{const ae=new Date;return`${ae.getFullYear()}${(ae.getMonth()+1).toString().padStart(2,"0")}${ae.getDate().toString().padStart(2,"0")}`})();if(!o.startTime||!o.endTime)throw H("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const Y=K(o.startTime),T=K(o.endTime),F=Y.replace(/:/g,"."),X=T.replace(/:/g,".");let d="yt-dlp --no-check-certificate";d=`${d} --concurrent-fragments 16 --throttled-rate 5M `,d=`${d} --download-sections "*${Y}-${T}"`;const U="~/storage/downloads/Reqable/";return e=="video"&&(d=`${d} --merge-output-format mp4 -o "${U}${L}_${F}-${X}.mp4"`),e=="audio"&&(d=`${d} ${C} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${U}${L}_${F}-${X}.mp3"`),d=`${d} '${P}' `,d}function h(c,e){var U;const o=a[c],C=o.isK?"-k":"";let P=(U=n.data)==null?void 0:U.urls[0];if(!P)throw H("请先播放视频"),new Error("请先播放视频");const x=P.match(/\/([^\/]+)\.mp4$/),L=x?x[1]:(()=>{const j=new Date;return`${j.getFullYear()}${(j.getMonth()+1).toString().padStart(2,"0")}${j.getDate().toString().padStart(2,"0")}`})();if(!o.startTime||!o.endTime)throw H("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const Y=K(o.startTime),T=K(o.endTime),F=Y.replace(/:/g,"."),X=T.replace(/:/g,".");let d=`--download-sections "*${Y}-${T}"`;return e=="video"&&(d=`${d} --merge-output-format mp4 -o "${L}_${F}-${X}.mp4"`),e=="audio"&&(d=`${d} ${C} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${L}_${F}-${X}.mp3"`),d}async function r(){var e;const c=(e=n.data)==null?void 0:e.urls[0];if(!c){H("请先播放视频");return}try{await navigator.clipboard.writeText(c),ee(`链接已复制：${c}`)}catch(o){console.error(o),H("复制失败，请手动复制")}}async function v(){var e;const c=(e=n.data)==null?void 0:e.id;if(!c){H("请先播放视频");return}try{await navigator.clipboard.writeText(c),ee(`ID已复制：${c}`)}catch(o){console.error(o),H("ID失败，请手动复制")}}async function f(c,e,o){let C="";switch(e){case"dlp":C=q(c,o);break;case"seal":C=h(c,o);break}try{await navigator.clipboard.writeText(C),ee(`命令已复制：${C}`)}catch(P){console.error(P),H("复制失败，请手动复制")}}const k=async c=>{const e=[];a.forEach((o,C)=>{console.log(`Index: ${C}`,o),e.push(q(C,c))});try{await navigator.clipboard.writeText(e.join(`
`)),ee(`命令已复制：${e.join("<br/>")}`)}catch(o){console.error(o),H("复制失败，请手动复制")}},V=y(!1);async function N(){var x;let c=(x=n.data)==null?void 0:x.urls[0];if(!c){H("请先播放视频");return}const e=c.match(/\/([^\/]+)\.mp4$/),o=e?e[1]:(()=>{const L=new Date;return`${L.getFullYear()}${(L.getMonth()+1).toString().padStart(2,"0")}${L.getDate().toString().padStart(2,"0")}`})(),C=a.filter(L=>L.startTime<L.endTime).map((L,Y)=>`${K(L.startTime)}-${K(L.endTime)}`);if(!C.length){H("请先至少设置一个开始和结束时间");return}const P=`dlp ${V.value?"keep":"delete"} '${c}' ${o} ${C.join(" ")}`;try{w(P),await navigator.clipboard.writeText(P),ee(`命令已复制：${P}`)}catch(L){console.error(L),te(L,"复制失败，请手动复制")}}async function w(c){try{const e=await fetch("http://localhost:8080/run",{method:"POST",headers:{"Content-Type":"text/plain"},body:c});if(!e.ok)throw new Error(`HTTP 错误: ${e.status}`);const C=(await e.json()).task_id;u(C)}catch(e){te(e,"请求失败: ")}}const O=y(!1),J=y("");function u(c){O.value=!0;const e=setInterval(async()=>{var C;let o="";try{const P=await fetch(`http://localhost:8080/progress/${c}`);if(!P.ok)throw new Error(`进度查询失败: ${P.status}`);const x=await P.json();o=(C=x.recent_log)!=null&&C.length?`

最近日志:
`+x.recent_log.join(`
`):"",x.status==="completed"&&(clearInterval(e),o=`处理完成✅ (状态: ${x.status})${o}`),x.status==="failed"&&(clearInterval(e),o=`处理完成✅ (状态: ${x.status})${o}`)}catch{clearInterval(e),o="监控失败: "}J.value=o},1e3)}const l=y(!1),b=y("情感"),p=y(!1);async function S(c,e){const o=_.getSubtitles(c,e);let C="";o.value.map(P=>{const x=P.time.split(".")[0]+" "+P.text+`
`;C+=x}),C+=l.value?vt:p.value?yt.replace("_P_",b.value):"";try{await navigator.clipboard.writeText(C),ee(`${o.value.length}条字幕已复制`)}catch(P){console.error(P),H("复制失败，请手动复制")}}return(c,e)=>{const o=z("el-button"),C=z("el-input"),P=z("DocumentCopy"),x=z("el-icon"),L=z("CaretLeft"),Y=z("CaretRight"),T=z("Plus"),F=z("Minus"),X=z("el-card");return G(),Z(se,null,[ue(t(X,{class:"segment-control-card"},{footer:s(()=>[D("div",ft,[t(o,{plain:"",type:"success",size:"small",onClick:r},{default:s(()=>e[17]||(e[17]=[M("复制链接")])),_:1}),t(o,{plain:"",type:"success",size:"small",onClick:v},{default:s(()=>e[18]||(e[18]=[M("复制ID")])),_:1}),t(o,{plain:"",type:"success",size:"small",onClick:N},{default:s(()=>e[19]||(e[19]=[M("下载片段")])),_:1}),t(o,{plain:"",type:O.value?"warning":"primary",size:"small",onClick:e[3]||(e[3]=d=>O.value=!O.value)},{default:s(()=>e[20]||(e[20]=[M("显示日志")])),_:1},8,["type"]),t(o,{plain:"",type:"success",size:"small",onClick:e[4]||(e[4]=d=>k("video"))},{default:s(()=>e[21]||(e[21]=[M("复制命令")])),_:1})])]),default:s(()=>[D("div",ct,[t(o,{size:"small",type:l.value?"success":"info",onClick:e[0]||(e[0]=d=>{p.value=!1,l.value=!l.value})},{default:s(()=>e[5]||(e[5]=[M("取标题")])),_:1},8,["type"]),t(o,{size:"small",type:p.value?"success":"info",onClick:e[1]||(e[1]=d=>{l.value=!1,p.value=!p.value})},{default:s(()=>e[6]||(e[6]=[M("取内容")])),_:1},8,["type"]),t(C,{size:"small",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=d=>b.value=d),disabled:!p.value,style:{flex:"1"}},null,8,["modelValue","disabled"])]),D("div",ut,[(G(!0),Z(se,null,Te(a,(d,U)=>(G(),Z("div",{key:d.id,class:"segment-item"},[D("div",dt,[t(o,{plain:"",type:"primary",size:"small",onClick:j=>f(U,"seal","audio")},{default:s(()=>e[7]||(e[7]=[M("SA")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"primary",size:"small",onClick:j=>f(U,"seal","video")},{default:s(()=>e[8]||(e[8]=[M("SV")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"primary",size:"small",onClick:j=>f(U,"dlp","audio")},{default:s(()=>e[9]||(e[9]=[M("DA")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"primary",size:"small",onClick:j=>f(U,"dlp","video")},{default:s(()=>e[10]||(e[10]=[M("DV")])),_:2},1032,["onClick"]),t(C,{"model-value":g(_).secondsToTime(d.endTime-d.startTime),size:"small",readonly:""},null,8,["model-value"]),t(o,{plain:"",size:"small",type:d.isK?"success":"info",onClick:j=>d.isK=!d.isK},{default:s(()=>[M(Q(d.isK?"k开":"k关"),1)]),_:2},1032,["type","onClick"]),t(o,{plain:"",size:"small",type:"success",onClick:j=>S(d.startTime,d.endTime)},{default:s(()=>[t(x,null,{default:s(()=>[t(P)]),_:1})]),_:2},1032,["onClick"])]),D("div",pt,[t(o,{plain:"",type:"success",size:"small",onClick:j=>A(U)},{default:s(()=>e[11]||(e[11]=[M("S")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"success",size:"small",onClick:j=>g(n).jumpTo(g(K)(d.startTime))},{default:s(()=>e[12]||(e[12]=[M("J")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"success",size:"small",onClick:j=>d.startTime=d.startTime-.5},{default:s(()=>[t(x,null,{default:s(()=>[t(L)]),_:1})]),_:2},1032,["onClick"]),t(o,{plain:"",type:"success",size:"small",onClick:j=>d.startTime=d.startTime+.5},{default:s(()=>[t(x,null,{default:s(()=>[t(Y)]),_:1})]),_:2},1032,["onClick"]),t(C,{"model-value":g(K)(d.startTime),size:"small",readonly:""},null,8,["model-value"]),t(o,{plain:"",size:"small",onClick:j=>B(U),disabled:U===0||a.length===1},{default:s(()=>e[13]||(e[13]=[M("↑")])),_:2},1032,["onClick","disabled"]),t(o,{plain:"",type:"success",size:"small",onClick:j=>I(U)},{default:s(()=>[t(x,null,{default:s(()=>[t(T)]),_:1})]),_:2},1032,["onClick"])]),D("div",mt,[t(o,{plain:"",type:"danger",size:"small",onClick:j=>W(U)},{default:s(()=>e[14]||(e[14]=[M("E")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"danger",size:"small",onClick:j=>g(n).jumpTo(g(K)(d.endTime))},{default:s(()=>e[15]||(e[15]=[M("J")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"danger",size:"small",onClick:j=>d.endTime=d.endTime-.5},{default:s(()=>[t(x,null,{default:s(()=>[t(L)]),_:1})]),_:2},1032,["onClick"]),t(o,{plain:"",type:"danger",size:"small",onClick:j=>d.endTime=d.endTime+.5},{default:s(()=>[t(x,null,{default:s(()=>[t(Y)]),_:1})]),_:2},1032,["onClick"]),t(C,{type:"danger","model-value":g(K)(d.endTime),size:"small",readonly:""},null,8,["model-value"]),t(o,{plain:"",size:"small",onClick:j=>R(U),disabled:U===a.length-1||a.length===1},{default:s(()=>e[16]||(e[16]=[M("↓")])),_:2},1032,["onClick","disabled"]),t(o,{plain:"",type:"danger",size:"small",onClick:j=>E(U),disabled:a.length===1},{default:s(()=>[t(x,null,{default:s(()=>[t(F)]),_:1})]),_:2},1032,["onClick","disabled"])])]))),128))])]),_:1},512),[[he,g(i).open]]),ue(t(X,{class:"log-card",style:{"max-width":"480px","z-index":"1000000 !important"}},{default:s(()=>[D("p",null,Q(J.value),1)]),_:1},512),[[he,O.value]])],64)}}}),we=_e(gt,[["__scopeId","data-v-67acc507"]]),_t={__name:"App",setup(m){return le(),(n,i)=>{const _=z("el-col"),a=z("el-row"),$=z("el-container");return G(),Z(se,null,[t(we),t($,{style:{height:"100vh"}},{default:s(()=>[t(a,{class:"grid-container"},{default:s(()=>[t(_,{class:"grid-section top"},{default:s(()=>[t(Je)]),_:1}),t(_,{class:"grid-section bottom"},{default:s(()=>[t(Xe),t(rt),t(we)]),_:1})]),_:1})]),_:1})],64)}}},$t=_e(_t,[["__scopeId","data-v-d44e3bc6"]]),oe=Ke($t);oe.use(Re());oe.use(xe);for(const[m,n]of Object.entries(Ie))oe.component(m,n);oe.mount("#app");
