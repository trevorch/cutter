import{E as de,i as ze}from"./element-plus-CRGBzuq5.js";import{B as xe,l as Ee,w as Me,Q as De}from"./@element-plus-By79ymwD.js";import{r as _,j as me,c as G,o as B,a as E,M as J,u as h,d as pe,k as we,ag as M,aq as Pe,I as ue,G as be,H as o,P as e,L as x,S as Ie,w as je,J as _e,O as oe,a6 as Ce,D as Le,n as Ve,X as Oe,Q as $e,at as Ue}from"./@vue-C01xNfPK.js";import{d as fe,c as He}from"./pinia-CKuVeK4o.js";import{P as Ke}from"./plyr-CZIZ1zVJ.js";import{H as re}from"./hls.js-DWnTp5j0.js";import{f as he}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))$(a);new MutationObserver(a=>{for(const g of a)if(g.type==="childList")for(const H of g.addedNodes)H.tagName==="LINK"&&H.rel==="modulepreload"&&$(H)}).observe(document,{childList:!0,subtree:!0});function m(a){const g={};return a.integrity&&(g.integrity=a.integrity),a.referrerPolicy&&(g.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?g.credentials="include":a.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function $(a){if(a.ep)return;a.ep=!0;const g=m(a);fetch(a.href,g)}})();function Re(p,s="未知错误"){if(p instanceof Error)return p.message;if(typeof p=="string")return p;if(typeof p=="object"&&p!==null&&"message"in p&&typeof p.message=="string")return p.message;try{return JSON.stringify(p)}catch{return s}}const ve={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},ye=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function Z(p,s){const m=Re(p),$=s?`${s}: ${m}`:m;de.error({...ve,message:`
    <div ${ye}>
      ${$}
    </div>
    `})}function O(p){de.error({...ve,message:`
    <div ${ye}>
      ${p}
    </div>
    `})}function X(p){de.success({...ve,message:`
    <div ${ye}>
      ${p}
    </div>
    `})}const ne=p=>{try{const[s,m]=p.split("."),[$,a,g]=s.split(":").map(Number),H=m?parseInt(m.padEnd(3,"0")):0;return $*3600+a*60+g+H/1e3}catch{return 0}},U=p=>{const s=Math.round(p%1*1e3),m=Math.floor(p),$=Math.floor(m/3600),a=Math.floor(m%3600/60),g=m%60;return`${String($).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String(g).padStart(2,"0")}.${String(s).padStart(3,"0")}`},se=fe("player",()=>{const p=_(""),s=_(null),m=_(null),$=_(null),a=_(null),g=_(null),H=r=>{s.value=new Ke(r,{hideControls:!1,controls:["play-large","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},D=r=>{a.value=r,p.value=r.date;const f=r.urls[0],v={type:"video",sources:[{src:f,type:N(f)}]};K(v).then(()=>{var C;return(C=s.value)==null?void 0:C.play()})},N=r=>r.includes(".m3u8")?"application/x-mpegURL":r.includes(".flv")?"video/x-flv":"video/mp4",K=async r=>{var v,C,I;(v=m.value)==null||v.destroy(),m.value=null,(C=$.value)==null||C.destroy(),$.value=null;const f=r.sources[0].src.includes(".m3u8")?"hls":r.sources[0].src.includes(".flv")?"flv":"html5";try{f!==g.value&&await((I=s.value)==null?void 0:I.stop()),s.value.source=r,f==="hls"&&re.isSupported()?await F(r.sources[0].src):f==="flv"&&he.isSupported()&&await q(r.sources[0].src),g.value=f}catch(L){console.error("源切换失败:",L)}},F=async r=>new Promise(f=>{m.value=new re,m.value.loadSource(r),m.value.attachMedia(s.value.media),m.value.on(re.Events.MANIFEST_PARSED,f)}),q=async r=>{$.value=he.createPlayer({type:"flv",url:r}),$.value.attachMediaElement(s.value.media),$.value.load(),await $.value.play()},R=_(!1);return{player:s,initPlayer:H,switchSource:K,playStream:D,title:p,data:a,autoPlay:R,jumpTo:r=>{const f=ne(r);if(s.value&&f>0)try{s.value.currentTime=f,R.value?s.value.play():s.value.pause()}catch(v){Z(v,"跳转播放失败，请检查播放器状态")}}}}),Ne={class:"video-wrapper"},Ae={class:"title"},Fe={class:"plyr-container"},Be={__name:"Player",setup(p){const s=se(),m=_(null);return me(()=>{s.initPlayer(m.value)}),($,a)=>(B(),G("div",Ne,[E("h3",Ae,J(h(s).title),1),E("div",Fe,[E("video",{class:"player",ref_key:"videoRef",ref:m,playsinline:""},null,512)])]))}},ge=fe("editor",()=>{const p=_(!1),s=_(!1),m=_(""),$=_(null),a=5e3,g=_(a),H=f=>{s.value=!0,$.value=f,m.value=f.date,k()},D=_([]),N=f=>{try{const[v,C]=f.split("."),[I,L,z]=v.split(":").map(Number);return I*3600+L*60+z}catch(v){console.error(v)}},K=_(new Map),F=()=>{K.value.clear(),D.value.forEach((f,v)=>{try{const C=N(f.time);K.value.has(C)||K.value.set(C,v)}catch(C){console.error(`错误处理时间戳 ${f.time}（索引 ${v}）: ${C}`)}})},q=f=>{if(!D.value)return;const v=g.value+f;g.value=Math.max(v,0);const C=f/1e3;D.value=D.value.map(I=>{const z=ne(I.time)+C;return{...I,time:U(Math.max(z,0))}}),F()},R=()=>{if(!D.value)return;const v=(g.value-a)/1e3;D.value=D.value.map(C=>{const L=ne(C.time)-v;return{...C,time:U(Math.max(L,0))}}),g.value=a,F()},k=async()=>{var f;p.value=!0;try{const v=await fetch(`srts/${(f=$.value)==null?void 0:f.id}`);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);D.value=await v.json();const C=g.value/1e3;D.value=D.value.map(I=>{const z=ne(I.time)+C;return{...I,time:U(Math.max(z,0))}}),F()}catch(v){console.error("数据获取失败:",v),Z(v,"字幕数据加载失败，请稍后重试"),D.value=[]}finally{p.value=!1}};return{open:s,title:m,edit:H,data:$,timelineData:D,loading:p,shiftCount:g,shiftSubtitles:q,timeToSeconds:ne,secondsToTime:U,resetSubtitles:R,timeMap:K,timeToKey:N,getSubtitles:(f,v)=>{var A;const C=_([]);if(!((A=D.value)!=null&&A.length))return console.error("时间轴数据未加载"),C;const I=N(U(f)),L=N(U(v)),z=K.value.get(I),i=K.value.get(L);if(typeof z!="number"||typeof i!="number")return console.error("无法匹配有效的时间段"),C;const n=Math.max(0,z),w=Math.min(D.value.length-1,i),[y,b]=n<=w?[n,w]:[w,n];return C.value=D.value.slice(y,b+1),C}}}),qe=["onClick"],Je=["onClick"],Ye={style:{display:"flex",gap:"0","justify-content":"flex-end"}},Qe=pe({__name:"Playlist",setup(p){const s=se(),m=ge(),$=_(""),a=_(!0),g=_([]),H=async()=>{try{const k=await fetch("video.json");if(!k.ok)throw new Error(`HTTP error! status: ${k.status}`);g.value=await k.json()}catch(k){Z(k,"数据加载失败")}finally{a.value=!1}},D=we(()=>{const k=$.value.toLowerCase();return g.value.filter(r=>r.id.toLowerCase().includes(k)||r.date.toLowerCase().includes(k))}),N=async k=>{var r;((r=k.urls)==null?void 0:r.length)>0?await F(k.urls[0],"链接已复制到剪贴板","链接复制失败"):O("该记录没有可用的链接")},K=async k=>{k.id?await F(k.id,"ID已复制到剪贴板","ID复制失败"):O("该记录没有可用的ID")},F=async(k,r,f)=>{try{await navigator.clipboard.writeText(k),X(r)}catch(v){Z(v,f)}},q=k=>{var r;(r=k.urls)!=null&&r.length&&(k.urls[0],s.playStream(k),m.edit(k))},R=k=>{var r;(r=k.urls)!=null&&r.length&&(k.urls[0],s.playStream(k))};return me(()=>{H()}),(k,r)=>{const f=M("el-table-column"),v=M("el-input"),C=M("el-button"),I=M("el-table"),L=Pe("loading");return ue((B(),be(I,{data:D.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:o(()=>[e(f,{fixed:"",label:"日期",prop:"date",sortable:"",width:"140"},{default:o(z=>[E("span",{class:"clickable-text",onClick:i=>N(z.row)},J(z.row.date),9,qe)]),_:1}),e(f,{fixed:"",label:"标识",prop:"id",width:"180"},{default:o(z=>[E("span",{class:"clickable-text",onClick:i=>K(z.row)},J(z.row.id),9,Je)]),_:1}),e(f,{fixed:"right",align:"right",width:"115"},{header:o(()=>[e(v,{modelValue:$.value,"onUpdate:modelValue":r[0]||(r[0]=z=>$.value=z),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:o(z=>{var i,n;return[E("div",Ye,[e(C,{plain:"",size:"small",onClick:w=>q(z.row),type:z.row.hasSrt?"success":"warning",disabled:!z.row.hasSrt},{default:o(()=>r[1]||(r[1]=[x(" 切片 ")])),_:2},1032,["onClick","type","disabled"]),e(C,{plain:"",size:"small",onClick:w=>R(z.row),type:(i=z.row.urls)!=null&&i.length?"success":"warning",disabled:!((n=z.row.urls)!=null&&n.length)},{default:o(()=>r[2]||(r[2]=[x(" 播放 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[L,a.value]])}}}),Te=fe("picker",()=>{const p=_(!1),s=_(!1),m=_("");return _(null),_(0),{open:s,title:m,loading:p}}),Ge={style:{display:"flex",gap:"0","justify-content":"flex-start"}},We={key:0,class:"loading-state"},Xe={class:"time-label"},Ze=["onClick"],et={key:1,class:"empty-state"},tt={class:"footer-container"},nt={class:"time-shift-controls"},st={class:"time-shift-controls"},ot={class:"time-shift-controls"},ie=100,ce=5e3,lt=pe({__name:"Editor",setup(p){const s=ge(),m=se(),$=Te(),a=_(1e3),g=i=>{const n=a.value+i;a.value=Math.max(ie,Math.min(ce,n))},H=_(["你好","晚上好","拜拜","再见"]),D=i=>H.value.some(n=>i.includes(n)),N=we(()=>s.timelineData.map((i,n)=>({text:i.text,index:n})).filter(({text:i})=>D(i)).map(({index:i})=>i).sort((i,n)=>i-n)),K=()=>{const i=N.value;if(i.length===0){O("未找到包含关键字的字幕行");return}let n=0,w=i.length-1,y=-1;for(;n<=w;){const b=Math.floor((n+w)/2);i[b]<r.value?(y=i[b],n=b+1):w=b-1}y===-1&&(y=i[i.length-1]),v(y)},F=()=>{const i=N.value;if(i.length===0){O("未找到包含关键字的字幕行");return}let n=0,w=i.length-1,y=-1;for(;n<=w;){const b=Math.floor((n+w)/2);i[b]>r.value?(y=i[b],w=b-1):n=b+1}y===-1&&(y=i[0]),v(y)},q=_(),R=_([]),k=i=>{i instanceof HTMLElement&&R.value.push(i)},r=_(0),f=async i=>{const n=U(i),w=s.timeToKey(n),y=s.timeMap.get(w);typeof y=="number"&&y!==r.value&&(r.value=y,await Ve(),setTimeout(()=>v(y),50))},v=i=>{const n=q.value,w=R.value[i];if(w instanceof HTMLElement&&n){const b=w.offsetTop-n.clientHeight/2;n.scrollTo({top:b,behavior:"smooth"})}},C=_(595),I=_();let L=null;me(()=>{I.value=document.querySelector(".grid-section.bottom"),I.value&&(L=new ResizeObserver(i=>{for(const n of i){const{height:w}=n.contentRect;C.value=w}}),L.observe(I.value)),m.player.on("timeupdate",()=>{f(m.player.currentTime)})}),Ie(()=>{L&&I.value&&L.unobserve(I.value),m.player.off("timeupdate",f),R.value=[]}),je(()=>s.timelineData,()=>{R.value=[]});const z=async()=>{var i,n;try{const w=(i=m.player)==null?void 0:i.media;if(!(w instanceof HTMLVideoElement)){O("无法获取视频元素");return}const y=document.createElement("canvas");y.width=w.videoWidth,y.height=w.videoHeight;const b=y.getContext("2d");if(!b){Z("无法创建画布上下文");return}b.drawImage(w,0,0,y.width,y.height);const A=y.toDataURL("image/jpeg",.9),Y=document.createElement("a"),c=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);Y.download=`capture_${(n=s.data)==null?void 0:n.id}_${c}.jpg`,Y.href=A,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),X("截图已保存")}catch(w){Z(`截图失败: ${w instanceof Error?w.message:w}`)}};return(i,n)=>{const w=M("Camera"),y=M("el-icon"),b=M("el-button"),A=M("el-text"),Y=M("Expand"),c=M("Top"),t=M("Bottom"),l=M("Minus"),T=M("el-drawer");return B(),be(T,{modelValue:h(s).open,"onUpdate:modelValue":n[10]||(n[10]=u=>h(s).open=u),direction:"btt",modal:!1,size:C.value,onOpened:n[11]||(n[11]=u=>h(s).shiftSubtitles(0))},{header:o(()=>[E("div",Ge,[e(b,{size:"small",circle:""},{default:o(()=>[e(y,{onClick:z},{default:o(()=>[e(w)]),_:1})]),_:1}),e(A,{class:"mx-1",type:"warning"},{default:o(()=>{var u;return[x(J((u=h(s).data)==null?void 0:u.id),1)]}),_:1})])]),default:o(()=>[E("div",{class:"timeline-container",ref_key:"containerRef",ref:q},[h(s).loading?(B(),G("div",We,[e(y,{class:"is-loading",color:"#409EFF",size:20},{default:o(()=>[e(h(Ee))]),_:1}),n[12]||(n[12]=E("span",null,"正在加载字幕数据...",-1))])):_e("",!0),(B(!0),G(oe,null,Ce(h(s).timelineData,(u,S)=>(B(),G("div",{key:S,class:"timeline-item",ref_for:!0,ref:k},[E("span",Xe,J(u.time),1),E("span",{class:Le(["content-text",{highlight:S==r.value,keyword:D(u.text)}]),onClick:j=>{f(h(ne)(u.time)),h(m).jumpTo(u.time)}},J(u.text),11,Ze)]))),128)),!h(s).loading&&h(s).timelineData.length===0?(B(),G("div",et,[e(y,null,{default:o(()=>[e(h(Me))]),_:1}),n[13]||(n[13]=E("span",null,"暂无字幕数据",-1))])):_e("",!0)],512)]),footer:o(()=>[E("div",tt,[E("div",nt,[e(b,{size:"small",type:h($).open?"success":""},{default:o(()=>[e(y,{onClick:n[0]||(n[0]=u=>h($).open=!h($).open)},{default:o(()=>[e(Y)]),_:1})]),_:1},8,["type"]),e(b,{size:"small"},{default:o(()=>[e(y,{onClick:K},{default:o(()=>[e(c)]),_:1})]),_:1}),e(b,{size:"small"},{default:o(()=>[e(y,{onClick:F},{default:o(()=>[e(t)]),_:1})]),_:1}),e(b,{onClick:n[1]||(n[1]=u=>h(m).autoPlay=!h(m).autoPlay),type:h(m).autoPlay?"success":"",size:"small"},{default:o(()=>n[14]||(n[14]=[x("A")])),_:1},8,["type"])]),E("div",st,[e(b,{type:"danger",onClick:n[2]||(n[2]=u=>g(-1e3)),disabled:a.value<=ie,size:"small"},{default:o(()=>n[15]||(n[15]=[x(" 1000 ")])),_:1},8,["disabled"]),e(b,{type:"danger",onClick:n[3]||(n[3]=u=>g(-100)),disabled:a.value<=ie,size:"small"},{default:o(()=>n[16]||(n[16]=[x(" 100 ")])),_:1},8,["disabled"]),E("span",{class:"count",onClick:n[4]||(n[4]=u=>a.value=1e3)},J(a.value),1),e(b,{type:"success",onClick:n[5]||(n[5]=u=>g(100)),disabled:a.value>=ce,size:"small"},{default:o(()=>n[17]||(n[17]=[x(" 100 ")])),_:1},8,["disabled"]),e(b,{type:"success",onClick:n[6]||(n[6]=u=>g(1e3)),disabled:a.value>=ce,size:"small"},{default:o(()=>n[18]||(n[18]=[x(" 1000 ")])),_:1},8,["disabled"])]),E("div",ot,[e(b,{onClick:n[7]||(n[7]=u=>h(s).shiftSubtitles(-a.value)),disabled:h(s).shiftCount===0,size:"small"},{default:o(()=>[e(y,null,{default:o(()=>[e(l)]),_:1})]),_:1},8,["disabled"]),E("span",{class:"count",onClick:n[8]||(n[8]=(...u)=>h(s).resetSubtitles&&h(s).resetSubtitles(...u))},J(h(s).shiftCount),1),e(b,{onClick:n[9]||(n[9]=u=>h(s).shiftSubtitles(a.value)),size:"small"},{default:o(()=>[e(y,null,{default:o(()=>[e(h(xe))]),_:1})]),_:1})])])]),_:1},8,["modelValue","size"])}}}),at={class:"prompt-controls",style:{display:"flex",gap:"5px",margin:"5px","align-items":"center"}},rt={class:"segment-container"},it={class:"time-controls"},ct={class:"time-controls"},ut={class:"time-controls"},dt={class:"card-footer"},mt=`
总结上面的对话内容，并参考下面的标题，为上面的对话内容起一个吸睛接地气的标题，同时给出建议标签，标签要每行一个，标题和标签要方便复制：
1、心智阳光健康，本科大二学生，聊天很是投缘，大冰不舍挂断
2、人为什么需要亲密关系？大冰深度分析，看完人都通透了
3、主动要礼物！聊天高端局，“泄露天机”太多，大冰“索要”礼物
4、如何把事情处理得圆润得体？大冰深度教学，家庭职场都受用
5、情侣裂痕是如何产生的？大冰深度分析，值得反复观看
6、光长年龄不长心智是一种什么体验？大冰对话32岁女画师，表现惊掉你下巴
7、颠覆你的认知：如何炼成顶级倾听力？大冰独家分享！带你突破沟通瓶颈！
8、如何把握相处的底层逻辑？大冰深度分析，职场婚姻都受用
9、精神未断奶是一种什么体验？大冰对话女硕士，思维表现大跌眼镜
10、如何克服自我否定的毛病？大冰深度教学，看完终身受益
`,pt=`
从上面的对话提取有关_P_方面的内容，并给出出现的开始时间
`,ft=pe({__name:"Picker",setup(p){const s=se(),m=Te(),$=ge(),a=Oe([g()]);function g(){return{id:crypto.randomUUID(),startTime:0,endTime:0,duration:0,isK:!1}}const H=c=>{a.splice(c+1,0,g())},D=c=>{a.length>1&&a.splice(c,1)},N=c=>{if(c>0){const t=a.splice(c,1)[0];a.splice(c-1,0,t)}},K=c=>{if(c<a.length-1){const t=a.splice(c,1)[0];a.splice(c+1,0,t)}};function F(c){if(!s.player)return;const t=s.player.currentTime,l=a[c];l.startTime=t}function q(c){if(!s.player)return;const t=s.player.currentTime,l=a[c];l.endTime=t}function R(c,t){var P;const l=a[c],T=l.isK?"-k":"";let u=(P=s.data)==null?void 0:P.urls[0];if(!u)throw O("请先播放视频"),new Error("请先播放视频");const S=u.match(/\/([^\/]+)\.mp4$/),j=S?S[1]:(()=>{const ae=new Date;return`${ae.getFullYear()}${(ae.getMonth()+1).toString().padStart(2,"0")}${ae.getDate().toString().padStart(2,"0")}`})();if(!l.startTime||!l.endTime)throw O("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const Q=U(l.startTime),ee=U(l.endTime),te=Q.replace(/:/g,"."),W=ee.replace(/:/g,".");let d="yt-dlp --no-check-certificate";d=`${d} --concurrent-fragments 16 --throttled-rate 5M `,d=`${d} --download-sections "*${Q}-${ee}"`;const V="~/storage/downloads/Reqable/";return t=="video"&&(d=`${d} --merge-output-format mp4 -o "${V}${j}_${te}-${W}.mp4"`),t=="audio"&&(d=`${d} ${T} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${V}${j}_${te}-${W}.mp3"`),d=`${d} '${u}' `,d}function k(c,t){var V;const l=a[c],T=l.isK?"-k":"";let u=(V=s.data)==null?void 0:V.urls[0];if(!u)throw O("请先播放视频"),new Error("请先播放视频");const S=u.match(/\/([^\/]+)\.mp4$/),j=S?S[1]:(()=>{const P=new Date;return`${P.getFullYear()}${(P.getMonth()+1).toString().padStart(2,"0")}${P.getDate().toString().padStart(2,"0")}`})();if(!l.startTime||!l.endTime)throw O("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const Q=U(l.startTime),ee=U(l.endTime),te=Q.replace(/:/g,"."),W=ee.replace(/:/g,".");let d=`--download-sections "*${Q}-${ee}"`;return t=="video"&&(d=`${d} --merge-output-format mp4 -o "${j}_${te}-${W}.mp4"`),t=="audio"&&(d=`${d} ${T} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${j}_${te}-${W}.mp3"`),d}async function r(){var t;const c=(t=s.data)==null?void 0:t.urls[0];if(!c){O("请先播放视频");return}try{await navigator.clipboard.writeText(c),X(`链接已复制：${c}`)}catch(l){console.error(l),O("复制失败，请手动复制")}}async function f(){var t;const c=(t=s.data)==null?void 0:t.id;if(!c){O("请先播放视频");return}try{await navigator.clipboard.writeText(c),X(`ID已复制：${c}`)}catch(l){console.error(l),O("ID失败，请手动复制")}}async function v(c,t,l){let T="";switch(t){case"dlp":T=R(c,l);break;case"seal":T=k(c,l);break}try{await navigator.clipboard.writeText(T),X(`命令已复制：${T}`)}catch(u){console.error(u),O("复制失败，请手动复制")}}const C=async c=>{const t=[];a.forEach((l,T)=>{console.log(`Index: ${T}`,l),t.push(R(T,c))});try{await navigator.clipboard.writeText(t.join(`
`)),X(`命令已复制：${t.join("<br/>")}`)}catch(l){console.error(l),O("复制失败，请手动复制")}},I=_(!1);async function L(){var S;let c=(S=s.data)==null?void 0:S.urls[0];if(!c){O("请先播放视频");return}const t=c.match(/\/([^\/]+)\.mp4$/),l=t?t[1]:(()=>{const j=new Date;return`${j.getFullYear()}${(j.getMonth()+1).toString().padStart(2,"0")}${j.getDate().toString().padStart(2,"0")}`})(),T=a.filter(j=>j.startTime<j.endTime).map((j,Q)=>`${U(j.startTime)}-${U(j.endTime)}`);if(!T.length){O("请先至少设置一个开始和结束时间");return}const u=`dlp ${I.value?"keep":"delete"} '${c}' ${l} ${T.join(" ")}`;try{z(u),await navigator.clipboard.writeText(u),X(`命令已复制：${u}`)}catch(j){console.error(j),Z(j,"复制失败，请手动复制")}}async function z(c){try{const t=await fetch("http://localhost:8080/run",{method:"POST",headers:{"Content-Type":"text/plain"},body:c});if(!t.ok)throw new Error(`HTTP 错误: ${t.status}`);const T=(await t.json()).task_id;w(T)}catch(t){Z(t,"请求失败: ")}}const i=_(!1),n=_("");function w(c){i.value=!0;const t=setInterval(async()=>{var T;let l="";try{const u=await fetch(`http://localhost:8080/progress/${c}`);if(!u.ok)throw new Error(`进度查询失败: ${u.status}`);const S=await u.json();l=(T=S.recent_log)!=null&&T.length?`

最近日志:
`+S.recent_log.join(`
`):"",S.status==="completed"&&(clearInterval(t),l=`处理完成✅ (状态: ${S.status})${l}`),S.status==="failed"&&(clearInterval(t),l=`处理完成✅ (状态: ${S.status})${l}`)}catch{clearInterval(t),l="监控失败: "}n.value=l},1e3)}const y=_(!1),b=_("情感"),A=_(!1);async function Y(c,t){const l=$.getSubtitles(c,t);let T="";l.value.map(u=>{const S=u.time.split(".")[0]+" "+u.text+`
`;T+=S}),T+=y.value?mt:A.value?pt.replace("_P_",b.value):"";try{await navigator.clipboard.writeText(T),X(`${l.value.length}条字幕已复制`)}catch(u){console.error(u),O("复制失败，请手动复制")}}return(c,t)=>{const l=M("el-button"),T=M("el-input"),u=M("DocumentCopy"),S=M("el-icon"),j=M("CaretLeft"),Q=M("CaretRight"),ee=M("Minus"),te=M("Plus"),W=M("el-card");return B(),G(oe,null,[ue(e(W,{class:"segment-control-card"},{footer:o(()=>[E("div",dt,[e(l,{size:"small",onClick:r},{default:o(()=>t[17]||(t[17]=[x("链接")])),_:1}),e(l,{size:"small",onClick:f},{default:o(()=>t[18]||(t[18]=[x("ID")])),_:1}),e(l,{size:"small",onClick:L},{default:o(()=>t[19]||(t[19]=[x("下载片段")])),_:1}),e(l,{size:"small",onClick:t[3]||(t[3]=d=>i.value=!i.value)},{default:o(()=>t[20]||(t[20]=[x("日志")])),_:1}),e(l,{size:"small",onClick:t[4]||(t[4]=d=>C("video"))},{default:o(()=>t[21]||(t[21]=[x("复制命令")])),_:1})])]),default:o(()=>[E("div",at,[e(l,{size:"small",type:y.value?"success":"info",onClick:t[0]||(t[0]=d=>{A.value=!1,y.value=!y.value})},{default:o(()=>t[5]||(t[5]=[x("取标题")])),_:1},8,["type"]),e(l,{size:"small",type:A.value?"success":"info",onClick:t[1]||(t[1]=d=>{y.value=!1,A.value=!A.value})},{default:o(()=>t[6]||(t[6]=[x("取内容")])),_:1},8,["type"]),e(T,{size:"small",modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=d=>b.value=d),disabled:!A.value,style:{flex:"1"}},null,8,["modelValue","disabled"])]),E("div",rt,[(B(!0),G(oe,null,Ce(a,(d,V)=>(B(),G("div",{key:d.id,class:"segment-item"},[E("div",it,[e(l,{type:"primary",size:"small",onClick:P=>v(V,"seal","audio")},{default:o(()=>t[7]||(t[7]=[x("SA")])),_:2},1032,["onClick"]),e(l,{type:"primary",size:"small",onClick:P=>v(V,"seal","video")},{default:o(()=>t[8]||(t[8]=[x("SV")])),_:2},1032,["onClick"]),e(l,{type:"primary",size:"small",onClick:P=>v(V,"dlp","audio")},{default:o(()=>t[9]||(t[9]=[x("DA")])),_:2},1032,["onClick"]),e(l,{type:"primary",size:"small",onClick:P=>v(V,"dlp","video")},{default:o(()=>t[10]||(t[10]=[x("DV")])),_:2},1032,["onClick"]),e(T,{"model-value":h($).secondsToTime(d.endTime-d.startTime),size:"small",readonly:""},null,8,["model-value"]),e(l,{size:"small",type:d.isK?"success":"info",onClick:P=>d.isK=!d.isK},{default:o(()=>[x(J(d.isK?"k开":"k关"),1)]),_:2},1032,["type","onClick"]),e(l,{size:"small",type:"success",onClick:P=>Y(d.startTime,d.endTime)},{default:o(()=>[e(S,null,{default:o(()=>[e(u)]),_:1})]),_:2},1032,["onClick"])]),E("div",ct,[e(l,{type:"success",size:"small",onClick:P=>F(V)},{default:o(()=>t[11]||(t[11]=[x("S")])),_:2},1032,["onClick"]),e(l,{type:"success",size:"small",onClick:P=>h(s).jumpTo(h(U)(d.startTime))},{default:o(()=>t[12]||(t[12]=[x("J")])),_:2},1032,["onClick"]),e(l,{type:"success",size:"small",onClick:P=>d.startTime=d.startTime-.5},{default:o(()=>[e(S,null,{default:o(()=>[e(j)]),_:1})]),_:2},1032,["onClick"]),e(l,{type:"success",size:"small",onClick:P=>d.startTime=d.startTime+.5},{default:o(()=>[e(S,null,{default:o(()=>[e(Q)]),_:1})]),_:2},1032,["onClick"]),e(T,{"model-value":h(U)(d.startTime),size:"small",readonly:""},null,8,["model-value"]),e(l,{size:"small",onClick:P=>N(V),disabled:V===0||a.length===1},{default:o(()=>t[13]||(t[13]=[x("↑")])),_:2},1032,["onClick","disabled"]),e(l,{size:"small",onClick:P=>D(V),disabled:a.length===1},{default:o(()=>[e(S,null,{default:o(()=>[e(ee)]),_:1})]),_:2},1032,["onClick","disabled"])]),E("div",ut,[e(l,{type:"danger",size:"small",onClick:P=>q(V)},{default:o(()=>t[14]||(t[14]=[x("E")])),_:2},1032,["onClick"]),e(l,{type:"danger",size:"small",onClick:P=>h(s).jumpTo(h(U)(d.endTime))},{default:o(()=>t[15]||(t[15]=[x("J")])),_:2},1032,["onClick"]),e(l,{type:"danger",size:"small",onClick:P=>d.endTime=d.endTime-.5},{default:o(()=>[e(S,null,{default:o(()=>[e(j)]),_:1})]),_:2},1032,["onClick"]),e(l,{type:"danger",size:"small",onClick:P=>d.endTime=d.endTime+.5},{default:o(()=>[e(S,null,{default:o(()=>[e(Q)]),_:1})]),_:2},1032,["onClick"]),e(T,{type:"danger","model-value":h(U)(d.endTime),size:"small",readonly:""},null,8,["model-value"]),e(l,{size:"small",onClick:P=>K(V),disabled:V===a.length-1||a.length===1},{default:o(()=>t[16]||(t[16]=[x("↓")])),_:2},1032,["onClick","disabled"]),e(l,{size:"small",onClick:P=>H(V)},{default:o(()=>[e(S,null,{default:o(()=>[e(te)]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1},512),[[$e,h(m).open]]),ue(e(W,{class:"log-card",style:{"max-width":"480px","z-index":"1000000 !important"}},{default:o(()=>[E("p",null,J(n.value),1)]),_:1},512),[[$e,i.value]])],64)}}}),Se=(p,s)=>{const m=p.__vccOpts||p;for(const[$,a]of s)m[$]=a;return m},ke=Se(ft,[["__scopeId","data-v-1aea8eb3"]]),vt={__name:"App",setup(p){return se(),(s,m)=>{const $=M("el-col"),a=M("el-row"),g=M("el-container");return B(),G(oe,null,[e(ke),e(g,{style:{height:"100vh"}},{default:o(()=>[e(a,{class:"grid-container"},{default:o(()=>[e($,{class:"grid-section top"},{default:o(()=>[e(Be)]),_:1}),e($,{class:"grid-section bottom"},{default:o(()=>[e(Qe),e(lt),e(ke)]),_:1})]),_:1})]),_:1})],64)}}},yt=Se(vt,[["__scopeId","data-v-d44e3bc6"]]),le=Ue(yt);le.use(He());le.use(ze);for(const[p,s]of Object.entries(De))le.component(p,s);le.mount("#app");
