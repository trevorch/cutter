import{E as ye,i as Pe}from"./element-plus-DRLPWQh5.js";import{B as Ee,l as Me,w as Ie,Q as je,R as Le,S as Ue}from"./@element-plus-Dp6MuveI.js";import{r as $,j as ge,c as X,o as O,a as M,M as J,u as w,d as $e,k as xe,ag as E,aq as Ve,O as re,P as t,I as ve,H as l,L as b,G as ae,J as ie,S as Ke,w as Oe,a6 as ze,D as Re,n as He,X as Ae,Q as be,at as Ne}from"./@vue-C01xNfPK.js";import{d as _e,c as Fe}from"./pinia-CKuVeK4o.js";import{P as Be}from"./plyr-CZIZ1zVJ.js";import{H as pe}from"./hls.js-DWnTp5j0.js";import{f as Te}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))_(v);new MutationObserver(v=>{for(const r of v)if(r.type==="childList")for(const z of r.addedNodes)z.tagName==="LINK"&&z.rel==="modulepreload"&&_(z)}).observe(document,{childList:!0,subtree:!0});function p(v){const r={};return v.integrity&&(r.integrity=v.integrity),v.referrerPolicy&&(r.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?r.credentials="include":v.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function _(v){if(v.ep)return;v.ep=!0;const r=p(v);fetch(v.href,r)}})();function qe(g,o="未知错误"){if(g instanceof Error)return g.message;if(typeof g=="string")return g;if(typeof g=="object"&&g!==null&&"message"in g&&typeof g.message=="string")return g.message;try{return JSON.stringify(g)}catch{return o}}const we={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},ke=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function ne(g,o){const p=qe(g),_=o?`${o}: ${p}`:p;ye.error({...we,message:`
    <div ${ke}>
      ${_}
    </div>
    `})}function L(g){ye.error({...we,message:`
    <div ${ke}>
      ${g}
    </div>
    `})}function ee(g){ye.success({...we,message:`
    <div ${ke}>
      ${g}
    </div>
    `})}const oe=g=>{try{const[o,p]=g.split("."),[_,v,r]=o.split(":").map(Number),z=p?parseInt(p.padEnd(3,"0")):0;return _*3600+v*60+r+z/1e3}catch{return 0}},U=g=>{const o=Math.round(g%1*1e3),p=Math.floor(g),_=Math.floor(p/3600),v=Math.floor(p%3600/60),r=p%60;return`${String(_).padStart(2,"0")}:${String(v).padStart(2,"0")}:${String(r).padStart(2,"0")}.${String(o).padStart(3,"0")}`},ce=_e("player",()=>{const g=$(""),o=$(null),p=$(null),_=$(null),v=$(null),r=$(null),z=d=>{o.value=new Be(d,{hideControls:!1,controls:["play","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},D=d=>{K(d,!0)},Y=d=>{K(d,!1)},K=(d,i)=>{v.value=d,g.value=d.date;const a=d.urls[0],P={type:"video",sources:[{src:a,type:N(a)}]};R(P).then(()=>{var T;i&&((T=o.value)==null||T.play())})},N=d=>d.includes(".m3u8")?"application/x-mpegURL":d.includes(".flv")?"video/x-flv":"video/mp4",R=async d=>{var a,P,T;(a=p.value)==null||a.destroy(),p.value=null,(P=_.value)==null||P.destroy(),_.value=null;const i=d.sources[0].src.includes(".m3u8")?"hls":d.sources[0].src.includes(".flv")?"flv":"html5";try{i!==r.value&&await((T=o.value)==null?void 0:T.stop()),o.value.source=d,i==="hls"&&pe.isSupported()?await Z(d.sources[0].src):i==="flv"&&Te.isSupported()&&await F(d.sources[0].src),r.value=i}catch(H){console.error("源切换失败:",H)}},Z=async d=>new Promise(i=>{p.value=new pe,p.value.loadSource(d),p.value.attachMedia(o.value.media),p.value.on(pe.Events.MANIFEST_PARSED,i)}),F=async d=>{_.value=Te.createPlayer({type:"flv",url:d}),_.value.attachMediaElement(o.value.media),_.value.load(),await _.value.play()},B=$(!1);return{player:o,initPlayer:z,switchSource:R,playStream:D,switchStream:Y,title:g,data:v,autoPlay:B,jumpTo:d=>{const i=oe(d);if(o.value&&i>0)try{o.value.currentTime=i,B.value?o.value.play():o.value.pause()}catch(a){ne(a,"跳转播放失败，请检查播放器状态")}}}}),Je={class:"video-wrapper"},Ye={class:"title"},Qe={class:"plyr-container"},Ge={__name:"Player",setup(g){const o=ce(),p=$(null);return ge(()=>{o.initPlayer(p.value)}),(_,v)=>(O(),X("div",Je,[M("h3",Ye,J(w(o).title),1),M("div",Qe,[M("video",{class:"player",ref_key:"videoRef",ref:p,playsinline:""},null,512)])]))}},he=_e("editor",()=>{const g=$(!1),o=$(!1),p=$(""),_=$(null),v=5e3,r=$(v),z=j=>{o.value=!0,_.value=j,p.value=j.date,F(j.dsource)},D=$([]),Y=j=>{try{const[d,i]=j.split("."),[a,P,T]=d.split(":").map(Number);return a*3600+P*60+T}catch(d){console.error(d)}},K=$(new Map),N=()=>{K.value.clear(),D.value.forEach((j,d)=>{try{const i=Y(j.time);K.value.has(i)||K.value.set(i,d)}catch(i){console.error(`错误处理时间戳 ${j.time}（索引 ${d}）: ${i}`)}})},R=j=>{if(!D.value)return;const d=r.value+j;r.value=Math.max(d,0);const i=j/1e3;D.value=D.value.map(a=>{const T=oe(a.time)+i;return{...a,time:U(Math.max(T,0))}}),N()},Z=()=>{if(!D.value)return;const d=(r.value-v)/1e3;D.value=D.value.map(i=>{const P=oe(i.time)-d;return{...i,time:U(Math.max(P,0))}}),r.value=v,N()},F=async j=>{var d;g.value=!0;try{const i=Date.now(),a=await fetch(j+`/srts/${(d=_.value)==null?void 0:d.id}?t=${i}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);D.value=await a.json();const P=r.value/1e3;D.value=D.value.map(T=>{const Q=oe(T.time)+P;return{...T,time:U(Math.max(Q,0))}}),N()}catch(i){console.error("数据获取失败:",i),ne(i,"字幕数据加载失败，请稍后重试"),D.value=[]}finally{g.value=!1}};return{open:o,title:p,edit:z,data:_,timelineData:D,loading:g,shiftCount:r,shiftSubtitles:R,timeToSeconds:oe,secondsToTime:U,resetSubtitles:Z,timeMap:K,timeToKey:Y,getSubtitles:(j,d)=>{var y;const i=$([]);if(!((y=D.value)!=null&&y.length))return console.error("时间轴数据未加载"),i;const a=Y(U(j)),P=Y(U(d)),T=K.value.get(a),H=K.value.get(P);if(typeof T!="number"||typeof H!="number")return console.error("无法匹配有效的时间段"),i;const Q=Math.max(0,T),m=Math.min(D.value.length-1,H),[n,h]=Q<=m?[Q,m]:[m,Q];return i.value=D.value.slice(n,h+1),i}}}),We=["onClick"],Xe=["onClick"],Ze=["onClick"],et={style:{display:"flex","justify-content":"flex-end","overflow-x":"auto","overflow-y":"hidden"}},tt=$e({__name:"Playlist",setup(g){const o=ce(),p=he(),_=$(""),v=$(!0),r=$([]),z=$("kwai"),D=async i=>{console.log("url:"+i+"/video.json");try{const a=await fetch(i+"/video.json");if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);r.value=await a.json()}catch(a){console.log(a),ne(a,"数据加载失败")}finally{v.value=!1}},Y=xe(()=>{const i=_.value.toLowerCase();return r.value.filter(a=>a.id.toLowerCase().includes(i)||a.date.toLowerCase().includes(i))}),K=async i=>{var a;((a=i.urls)==null?void 0:a.length)>0?await R(i.urls[0],"链接已复制到剪贴板","链接复制失败"):L("该记录没有可用的链接")},N=async i=>{i.id?await R(i.id,"ID已复制到剪贴板","ID复制失败"):L("该记录没有可用的ID")},R=async(i,a,P)=>{try{await navigator.clipboard.writeText(i),ee(a)}catch(T){ne(T,P)}},Z=async i=>{await R(`ytmp4 ${i.id}`,"视频下载命令已复制到剪贴板","复制失败")},F=async i=>{await R(`gdmp3 '${i.urls[0]}' ${i.id}`,"音频下载命令已复制到剪贴板","复制失败")},B=async i=>{await R(`ytmp3 ${i.id}`,"音频下载命令已复制到剪贴板","复制失败")},j=i=>{var a;(a=i.urls)!=null&&a.length&&(i.urls[0],o.switchStream(i),p.edit(i))},d=i=>{var a;(a=i.urls)!=null&&a.length&&(i.urls[0],o.playStream(i))};return ge(()=>{D("kwai")}),(i,a)=>{const P=E("el-button"),T=E("el-table-column"),H=E("el-input"),Q=E("el-table"),m=Ve("loading");return O(),X(re,null,[t(P,{type:z.value==="kwai"?"danger":"default",size:"small",onClick:a[0]||(a[0]=n=>{z.value="kwai",D("kwai")})},{default:l(()=>a[3]||(a[3]=[b(" KS ")])),_:1},8,["type"]),t(P,{type:z.value==="local"?"danger":"default",size:"small",onClick:a[1]||(a[1]=n=>{z.value="local",D("local")}),loading:v.value},{default:l(()=>a[4]||(a[4]=[b(" 本地 ")])),_:1},8,["type","loading"]),ve((O(),ae(Q,{data:Y.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:l(()=>[t(T,{fixed:"",label:"序号",width:"40"},{default:l(n=>[M("span",{class:"column-text",onClick:h=>N(n.row)},J((n.$index+1).toString().padStart(4,"0")),9,We)]),_:1}),t(T,{fixed:"",label:"日期",prop:"date",sortable:"",width:"100"},{default:l(n=>[M("span",{class:"column-text clickable-text",onClick:h=>K(n.row)},J(n.row.date),9,Xe)]),_:1}),t(T,{fixed:"",label:"ID",prop:"id",width:"130"},{default:l(n=>[M("span",{class:"column-text clickable-text",onClick:h=>N(n.row)},J(n.row.id),9,Ze)]),_:1}),t(T,{fixed:"right",align:"right",width:"200"},{header:l(()=>[t(H,{modelValue:_.value,"onUpdate:modelValue":a[2]||(a[2]=n=>_.value=n),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:l(n=>{var h,y;return[M("div",et,[n.row.dsource==="kwai"?(O(),ae(P,{key:0,plain:"",size:"small",onClick:k=>F(n.row),type:"primary"},{default:l(()=>a[5]||(a[5]=[b(" 下载 ")])),_:2},1032,["onClick"])):ie("",!0),n.row.dsource==="tube"?(O(),ae(P,{key:1,plain:"",size:"small",onClick:k=>Z(n.row),type:"primary"},{default:l(()=>a[6]||(a[6]=[b(" 下片 ")])),_:2},1032,["onClick"])):ie("",!0),n.row.dsource==="tube"?(O(),ae(P,{key:2,plain:"",size:"small",onClick:k=>B(n.row),type:"primary"},{default:l(()=>a[7]||(a[7]=[b(" 下音 ")])),_:2},1032,["onClick"])):ie("",!0),t(P,{plain:"",size:"small",onClick:k=>j(n.row),type:n.row.hasSrt?"success":"warning",disabled:!n.row.hasSrt},{default:l(()=>a[8]||(a[8]=[b(" 切 ")])),_:2},1032,["onClick","type","disabled"]),t(P,{plain:"",size:"small",onClick:k=>d(n.row),type:(h=n.row.urls)!=null&&h.length?"success":"warning",disabled:!((y=n.row.urls)!=null&&y.length)},{default:l(()=>a[9]||(a[9]=[b(" 播 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[m,v.value]])],64)}}}),Ce=(g,o)=>{const p=g.__vccOpts||g;for(const[_,v]of o)p[_]=v;return p},nt=Ce(tt,[["__scopeId","data-v-a2bf2572"]]),De=_e("picker",()=>{const g=$(!1),o=$(!1),p=$("");return $(null),$(0),{open:o,title:p,loading:g}}),lt={style:{display:"flex",gap:"0","justify-content":"flex-start"}},ot={key:0,class:"loading-state"},st={class:"srt-time"},at=["onClick"],it={key:1,class:"empty-state"},rt={class:"footer-container"},ct={class:"time-shift-controls"},ut={class:"time-shift-controls"},dt={class:"time-shift-controls"},me=100,fe=5e3,pt=$e({__name:"Editor",setup(g){const o=he(),p=ce(),_=De(),v=$(!1),r=()=>{p.player&&(p.player.playing?p.player.pause():p.player.play())},z=$(1e3),D=m=>{const n=z.value+m;z.value=Math.max(me,Math.min(fe,n))},Y=$(["你好","晚上好","拜拜","再见"]),K=m=>Y.value.some(n=>m.includes(n)),N=xe(()=>o.timelineData.map((m,n)=>({text:m.text,index:n})).filter(({text:m})=>K(m)).map(({index:m})=>m).sort((m,n)=>m-n)),R=()=>{const m=N.value;if(m.length===0){L("未找到包含关键字的字幕行");return}let n=0,h=m.length-1,y=-1;for(;n<=h;){const k=Math.floor((n+h)/2);m[k]<d.value?(y=m[k],n=k+1):h=k-1}y===-1&&(y=m[m.length-1]),a(y)},Z=()=>{const m=N.value;if(m.length===0){L("未找到包含关键字的字幕行");return}let n=0,h=m.length-1,y=-1;for(;n<=h;){const k=Math.floor((n+h)/2);m[k]>d.value?(y=m[k],h=k-1):n=k+1}y===-1&&(y=m[0]),a(y)},F=$(),B=$([]),j=m=>{m instanceof HTMLElement&&B.value.push(m)},d=$(0),i=async m=>{const n=U(m),h=o.timeToKey(n),y=o.timeMap.get(h);typeof y=="number"&&y!==d.value&&(d.value=y,await He(),setTimeout(()=>a(y),50))},a=m=>{const n=F.value,h=B.value[m];if(h instanceof HTMLElement&&n){const k=h.offsetTop-n.clientHeight/2;n.scrollTo({top:k,behavior:"smooth"})}},P=$(595),T=$();let H=null;ge(()=>{T.value=document.querySelector(".grid-section.bottom"),T.value&&(H=new ResizeObserver(m=>{for(const n of m){const{height:h}=n.contentRect;P.value=h}}),H.observe(T.value)),p.player.on("timeupdate",()=>{i(p.player.currentTime)}),p.player.on("play",()=>{v.value=!0}),p.player.on("pause",()=>{v.value=!1})}),Ke(()=>{H&&T.value&&H.unobserve(T.value),p.player.off("timeupdate",i),B.value=[]}),Oe(()=>o.timelineData,()=>{B.value=[]});const Q=async()=>{var m,n;try{const h=(m=p.player)==null?void 0:m.media;if(!(h instanceof HTMLVideoElement)){L("无法获取视频元素");return}const y=document.createElement("canvas");y.width=h.videoWidth,y.height=h.videoHeight;const k=y.getContext("2d");if(!k){ne("无法创建画布上下文");return}k.drawImage(h,0,0,y.width,y.height);const le=y.toDataURL("image/jpeg",.9),G=document.createElement("a"),se=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);G.download=`capture_${(n=o.data)==null?void 0:n.id}_${se}.jpg`,G.href=le,document.body.appendChild(G),G.click(),document.body.removeChild(G),ee("截图已保存")}catch(h){ne(`截图失败: ${h instanceof Error?h.message:h}`)}};return(m,n)=>{const h=E("Camera"),y=E("el-icon"),k=E("el-button"),le=E("el-text"),G=E("Top"),se=E("Bottom"),c=E("el-space"),e=E("el-affix"),s=E("Expand"),C=E("Minus"),x=E("el-drawer");return O(),ae(x,{modelValue:w(o).open,"onUpdate:modelValue":n[10]||(n[10]=u=>w(o).open=u),direction:"btt",modal:!1,size:P.value,onOpened:n[11]||(n[11]=u=>w(o).shiftSubtitles(0))},{header:l(()=>[M("div",lt,[t(k,{onClick:Q,size:"small",circle:""},{default:l(()=>[t(y,null,{default:l(()=>[t(h)]),_:1})]),_:1}),t(le,{class:"mx-1",type:"warning"},{default:l(()=>{var u,S;return[b(J((u=w(o).data)==null?void 0:u.date)+" - "+J((S=w(o).data)==null?void 0:S.id),1)]}),_:1})])]),default:l(()=>[M("div",{class:"timeline-container",ref_key:"containerRef",ref:F},[w(o).loading?(O(),X("div",ot,[t(y,{class:"is-loading",color:"#409EFF",size:20},{default:l(()=>[t(w(Me))]),_:1}),n[12]||(n[12]=M("span",null,"正在加载字幕数据...",-1))])):ie("",!0),(O(!0),X(re,null,ze(w(o).timelineData,(u,S)=>(O(),X("div",{key:S,class:"timeline-item",ref_for:!0,ref:j},[M("span",st,J(u.time),1),M("span",{class:Re(["srt-text",{highlight:S==d.value,keyword:K(u.text)}]),onClick:q=>{i(w(oe)(u.time)),w(p).jumpTo(u.time)}},J(u.text),11,at)]))),128)),!w(o).loading&&w(o).timelineData.length===0?(O(),X("div",it,[t(y,null,{default:l(()=>[t(w(Ie))]),_:1}),n[13]||(n[13]=M("span",null,"暂无字幕数据",-1))])):ie("",!0)],512),t(e,{class:"floating-btn",position:"bottom",offset:200},{default:l(()=>[t(c,{direction:"vertical"},{default:l(()=>[t(k,{onClick:n[0]||(n[0]=u=>w(p).autoPlay=!w(p).autoPlay),type:w(p).autoPlay?"success":""},{default:l(()=>[t(y,null,{default:l(()=>n[14]||(n[14]=[b("A")])),_:1})]),_:1},8,["type"]),t(k,{onClick:R},{default:l(()=>[t(y,null,{default:l(()=>[t(G)]),_:1})]),_:1}),t(k,{onClick:Z},{default:l(()=>[t(y,null,{default:l(()=>[t(se)]),_:1})]),_:1}),t(k,{onClick:r,icon:v.value?w(je):w(Le)},null,8,["icon"])]),_:1})]),_:1})]),footer:l(()=>[M("div",rt,[M("div",ct,[t(k,{size:"small",type:w(_).open?"success":""},{default:l(()=>[t(y,{onClick:n[1]||(n[1]=u=>w(_).open=!w(_).open)},{default:l(()=>[t(s)]),_:1})]),_:1},8,["type"])]),M("div",ut,[t(k,{onClick:n[2]||(n[2]=u=>w(o).shiftSubtitles(-z.value)),disabled:w(o).shiftCount===0,size:"small"},{default:l(()=>[t(y,null,{default:l(()=>[t(C)]),_:1})]),_:1},8,["disabled"]),M("span",{class:"count",onClick:n[3]||(n[3]=(...u)=>w(o).resetSubtitles&&w(o).resetSubtitles(...u))},J(w(o).shiftCount),1),t(k,{onClick:n[4]||(n[4]=u=>w(o).shiftSubtitles(z.value)),size:"small"},{default:l(()=>[t(y,null,{default:l(()=>[t(w(Ee))]),_:1})]),_:1})]),M("div",dt,[t(k,{plain:"",type:"danger",onClick:n[5]||(n[5]=u=>D(-1e3)),disabled:z.value<=me,size:"small"},{default:l(()=>n[15]||(n[15]=[b(" <<1000 ")])),_:1},8,["disabled"]),t(k,{plain:"",type:"danger",onClick:n[6]||(n[6]=u=>D(-100)),disabled:z.value<=me,size:"small"},{default:l(()=>n[16]||(n[16]=[b(" <100 ")])),_:1},8,["disabled"]),M("span",{class:"count",onClick:n[7]||(n[7]=u=>z.value=1e3)},J(z.value),1),t(k,{plain:"",type:"success",onClick:n[8]||(n[8]=u=>D(100)),disabled:z.value>=fe,size:"small"},{default:l(()=>n[17]||(n[17]=[b(" 100> ")])),_:1},8,["disabled"]),t(k,{plain:"",type:"success",onClick:n[9]||(n[9]=u=>D(1e3)),disabled:z.value>=fe,size:"small"},{default:l(()=>n[18]||(n[18]=[b(" 1000>> ")])),_:1},8,["disabled"])])])]),_:1},8,["modelValue","size"])}}}),mt={class:"prompt-controls",style:{display:"flex",gap:"5px",margin:"5px","align-items":"center"}},ft={class:"segment-container"},vt={class:"time-controls"},yt={class:"time-controls"},gt={class:"time-controls"},$t={class:"card-footer"},_t=`
总结上面的对话内容，并参考下面的标题以及高点击率标题核心公式，运用马斯洛需求层次理论，为上面的对话内容起一个容易引起讨论的标题，不能夸大其词，不能包含不实内容，同时给出建议标签，标签要每行一个，标题和标签要方便复制：
一、参考标题
1、心智阳光健康，本科大二学生，聊天很是投缘，大冰不舍挂断
2、人为什么需要亲密关系？大冰深度分析，看完人都通透了
3、主动要礼物！聊天高端局，“泄露天机”太多，大冰“索要”礼物
4、如何把事情处理得圆润得体？大冰深度教学，家庭职场都受用
5、情侣裂痕是如何产生的？大冰深度分析，值得反复观看
6、光长年龄不长心智是一种什么体验？大冰对话32岁女画师，表现惊掉你下巴
7、颠覆你的认知：如何炼成顶级倾听力？大冰独家分享！带你突破沟通瓶颈！
8、如何把握相处的底层逻辑？大冰深度分析，职场婚姻都受用
9、精神未断奶是一种什么体验？大冰对话女硕士，思维表现大跌眼镜
10、如何克服自我否定的毛病？大冰深度教学，看完终身受益
二、高点击率标题核心公式
1、数字+痛点/利益
例：《月薪3千到3万，她靠这5个理财技巧逆袭，第3点人人可复制》。
2、疑问句+悬念
例：《为何日本核污水排海后，欧美集体沉默？背后真相远超想象》。
3、热点绑定+情绪词
例：《全网震怒！某顶流明星偷税细节曝光，经纪人一句话惹怒全网》。
4、挑战常识+颠覆认知
例：《喝粥不养胃！协和医生警告：这3种“健康习惯”反而致癌》。
5、本地化+紧迫感
例：《北京人注意！这趟地铁线路将停运3个月，明天起实施》。
`,wt=`
对以上内容进出场景划分，每个场景都以“你好/晚上好”等类似问候语开始，
以“拜拜/再见/下一位”等类似问候语结束，
针对每个场景总结一个简介，提取一个符合内容事实，反映核心矛盾冲突的标题，
标题分为大标题和小标题，大标题主打奇葩吸引眼球，大概13个字，小标题使用富含哲理的话术阐述事实，大概20-30个字，
并给出每个场景的开始和结束始时间，提取对话中最严厉的话作为为每个场景的开场白，并给出这句话出现的时间点。
同时为每个场景提取5个不会被b站限流的爆炸性词汇。
`,kt=`
对以上内容按如下要求处理：
1、按观点进行场景划分
2、每个场景约10至15分钟，要包含相对完整的叙事，总结每个观点的核心内容
3、针对每个场景提取一个符合内容事实，富含哲理且正面的标题，标题分为大标题和小标题，大标题吸引眼球，小标题简要阐述事实，但不能违反中国国家法律
4、给出每个场景的开始和结束始时间
5、请使用中文回答。
`,ht=$e({__name:"Picker",setup(g){const o=ce(),p=De(),_=he(),v=$(!1),r=Ae([z()]);function z(){return{id:crypto.randomUUID(),startTime:0,endTime:0,duration:0,isK:!1}}const D=c=>{r.splice(c+1,0,z())},Y=c=>{r.length>1&&r.splice(c,1)},K=c=>{if(c>0){const e=r.splice(c,1)[0];r.splice(c-1,0,e)}},N=c=>{if(c<r.length-1){const e=r.splice(c,1)[0];r.splice(c+1,0,e)}};function R(c){if(!o.player)return;const e=o.player.currentTime,s=r[c];s.startTime=e}function Z(c){if(!o.player)return;const e=o.player.currentTime,s=r[c];s.endTime=e}function F(c){var e,s;if(((e=o.data)==null?void 0:e.dsource)==="local"){const C=window.location.protocol,x=window.location.host;return`${`${C}//${x}`}/${c}`}if(!v.value){const C=window.location.protocol,x=window.location.host;return`${`${C}//${x}`}/local/${(s=o.data)==null?void 0:s.id}.mp4`}return c}function B(c,e){var I;const s=r[c],C=s.isK?"-k":"";let x=F((I=o.data)==null?void 0:I.urls[0]);if(!x)throw L("请先播放视频"),new Error("请先播放视频");const u=x.match(/\/([^\/]+)\.mp4$/),S=u?u[1]:(()=>{const de=new Date;return`${de.getFullYear()}${(de.getMonth()+1).toString().padStart(2,"0")}${de.getDate().toString().padStart(2,"0")}`})();if(!s.startTime||!s.endTime)throw L("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const q=U(s.startTime),A=U(s.endTime),W=q.replace(/:/g,"."),te=A.replace(/:/g,".");let f="yt-dlp --no-check-certificate";f=`${f} --concurrent-fragments 16 --throttled-rate 5M `,f=`${f} --download-sections "*${q}-${A}"`;const V="~/storage/downloads/Reqable/";return e=="video"&&(f=`${f} --merge-output-format mp4 -o "${V}${S}_${W}-${te}.mp4"`),e=="audio"&&(f=`${f} ${C} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${V}${S}_${W}-${te}.mp3"`),f=`${f} '${x}' `,f}function j(c,e){var V;const s=r[c],C=s.isK?"-k":"";let x=F((V=o.data)==null?void 0:V.urls[0]);if(!x)throw L("请先播放视频"),new Error("请先播放视频");const u=x.match(/\/([^\/]+)\.mp4$/),S=u?u[1]:(()=>{const I=new Date;return`${I.getFullYear()}${(I.getMonth()+1).toString().padStart(2,"0")}${I.getDate().toString().padStart(2,"0")}`})();if(!s.startTime||!s.endTime)throw L("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const q=U(s.startTime),A=U(s.endTime),W=q.replace(/:/g,"."),te=A.replace(/:/g,".");let f=`--download-sections "*${q}-${A}"`;return e=="video"&&(f=`${f} --merge-output-format mp4 -o "${S}_${W}-${te}.mp4"`),e=="audio"&&(f=`${f} ${C} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${S}_${W}-${te}.mp3"`),f}async function d(){var e;const c=F((e=o.data)==null?void 0:e.urls[0]);if(!c){L("请先播放视频");return}try{await navigator.clipboard.writeText(c),ee(`链接已复制：${c}`)}catch(s){console.error(s),L("复制失败，请手动复制")}}async function i(){var e;const c=(e=o.data)==null?void 0:e.id;if(!c){L("请先播放视频");return}try{await navigator.clipboard.writeText(c),ee(`ID已复制：${c}`)}catch(s){console.error(s),L("ID失败，请手动复制")}}async function a(c,e,s){let C="";switch(e){case"dlp":C=B(c,s);break;case"seal":C=j(c,s);break}try{await navigator.clipboard.writeText(C),ee(`命令已复制：${C}`)}catch(x){console.error(x),L("复制失败，请手动复制")}}const P=async c=>{const e=[];r.forEach((s,C)=>{console.log(`Index: ${C}`,s),e.push(B(C,c))});try{await navigator.clipboard.writeText(e.join(`
`)),ee(`命令已复制：${e.join("<br/>")}`)}catch(s){console.error(s),L("复制失败，请手动复制")}},T=$(!1);async function H(){var u;let c=F((u=o.data)==null?void 0:u.urls[0]);if(!c){L("请先播放视频");return}const e=c.match(/\/([^\/]+)\.mp4$/),s=e?e[1]:(()=>{const S=new Date;return`${S.getFullYear()}${(S.getMonth()+1).toString().padStart(2,"0")}${S.getDate().toString().padStart(2,"0")}`})(),C=r.filter(S=>S.startTime<S.endTime).map((S,q)=>`${U(S.startTime)}-${U(S.endTime)}`);if(!C.length){L("请先至少设置一个开始和结束时间");return}const x=`dlp ${T.value?"keep":"delete"} '${c}' '${s}' ${C.join(" ")}`;try{Q(x),await navigator.clipboard.writeText(x),ee(`命令已复制：${x}`)}catch(S){console.error(S),ne(S,"复制失败，请手动复制")}}async function Q(c){try{const e=await fetch("http://localhost:8080/run",{method:"POST",headers:{"Content-Type":"text/plain"},body:c});if(!e.ok)throw new Error(`HTTP 错误: ${e.status}`);const C=(await e.json()).task_id;h(C)}catch(e){ne(e,"请求失败: ")}}const m=$(!1),n=$("");function h(c){m.value=!0;const e=setInterval(async()=>{var C;let s="";try{const x=await fetch(`http://localhost:8080/progress/${c}`);if(!x.ok)throw new Error(`进度查询失败: ${x.status}`);const u=await x.json();s=(C=u.recent_log)!=null&&C.length?`

最近日志:
`+u.recent_log.join(`
`):"",u.status==="completed"&&(clearInterval(e),s=`处理完成✅ (状态: ${u.status})${s}`),u.status==="failed"&&(clearInterval(e),s=`处理完成✅ (状态: ${u.status})${s}`)}catch{clearInterval(e),s="监控失败: "}n.value=s},1e3)}const y=$(""),k=$("情感"),le=$("");async function G(c){y.value=c}async function se(c,e){var u,S,q;const s=y.value;if(s==="info"){let A=`${(u=_.data)==null?void 0:u.date}-${(S=_.data)==null?void 0:S.id} ${U(c)}-${U(e)}`;try{await navigator.clipboard.writeText(A),ee("切片信息已复制")}catch(W){console.error(W),L("复制失败，请手动复制")}return}const C=_.getSubtitles(c,e);let x="";switch(C.value.map(A=>{const W=A.time.split(".")[0]+" "+A.text+`
`;x+=W}),(q=o.data)==null?void 0:q.dsource){case"kwai":le.value=wt;break;default:le.value=kt}x+=s=="title"?_t:s=="target"?le.value.replace("_P_",k.value):"";try{await navigator.clipboard.writeText(x),ee(`${C.value.length}条字幕已复制`)}catch(A){console.error(A),L("复制失败，请手动复制")}}return(c,e)=>{const s=E("el-button"),C=E("el-input"),x=E("DocumentCopy"),u=E("el-icon"),S=E("CaretLeft"),q=E("CaretRight"),A=E("Plus"),W=E("Minus"),te=E("el-card");return O(),X(re,null,[ve(t(te,{class:"segment-control-card"},{footer:l(()=>[M("div",$t,[t(s,{plain:"",type:"success",size:"small",onClick:H},{default:l(()=>e[20]||(e[20]=[b("下载片段")])),_:1}),t(s,{plain:"",type:m.value?"warning":"primary",size:"small",onClick:e[5]||(e[5]=f=>m.value=!m.value)},{default:l(()=>e[21]||(e[21]=[b("显示日志")])),_:1},8,["type"]),t(s,{plain:"",type:"success",size:"small",onClick:d},{default:l(()=>e[22]||(e[22]=[b("复制链接")])),_:1}),t(s,{plain:"",type:"success",size:"small",onClick:i},{default:l(()=>e[23]||(e[23]=[b("复制ID")])),_:1}),t(s,{plain:"",type:"success",size:"small",onClick:e[6]||(e[6]=f=>P("video"))},{default:l(()=>e[24]||(e[24]=[b("复制命令")])),_:1})])]),default:l(()=>[M("div",mt,[t(s,{size:"small",onClick:e[0]||(e[0]=f=>v.value=!v.value),type:v.value?"success":"danger"},{default:l(()=>[b(J(v.value?"远程":"本地"),1)]),_:1},8,["type"]),t(s,{size:"small",type:y.value==="info"?"success":"info",onClick:e[1]||(e[1]=f=>G("info"))},{default:l(()=>e[7]||(e[7]=[b("取信息")])),_:1},8,["type"]),t(s,{size:"small",type:y.value==="title"?"success":"info",onClick:e[2]||(e[2]=f=>G("title"))},{default:l(()=>e[8]||(e[8]=[b("取标题")])),_:1},8,["type"]),t(s,{size:"small",type:y.value==="target"?"success":"info",onClick:e[3]||(e[3]=f=>G("target"))},{default:l(()=>e[9]||(e[9]=[b("取内容")])),_:1},8,["type"]),t(C,{size:"small",modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=f=>k.value=f),disabled:y.value!=="target",style:{flex:"1"}},null,8,["modelValue","disabled"])]),M("div",ft,[(O(!0),X(re,null,ze(r,(f,V)=>(O(),X("div",{key:f.id,class:"segment-item"},[M("div",vt,[t(s,{plain:"",type:"primary",size:"small",onClick:I=>a(V,"seal","audio")},{default:l(()=>e[10]||(e[10]=[b("SA")])),_:2},1032,["onClick"]),t(s,{plain:"",type:"primary",size:"small",onClick:I=>a(V,"seal","video")},{default:l(()=>e[11]||(e[11]=[b("SV")])),_:2},1032,["onClick"]),t(s,{plain:"",type:"primary",size:"small",onClick:I=>a(V,"dlp","audio")},{default:l(()=>e[12]||(e[12]=[b("DA")])),_:2},1032,["onClick"]),t(s,{plain:"",type:"primary",size:"small",onClick:I=>a(V,"dlp","video")},{default:l(()=>e[13]||(e[13]=[b("DV")])),_:2},1032,["onClick"]),t(C,{"model-value":w(_).secondsToTime(f.endTime-f.startTime),size:"small",readonly:""},null,8,["model-value"]),t(s,{plain:"",size:"small",type:f.isK?"success":"info",onClick:I=>f.isK=!f.isK},{default:l(()=>[b(J(f.isK?"k开":"k关"),1)]),_:2},1032,["type","onClick"]),t(s,{plain:"",size:"small",type:"success",onClick:I=>se(f.startTime,f.endTime)},{default:l(()=>[t(u,null,{default:l(()=>[t(x)]),_:1})]),_:2},1032,["onClick"])]),M("div",yt,[t(s,{plain:"",type:"success",size:"small",onClick:I=>R(V)},{default:l(()=>e[14]||(e[14]=[b("S")])),_:2},1032,["onClick"]),t(s,{plain:"",type:"success",size:"small",onClick:I=>w(o).jumpTo(w(U)(f.startTime))},{default:l(()=>e[15]||(e[15]=[b("J")])),_:2},1032,["onClick"]),t(s,{plain:"",type:"success",size:"small",onClick:I=>f.startTime=f.startTime-.5},{default:l(()=>[t(u,null,{default:l(()=>[t(S)]),_:1})]),_:2},1032,["onClick"]),t(s,{plain:"",type:"success",size:"small",onClick:I=>f.startTime=f.startTime+.5},{default:l(()=>[t(u,null,{default:l(()=>[t(q)]),_:1})]),_:2},1032,["onClick"]),t(C,{"model-value":w(U)(f.startTime),size:"small",readonly:""},null,8,["model-value"]),t(s,{plain:"",size:"small",onClick:I=>K(V),disabled:V===0||r.length===1},{default:l(()=>e[16]||(e[16]=[b("↑")])),_:2},1032,["onClick","disabled"]),t(s,{plain:"",type:"success",size:"small",onClick:I=>D(V)},{default:l(()=>[t(u,null,{default:l(()=>[t(A)]),_:1})]),_:2},1032,["onClick"])]),M("div",gt,[t(s,{plain:"",type:"danger",size:"small",onClick:I=>Z(V)},{default:l(()=>e[17]||(e[17]=[b("E")])),_:2},1032,["onClick"]),t(s,{plain:"",type:"danger",size:"small",onClick:I=>w(o).jumpTo(w(U)(f.endTime))},{default:l(()=>e[18]||(e[18]=[b("J")])),_:2},1032,["onClick"]),t(s,{plain:"",type:"danger",size:"small",onClick:I=>f.endTime=f.endTime-.5},{default:l(()=>[t(u,null,{default:l(()=>[t(S)]),_:1})]),_:2},1032,["onClick"]),t(s,{plain:"",type:"danger",size:"small",onClick:I=>f.endTime=f.endTime+.5},{default:l(()=>[t(u,null,{default:l(()=>[t(q)]),_:1})]),_:2},1032,["onClick"]),t(C,{type:"danger","model-value":w(U)(f.endTime),size:"small",readonly:""},null,8,["model-value"]),t(s,{plain:"",size:"small",onClick:I=>N(V),disabled:V===r.length-1||r.length===1},{default:l(()=>e[19]||(e[19]=[b("↓")])),_:2},1032,["onClick","disabled"]),t(s,{plain:"",type:"danger",size:"small",onClick:I=>Y(V),disabled:r.length===1},{default:l(()=>[t(u,null,{default:l(()=>[t(W)]),_:1})]),_:2},1032,["onClick","disabled"])])]))),128))])]),_:1},512),[[be,w(p).open]]),ve(t(te,{class:"log-card",style:{"max-width":"480px","z-index":"1000000 !important"}},{default:l(()=>[M("p",null,J(n.value),1)]),_:1},512),[[be,m.value]])],64)}}}),Se=Ce(ht,[["__scopeId","data-v-259b311c"]]),Ct={__name:"App",setup(g){return ce(),(o,p)=>{const _=E("el-col"),v=E("el-row"),r=E("el-container");return O(),X(re,null,[t(Se),t(r,{style:{height:"100vh"}},{default:l(()=>[t(v,{class:"grid-container"},{default:l(()=>[t(_,{class:"grid-section top"},{default:l(()=>[t(Ge)]),_:1}),t(_,{class:"grid-section bottom"},{default:l(()=>[t(nt),t(pt),t(Se)]),_:1})]),_:1})]),_:1})],64)}}},bt=Ce(Ct,[["__scopeId","data-v-d44e3bc6"]]),ue=Ne(bt);ue.use(Fe());ue.use(Pe);for(const[g,o]of Object.entries(Ue))ue.component(g,o);ue.mount("#app");
