import{E as me,i as Pe}from"./element-plus-DRLPWQh5.js";import{B as Ee,l as De,w as Me,Q as Ie,R as je,S as Le}from"./@element-plus-Dp6MuveI.js";import{r as g,j as fe,c as X,o as Y,a as I,M as J,u as $,d as ve,k as Te,ag as D,aq as Ue,O as se,L as S,P as e,I as pe,H as n,G as Se,S as Ve,w as Oe,J as we,a6 as xe,D as He,n as Ke,X as Re,Q as he,at as Ne}from"./@vue-C01xNfPK.js";import{d as ye,c as Ae}from"./pinia-CKuVeK4o.js";import{P as Fe}from"./plyr-CZIZ1zVJ.js";import{H as ce}from"./hls.js-DWnTp5j0.js";import{f as Ce}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))_(a);new MutationObserver(a=>{for(const k of a)if(k.type==="childList")for(const P of k.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&_(P)}).observe(document,{childList:!0,subtree:!0});function u(a){const k={};return a.integrity&&(k.integrity=a.integrity),a.referrerPolicy&&(k.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?k.credentials="include":a.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function _(a){if(a.ep)return;a.ep=!0;const k=u(a);fetch(a.href,k)}})();function Be(v,l="未知错误"){if(v instanceof Error)return v.message;if(typeof v=="string")return v;if(typeof v=="object"&&v!==null&&"message"in v&&typeof v.message=="string")return v.message;try{return JSON.stringify(v)}catch{return l}}const ge={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},_e=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function ne(v,l){const u=Be(v),_=l?`${l}: ${u}`:u;me.error({...ge,message:`
    <div ${_e}>
      ${_}
    </div>
    `})}function O(v){me.error({...ge,message:`
    <div ${_e}>
      ${v}
    </div>
    `})}function ee(v){me.success({...ge,message:`
    <div ${_e}>
      ${v}
    </div>
    `})}const oe=v=>{try{const[l,u]=v.split("."),[_,a,k]=l.split(":").map(Number),P=u?parseInt(u.padEnd(3,"0")):0;return _*3600+a*60+k+P/1e3}catch{return 0}},H=v=>{const l=Math.round(v%1*1e3),u=Math.floor(v),_=Math.floor(u/3600),a=Math.floor(u%3600/60),k=u%60;return`${String(_).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String(k).padStart(2,"0")}.${String(l).padStart(3,"0")}`},ae=ye("player",()=>{const v=g(""),l=g(null),u=g(null),_=g(null),a=g(null),k=g(null),P=r=>{l.value=new Fe(r,{hideControls:!1,controls:["play","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},x=r=>{N(r,!0)},B=r=>{N(r,!1)},N=(r,d)=>{a.value=r,v.value=r.date;const E=r.urls[0],U={type:"video",sources:[{src:E,type:F(E)}]};Q(U).then(()=>{var j;d&&((j=l.value)==null||j.play())})},F=r=>r.includes(".m3u8")?"application/x-mpegURL":r.includes(".flv")?"video/x-flv":"video/mp4",Q=async r=>{var E,U,j;(E=u.value)==null||E.destroy(),u.value=null,(U=_.value)==null||U.destroy(),_.value=null;const d=r.sources[0].src.includes(".m3u8")?"hls":r.sources[0].src.includes(".flv")?"flv":"html5";try{d!==k.value&&await((j=l.value)==null?void 0:j.stop()),l.value.source=r,d==="hls"&&ce.isSupported()?await q(r.sources[0].src):d==="flv"&&Ce.isSupported()&&await G(r.sources[0].src),k.value=d}catch(C){console.error("源切换失败:",C)}},q=async r=>new Promise(d=>{u.value=new ce,u.value.loadSource(r),u.value.attachMedia(l.value.media),u.value.on(ce.Events.MANIFEST_PARSED,d)}),G=async r=>{_.value=Ce.createPlayer({type:"flv",url:r}),_.value.attachMediaElement(l.value.media),_.value.load(),await _.value.play()},w=g(!1);return{player:l,initPlayer:P,switchSource:Q,playStream:x,switchStream:B,title:v,data:a,autoPlay:w,jumpTo:r=>{const d=oe(r);if(l.value&&d>0)try{l.value.currentTime=d,w.value?l.value.play():l.value.pause()}catch(E){ne(E,"跳转播放失败，请检查播放器状态")}}}}),qe={class:"video-wrapper"},Je={class:"title"},Ye={class:"plyr-container"},Qe={__name:"Player",setup(v){const l=ae(),u=g(null);return fe(()=>{l.initPlayer(u.value)}),(_,a)=>(Y(),X("div",qe,[I("h3",Je,J($(l).title),1),I("div",Ye,[I("video",{class:"player",ref_key:"videoRef",ref:u,playsinline:""},null,512)])]))}},$e=ye("editor",()=>{const v=g(!1),l=g(!1),u=g(""),_=g(null),a=5e3,k=g(a),P=i=>{l.value=!0,_.value=i,u.value=i.date,G(i.dsource)},x=g([]),B=i=>{try{const[r,d]=i.split("."),[E,U,j]=r.split(":").map(Number);return E*3600+U*60+j}catch(r){console.error(r)}},N=g(new Map),F=()=>{N.value.clear(),x.value.forEach((i,r)=>{try{const d=B(i.time);N.value.has(d)||N.value.set(d,r)}catch(d){console.error(`错误处理时间戳 ${i.time}（索引 ${r}）: ${d}`)}})},Q=i=>{if(!x.value)return;const r=k.value+i;k.value=Math.max(r,0);const d=i/1e3;x.value=x.value.map(E=>{const j=oe(E.time)+d;return{...E,time:H(Math.max(j,0))}}),F()},q=()=>{if(!x.value)return;const r=(k.value-a)/1e3;x.value=x.value.map(d=>{const U=oe(d.time)-r;return{...d,time:H(Math.max(U,0))}}),k.value=a,F()},G=async i=>{var r;v.value=!0;try{const d=Date.now(),E=await fetch(i+`/srts/${(r=_.value)==null?void 0:r.id}?t=${d}`);if(!E.ok)throw new Error(`HTTP error! status: ${E.status}`);x.value=await E.json();const U=k.value/1e3;x.value=x.value.map(j=>{const V=oe(j.time)+U;return{...j,time:H(Math.max(V,0))}}),F()}catch(d){console.error("数据获取失败:",d),ne(d,"字幕数据加载失败，请稍后重试"),x.value=[]}finally{v.value=!1}};return{open:l,title:u,edit:P,data:_,timelineData:x,loading:v,shiftCount:k,shiftSubtitles:Q,timeToSeconds:oe,secondsToTime:H,resetSubtitles:q,timeMap:N,timeToKey:B,getSubtitles:(i,r)=>{var y;const d=g([]);if(!((y=x.value)!=null&&y.length))return console.error("时间轴数据未加载"),d;const E=B(H(i)),U=B(H(r)),j=N.value.get(E),C=N.value.get(U);if(typeof j!="number"||typeof C!="number")return console.error("无法匹配有效的时间段"),d;const V=Math.max(0,j),p=Math.min(x.value.length-1,C),[s,h]=V<=p?[V,p]:[p,V];return d.value=x.value.slice(s,h+1),d}}}),Ge=["onClick"],We=["onClick"],Xe=["onClick"],Ze={style:{display:"flex",gap:"0","justify-content":"flex-end"}},et=ve({__name:"Playlist",setup(v){const l=ae(),u=$e(),_=g(""),a=g(!0),k=g([]),P=g("kwai"),x=async w=>{console.log("url:"+w+"/video.json");try{const i=await fetch(w+"/video.json");if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);k.value=await i.json()}catch(i){console.log(i),ne(i,"数据加载失败")}finally{a.value=!1}},B=Te(()=>{const w=_.value.toLowerCase();return k.value.filter(i=>i.id.toLowerCase().includes(w)||i.date.toLowerCase().includes(w))}),N=async w=>{var i;((i=w.urls)==null?void 0:i.length)>0?await Q(w.urls[0],"链接已复制到剪贴板","链接复制失败"):O("该记录没有可用的链接")},F=async w=>{w.id?await Q(w.id,"ID已复制到剪贴板","ID复制失败"):O("该记录没有可用的ID")},Q=async(w,i,r)=>{try{await navigator.clipboard.writeText(w),ee(i)}catch(d){ne(d,r)}},q=w=>{var i;(i=w.urls)!=null&&i.length&&(w.urls[0],l.switchStream(w),u.edit(w))},G=w=>{var i;(i=w.urls)!=null&&i.length&&(w.urls[0],l.playStream(w))};return fe(()=>{x("kwai")}),(w,i)=>{const r=D("el-button"),d=D("el-table-column"),E=D("el-input"),U=D("el-table"),j=Ue("loading");return Y(),X(se,null,[i[7]||(i[7]=S(" 数据源： ")),e(r,{type:P.value==="kwai"?"danger":"default",size:"small",onClick:i[0]||(i[0]=C=>{P.value="kwai",x("kwai")})},{default:n(()=>i[3]||(i[3]=[S(" 快手 ")])),_:1},8,["type"]),e(r,{type:P.value==="local"?"danger":"default",size:"small",onClick:i[1]||(i[1]=C=>{P.value="local",x("local")}),loading:a.value},{default:n(()=>i[4]||(i[4]=[S(" 本地 ")])),_:1},8,["type","loading"]),pe((Y(),Se(U,{data:B.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:n(()=>[e(d,{fixed:"",label:"序号",width:"40"},{default:n(C=>[I("span",{class:"column-text",onClick:V=>F(C.row)},J((C.$index+1).toString().padStart(4,"0")),9,Ge)]),_:1}),e(d,{fixed:"",label:"日期",prop:"date",sortable:"",width:"130"},{default:n(C=>[I("span",{class:"column-text clickable-text",onClick:V=>N(C.row)},J(C.row.date),9,We)]),_:1}),e(d,{fixed:"",label:"ID",prop:"id",width:"180"},{default:n(C=>[I("span",{class:"column-text clickable-text",onClick:V=>F(C.row)},J(C.row.id),9,Xe)]),_:1}),e(d,{fixed:"right",align:"right",width:"115"},{header:n(()=>[e(E,{modelValue:_.value,"onUpdate:modelValue":i[2]||(i[2]=C=>_.value=C),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:n(C=>{var V,p;return[I("div",Ze,[e(r,{plain:"",size:"small",onClick:s=>q(C.row),type:C.row.hasSrt?"success":"warning",disabled:!C.row.hasSrt},{default:n(()=>i[5]||(i[5]=[S(" 切片 ")])),_:2},1032,["onClick","type","disabled"]),e(r,{plain:"",size:"small",onClick:s=>G(C.row),type:(V=C.row.urls)!=null&&V.length?"success":"warning",disabled:!((p=C.row.urls)!=null&&p.length)},{default:n(()=>i[6]||(i[6]=[S(" 播放 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[j,a.value]])],64)}}}),ke=(v,l)=>{const u=v.__vccOpts||v;for(const[_,a]of l)u[_]=a;return u},tt=ke(et,[["__scopeId","data-v-ee4439a7"]]),ze=ye("picker",()=>{const v=g(!1),l=g(!1),u=g("");return g(null),g(0),{open:l,title:u,loading:v}}),nt={style:{display:"flex",gap:"0","justify-content":"flex-start"}},lt={key:0,class:"loading-state"},ot={class:"srt-time"},st=["onClick"],at={key:1,class:"empty-state"},it={class:"footer-container"},rt={class:"time-shift-controls"},ct={class:"time-shift-controls"},ut={class:"time-shift-controls"},ue=100,de=5e3,dt=ve({__name:"Editor",setup(v){const l=$e(),u=ae(),_=ze(),a=g(!1),k=()=>{u.player&&(u.player.playing?u.player.pause():u.player.play())},P=g(1e3),x=p=>{const s=P.value+p;P.value=Math.max(ue,Math.min(de,s))},B=g(["你好","晚上好","拜拜","再见"]),N=p=>B.value.some(s=>p.includes(s)),F=Te(()=>l.timelineData.map((p,s)=>({text:p.text,index:s})).filter(({text:p})=>N(p)).map(({index:p})=>p).sort((p,s)=>p-s)),Q=()=>{const p=F.value;if(p.length===0){O("未找到包含关键字的字幕行");return}let s=0,h=p.length-1,y=-1;for(;s<=h;){const b=Math.floor((s+h)/2);p[b]<r.value?(y=p[b],s=b+1):h=b-1}y===-1&&(y=p[p.length-1]),E(y)},q=()=>{const p=F.value;if(p.length===0){O("未找到包含关键字的字幕行");return}let s=0,h=p.length-1,y=-1;for(;s<=h;){const b=Math.floor((s+h)/2);p[b]>r.value?(y=p[b],h=b-1):s=b+1}y===-1&&(y=p[0]),E(y)},G=g(),w=g([]),i=p=>{p instanceof HTMLElement&&w.value.push(p)},r=g(0),d=async p=>{const s=H(p),h=l.timeToKey(s),y=l.timeMap.get(h);typeof y=="number"&&y!==r.value&&(r.value=y,await Ke(),setTimeout(()=>E(y),50))},E=p=>{const s=G.value,h=w.value[p];if(h instanceof HTMLElement&&s){const b=h.offsetTop-s.clientHeight/2;s.scrollTo({top:b,behavior:"smooth"})}},U=g(595),j=g();let C=null;fe(()=>{j.value=document.querySelector(".grid-section.bottom"),j.value&&(C=new ResizeObserver(p=>{for(const s of p){const{height:h}=s.contentRect;U.value=h}}),C.observe(j.value)),u.player.on("timeupdate",()=>{d(u.player.currentTime)}),u.player.on("play",()=>{a.value=!0}),u.player.on("pause",()=>{a.value=!1})}),Ve(()=>{C&&j.value&&C.unobserve(j.value),u.player.off("timeupdate",d),w.value=[]}),Oe(()=>l.timelineData,()=>{w.value=[]});const V=async()=>{var p,s;try{const h=(p=u.player)==null?void 0:p.media;if(!(h instanceof HTMLVideoElement)){O("无法获取视频元素");return}const y=document.createElement("canvas");y.width=h.videoWidth,y.height=h.videoHeight;const b=y.getContext("2d");if(!b){ne("无法创建画布上下文");return}b.drawImage(h,0,0,y.width,y.height);const le=y.toDataURL("image/jpeg",.9),Z=document.createElement("a"),c=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);Z.download=`capture_${(s=l.data)==null?void 0:s.id}_${c}.jpg`,Z.href=le,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),ee("截图已保存")}catch(h){ne(`截图失败: ${h instanceof Error?h.message:h}`)}};return(p,s)=>{const h=D("Camera"),y=D("el-icon"),b=D("el-button"),le=D("el-text"),Z=D("Top"),c=D("Bottom"),t=D("el-space"),o=D("el-affix"),T=D("Expand"),M=D("Minus"),z=D("el-drawer");return Y(),Se(z,{modelValue:$(l).open,"onUpdate:modelValue":s[10]||(s[10]=m=>$(l).open=m),direction:"btt",modal:!1,size:U.value,onOpened:s[11]||(s[11]=m=>$(l).shiftSubtitles(0))},{header:n(()=>[I("div",nt,[e(b,{onClick:V,size:"small",circle:""},{default:n(()=>[e(y,null,{default:n(()=>[e(h)]),_:1})]),_:1}),e(le,{class:"mx-1",type:"warning"},{default:n(()=>{var m,K;return[S(J((m=$(l).data)==null?void 0:m.date)+" - "+J((K=$(l).data)==null?void 0:K.id),1)]}),_:1})])]),default:n(()=>[I("div",{class:"timeline-container",ref_key:"containerRef",ref:G},[$(l).loading?(Y(),X("div",lt,[e(y,{class:"is-loading",color:"#409EFF",size:20},{default:n(()=>[e($(De))]),_:1}),s[12]||(s[12]=I("span",null,"正在加载字幕数据...",-1))])):we("",!0),(Y(!0),X(se,null,xe($(l).timelineData,(m,K)=>(Y(),X("div",{key:K,class:"timeline-item",ref_for:!0,ref:i},[I("span",ot,J(m.time),1),I("span",{class:He(["srt-text",{highlight:K==r.value,keyword:N(m.text)}]),onClick:A=>{d($(oe)(m.time)),$(u).jumpTo(m.time)}},J(m.text),11,st)]))),128)),!$(l).loading&&$(l).timelineData.length===0?(Y(),X("div",at,[e(y,null,{default:n(()=>[e($(Me))]),_:1}),s[13]||(s[13]=I("span",null,"暂无字幕数据",-1))])):we("",!0)],512),e(o,{class:"floating-btn",position:"bottom",offset:200},{default:n(()=>[e(t,{direction:"vertical"},{default:n(()=>[e(b,{onClick:s[0]||(s[0]=m=>$(u).autoPlay=!$(u).autoPlay),type:$(u).autoPlay?"success":""},{default:n(()=>[e(y,null,{default:n(()=>s[14]||(s[14]=[S("A")])),_:1})]),_:1},8,["type"]),e(b,{onClick:Q},{default:n(()=>[e(y,null,{default:n(()=>[e(Z)]),_:1})]),_:1}),e(b,{onClick:q},{default:n(()=>[e(y,null,{default:n(()=>[e(c)]),_:1})]),_:1}),e(b,{onClick:k,icon:a.value?$(Ie):$(je)},null,8,["icon"])]),_:1})]),_:1})]),footer:n(()=>[I("div",it,[I("div",rt,[e(b,{size:"small",type:$(_).open?"success":""},{default:n(()=>[e(y,{onClick:s[1]||(s[1]=m=>$(_).open=!$(_).open)},{default:n(()=>[e(T)]),_:1})]),_:1},8,["type"])]),I("div",ct,[e(b,{onClick:s[2]||(s[2]=m=>$(l).shiftSubtitles(-P.value)),disabled:$(l).shiftCount===0,size:"small"},{default:n(()=>[e(y,null,{default:n(()=>[e(M)]),_:1})]),_:1},8,["disabled"]),I("span",{class:"count",onClick:s[3]||(s[3]=(...m)=>$(l).resetSubtitles&&$(l).resetSubtitles(...m))},J($(l).shiftCount),1),e(b,{onClick:s[4]||(s[4]=m=>$(l).shiftSubtitles(P.value)),size:"small"},{default:n(()=>[e(y,null,{default:n(()=>[e($(Ee))]),_:1})]),_:1})]),I("div",ut,[e(b,{plain:"",type:"danger",onClick:s[5]||(s[5]=m=>x(-1e3)),disabled:P.value<=ue,size:"small"},{default:n(()=>s[15]||(s[15]=[S(" <<1000 ")])),_:1},8,["disabled"]),e(b,{plain:"",type:"danger",onClick:s[6]||(s[6]=m=>x(-100)),disabled:P.value<=ue,size:"small"},{default:n(()=>s[16]||(s[16]=[S(" <100 ")])),_:1},8,["disabled"]),I("span",{class:"count",onClick:s[7]||(s[7]=m=>P.value=1e3)},J(P.value),1),e(b,{plain:"",type:"success",onClick:s[8]||(s[8]=m=>x(100)),disabled:P.value>=de,size:"small"},{default:n(()=>s[17]||(s[17]=[S(" 100> ")])),_:1},8,["disabled"]),e(b,{plain:"",type:"success",onClick:s[9]||(s[9]=m=>x(1e3)),disabled:P.value>=de,size:"small"},{default:n(()=>s[18]||(s[18]=[S(" 1000>> ")])),_:1},8,["disabled"])])])]),_:1},8,["modelValue","size"])}}}),pt={class:"prompt-controls",style:{display:"flex",gap:"5px",margin:"5px","align-items":"center"}},mt={class:"segment-container"},ft={class:"time-controls"},vt={class:"time-controls"},yt={class:"time-controls"},gt={class:"card-footer"},_t=`
总结上面的对话内容，并参考下面的标题以及高点击率标题核心公式，运用马斯洛需求层次理论，为上面的对话内容起一个容易引起讨论的标题，不能夸大其词，不能包含不实内容，同时给出建议标签，标签要每行一个，标题和标签要方便复制：
一、参考标题
1、心智阳光健康，本科大二学生，聊天很是投缘，大冰不舍挂断
2、人为什么需要亲密关系？大冰深度分析，看完人都通透了
3、主动要礼物！聊天高端局，“泄露天机”太多，大冰“索要”礼物
4、如何把事情处理得圆润得体？大冰深度教学，家庭职场都受用
5、情侣裂痕是如何产生的？大冰深度分析，值得反复观看
6、光长年龄不长心智是一种什么体验？大冰对话32岁女画师，表现惊掉你下巴
7、颠覆你的认知：如何炼成顶级倾听力？大冰独家分享！带你突破沟通瓶颈！
8、如何把握相处的底层逻辑？大冰深度分析，职场婚姻都受用
9、精神未断奶是一种什么体验？大冰对话女硕士，思维表现大跌眼镜
10、如何克服自我否定的毛病？大冰深度教学，看完终身受益
二、高点击率标题核心公式
1、数字+痛点/利益
例：《月薪3千到3万，她靠这5个理财技巧逆袭，第3点人人可复制》。
2、疑问句+悬念
例：《为何日本核污水排海后，欧美集体沉默？背后真相远超想象》。
3、热点绑定+情绪词
例：《全网震怒！某顶流明星偷税细节曝光，经纪人一句话惹怒全网》。
4、挑战常识+颠覆认知
例：《喝粥不养胃！协和医生警告：这3种“健康习惯”反而致癌》。
5、本地化+紧迫感
例：《北京人注意！这趟地铁线路将停运3个月，明天起实施》。
`,$t=`
对以上内容进出场景划分，每个场景都以“你好/晚上好”等类似问候语开始，以“拜拜/再见/下一位”等类似问候语结束，请总结每个场景的大概内容，要如实反应，提取批判性语句和观点并保留原话，为每个场景取一个合适的毒舌标题，并给每个场景的开始和结束始时间
`,kt=`
对以上内容按观点进出场景划分，请总结每个场景的核心内容，为每个场景取一个合适的毒舌标题，并给每个场景的开始和结束始时间
`,wt=ve({__name:"Picker",setup(v){const l=ae(),u=ze(),_=$e(),a=Re([k()]);function k(){return{id:crypto.randomUUID(),startTime:0,endTime:0,duration:0,isK:!1}}const P=c=>{a.splice(c+1,0,k())},x=c=>{a.length>1&&a.splice(c,1)},B=c=>{if(c>0){const t=a.splice(c,1)[0];a.splice(c-1,0,t)}},N=c=>{if(c<a.length-1){const t=a.splice(c,1)[0];a.splice(c+1,0,t)}};function F(c){if(!l.player)return;const t=l.player.currentTime,o=a[c];o.startTime=t}function Q(c){if(!l.player)return;const t=l.player.currentTime,o=a[c];o.endTime=t}function q(c){var t;if(((t=l.data)==null?void 0:t.dsource)==="local"){const o=window.location.protocol,T=window.location.host;return`${`${o}//${T}`}/${c}`}return c}function G(c,t){var L;const o=a[c],T=o.isK?"-k":"";let M=q((L=l.data)==null?void 0:L.urls[0]);if(!M)throw O("请先播放视频"),new Error("请先播放视频");const z=M.match(/\/([^\/]+)\.mp4$/),m=z?z[1]:(()=>{const re=new Date;return`${re.getFullYear()}${(re.getMonth()+1).toString().padStart(2,"0")}${re.getDate().toString().padStart(2,"0")}`})();if(!o.startTime||!o.endTime)throw O("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const K=H(o.startTime),A=H(o.endTime),W=K.replace(/:/g,"."),te=A.replace(/:/g,".");let f="yt-dlp --no-check-certificate";f=`${f} --concurrent-fragments 16 --throttled-rate 5M `,f=`${f} --download-sections "*${K}-${A}"`;const R="~/storage/downloads/Reqable/";return t=="video"&&(f=`${f} --merge-output-format mp4 -o "${R}${m}_${W}-${te}.mp4"`),t=="audio"&&(f=`${f} ${T} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${R}${m}_${W}-${te}.mp3"`),f=`${f} '${M}' `,f}function w(c,t){var R;const o=a[c],T=o.isK?"-k":"";let M=q((R=l.data)==null?void 0:R.urls[0]);if(!M)throw O("请先播放视频"),new Error("请先播放视频");const z=M.match(/\/([^\/]+)\.mp4$/),m=z?z[1]:(()=>{const L=new Date;return`${L.getFullYear()}${(L.getMonth()+1).toString().padStart(2,"0")}${L.getDate().toString().padStart(2,"0")}`})();if(!o.startTime||!o.endTime)throw O("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const K=H(o.startTime),A=H(o.endTime),W=K.replace(/:/g,"."),te=A.replace(/:/g,".");let f=`--download-sections "*${K}-${A}"`;return t=="video"&&(f=`${f} --merge-output-format mp4 -o "${m}_${W}-${te}.mp4"`),t=="audio"&&(f=`${f} ${T} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${m}_${W}-${te}.mp3"`),f}async function i(){var t;const c=q((t=l.data)==null?void 0:t.urls[0]);if(!c){O("请先播放视频");return}try{await navigator.clipboard.writeText(c),ee(`链接已复制：${c}`)}catch(o){console.error(o),O("复制失败，请手动复制")}}async function r(){var t;const c=(t=l.data)==null?void 0:t.id;if(!c){O("请先播放视频");return}try{await navigator.clipboard.writeText(c),ee(`ID已复制：${c}`)}catch(o){console.error(o),O("ID失败，请手动复制")}}async function d(c,t,o){let T="";switch(t){case"dlp":T=G(c,o);break;case"seal":T=w(c,o);break}try{await navigator.clipboard.writeText(T),ee(`命令已复制：${T}`)}catch(M){console.error(M),O("复制失败，请手动复制")}}const E=async c=>{const t=[];a.forEach((o,T)=>{console.log(`Index: ${T}`,o),t.push(G(T,c))});try{await navigator.clipboard.writeText(t.join(`
`)),ee(`命令已复制：${t.join("<br/>")}`)}catch(o){console.error(o),O("复制失败，请手动复制")}},U=g(!1);async function j(){var z;let c=q((z=l.data)==null?void 0:z.urls[0]);if(!c){O("请先播放视频");return}const t=c.match(/\/([^\/]+)\.mp4$/),o=t?t[1]:(()=>{const m=new Date;return`${m.getFullYear()}${(m.getMonth()+1).toString().padStart(2,"0")}${m.getDate().toString().padStart(2,"0")}`})(),T=a.filter(m=>m.startTime<m.endTime).map((m,K)=>`${H(m.startTime)}-${H(m.endTime)}`);if(!T.length){O("请先至少设置一个开始和结束时间");return}const M=`dlp ${U.value?"keep":"delete"} '${c}' '${o}' ${T.join(" ")}`;try{C(M),await navigator.clipboard.writeText(M),ee(`命令已复制：${M}`)}catch(m){console.error(m),ne(m,"复制失败，请手动复制")}}async function C(c){try{const t=await fetch("http://localhost:8080/run",{method:"POST",headers:{"Content-Type":"text/plain"},body:c});if(!t.ok)throw new Error(`HTTP 错误: ${t.status}`);const T=(await t.json()).task_id;s(T)}catch(t){ne(t,"请求失败: ")}}const V=g(!1),p=g("");function s(c){V.value=!0;const t=setInterval(async()=>{var T;let o="";try{const M=await fetch(`http://localhost:8080/progress/${c}`);if(!M.ok)throw new Error(`进度查询失败: ${M.status}`);const z=await M.json();o=(T=z.recent_log)!=null&&T.length?`

最近日志:
`+z.recent_log.join(`
`):"",z.status==="completed"&&(clearInterval(t),o=`处理完成✅ (状态: ${z.status})${o}`),z.status==="failed"&&(clearInterval(t),o=`处理完成✅ (状态: ${z.status})${o}`)}catch{clearInterval(t),o="监控失败: "}p.value=o},1e3)}const h=g(""),y=g("情感"),b=g("");async function le(c){h.value=c}async function Z(c,t){var z,m,K;const o=h.value;if(o==="info"){let A=`${(z=_.data)==null?void 0:z.date}-${(m=_.data)==null?void 0:m.id} ${H(c)}-${H(t)}`;try{await navigator.clipboard.writeText(A),ee("切片信息已复制")}catch(W){console.error(W),O("复制失败，请手动复制")}return}const T=_.getSubtitles(c,t);let M="";switch(T.value.map(A=>{const W=A.time.split(".")[0]+" "+A.text+`
`;M+=W}),(K=l.data)==null?void 0:K.dsource){case"kwai":b.value=$t;break;case"seal":b.value=kt;break}M+=o=="title"?_t:o=="target"?b.value.replace("_P_",y.value):"";try{await navigator.clipboard.writeText(M),ee(`${T.value.length}条字幕已复制`)}catch(A){console.error(A),O("复制失败，请手动复制")}}return(c,t)=>{const o=D("el-button"),T=D("el-input"),M=D("DocumentCopy"),z=D("el-icon"),m=D("CaretLeft"),K=D("CaretRight"),A=D("Plus"),W=D("Minus"),te=D("el-card");return Y(),X(se,null,[pe(e(te,{class:"segment-control-card"},{footer:n(()=>[I("div",gt,[e(o,{plain:"",type:"success",size:"small",onClick:j},{default:n(()=>t[19]||(t[19]=[S("下载片段")])),_:1}),e(o,{plain:"",type:V.value?"warning":"primary",size:"small",onClick:t[4]||(t[4]=f=>V.value=!V.value)},{default:n(()=>t[20]||(t[20]=[S("显示日志")])),_:1},8,["type"]),e(o,{plain:"",type:"success",size:"small",onClick:i},{default:n(()=>t[21]||(t[21]=[S("复制链接")])),_:1}),e(o,{plain:"",type:"success",size:"small",onClick:r},{default:n(()=>t[22]||(t[22]=[S("复制ID")])),_:1}),e(o,{plain:"",type:"success",size:"small",onClick:t[5]||(t[5]=f=>E("video"))},{default:n(()=>t[23]||(t[23]=[S("复制命令")])),_:1})])]),default:n(()=>[I("div",pt,[e(o,{size:"small",type:h.value==="info"?"success":"info",onClick:t[0]||(t[0]=f=>le("info"))},{default:n(()=>t[6]||(t[6]=[S("取信息")])),_:1},8,["type"]),e(o,{size:"small",type:h.value==="title"?"success":"info",onClick:t[1]||(t[1]=f=>le("title"))},{default:n(()=>t[7]||(t[7]=[S("取标题")])),_:1},8,["type"]),e(o,{size:"small",type:h.value==="target"?"success":"info",onClick:t[2]||(t[2]=f=>le("target"))},{default:n(()=>t[8]||(t[8]=[S("取内容")])),_:1},8,["type"]),e(T,{size:"small",modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=f=>y.value=f),disabled:h.value!=="target",style:{flex:"1"}},null,8,["modelValue","disabled"])]),I("div",mt,[(Y(!0),X(se,null,xe(a,(f,R)=>(Y(),X("div",{key:f.id,class:"segment-item"},[I("div",ft,[e(o,{plain:"",type:"primary",size:"small",onClick:L=>d(R,"seal","audio")},{default:n(()=>t[9]||(t[9]=[S("SA")])),_:2},1032,["onClick"]),e(o,{plain:"",type:"primary",size:"small",onClick:L=>d(R,"seal","video")},{default:n(()=>t[10]||(t[10]=[S("SV")])),_:2},1032,["onClick"]),e(o,{plain:"",type:"primary",size:"small",onClick:L=>d(R,"dlp","audio")},{default:n(()=>t[11]||(t[11]=[S("DA")])),_:2},1032,["onClick"]),e(o,{plain:"",type:"primary",size:"small",onClick:L=>d(R,"dlp","video")},{default:n(()=>t[12]||(t[12]=[S("DV")])),_:2},1032,["onClick"]),e(T,{"model-value":$(_).secondsToTime(f.endTime-f.startTime),size:"small",readonly:""},null,8,["model-value"]),e(o,{plain:"",size:"small",type:f.isK?"success":"info",onClick:L=>f.isK=!f.isK},{default:n(()=>[S(J(f.isK?"k开":"k关"),1)]),_:2},1032,["type","onClick"]),e(o,{plain:"",size:"small",type:"success",onClick:L=>Z(f.startTime,f.endTime)},{default:n(()=>[e(z,null,{default:n(()=>[e(M)]),_:1})]),_:2},1032,["onClick"])]),I("div",vt,[e(o,{plain:"",type:"success",size:"small",onClick:L=>F(R)},{default:n(()=>t[13]||(t[13]=[S("S")])),_:2},1032,["onClick"]),e(o,{plain:"",type:"success",size:"small",onClick:L=>$(l).jumpTo($(H)(f.startTime))},{default:n(()=>t[14]||(t[14]=[S("J")])),_:2},1032,["onClick"]),e(o,{plain:"",type:"success",size:"small",onClick:L=>f.startTime=f.startTime-.5},{default:n(()=>[e(z,null,{default:n(()=>[e(m)]),_:1})]),_:2},1032,["onClick"]),e(o,{plain:"",type:"success",size:"small",onClick:L=>f.startTime=f.startTime+.5},{default:n(()=>[e(z,null,{default:n(()=>[e(K)]),_:1})]),_:2},1032,["onClick"]),e(T,{"model-value":$(H)(f.startTime),size:"small",readonly:""},null,8,["model-value"]),e(o,{plain:"",size:"small",onClick:L=>B(R),disabled:R===0||a.length===1},{default:n(()=>t[15]||(t[15]=[S("↑")])),_:2},1032,["onClick","disabled"]),e(o,{plain:"",type:"success",size:"small",onClick:L=>P(R)},{default:n(()=>[e(z,null,{default:n(()=>[e(A)]),_:1})]),_:2},1032,["onClick"])]),I("div",yt,[e(o,{plain:"",type:"danger",size:"small",onClick:L=>Q(R)},{default:n(()=>t[16]||(t[16]=[S("E")])),_:2},1032,["onClick"]),e(o,{plain:"",type:"danger",size:"small",onClick:L=>$(l).jumpTo($(H)(f.endTime))},{default:n(()=>t[17]||(t[17]=[S("J")])),_:2},1032,["onClick"]),e(o,{plain:"",type:"danger",size:"small",onClick:L=>f.endTime=f.endTime-.5},{default:n(()=>[e(z,null,{default:n(()=>[e(m)]),_:1})]),_:2},1032,["onClick"]),e(o,{plain:"",type:"danger",size:"small",onClick:L=>f.endTime=f.endTime+.5},{default:n(()=>[e(z,null,{default:n(()=>[e(K)]),_:1})]),_:2},1032,["onClick"]),e(T,{type:"danger","model-value":$(H)(f.endTime),size:"small",readonly:""},null,8,["model-value"]),e(o,{plain:"",size:"small",onClick:L=>N(R),disabled:R===a.length-1||a.length===1},{default:n(()=>t[18]||(t[18]=[S("↓")])),_:2},1032,["onClick","disabled"]),e(o,{plain:"",type:"danger",size:"small",onClick:L=>x(R),disabled:a.length===1},{default:n(()=>[e(z,null,{default:n(()=>[e(W)]),_:1})]),_:2},1032,["onClick","disabled"])])]))),128))])]),_:1},512),[[he,$(u).open]]),pe(e(te,{class:"log-card",style:{"max-width":"480px","z-index":"1000000 !important"}},{default:n(()=>[I("p",null,J(p.value),1)]),_:1},512),[[he,V.value]])],64)}}}),be=ke(wt,[["__scopeId","data-v-d042cbe0"]]),ht={__name:"App",setup(v){return ae(),(l,u)=>{const _=D("el-col"),a=D("el-row"),k=D("el-container");return Y(),X(se,null,[e(be),e(k,{style:{height:"100vh"}},{default:n(()=>[e(a,{class:"grid-container"},{default:n(()=>[e(_,{class:"grid-section top"},{default:n(()=>[e(Qe)]),_:1}),e(_,{class:"grid-section bottom"},{default:n(()=>[e(tt),e(dt),e(be)]),_:1})]),_:1})]),_:1})],64)}}},Ct=ke(ht,[["__scopeId","data-v-d44e3bc6"]]),ie=Ne(Ct);ie.use(Ae());ie.use(Pe);for(const[v,l]of Object.entries(Le))ie.component(v,l);ie.mount("#app");
