import{E as Y,i as ie}from"./element-plus-CPntL8j2.js";import{f as j,g as N,B as re,l as ue,w as ce,Q as de}from"./@element-plus-By79ymwD.js";import{r as y,j as R,c as D,o as S,a as C,M as z,u as f,ag as x,P as e,H as l,L,d as q,I as Z,Q as fe,G as B,O as J,a6 as ee,k as te,S as pe,w as me,J as W,D as ve,n as _e,aq as ye,at as ge}from"./@vue-C01xNfPK.js";import{d as Q,c as he}from"./pinia-CKuVeK4o.js";import{P as be}from"./plyr-CZIZ1zVJ.js";import{H as U}from"./hls.js-DWnTp5j0.js";import{f as X}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const m of n)if(m.type==="childList")for(const g of m.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&a(g)}).observe(document,{childList:!0,subtree:!0});function d(n){const m={};return n.integrity&&(m.integrity=n.integrity),n.referrerPolicy&&(m.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?m.credentials="include":n.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function a(n){if(n.ep)return;n.ep=!0;const m=d(n);fetch(n.href,m)}})();const V=Q("player",()=>{const p=y(""),s=y(null),d=y(null),a=y(null),n=y(null),m=y(null),g=w=>{s.value=new be(w,{hideControls:!1,controls:["play-large","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},M=w=>{n.value=w,p.value=w.date;const i=w.urls[0],_={type:"video",sources:[{src:i,type:$(i)}]};P(_).then(()=>{var c;return(c=s.value)==null?void 0:c.play()})},$=w=>w.includes(".m3u8")?"application/x-mpegURL":w.includes(".flv")?"video/x-flv":"video/mp4",P=async w=>{var _,c,v;(_=d.value)==null||_.destroy(),d.value=null,(c=a.value)==null||c.destroy(),a.value=null;const i=w.sources[0].src.includes(".m3u8")?"hls":w.sources[0].src.includes(".flv")?"flv":"html5";try{i!==m.value&&await((v=s.value)==null?void 0:v.stop()),s.value.source=w,i==="hls"&&U.isSupported()?await T(w.sources[0].src):i==="flv"&&X.isSupported()&&await E(w.sources[0].src),m.value=i}catch(h){console.error("源切换失败:",h)}},T=async w=>new Promise(i=>{d.value=new U,d.value.loadSource(w),d.value.attachMedia(s.value.media),d.value.on(U.Events.MANIFEST_PARSED,i)}),E=async w=>{a.value=X.createPlayer({type:"flv",url:w}),a.value.attachMediaElement(s.value.media),a.value.load(),await a.value.play()};return{player:s,initPlayer:g,switchSource:P,playStream:M,title:p,data:n}}),we={class:"video-wrapper"},ke={class:"title"},Ce={class:"plyr-container"},xe={__name:"Player",setup(p){const s=V(),d=y(null);return R(()=>{s.initPlayer(d.value)}),(a,n)=>(S(),D("div",we,[C("h3",ke,z(f(s).title),1),C("div",Ce,[C("video",{class:"player",ref_key:"videoRef",ref:d,playsinline:""},null,512)])]))}};function Se(p,s="未知错误"){if(p instanceof Error)return p.message;if(typeof p=="string")return p;if(typeof p=="object"&&p!==null&&"message"in p&&typeof p.message=="string")return p.message;try{return JSON.stringify(p)}catch{return s}}function I(p,s){const d=Se(p),a=s?`${s}: ${d}`:d;Y.error({message:a,offset:600,duration:3e3})}function $e(p){Y.success({message:p,offset:600,duration:3e3})}const G=Q("editor",()=>{const p=y(!1),s=y(!1),d=y(""),a=y(null),n=y(0),m=c=>{s.value=!0,a.value=c,d.value=c.date,_()},g=y([]),M=c=>{try{const[v,h]=c.split("."),[o,t,u]=v.split(":").map(Number),r=h?parseInt(h.padEnd(3,"0")):0;return o*3600+t*60+u+r/1e3}catch{return 0}},$=c=>{const v=Math.round(c%1*1e3),h=Math.floor(c),o=Math.floor(h/3600),t=Math.floor(h%3600/60),u=h%60;return`${String(o).padStart(2,"0")}:${String(t).padStart(2,"0")}:${String(u).padStart(2,"0")}.${String(v).padStart(3,"0")}`},P=c=>{try{const[v,h]=c.split("."),[o,t,u]=v.split(":").map(Number);return o*3600+t*60+u}catch(v){console.error(v)}},T=y(new Map),E=()=>{T.value.clear(),g.value.forEach((c,v)=>{try{const h=P(c.time);T.value.has(h)||T.value.set(h,v)}catch(h){console.error(`错误处理时间戳 ${c.time}（索引 ${v}）: ${h}`)}})},w=c=>{if(!g.value)return;const v=n.value+c;n.value=Math.max(v,0);const h=c/1e3;g.value=g.value.map(o=>{const u=M(o.time)+h;return{...o,time:$(Math.max(u,0))}}),E()},i=()=>{if(g.value){if(n.value){const c=n.value/1e3;g.value=g.value.map(v=>{const o=M(v.time)-c;return{...v,time:$(Math.max(o,0))}})}n.value=0,E()}},_=async()=>{var c;p.value=!0;try{const v=await fetch(`srts/${(c=a.value)==null?void 0:c.id}`);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);if(g.value=await v.json(),n.value){const h=n.value/1e3;g.value=g.value.map(o=>{const u=M(o.time)+h;return{...o,time:$(Math.max(u,0))}})}E()}catch(v){console.error("数据获取失败:",v),I(v,"字幕数据加载失败，请稍后重试"),g.value=[]}finally{p.value=!1}};return{open:s,title:d,edit:m,data:a,timelineData:g,loading:p,shiftCount:n,shiftSubtitles:w,timeToSeconds:M,secondsToTime:$,resetSubtitles:i,timeMap:T,timeToKey:P}}),se=(p,s)=>{const d=p.__vccOpts||p;for(const[a,n]of s)d[a]=n;return d},Te={class:"button-rows"},Me={__name:"Control",setup(p){const s=V(),d=G();return R(()=>{}),(a,n)=>{const m=x("el-button");return S(),D("div",Te,[e(m,{size:"small",onClick:n[0]||(n[0]=g=>f(d).edit(f(s).data))},{default:l(()=>n[1]||(n[1]=[L(" 编辑 ")])),_:1})])}}},Pe=se(Me,[["__scopeId","data-v-033f34de"]]),ne=Q("picker",()=>{const p=y(!1),s=y(!1),d=y("");return y(null),y(0),{open:s,title:d,loading:p}}),Ee={style:{display:"flex",gap:"0","justify-content":"center"}},ze=q({__name:"Picker",setup(p){const s=ne();return(d,a)=>{const n=x("el-button"),m=x("el-card");return Z((S(),B(m,{style:{"max-width":"480px"}},{footer:l(()=>[C("div",Ee,[e(n,{size:"small",onClick:a[0]||(a[0]=()=>{})},{default:l(()=>a[3]||(a[3]=[L(" 加行 ")])),_:1}),e(n,{size:"small",onClick:a[1]||(a[1]=()=>{})},{default:l(()=>a[4]||(a[4]=[L(" 下载 ")])),_:1}),e(n,{size:"small",onClick:a[2]||(a[2]=()=>{})},{default:l(()=>a[5]||(a[5]=[L(" 复制 ")])),_:1})])]),default:l(()=>[(S(),D(J,null,ee(40,g=>C("p",{key:g,class:"text item"},z("List item "+g),1)),64))]),_:1},512)),[[fe,f(s).open]])}}}),De={style:{display:"flex",gap:"10px","justify-content":"flex-start","margin-right":"10px"}},Ie={key:0,class:"loading-state"},Le={class:"time-label"},je=["onClick"],Ne={key:1,class:"empty-state"},Ve={class:"footer-container"},He={class:"time-shift-controls"},Oe={class:"time-shift-controls"},H=50,O=5e3,Re=q({__name:"Editor",setup(p){const s=G(),d=V(),a=ne(),n=y(1e3),m=o=>{const t=n.value+o;n.value=Math.max(H,Math.min(O,t))},g=o=>{const t=s.timeToSeconds(o);if(d.player&&t>0)try{d.player.currentTime=t,d.player.play()}catch(u){I(u,"跳转播放失败，请检查播放器状态")}},M=y(["你好","晚上好","拜拜","再见"]),$=o=>M.value.some(t=>o.includes(t)),P=te(()=>s.timelineData.map((o,t)=>({text:o.text,index:t})).filter(({text:o})=>$(o)).map(({index:o})=>o).sort((o,t)=>o-t)),T=()=>{const o=P.value;if(o.length===0){I("未找到包含关键字的字幕行");return}let t=0,u=o.length-1,r=-1;for(;t<=u;){const b=Math.floor((t+u)/2);o[b]<c.value?(r=o[b],t=b+1):u=b-1}r===-1&&(r=o[o.length-1]),h(r)},E=()=>{const o=P.value;if(o.length===0){I("未找到包含关键字的字幕行");return}let t=0,u=o.length-1,r=-1;for(;t<=u;){const b=Math.floor((t+u)/2);o[b]>c.value?(r=o[b],u=b-1):t=b+1}r===-1&&(r=o[0]),h(r)},w=y(),i=y([]),_=o=>{o instanceof HTMLElement&&i.value.push(o)},c=y(0),v=async()=>{if(!d.player)return;const o=d.player.currentTime,t=s.secondsToTime(o),u=s.timeToKey(t),r=s.timeMap.get(u);typeof r=="number"&&r!==c.value&&(c.value=r,await _e(),setTimeout(()=>h(r),50))},h=o=>{const t=w.value,u=i.value[o];if(u instanceof HTMLElement&&t){const b=u.offsetTop-t.clientHeight/2;t.scrollTo({top:b,behavior:"smooth"})}};return R(()=>{d.player.on("timeupdate",v)}),pe(()=>{d.player.off("timeupdate",v),i.value=[]}),me(()=>s.timelineData,()=>{i.value=[]}),(o,t)=>{const u=x("Expand"),r=x("el-icon"),b=x("el-button"),F=x("Top"),le=x("Bottom"),oe=x("Minus"),ae=x("el-drawer");return S(),B(ae,{modelValue:f(s).open,"onUpdate:modelValue":t[11]||(t[11]=k=>f(s).open=k),direction:"btt",modal:!1,size:"595",onOpened:t[12]||(t[12]=k=>f(s).shiftSubtitles(0))},{header:l(()=>{var k;return[C("div",De,[e(b,{size:"small",type:f(a).open?"danger":"",circle:""},{default:l(()=>[e(r,{onClick:t[0]||(t[0]=K=>f(a).open=!f(a).open)},{default:l(()=>[e(u)]),_:1})]),_:1},8,["type"]),e(b,{size:"small",circle:""},{default:l(()=>[e(r,{onClick:T},{default:l(()=>[e(F)]),_:1})]),_:1}),e(b,{size:"small",circle:""},{default:l(()=>[e(r,{onClick:E},{default:l(()=>[e(le)]),_:1})]),_:1}),L(" "+z((k=f(s).data)==null?void 0:k.id),1)])]}),default:l(()=>[e(ze),C("div",{class:"timeline-container",ref_key:"containerRef",ref:w},[f(s).loading?(S(),D("div",Ie,[e(r,{class:"is-loading",color:"#409EFF",size:20},{default:l(()=>[e(f(ue))]),_:1}),t[13]||(t[13]=C("span",null,"正在加载字幕数据...",-1))])):W("",!0),(S(!0),D(J,null,ee(f(s).timelineData,(k,K)=>(S(),D("div",{key:K,class:ve(["timeline-item",{highlight:K==c.value,keyword:$(k.text)}]),ref_for:!0,ref:_},[C("span",Le,z(k.time),1),C("span",{class:"content-text",onClick:Je=>g(k.time)},z(k.text),9,je)],2))),128)),!f(s).loading&&f(s).timelineData.length===0?(S(),D("div",Ne,[e(r,null,{default:l(()=>[e(f(ce))]),_:1}),t[14]||(t[14]=C("span",null,"暂无字幕数据",-1))])):W("",!0)],512)]),footer:l(()=>[C("div",Ve,[C("div",He,[e(b,{onClick:t[1]||(t[1]=k=>m(-1e3)),disabled:n.value<=H,size:"small"},{default:l(()=>[e(r,null,{default:l(()=>[e(f(j))]),_:1}),e(r,null,{default:l(()=>[e(f(j))]),_:1}),e(r,null,{default:l(()=>[e(f(j))]),_:1})]),_:1},8,["disabled"]),e(b,{onClick:t[2]||(t[2]=k=>m(-500)),disabled:n.value<=H,size:"small"},{default:l(()=>[e(r,null,{default:l(()=>[e(f(j))]),_:1}),e(r,null,{default:l(()=>[e(f(j))]),_:1})]),_:1},8,["disabled"]),e(b,{onClick:t[3]||(t[3]=k=>m(-50)),disabled:n.value<=H,size:"small"},{default:l(()=>[e(r,null,{default:l(()=>[e(f(j))]),_:1})]),_:1},8,["disabled"]),C("span",{class:"count",onClick:t[4]||(t[4]=k=>n.value=50)},z(n.value),1),e(b,{onClick:t[5]||(t[5]=k=>m(50)),disabled:n.value>=O,size:"small"},{default:l(()=>[e(r,null,{default:l(()=>[e(f(N))]),_:1})]),_:1},8,["disabled"]),e(b,{onClick:t[6]||(t[6]=k=>m(500)),disabled:n.value>=O,size:"small"},{default:l(()=>[e(r,null,{default:l(()=>[e(f(N))]),_:1}),e(r,null,{default:l(()=>[e(f(N))]),_:1})]),_:1},8,["disabled"]),e(b,{onClick:t[7]||(t[7]=k=>m(1e3)),disabled:n.value>=O,size:"small"},{default:l(()=>[e(r,null,{default:l(()=>[e(f(N))]),_:1}),e(r,null,{default:l(()=>[e(f(N))]),_:1}),e(r,null,{default:l(()=>[e(f(N))]),_:1})]),_:1},8,["disabled"])]),C("div",Oe,[e(b,{onClick:t[8]||(t[8]=k=>f(s).shiftSubtitles(-n.value)),disabled:f(s).shiftCount===0},{default:l(()=>[e(r,null,{default:l(()=>[e(oe)]),_:1})]),_:1},8,["disabled"]),C("span",{class:"count",onClick:t[9]||(t[9]=(...k)=>f(s).resetSubtitles&&f(s).resetSubtitles(...k))},z(f(s).shiftCount),1),e(b,{onClick:t[10]||(t[10]=k=>f(s).shiftSubtitles(n.value))},{default:l(()=>[e(r,null,{default:l(()=>[e(f(re))]),_:1})]),_:1})])])]),_:1},8,["modelValue"])}}}),Be=["onClick"],Ae=["onClick"],Fe={style:{display:"flex",gap:"0","justify-content":"flex-end"}},Ke=q({__name:"Playlist",setup(p){const s=V(),d=G(),a=y(""),n=y(!0),m=y([]),g=async()=>{try{const i=await fetch("video.json");if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);m.value=await i.json()}catch(i){I(i,"数据加载失败")}finally{n.value=!1}},M=te(()=>{const i=a.value.toLowerCase();return m.value.filter(_=>_.id.toLowerCase().includes(i)||_.date.toLowerCase().includes(i))}),$=async i=>{var _;((_=i.urls)==null?void 0:_.length)>0?await T(i.urls[0],"链接已复制到剪贴板","链接复制失败"):I("该记录没有可用的链接")},P=async i=>{i.id?await T(i.id,"ID已复制到剪贴板","ID复制失败"):I("该记录没有可用的ID")},T=async(i,_,c)=>{try{await navigator.clipboard.writeText(i),$e(_)}catch(v){I(v,c)}},E=i=>{var _;(_=i.urls)!=null&&_.length&&(i.urls[0],s.playStream(i),d.edit(i))},w=i=>{var _;(_=i.urls)!=null&&_.length&&(i.urls[0],s.playStream(i))};return R(()=>{g()}),(i,_)=>{const c=x("el-table-column"),v=x("el-input"),h=x("el-button"),o=x("el-table"),t=ye("loading");return S(),D(J,null,[Z((S(),B(o,{data:M.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:l(()=>[e(c,{fixed:"",label:"日期",prop:"date",sortable:"",width:"140"},{default:l(u=>[C("span",{class:"clickable-text",onClick:r=>$(u.row)},z(u.row.date),9,Be)]),_:1}),e(c,{fixed:"",label:"标识",prop:"id",width:"180"},{default:l(u=>[C("span",{class:"clickable-text",onClick:r=>P(u.row)},z(u.row.id),9,Ae)]),_:1}),e(c,{fixed:"right",align:"right",width:"115"},{header:l(()=>[e(v,{modelValue:a.value,"onUpdate:modelValue":_[0]||(_[0]=u=>a.value=u),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:l(u=>{var r,b;return[C("div",Fe,[e(h,{size:"small",onClick:F=>E(u.row),disabled:!((r=u.row.urls)!=null&&r.length)},{default:l(()=>_[1]||(_[1]=[L(" 编辑 ")])),_:2},1032,["onClick","disabled"]),e(h,{size:"small",onClick:F=>w(u.row),disabled:!((b=u.row.urls)!=null&&b.length)},{default:l(()=>_[2]||(_[2]=[L(" 播放 ")])),_:2},1032,["onClick","disabled"])])]}),_:1})]),_:1},8,["data"])),[[t,n.value]]),e(Re)],64)}}}),Ue={__name:"App",setup(p){return V(),(s,d)=>{const a=x("el-col"),n=x("el-row"),m=x("el-container");return S(),B(m,{style:{height:"100vh"}},{default:l(()=>[e(n,{class:"grid-container"},{default:l(()=>[e(a,{class:"grid-section top"},{default:l(()=>[e(xe)]),_:1}),e(a,{class:"grid-section middle"},{default:l(()=>[e(Pe)]),_:1}),e(a,{class:"grid-section bottom"},{default:l(()=>[e(Ke)]),_:1})]),_:1})]),_:1})}}},qe=se(Ue,[["__scopeId","data-v-78e66ddb"]]),A=ge(qe);A.use(he());A.use(ie);for(const[p,s]of Object.entries(de))A.component(p,s);A.mount("#app");
