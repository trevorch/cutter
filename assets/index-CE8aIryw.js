import{E as ve,i as De}from"./element-plus-DRLPWQh5.js";import{B as Pe,l as Ee,w as Me,Q as Ie,R as je,S as Le}from"./@element-plus-Dp6MuveI.js";import{r as $,j as ye,c as X,o as A,a as M,M as Q,u as w,d as ge,k as Se,ag as E,aq as Ue,O as ie,P as e,I as fe,H as l,L as C,G as se,J as ae,S as Ve,w as Oe,a6 as xe,D as Ke,n as He,X as Re,Q as Ce,at as Ae}from"./@vue-C01xNfPK.js";import{d as $e,c as Ne}from"./pinia-CKuVeK4o.js";import{P as Fe}from"./plyr-CZIZ1zVJ.js";import{H as de}from"./hls.js-DWnTp5j0.js";import{f as be}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))_(r);new MutationObserver(r=>{for(const h of r)if(h.type==="childList")for(const x of h.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&_(x)}).observe(document,{childList:!0,subtree:!0});function d(r){const h={};return r.integrity&&(h.integrity=r.integrity),r.referrerPolicy&&(h.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?h.credentials="include":r.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function _(r){if(r.ep)return;r.ep=!0;const h=d(r);fetch(r.href,h)}})();function Be(y,o="未知错误"){if(y instanceof Error)return y.message;if(typeof y=="string")return y;if(typeof y=="object"&&y!==null&&"message"in y&&typeof y.message=="string")return y.message;try{return JSON.stringify(y)}catch{return o}}const _e={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},we=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function ne(y,o){const d=Be(y),_=o?`${o}: ${d}`:d;ve.error({..._e,message:`
    <div ${we}>
      ${_}
    </div>
    `})}function L(y){ve.error({..._e,message:`
    <div ${we}>
      ${y}
    </div>
    `})}function ee(y){ve.success({..._e,message:`
    <div ${we}>
      ${y}
    </div>
    `})}const oe=y=>{try{const[o,d]=y.split("."),[_,r,h]=o.split(":").map(Number),x=d?parseInt(d.padEnd(3,"0")):0;return _*3600+r*60+h+x/1e3}catch{return 0}},U=y=>{const o=Math.round(y%1*1e3),d=Math.floor(y),_=Math.floor(d/3600),r=Math.floor(d%3600/60),h=d%60;return`${String(_).padStart(2,"0")}:${String(r).padStart(2,"0")}:${String(h).padStart(2,"0")}.${String(o).padStart(3,"0")}`},re=$e("player",()=>{const y=$(""),o=$(null),d=$(null),_=$(null),r=$(null),h=$(null),x=u=>{o.value=new Fe(u,{hideControls:!1,controls:["play","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},z=u=>{K(u,!0)},q=u=>{K(u,!1)},K=(u,a)=>{r.value=u,y.value=u.date;const i=u.urls[0],D={type:"video",sources:[{src:i,type:B(i)}]};N(D).then(()=>{var S;a&&((S=o.value)==null||S.play())})},B=u=>u.includes(".m3u8")?"application/x-mpegURL":u.includes(".flv")?"video/x-flv":"video/mp4",N=async u=>{var i,D,S;(i=d.value)==null||i.destroy(),d.value=null,(D=_.value)==null||D.destroy(),_.value=null;const a=u.sources[0].src.includes(".m3u8")?"hls":u.sources[0].src.includes(".flv")?"flv":"html5";try{a!==h.value&&await((S=o.value)==null?void 0:S.stop()),o.value.source=u,a==="hls"&&de.isSupported()?await J(u.sources[0].src):a==="flv"&&be.isSupported()&&await G(u.sources[0].src),h.value=a}catch(F){console.error("源切换失败:",F)}},J=async u=>new Promise(a=>{d.value=new de,d.value.loadSource(u),d.value.attachMedia(o.value.media),d.value.on(de.Events.MANIFEST_PARSED,a)}),G=async u=>{_.value=be.createPlayer({type:"flv",url:u}),_.value.attachMediaElement(o.value.media),_.value.load(),await _.value.play()},Y=$(!1);return{player:o,initPlayer:x,switchSource:N,playStream:z,switchStream:q,title:y,data:r,autoPlay:Y,jumpTo:u=>{const a=oe(u);if(o.value&&a>0)try{o.value.currentTime=a,Y.value?o.value.play():o.value.pause()}catch(i){ne(i,"跳转播放失败，请检查播放器状态")}}}}),qe={class:"video-wrapper"},Je={class:"title"},Ye={class:"plyr-container"},Qe={__name:"Player",setup(y){const o=re(),d=$(null);return ye(()=>{o.initPlayer(d.value)}),(_,r)=>(A(),X("div",qe,[M("h3",Je,Q(w(o).title),1),M("div",Ye,[M("video",{class:"player",ref_key:"videoRef",ref:d,playsinline:""},null,512)])]))}},ke=$e("editor",()=>{const y=$(!1),o=$(!1),d=$(""),_=$(null),r=5e3,h=$(r),x=j=>{o.value=!0,_.value=j,d.value=j.date,G(j.dsource)},z=$([]),q=j=>{try{const[u,a]=j.split("."),[i,D,S]=u.split(":").map(Number);return i*3600+D*60+S}catch(u){console.error(u)}},K=$(new Map),B=()=>{K.value.clear(),z.value.forEach((j,u)=>{try{const a=q(j.time);K.value.has(a)||K.value.set(a,u)}catch(a){console.error(`错误处理时间戳 ${j.time}（索引 ${u}）: ${a}`)}})},N=j=>{if(!z.value)return;const u=h.value+j;h.value=Math.max(u,0);const a=j/1e3;z.value=z.value.map(i=>{const S=oe(i.time)+a;return{...i,time:U(Math.max(S,0))}}),B()},J=()=>{if(!z.value)return;const u=(h.value-r)/1e3;z.value=z.value.map(a=>{const D=oe(a.time)-u;return{...a,time:U(Math.max(D,0))}}),h.value=r,B()},G=async j=>{var u;y.value=!0;try{const a=Date.now(),i=await fetch(j+`/srts/${(u=_.value)==null?void 0:u.id}?t=${a}`);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);z.value=await i.json();const D=h.value/1e3;z.value=z.value.map(S=>{const H=oe(S.time)+D;return{...S,time:U(Math.max(H,0))}}),B()}catch(a){console.error("数据获取失败:",a),ne(a,"字幕数据加载失败，请稍后重试"),z.value=[]}finally{y.value=!1}};return{open:o,title:d,edit:x,data:_,timelineData:z,loading:y,shiftCount:h,shiftSubtitles:N,timeToSeconds:oe,secondsToTime:U,resetSubtitles:J,timeMap:K,timeToKey:q,getSubtitles:(j,u)=>{var v;const a=$([]);if(!((v=z.value)!=null&&v.length))return console.error("时间轴数据未加载"),a;const i=q(U(j)),D=q(U(u)),S=K.value.get(i),F=K.value.get(D);if(typeof S!="number"||typeof F!="number")return console.error("无法匹配有效的时间段"),a;const H=Math.max(0,S),m=Math.min(z.value.length-1,F),[t,g]=H<=m?[H,m]:[m,H];return a.value=z.value.slice(t,g+1),a}}}),Ge=["onClick"],We=["onClick"],Xe=["onClick"],Ze={style:{display:"flex","justify-content":"flex-end","overflow-x":"auto","overflow-y":"hidden"}},et=ge({__name:"Playlist",setup(y){const o=re(),d=ke(),_=$(""),r=$(!0),h=$([]),x=$("tube"),z=async a=>{console.log("url:"+a+"/video.json");try{const i=await fetch(a+"/video.json");if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);h.value=await i.json()}catch(i){console.log(i),ne(i,"数据加载失败")}finally{r.value=!1}},q=Se(()=>{const a=_.value.toLowerCase();return h.value.filter(i=>i.id.toLowerCase().includes(a)||i.date.toLowerCase().includes(a))}),K=async a=>{var i;((i=a.urls)==null?void 0:i.length)>0?await N(a.urls[0],"链接已复制到剪贴板","链接复制失败"):L("该记录没有可用的链接")},B=async a=>{a.id?await N(a.id,"ID已复制到剪贴板","ID复制失败"):L("该记录没有可用的ID")},N=async(a,i,D)=>{try{await navigator.clipboard.writeText(a),ee(i)}catch(S){ne(S,D)}},J=async a=>{await N(`ytmp4 ${a.id}`,"视频下载命令已复制到剪贴板","复制失败")},G=async a=>{await N(`gdmp3 '${a.urls[0]}' ${a.id}`,"音频下载命令已复制到剪贴板","复制失败")},Y=async a=>{await N(`ytmp3 ${a.id}`,"音频下载命令已复制到剪贴板","复制失败")},j=a=>{var i;(i=a.urls)!=null&&i.length&&(a.urls[0],o.switchStream(a),d.edit(a))},u=a=>{var i;(i=a.urls)!=null&&i.length&&(a.urls[0],o.playStream(a))};return ye(()=>{z("tube")}),(a,i)=>{const D=E("el-button"),S=E("el-table-column"),F=E("el-input"),H=E("el-table"),m=Ue("loading");return A(),X(ie,null,[e(D,{type:x.value==="tube"?"danger":"default",size:"small",onClick:i[0]||(i[0]=t=>{x.value="tube",z("tube")})},{default:l(()=>i[4]||(i[4]=[C(" 馆长 ")])),_:1},8,["type"]),e(D,{type:x.value==="local"?"danger":"default",size:"small",onClick:i[1]||(i[1]=t=>{x.value="local",z("local")}),loading:r.value},{default:l(()=>i[5]||(i[5]=[C(" 本地 ")])),_:1},8,["type","loading"]),e(D,{type:x.value==="kwai"?"danger":"default",size:"small",onClick:i[2]||(i[2]=t=>{x.value="kwai",z("kwai")})},{default:l(()=>i[6]||(i[6]=[C(" 快手 ")])),_:1},8,["type"]),fe((A(),se(H,{data:q.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:l(()=>[e(S,{fixed:"",label:"序号",width:"40"},{default:l(t=>[M("span",{class:"column-text",onClick:g=>B(t.row)},Q((t.$index+1).toString().padStart(4,"0")),9,Ge)]),_:1}),e(S,{fixed:"",label:"日期",prop:"date",sortable:"",width:"100"},{default:l(t=>[M("span",{class:"column-text clickable-text",onClick:g=>K(t.row)},Q(t.row.date),9,We)]),_:1}),e(S,{fixed:"",label:"ID",prop:"id",width:"130"},{default:l(t=>[M("span",{class:"column-text clickable-text",onClick:g=>B(t.row)},Q(t.row.id),9,Xe)]),_:1}),e(S,{fixed:"right",align:"right",width:"200"},{header:l(()=>[e(F,{modelValue:_.value,"onUpdate:modelValue":i[3]||(i[3]=t=>_.value=t),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:l(t=>{var g,v;return[M("div",Ze,[t.row.dsource==="kwai"?(A(),se(D,{key:0,plain:"",size:"small",onClick:k=>G(t.row),type:"primary"},{default:l(()=>i[7]||(i[7]=[C(" 下音 ")])),_:2},1032,["onClick"])):ae("",!0),t.row.dsource==="tube"?(A(),se(D,{key:1,plain:"",size:"small",onClick:k=>J(t.row),type:"primary"},{default:l(()=>i[8]||(i[8]=[C(" 下片 ")])),_:2},1032,["onClick"])):ae("",!0),t.row.dsource==="tube"?(A(),se(D,{key:2,plain:"",size:"small",onClick:k=>Y(t.row),type:"primary"},{default:l(()=>i[9]||(i[9]=[C(" 下音 ")])),_:2},1032,["onClick"])):ae("",!0),e(D,{plain:"",size:"small",onClick:k=>j(t.row),type:t.row.hasSrt?"success":"warning",disabled:!t.row.hasSrt},{default:l(()=>i[10]||(i[10]=[C(" 切 ")])),_:2},1032,["onClick","type","disabled"]),e(D,{plain:"",size:"small",onClick:k=>u(t.row),type:(g=t.row.urls)!=null&&g.length?"success":"warning",disabled:!((v=t.row.urls)!=null&&v.length)},{default:l(()=>i[11]||(i[11]=[C(" 播 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[m,r.value]])],64)}}}),he=(y,o)=>{const d=y.__vccOpts||y;for(const[_,r]of o)d[_]=r;return d},tt=he(et,[["__scopeId","data-v-ed3843aa"]]),ze=$e("picker",()=>{const y=$(!1),o=$(!1),d=$("");return $(null),$(0),{open:o,title:d,loading:y}}),nt={style:{display:"flex",gap:"0","justify-content":"flex-start"}},lt={key:0,class:"loading-state"},ot={class:"srt-time"},st=["onClick"],at={key:1,class:"empty-state"},it={class:"footer-container"},rt={class:"time-shift-controls"},ct={class:"time-shift-controls"},ut={class:"time-shift-controls"},pe=100,me=5e3,dt=ge({__name:"Editor",setup(y){const o=ke(),d=re(),_=ze(),r=$(!1),h=()=>{d.player&&(d.player.playing?d.player.pause():d.player.play())},x=$(1e3),z=m=>{const t=x.value+m;x.value=Math.max(pe,Math.min(me,t))},q=$(["你好","晚上好","拜拜","再见"]),K=m=>q.value.some(t=>m.includes(t)),B=Se(()=>o.timelineData.map((m,t)=>({text:m.text,index:t})).filter(({text:m})=>K(m)).map(({index:m})=>m).sort((m,t)=>m-t)),N=()=>{const m=B.value;if(m.length===0){L("未找到包含关键字的字幕行");return}let t=0,g=m.length-1,v=-1;for(;t<=g;){const k=Math.floor((t+g)/2);m[k]<u.value?(v=m[k],t=k+1):g=k-1}v===-1&&(v=m[m.length-1]),i(v)},J=()=>{const m=B.value;if(m.length===0){L("未找到包含关键字的字幕行");return}let t=0,g=m.length-1,v=-1;for(;t<=g;){const k=Math.floor((t+g)/2);m[k]>u.value?(v=m[k],g=k-1):t=k+1}v===-1&&(v=m[0]),i(v)},G=$(),Y=$([]),j=m=>{m instanceof HTMLElement&&Y.value.push(m)},u=$(0),a=async m=>{const t=U(m),g=o.timeToKey(t),v=o.timeMap.get(g);typeof v=="number"&&v!==u.value&&(u.value=v,await He(),setTimeout(()=>i(v),50))},i=m=>{const t=G.value,g=Y.value[m];if(g instanceof HTMLElement&&t){const k=g.offsetTop-t.clientHeight/2;t.scrollTo({top:k,behavior:"smooth"})}},D=$(595),S=$();let F=null;ye(()=>{S.value=document.querySelector(".grid-section.bottom"),S.value&&(F=new ResizeObserver(m=>{for(const t of m){const{height:g}=t.contentRect;D.value=g}}),F.observe(S.value)),d.player.on("timeupdate",()=>{a(d.player.currentTime)}),d.player.on("play",()=>{r.value=!0}),d.player.on("pause",()=>{r.value=!1})}),Ve(()=>{F&&S.value&&F.unobserve(S.value),d.player.off("timeupdate",a),Y.value=[]}),Oe(()=>o.timelineData,()=>{Y.value=[]});const H=async()=>{var m,t;try{const g=(m=d.player)==null?void 0:m.media;if(!(g instanceof HTMLVideoElement)){L("无法获取视频元素");return}const v=document.createElement("canvas");v.width=g.videoWidth,v.height=g.videoHeight;const k=v.getContext("2d");if(!k){ne("无法创建画布上下文");return}k.drawImage(g,0,0,v.width,v.height);const le=v.toDataURL("image/jpeg",.9),Z=document.createElement("a"),c=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);Z.download=`capture_${(t=o.data)==null?void 0:t.id}_${c}.jpg`,Z.href=le,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),ee("截图已保存")}catch(g){ne(`截图失败: ${g instanceof Error?g.message:g}`)}};return(m,t)=>{const g=E("Camera"),v=E("el-icon"),k=E("el-button"),le=E("el-text"),Z=E("Top"),c=E("Bottom"),n=E("el-space"),s=E("el-affix"),b=E("Expand"),P=E("Minus"),T=E("el-drawer");return A(),se(T,{modelValue:w(o).open,"onUpdate:modelValue":t[10]||(t[10]=p=>w(o).open=p),direction:"btt",modal:!1,size:D.value,onOpened:t[11]||(t[11]=p=>w(o).shiftSubtitles(0))},{header:l(()=>[M("div",nt,[e(k,{onClick:H,size:"small",circle:""},{default:l(()=>[e(v,null,{default:l(()=>[e(g)]),_:1})]),_:1}),e(le,{class:"mx-1",type:"warning"},{default:l(()=>{var p,V;return[C(Q((p=w(o).data)==null?void 0:p.date)+" - "+Q((V=w(o).data)==null?void 0:V.id),1)]}),_:1})])]),default:l(()=>[M("div",{class:"timeline-container",ref_key:"containerRef",ref:G},[w(o).loading?(A(),X("div",lt,[e(v,{class:"is-loading",color:"#409EFF",size:20},{default:l(()=>[e(w(Ee))]),_:1}),t[12]||(t[12]=M("span",null,"正在加载字幕数据...",-1))])):ae("",!0),(A(!0),X(ie,null,xe(w(o).timelineData,(p,V)=>(A(),X("div",{key:V,class:"timeline-item",ref_for:!0,ref:j},[M("span",ot,Q(p.time),1),M("span",{class:Ke(["srt-text",{highlight:V==u.value,keyword:K(p.text)}]),onClick:R=>{a(w(oe)(p.time)),w(d).jumpTo(p.time)}},Q(p.text),11,st)]))),128)),!w(o).loading&&w(o).timelineData.length===0?(A(),X("div",at,[e(v,null,{default:l(()=>[e(w(Me))]),_:1}),t[13]||(t[13]=M("span",null,"暂无字幕数据",-1))])):ae("",!0)],512),e(s,{class:"floating-btn",position:"bottom",offset:200},{default:l(()=>[e(n,{direction:"vertical"},{default:l(()=>[e(k,{onClick:t[0]||(t[0]=p=>w(d).autoPlay=!w(d).autoPlay),type:w(d).autoPlay?"success":""},{default:l(()=>[e(v,null,{default:l(()=>t[14]||(t[14]=[C("A")])),_:1})]),_:1},8,["type"]),e(k,{onClick:N},{default:l(()=>[e(v,null,{default:l(()=>[e(Z)]),_:1})]),_:1}),e(k,{onClick:J},{default:l(()=>[e(v,null,{default:l(()=>[e(c)]),_:1})]),_:1}),e(k,{onClick:h,icon:r.value?w(Ie):w(je)},null,8,["icon"])]),_:1})]),_:1})]),footer:l(()=>[M("div",it,[M("div",rt,[e(k,{size:"small",type:w(_).open?"success":""},{default:l(()=>[e(v,{onClick:t[1]||(t[1]=p=>w(_).open=!w(_).open)},{default:l(()=>[e(b)]),_:1})]),_:1},8,["type"])]),M("div",ct,[e(k,{onClick:t[2]||(t[2]=p=>w(o).shiftSubtitles(-x.value)),disabled:w(o).shiftCount===0,size:"small"},{default:l(()=>[e(v,null,{default:l(()=>[e(P)]),_:1})]),_:1},8,["disabled"]),M("span",{class:"count",onClick:t[3]||(t[3]=(...p)=>w(o).resetSubtitles&&w(o).resetSubtitles(...p))},Q(w(o).shiftCount),1),e(k,{onClick:t[4]||(t[4]=p=>w(o).shiftSubtitles(x.value)),size:"small"},{default:l(()=>[e(v,null,{default:l(()=>[e(w(Pe))]),_:1})]),_:1})]),M("div",ut,[e(k,{plain:"",type:"danger",onClick:t[5]||(t[5]=p=>z(-1e3)),disabled:x.value<=pe,size:"small"},{default:l(()=>t[15]||(t[15]=[C(" <<1000 ")])),_:1},8,["disabled"]),e(k,{plain:"",type:"danger",onClick:t[6]||(t[6]=p=>z(-100)),disabled:x.value<=pe,size:"small"},{default:l(()=>t[16]||(t[16]=[C(" <100 ")])),_:1},8,["disabled"]),M("span",{class:"count",onClick:t[7]||(t[7]=p=>x.value=1e3)},Q(x.value),1),e(k,{plain:"",type:"success",onClick:t[8]||(t[8]=p=>z(100)),disabled:x.value>=me,size:"small"},{default:l(()=>t[17]||(t[17]=[C(" 100> ")])),_:1},8,["disabled"]),e(k,{plain:"",type:"success",onClick:t[9]||(t[9]=p=>z(1e3)),disabled:x.value>=me,size:"small"},{default:l(()=>t[18]||(t[18]=[C(" 1000>> ")])),_:1},8,["disabled"])])])]),_:1},8,["modelValue","size"])}}}),pt={class:"prompt-controls",style:{display:"flex",gap:"5px",margin:"5px","align-items":"center"}},mt={class:"segment-container"},ft={class:"time-controls"},vt={class:"time-controls"},yt={class:"time-controls"},gt={class:"card-footer"},$t=`
总结上面的对话内容，并参考下面的标题以及高点击率标题核心公式，运用马斯洛需求层次理论，为上面的对话内容起一个容易引起讨论的标题，不能夸大其词，不能包含不实内容，同时给出建议标签，标签要每行一个，标题和标签要方便复制：
一、参考标题
1、心智阳光健康，本科大二学生，聊天很是投缘，大冰不舍挂断
2、人为什么需要亲密关系？大冰深度分析，看完人都通透了
3、主动要礼物！聊天高端局，“泄露天机”太多，大冰“索要”礼物
4、如何把事情处理得圆润得体？大冰深度教学，家庭职场都受用
5、情侣裂痕是如何产生的？大冰深度分析，值得反复观看
6、光长年龄不长心智是一种什么体验？大冰对话32岁女画师，表现惊掉你下巴
7、颠覆你的认知：如何炼成顶级倾听力？大冰独家分享！带你突破沟通瓶颈！
8、如何把握相处的底层逻辑？大冰深度分析，职场婚姻都受用
9、精神未断奶是一种什么体验？大冰对话女硕士，思维表现大跌眼镜
10、如何克服自我否定的毛病？大冰深度教学，看完终身受益
二、高点击率标题核心公式
1、数字+痛点/利益
例：《月薪3千到3万，她靠这5个理财技巧逆袭，第3点人人可复制》。
2、疑问句+悬念
例：《为何日本核污水排海后，欧美集体沉默？背后真相远超想象》。
3、热点绑定+情绪词
例：《全网震怒！某顶流明星偷税细节曝光，经纪人一句话惹怒全网》。
4、挑战常识+颠覆认知
例：《喝粥不养胃！协和医生警告：这3种“健康习惯”反而致癌》。
5、本地化+紧迫感
例：《北京人注意！这趟地铁线路将停运3个月，明天起实施》。
`,_t=`
对以上内容进出场景划分，每个场景都以“你好/晚上好”等类似问候语开始，以“拜拜/再见/下一位”等类似问候语结束，请总结每个场景的大概内容，要如实反应，提取批判性语句和观点并保留原话，为每个场景取一个合适的毒舌标题，并给每个场景的开始和结束始时间
`,wt=`
对以上内容按如下要求处理：
1、按观点进行场景划分
2、每个场景约10至15分钟，要包含相对完整的叙事，总结每个观点的核心内容
3、针对每个场景提取说话者的原话并加工成每个场景的标题，标题字数为40-50个字，标题性质要辛辣、调侃、幽默、接地气、吸引眼球，但不能违反中国国家法律
4、给出每个场景的开始和结束始时间
5、请使用中文回答。
`,kt=ge({__name:"Picker",setup(y){const o=re(),d=ze(),_=ke(),r=Re([h()]);function h(){return{id:crypto.randomUUID(),startTime:0,endTime:0,duration:0,isK:!1}}const x=c=>{r.splice(c+1,0,h())},z=c=>{r.length>1&&r.splice(c,1)},q=c=>{if(c>0){const n=r.splice(c,1)[0];r.splice(c-1,0,n)}},K=c=>{if(c<r.length-1){const n=r.splice(c,1)[0];r.splice(c+1,0,n)}};function B(c){if(!o.player)return;const n=o.player.currentTime,s=r[c];s.startTime=n}function N(c){if(!o.player)return;const n=o.player.currentTime,s=r[c];s.endTime=n}function J(c){var n,s,b;if(((n=o.data)==null?void 0:n.dsource)==="local"){const P=window.location.protocol,T=window.location.host;return`${`${P}//${T}`}/${c}`}if(((s=o.data)==null?void 0:s.dsource)==="tube"){const P=window.location.protocol,T=window.location.host;return`${`${P}//${T}`}/local/${(b=o.data)==null?void 0:b.id}.mp4`}return c}function G(c,n){var I;const s=r[c],b=s.isK?"-k":"";let P=J((I=o.data)==null?void 0:I.urls[0]);if(!P)throw L("请先播放视频"),new Error("请先播放视频");const T=P.match(/\/([^\/]+)\.mp4$/),p=T?T[1]:(()=>{const ue=new Date;return`${ue.getFullYear()}${(ue.getMonth()+1).toString().padStart(2,"0")}${ue.getDate().toString().padStart(2,"0")}`})();if(!s.startTime||!s.endTime)throw L("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const V=U(s.startTime),R=U(s.endTime),W=V.replace(/:/g,"."),te=R.replace(/:/g,".");let f="yt-dlp --no-check-certificate";f=`${f} --concurrent-fragments 16 --throttled-rate 5M `,f=`${f} --download-sections "*${V}-${R}"`;const O="~/storage/downloads/Reqable/";return n=="video"&&(f=`${f} --merge-output-format mp4 -o "${O}${p}_${W}-${te}.mp4"`),n=="audio"&&(f=`${f} ${b} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${O}${p}_${W}-${te}.mp3"`),f=`${f} '${P}' `,f}function Y(c,n){var O;const s=r[c],b=s.isK?"-k":"";let P=J((O=o.data)==null?void 0:O.urls[0]);if(!P)throw L("请先播放视频"),new Error("请先播放视频");const T=P.match(/\/([^\/]+)\.mp4$/),p=T?T[1]:(()=>{const I=new Date;return`${I.getFullYear()}${(I.getMonth()+1).toString().padStart(2,"0")}${I.getDate().toString().padStart(2,"0")}`})();if(!s.startTime||!s.endTime)throw L("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const V=U(s.startTime),R=U(s.endTime),W=V.replace(/:/g,"."),te=R.replace(/:/g,".");let f=`--download-sections "*${V}-${R}"`;return n=="video"&&(f=`${f} --merge-output-format mp4 -o "${p}_${W}-${te}.mp4"`),n=="audio"&&(f=`${f} ${b} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${p}_${W}-${te}.mp3"`),f}async function j(){var n;const c=J((n=o.data)==null?void 0:n.urls[0]);if(!c){L("请先播放视频");return}try{await navigator.clipboard.writeText(c),ee(`链接已复制：${c}`)}catch(s){console.error(s),L("复制失败，请手动复制")}}async function u(){var n;const c=(n=o.data)==null?void 0:n.id;if(!c){L("请先播放视频");return}try{await navigator.clipboard.writeText(c),ee(`ID已复制：${c}`)}catch(s){console.error(s),L("ID失败，请手动复制")}}async function a(c,n,s){let b="";switch(n){case"dlp":b=G(c,s);break;case"seal":b=Y(c,s);break}try{await navigator.clipboard.writeText(b),ee(`命令已复制：${b}`)}catch(P){console.error(P),L("复制失败，请手动复制")}}const i=async c=>{const n=[];r.forEach((s,b)=>{console.log(`Index: ${b}`,s),n.push(G(b,c))});try{await navigator.clipboard.writeText(n.join(`
`)),ee(`命令已复制：${n.join("<br/>")}`)}catch(s){console.error(s),L("复制失败，请手动复制")}},D=$(!1);async function S(){var T;let c=J((T=o.data)==null?void 0:T.urls[0]);if(!c){L("请先播放视频");return}const n=c.match(/\/([^\/]+)\.mp4$/),s=n?n[1]:(()=>{const p=new Date;return`${p.getFullYear()}${(p.getMonth()+1).toString().padStart(2,"0")}${p.getDate().toString().padStart(2,"0")}`})(),b=r.filter(p=>p.startTime<p.endTime).map((p,V)=>`${U(p.startTime)}-${U(p.endTime)}`);if(!b.length){L("请先至少设置一个开始和结束时间");return}const P=`dlp ${D.value?"keep":"delete"} '${c}' '${s}' ${b.join(" ")}`;try{F(P),await navigator.clipboard.writeText(P),ee(`命令已复制：${P}`)}catch(p){console.error(p),ne(p,"复制失败，请手动复制")}}async function F(c){try{const n=await fetch("http://localhost:8080/run",{method:"POST",headers:{"Content-Type":"text/plain"},body:c});if(!n.ok)throw new Error(`HTTP 错误: ${n.status}`);const b=(await n.json()).task_id;t(b)}catch(n){ne(n,"请求失败: ")}}const H=$(!1),m=$("");function t(c){H.value=!0;const n=setInterval(async()=>{var b;let s="";try{const P=await fetch(`http://localhost:8080/progress/${c}`);if(!P.ok)throw new Error(`进度查询失败: ${P.status}`);const T=await P.json();s=(b=T.recent_log)!=null&&b.length?`

最近日志:
`+T.recent_log.join(`
`):"",T.status==="completed"&&(clearInterval(n),s=`处理完成✅ (状态: ${T.status})${s}`),T.status==="failed"&&(clearInterval(n),s=`处理完成✅ (状态: ${T.status})${s}`)}catch{clearInterval(n),s="监控失败: "}m.value=s},1e3)}const g=$(""),v=$("情感"),k=$("");async function le(c){g.value=c}async function Z(c,n){var T,p,V;const s=g.value;if(s==="info"){let R=`${(T=_.data)==null?void 0:T.date}-${(p=_.data)==null?void 0:p.id} ${U(c)}-${U(n)}`;try{await navigator.clipboard.writeText(R),ee("切片信息已复制")}catch(W){console.error(W),L("复制失败，请手动复制")}return}const b=_.getSubtitles(c,n);let P="";switch(b.value.map(R=>{const W=R.time.split(".")[0]+" "+R.text+`
`;P+=W}),(V=o.data)==null?void 0:V.dsource){case"kwai":k.value=_t;break;default:k.value=wt}P+=s=="title"?$t:s=="target"?k.value.replace("_P_",v.value):"";try{await navigator.clipboard.writeText(P),ee(`${b.value.length}条字幕已复制`)}catch(R){console.error(R),L("复制失败，请手动复制")}}return(c,n)=>{const s=E("el-button"),b=E("el-input"),P=E("DocumentCopy"),T=E("el-icon"),p=E("CaretLeft"),V=E("CaretRight"),R=E("Plus"),W=E("Minus"),te=E("el-card");return A(),X(ie,null,[fe(e(te,{class:"segment-control-card"},{footer:l(()=>[M("div",gt,[e(s,{plain:"",type:"success",size:"small",onClick:S},{default:l(()=>n[19]||(n[19]=[C("下载片段")])),_:1}),e(s,{plain:"",type:H.value?"warning":"primary",size:"small",onClick:n[4]||(n[4]=f=>H.value=!H.value)},{default:l(()=>n[20]||(n[20]=[C("显示日志")])),_:1},8,["type"]),e(s,{plain:"",type:"success",size:"small",onClick:j},{default:l(()=>n[21]||(n[21]=[C("复制链接")])),_:1}),e(s,{plain:"",type:"success",size:"small",onClick:u},{default:l(()=>n[22]||(n[22]=[C("复制ID")])),_:1}),e(s,{plain:"",type:"success",size:"small",onClick:n[5]||(n[5]=f=>i("video"))},{default:l(()=>n[23]||(n[23]=[C("复制命令")])),_:1})])]),default:l(()=>[M("div",pt,[e(s,{size:"small",type:g.value==="info"?"success":"info",onClick:n[0]||(n[0]=f=>le("info"))},{default:l(()=>n[6]||(n[6]=[C("取信息")])),_:1},8,["type"]),e(s,{size:"small",type:g.value==="title"?"success":"info",onClick:n[1]||(n[1]=f=>le("title"))},{default:l(()=>n[7]||(n[7]=[C("取标题")])),_:1},8,["type"]),e(s,{size:"small",type:g.value==="target"?"success":"info",onClick:n[2]||(n[2]=f=>le("target"))},{default:l(()=>n[8]||(n[8]=[C("取内容")])),_:1},8,["type"]),e(b,{size:"small",modelValue:v.value,"onUpdate:modelValue":n[3]||(n[3]=f=>v.value=f),disabled:g.value!=="target",style:{flex:"1"}},null,8,["modelValue","disabled"])]),M("div",mt,[(A(!0),X(ie,null,xe(r,(f,O)=>(A(),X("div",{key:f.id,class:"segment-item"},[M("div",ft,[e(s,{plain:"",type:"primary",size:"small",onClick:I=>a(O,"seal","audio")},{default:l(()=>n[9]||(n[9]=[C("SA")])),_:2},1032,["onClick"]),e(s,{plain:"",type:"primary",size:"small",onClick:I=>a(O,"seal","video")},{default:l(()=>n[10]||(n[10]=[C("SV")])),_:2},1032,["onClick"]),e(s,{plain:"",type:"primary",size:"small",onClick:I=>a(O,"dlp","audio")},{default:l(()=>n[11]||(n[11]=[C("DA")])),_:2},1032,["onClick"]),e(s,{plain:"",type:"primary",size:"small",onClick:I=>a(O,"dlp","video")},{default:l(()=>n[12]||(n[12]=[C("DV")])),_:2},1032,["onClick"]),e(b,{"model-value":w(_).secondsToTime(f.endTime-f.startTime),size:"small",readonly:""},null,8,["model-value"]),e(s,{plain:"",size:"small",type:f.isK?"success":"info",onClick:I=>f.isK=!f.isK},{default:l(()=>[C(Q(f.isK?"k开":"k关"),1)]),_:2},1032,["type","onClick"]),e(s,{plain:"",size:"small",type:"success",onClick:I=>Z(f.startTime,f.endTime)},{default:l(()=>[e(T,null,{default:l(()=>[e(P)]),_:1})]),_:2},1032,["onClick"])]),M("div",vt,[e(s,{plain:"",type:"success",size:"small",onClick:I=>B(O)},{default:l(()=>n[13]||(n[13]=[C("S")])),_:2},1032,["onClick"]),e(s,{plain:"",type:"success",size:"small",onClick:I=>w(o).jumpTo(w(U)(f.startTime))},{default:l(()=>n[14]||(n[14]=[C("J")])),_:2},1032,["onClick"]),e(s,{plain:"",type:"success",size:"small",onClick:I=>f.startTime=f.startTime-.5},{default:l(()=>[e(T,null,{default:l(()=>[e(p)]),_:1})]),_:2},1032,["onClick"]),e(s,{plain:"",type:"success",size:"small",onClick:I=>f.startTime=f.startTime+.5},{default:l(()=>[e(T,null,{default:l(()=>[e(V)]),_:1})]),_:2},1032,["onClick"]),e(b,{"model-value":w(U)(f.startTime),size:"small",readonly:""},null,8,["model-value"]),e(s,{plain:"",size:"small",onClick:I=>q(O),disabled:O===0||r.length===1},{default:l(()=>n[15]||(n[15]=[C("↑")])),_:2},1032,["onClick","disabled"]),e(s,{plain:"",type:"success",size:"small",onClick:I=>x(O)},{default:l(()=>[e(T,null,{default:l(()=>[e(R)]),_:1})]),_:2},1032,["onClick"])]),M("div",yt,[e(s,{plain:"",type:"danger",size:"small",onClick:I=>N(O)},{default:l(()=>n[16]||(n[16]=[C("E")])),_:2},1032,["onClick"]),e(s,{plain:"",type:"danger",size:"small",onClick:I=>w(o).jumpTo(w(U)(f.endTime))},{default:l(()=>n[17]||(n[17]=[C("J")])),_:2},1032,["onClick"]),e(s,{plain:"",type:"danger",size:"small",onClick:I=>f.endTime=f.endTime-.5},{default:l(()=>[e(T,null,{default:l(()=>[e(p)]),_:1})]),_:2},1032,["onClick"]),e(s,{plain:"",type:"danger",size:"small",onClick:I=>f.endTime=f.endTime+.5},{default:l(()=>[e(T,null,{default:l(()=>[e(V)]),_:1})]),_:2},1032,["onClick"]),e(b,{type:"danger","model-value":w(U)(f.endTime),size:"small",readonly:""},null,8,["model-value"]),e(s,{plain:"",size:"small",onClick:I=>K(O),disabled:O===r.length-1||r.length===1},{default:l(()=>n[18]||(n[18]=[C("↓")])),_:2},1032,["onClick","disabled"]),e(s,{plain:"",type:"danger",size:"small",onClick:I=>z(O),disabled:r.length===1},{default:l(()=>[e(T,null,{default:l(()=>[e(W)]),_:1})]),_:2},1032,["onClick","disabled"])])]))),128))])]),_:1},512),[[Ce,w(d).open]]),fe(e(te,{class:"log-card",style:{"max-width":"480px","z-index":"1000000 !important"}},{default:l(()=>[M("p",null,Q(m.value),1)]),_:1},512),[[Ce,H.value]])],64)}}}),Te=he(kt,[["__scopeId","data-v-eb92af10"]]),ht={__name:"App",setup(y){return re(),(o,d)=>{const _=E("el-col"),r=E("el-row"),h=E("el-container");return A(),X(ie,null,[e(Te),e(h,{style:{height:"100vh"}},{default:l(()=>[e(r,{class:"grid-container"},{default:l(()=>[e(_,{class:"grid-section top"},{default:l(()=>[e(Qe)]),_:1}),e(_,{class:"grid-section bottom"},{default:l(()=>[e(tt),e(dt),e(Te)]),_:1})]),_:1})]),_:1})],64)}}},Ct=he(ht,[["__scopeId","data-v-d44e3bc6"]]),ce=Ae(Ct);ce.use(Ne());ce.use(De);for(const[y,o]of Object.entries(Le))ce.component(y,o);ce.mount("#app");
