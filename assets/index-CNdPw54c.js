import{E as re,i as ze}from"./element-plus-CRGBzuq5.js";import{f as te,g as ne,B as xe,l as Ee,w as De,Q as Me}from"./@element-plus-By79ymwD.js";import{r as k,j as pe,c as W,o as F,a as I,M as Y,u as m,d as fe,k as we,ag as x,aq as Pe,I as be,G as ve,H as n,P as e,L as j,S as Ie,w as je,J as $e,O as ye,a6 as Ce,D as Le,n as Oe,X as Ue,Q as Ve,at as He}from"./@vue-C01xNfPK.js";import{d as ge,c as Ke}from"./pinia-CKuVeK4o.js";import{P as Re}from"./plyr-CZIZ1zVJ.js";import{H as me}from"./hls.js-DWnTp5j0.js";import{f as he}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))$(o);new MutationObserver(o=>{for(const y of o)if(y.type==="childList")for(const H of y.addedNodes)H.tagName==="LINK"&&H.rel==="modulepreload"&&$(H)}).observe(document,{childList:!0,subtree:!0});function p(o){const y={};return o.integrity&&(y.integrity=o.integrity),o.referrerPolicy&&(y.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?y.credentials="include":o.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function $(o){if(o.ep)return;o.ep=!0;const y=p(o);fetch(o.href,y)}})();function Ne(v,s="未知错误"){if(v instanceof Error)return v.message;if(typeof v=="string")return v;if(typeof v=="object"&&v!==null&&"message"in v&&typeof v.message=="string")return v.message;try{return JSON.stringify(v)}catch{return s}}const ie={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},ce=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function Q(v,s){const p=Ne(v),$=s?`${s}: ${p}`:p;re.error({...ie,message:`
    <div ${ce}>
      ${$}
    </div>
    `})}function L(v){re.error({...ie,message:`
    <div ${ce}>
      ${v}
    </div>
    `})}function Ae(v){re.info({...ie,message:`
    <div ${ce}>
      ${v}
    </div>
    `})}function J(v){re.success({...ie,message:`
    <div ${ce}>
      ${v}
    </div>
    `})}const le=v=>{try{const[s,p]=v.split("."),[$,o,y]=s.split(":").map(Number),H=p?parseInt(p.padEnd(3,"0")):0;return $*3600+o*60+y+H/1e3}catch{return 0}},V=v=>{const s=Math.round(v%1*1e3),p=Math.floor(v),$=Math.floor(p/3600),o=Math.floor(p%3600/60),y=p%60;return`${String($).padStart(2,"0")}:${String(o).padStart(2,"0")}:${String(y).padStart(2,"0")}.${String(s).padStart(3,"0")}`},se=ge("player",()=>{const v=k(""),s=k(null),p=k(null),$=k(null),o=k(null),y=k(null),H=c=>{s.value=new Re(c,{hideControls:!1,controls:["play-large","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},E=c=>{o.value=c,v.value=c.date;const g=c.urls[0],_={type:"video",sources:[{src:g,type:N(g)}]};K(_).then(()=>{var T;return(T=s.value)==null?void 0:T.play()})},N=c=>c.includes(".m3u8")?"application/x-mpegURL":c.includes(".flv")?"video/x-flv":"video/mp4",K=async c=>{var _,T,P;(_=p.value)==null||_.destroy(),p.value=null,(T=$.value)==null||T.destroy(),$.value=null;const g=c.sources[0].src.includes(".m3u8")?"hls":c.sources[0].src.includes(".flv")?"flv":"html5";try{g!==y.value&&await((P=s.value)==null?void 0:P.stop()),s.value.source=c,g==="hls"&&me.isSupported()?await A(c.sources[0].src):g==="flv"&&he.isSupported()&&await B(c.sources[0].src),y.value=g}catch(O){console.error("源切换失败:",O)}},A=async c=>new Promise(g=>{p.value=new me,p.value.loadSource(c),p.value.attachMedia(s.value.media),p.value.on(me.Events.MANIFEST_PARSED,g)}),B=async c=>{$.value=he.createPlayer({type:"flv",url:c}),$.value.attachMediaElement(s.value.media),$.value.load(),await $.value.play()},R=k(!1);return{player:s,initPlayer:H,switchSource:K,playStream:E,title:v,data:o,autoPlay:R,jumpTo:c=>{const g=le(c);if(s.value&&g>0)try{s.value.currentTime=g,R.value?s.value.play():s.value.pause()}catch(_){Q(_,"跳转播放失败，请检查播放器状态")}}}}),Fe={class:"video-wrapper"},Be={class:"title"},qe={class:"plyr-container"},Je={__name:"Player",setup(v){const s=se(),p=k(null);return pe(()=>{s.initPlayer(p.value)}),($,o)=>(F(),W("div",Fe,[I("h3",Be,Y(m(s).title),1),I("div",qe,[I("video",{class:"player",ref_key:"videoRef",ref:p,playsinline:""},null,512)])]))}},_e=ge("editor",()=>{const v=k(!1),s=k(!1),p=k(""),$=k(null),o=5e3,y=k(o),H=g=>{s.value=!0,$.value=g,p.value=g.date,w()},E=k([]),N=g=>{try{const[_,T]=g.split("."),[P,O,z]=_.split(":").map(Number);return P*3600+O*60+z}catch(_){console.error(_)}},K=k(new Map),A=()=>{K.value.clear(),E.value.forEach((g,_)=>{try{const T=N(g.time);K.value.has(T)||K.value.set(T,_)}catch(T){console.error(`错误处理时间戳 ${g.time}（索引 ${_}）: ${T}`)}})},B=g=>{if(!E.value)return;const _=y.value+g;y.value=Math.max(_,0);const T=g/1e3;E.value=E.value.map(P=>{const z=le(P.time)+T;return{...P,time:V(Math.max(z,0))}}),A()},R=()=>{if(!E.value)return;const _=(y.value-o)/1e3;E.value=E.value.map(T=>{const O=le(T.time)-_;return{...T,time:V(Math.max(O,0))}}),y.value=o,A()},w=async()=>{var g;v.value=!0;try{const _=await fetch(`srts/${(g=$.value)==null?void 0:g.id}`);if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);E.value=await _.json();const T=y.value/1e3;E.value=E.value.map(P=>{const z=le(P.time)+T;return{...P,time:V(Math.max(z,0))}}),A()}catch(_){console.error("数据获取失败:",_),Q(_,"字幕数据加载失败，请稍后重试"),E.value=[]}finally{v.value=!1}};return{open:s,title:p,edit:H,data:$,timelineData:E,loading:v,shiftCount:y,shiftSubtitles:B,timeToSeconds:le,secondsToTime:V,resetSubtitles:R,timeMap:K,timeToKey:N,getSubtitles:(g,_)=>{var G;const T=k([]);if(!((G=E.value)!=null&&G.length))return console.error("时间轴数据未加载"),T;const P=N(V(g)),O=N(V(_)),z=K.value.get(P),u=K.value.get(O);if(typeof z!="number"||typeof u!="number")return console.error("无法匹配有效的时间段"),T;const l=Math.max(0,z),h=Math.min(E.value.length-1,u),[r,C]=l<=h?[l,h]:[h,l];return T.value=E.value.slice(r,C+1),T}}}),Ye=["onClick"],Qe=["onClick"],Ge={style:{display:"flex",gap:"0","justify-content":"flex-end"}},We=fe({__name:"Playlist",setup(v){const s=se(),p=_e(),$=k(""),o=k(!0),y=k([]),H=async()=>{try{const w=await fetch("video.json");if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);y.value=await w.json()}catch(w){Q(w,"数据加载失败")}finally{o.value=!1}},E=we(()=>{const w=$.value.toLowerCase();return y.value.filter(c=>c.id.toLowerCase().includes(w)||c.date.toLowerCase().includes(w))}),N=async w=>{var c;((c=w.urls)==null?void 0:c.length)>0?await A(w.urls[0],"链接已复制到剪贴板","链接复制失败"):L("该记录没有可用的链接")},K=async w=>{w.id?await A(w.id,"ID已复制到剪贴板","ID复制失败"):L("该记录没有可用的ID")},A=async(w,c,g)=>{try{await navigator.clipboard.writeText(w),J(c)}catch(_){Q(_,g)}},B=w=>{var c;(c=w.urls)!=null&&c.length&&(w.urls[0],s.playStream(w),p.edit(w))},R=w=>{var c;(c=w.urls)!=null&&c.length&&(w.urls[0],s.playStream(w))};return pe(()=>{H()}),(w,c)=>{const g=x("el-table-column"),_=x("el-input"),T=x("el-button"),P=x("el-table"),O=Pe("loading");return be((F(),ve(P,{data:E.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:n(()=>[e(g,{fixed:"",label:"日期",prop:"date",sortable:"",width:"140"},{default:n(z=>[I("span",{class:"clickable-text",onClick:u=>N(z.row)},Y(z.row.date),9,Ye)]),_:1}),e(g,{fixed:"",label:"标识",prop:"id",width:"180"},{default:n(z=>[I("span",{class:"clickable-text",onClick:u=>K(z.row)},Y(z.row.id),9,Qe)]),_:1}),e(g,{fixed:"right",align:"right",width:"115"},{header:n(()=>[e(_,{modelValue:$.value,"onUpdate:modelValue":c[0]||(c[0]=z=>$.value=z),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:n(z=>{var u,l;return[I("div",Ge,[e(T,{plain:"",size:"small",onClick:h=>B(z.row),type:z.row.hasSrt?"success":"warning",disabled:!z.row.hasSrt},{default:n(()=>c[1]||(c[1]=[j(" 切片 ")])),_:2},1032,["onClick","type","disabled"]),e(T,{plain:"",size:"small",onClick:h=>R(z.row),type:(u=z.row.urls)!=null&&u.length?"success":"warning",disabled:!((l=z.row.urls)!=null&&l.length)},{default:n(()=>c[2]||(c[2]=[j(" 播放 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[O,o.value]])}}}),Te=ge("picker",()=>{const v=k(!1),s=k(!1),p=k("");return k(null),k(0),{open:s,title:p,loading:v}}),Xe={style:{display:"flex",gap:"0","justify-content":"flex-start"}},Ze={key:0,class:"loading-state"},et={class:"time-label"},tt=["onClick"],nt={key:1,class:"empty-state"},lt={class:"footer-container"},st={class:"time-shift-controls"},ot={class:"time-shift-controls"},oe=50,ae=5e3,at=fe({__name:"Editor",setup(v){const s=_e(),p=se(),$=Te(),o=k(1e3),y=u=>{const l=o.value+u;o.value=Math.max(oe,Math.min(ae,l))},H=k(["你好","晚上好","拜拜","再见"]),E=u=>H.value.some(l=>u.includes(l)),N=we(()=>s.timelineData.map((u,l)=>({text:u.text,index:l})).filter(({text:u})=>E(u)).map(({index:u})=>u).sort((u,l)=>u-l)),K=()=>{const u=N.value;if(u.length===0){L("未找到包含关键字的字幕行");return}let l=0,h=u.length-1,r=-1;for(;l<=h;){const C=Math.floor((l+h)/2);u[C]<c.value?(r=u[C],l=C+1):h=C-1}r===-1&&(r=u[u.length-1]),_(r)},A=()=>{const u=N.value;if(u.length===0){L("未找到包含关键字的字幕行");return}let l=0,h=u.length-1,r=-1;for(;l<=h;){const C=Math.floor((l+h)/2);u[C]>c.value?(r=u[C],h=C-1):l=C+1}r===-1&&(r=u[0]),_(r)},B=k(),R=k([]),w=u=>{u instanceof HTMLElement&&R.value.push(u)},c=k(0),g=async()=>{if(!p.player)return;const u=p.player.currentTime,l=V(u),h=s.timeToKey(l),r=s.timeMap.get(h);typeof r=="number"&&r!==c.value&&(c.value=r,await Oe(),setTimeout(()=>_(r),50))},_=u=>{const l=B.value,h=R.value[u];if(h instanceof HTMLElement&&l){const C=h.offsetTop-l.clientHeight/2;l.scrollTo({top:C,behavior:"smooth"})}},T=k(595),P=k();let O=null;pe(()=>{P.value=document.querySelector(".grid-section.bottom"),P.value&&(O=new ResizeObserver(u=>{for(const l of u){const{height:h}=l.contentRect;T.value=h}}),O.observe(P.value)),p.player.on("timeupdate",g)}),Ie(()=>{O&&P.value&&O.unobserve(P.value),p.player.off("timeupdate",g),R.value=[]}),je(()=>s.timelineData,()=>{R.value=[]});const z=async()=>{var u,l;try{const h=(u=p.player)==null?void 0:u.media;if(!(h instanceof HTMLVideoElement)){L("无法获取视频元素");return}const r=document.createElement("canvas");r.width=h.videoWidth,r.height=h.videoHeight;const C=r.getContext("2d");if(!C){Q("无法创建画布上下文");return}C.drawImage(h,0,0,r.width,r.height);const G=r.toDataURL("image/jpeg",.9),i=document.createElement("a"),t=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);i.download=`capture_${(l=s.data)==null?void 0:l.id}_${t}.jpg`,i.href=G,document.body.appendChild(i),i.click(),document.body.removeChild(i),J("截图已保存")}catch(h){Q(`截图失败: ${h instanceof Error?h.message:h}`)}};return(u,l)=>{const h=x("Expand"),r=x("el-icon"),C=x("el-button"),G=x("Top"),i=x("Bottom"),t=x("Camera"),a=x("el-text"),b=x("Minus"),S=x("el-drawer");return F(),ve(S,{modelValue:m(s).open,"onUpdate:modelValue":l[12]||(l[12]=d=>m(s).open=d),direction:"btt",modal:!1,size:T.value,onOpened:l[13]||(l[13]=d=>m(s).shiftSubtitles(0))},{header:n(()=>[I("div",Xe,[e(C,{size:"small",type:m($).open?"success":"",circle:""},{default:n(()=>[e(r,{onClick:l[0]||(l[0]=d=>m($).open=!m($).open)},{default:n(()=>[e(h)]),_:1})]),_:1},8,["type"]),e(C,{onClick:l[1]||(l[1]=d=>m(p).autoPlay=!m(p).autoPlay),type:m(p).autoPlay?"success":"",size:"small",circle:""},{default:n(()=>l[14]||(l[14]=[j("A")])),_:1},8,["type"]),e(C,{size:"small",circle:""},{default:n(()=>[e(r,{onClick:K},{default:n(()=>[e(G)]),_:1})]),_:1}),e(C,{size:"small",circle:""},{default:n(()=>[e(r,{onClick:A},{default:n(()=>[e(i)]),_:1})]),_:1}),e(C,{size:"small",circle:""},{default:n(()=>[e(r,{onClick:z},{default:n(()=>[e(t)]),_:1})]),_:1}),e(a,{class:"mx-1",type:"warning"},{default:n(()=>{var d;return[j(Y((d=m(s).data)==null?void 0:d.id),1)]}),_:1})])]),default:n(()=>[I("div",{class:"timeline-container",ref_key:"containerRef",ref:B},[m(s).loading?(F(),W("div",Ze,[e(r,{class:"is-loading",color:"#409EFF",size:20},{default:n(()=>[e(m(Ee))]),_:1}),l[15]||(l[15]=I("span",null,"正在加载字幕数据...",-1))])):$e("",!0),(F(!0),W(ye,null,Ce(m(s).timelineData,(d,D)=>(F(),W("div",{key:D,class:"timeline-item",ref_for:!0,ref:w},[I("span",et,Y(d.time),1),I("span",{class:Le(["content-text",{highlight:D==c.value,keyword:E(d.text)}]),onClick:q=>m(p).jumpTo(d.time)},Y(d.text),11,tt)]))),128)),!m(s).loading&&m(s).timelineData.length===0?(F(),W("div",nt,[e(r,null,{default:n(()=>[e(m(De))]),_:1}),l[16]||(l[16]=I("span",null,"暂无字幕数据",-1))])):$e("",!0)],512)]),footer:n(()=>[I("div",lt,[I("div",st,[e(C,{onClick:l[2]||(l[2]=d=>y(-1e3)),disabled:o.value<=oe,size:"small"},{default:n(()=>[e(r,null,{default:n(()=>[e(m(te))]),_:1}),e(r,null,{default:n(()=>[e(m(te))]),_:1}),e(r,null,{default:n(()=>[e(m(te))]),_:1})]),_:1},8,["disabled"]),e(C,{onClick:l[3]||(l[3]=d=>y(-500)),disabled:o.value<=oe,size:"small"},{default:n(()=>[e(r,null,{default:n(()=>[e(m(te))]),_:1}),e(r,null,{default:n(()=>[e(m(te))]),_:1})]),_:1},8,["disabled"]),e(C,{onClick:l[4]||(l[4]=d=>y(-50)),disabled:o.value<=oe,size:"small"},{default:n(()=>[e(r,null,{default:n(()=>[e(m(te))]),_:1})]),_:1},8,["disabled"]),I("span",{class:"count",onClick:l[5]||(l[5]=d=>o.value=50)},Y(o.value),1),e(C,{onClick:l[6]||(l[6]=d=>y(50)),disabled:o.value>=ae,size:"small"},{default:n(()=>[e(r,null,{default:n(()=>[e(m(ne))]),_:1})]),_:1},8,["disabled"]),e(C,{onClick:l[7]||(l[7]=d=>y(500)),disabled:o.value>=ae,size:"small"},{default:n(()=>[e(r,null,{default:n(()=>[e(m(ne))]),_:1}),e(r,null,{default:n(()=>[e(m(ne))]),_:1})]),_:1},8,["disabled"]),e(C,{onClick:l[8]||(l[8]=d=>y(1e3)),disabled:o.value>=ae,size:"small"},{default:n(()=>[e(r,null,{default:n(()=>[e(m(ne))]),_:1}),e(r,null,{default:n(()=>[e(m(ne))]),_:1}),e(r,null,{default:n(()=>[e(m(ne))]),_:1})]),_:1},8,["disabled"])]),I("div",ot,[e(C,{onClick:l[9]||(l[9]=d=>m(s).shiftSubtitles(-o.value)),disabled:m(s).shiftCount===0},{default:n(()=>[e(r,null,{default:n(()=>[e(b)]),_:1})]),_:1},8,["disabled"]),I("span",{class:"count",onClick:l[10]||(l[10]=(...d)=>m(s).resetSubtitles&&m(s).resetSubtitles(...d))},Y(m(s).shiftCount),1),e(C,{onClick:l[11]||(l[11]=d=>m(s).shiftSubtitles(o.value))},{default:n(()=>[e(r,null,{default:n(()=>[e(m(xe))]),_:1})]),_:1})])])]),_:1},8,["modelValue","size"])}}}),rt={class:"prompt-controls",style:{display:"flex",gap:"5px",margin:"5px","align-items":"center"}},it={class:"segment-container"},ct={class:"time-controls"},ut={class:"time-controls"},dt={class:"time-controls"},mt={class:"card-footer"},pt=`
总结上面的对话内容，并参考下面的标题，为上面的对话内容起一个吸睛接地气的标题，同时给出建议标签，标签要每行一个，标题和标签要方便复制：
1、心智阳光健康，本科大二学生，聊天很是投缘，大冰不舍挂断
2、人为什么需要亲密关系？大冰深度分析，看完人都通透了
3、主动要礼物！聊天高端局，“泄露天机”太多，大冰“索要”礼物
4、如何把事情处理得圆润得体？大冰深度教学，家庭职场都受用
5、情侣裂痕是如何产生的？大冰深度分析，值得反复观看
6、光长年龄不长心智是一种什么体验？大冰对话32岁女画师，表现惊掉你下巴
7、颠覆你的认知：如何炼成顶级倾听力？大冰独家分享！带你突破沟通瓶颈！
8、如何把握相处的底层逻辑？大冰深度分析，职场婚姻都受用
9、精神未断奶是一种什么体验？大冰对话女硕士，思维表现大跌眼镜
10、如何克服自我否定的毛病？大冰深度教学，看完终身受益
`,ft=fe({__name:"Picker",setup(v){const s=se(),p=Te(),$=_e(),o=Ue([y()]);function y(){return{id:crypto.randomUUID(),startTime:0,endTime:0,duration:0,isK:!1}}const H=i=>{o.splice(i+1,0,y())},E=i=>{o.length>1&&o.splice(i,1)},N=i=>{if(i>0){const t=o.splice(i,1)[0];o.splice(i-1,0,t)}},K=i=>{if(i<o.length-1){const t=o.splice(i,1)[0];o.splice(i+1,0,t)}};function A(i){if(!s.player)return;const t=s.player.currentTime,a=o[i];a.startTime=t}function B(i){if(!s.player)return;const t=s.player.currentTime,a=o[i];a.endTime=t}function R(i,t){var M;const a=o[i],b=a.isK?"-k":"";let S=(M=s.data)==null?void 0:M.urls[0];if(!S)throw L("请先播放视频"),new Error("请先播放视频");const d=S.match(/\/([^\/]+)\.mp4$/),D=d?d[1]:(()=>{const de=new Date;return`${de.getFullYear()}${(de.getMonth()+1).toString().padStart(2,"0")}${de.getDate().toString().padStart(2,"0")}`})();if(!a.startTime||!a.endTime)throw L("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const q=V(a.startTime),X=V(a.endTime),Z=q.replace(/:/g,"."),ee=X.replace(/:/g,".");let f="yt-dlp --no-check-certificate";f=`${f} --download-sections "*${q}-${X}"`,f=`${f} --force-keyframes-at-cuts`;const U="~/storage/downloads/Reqable/";return t=="video"&&(f=`${f} --merge-output-format mp4 -o "${U}${D}_${Z}-${ee}.mp4"`),t=="audio"&&(f=`${f} ${b} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${U}${D}_${Z}-${ee}.mp3"`),f=`${f} '${S}' `,f}function w(i,t){var U;const a=o[i],b=a.isK?"-k":"";let S=(U=s.data)==null?void 0:U.urls[0];if(!S)throw L("请先播放视频"),new Error("请先播放视频");const d=S.match(/\/([^\/]+)\.mp4$/),D=d?d[1]:(()=>{const M=new Date;return`${M.getFullYear()}${(M.getMonth()+1).toString().padStart(2,"0")}${M.getDate().toString().padStart(2,"0")}`})();if(!a.startTime||!a.endTime)throw L("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const q=V(a.startTime),X=V(a.endTime),Z=q.replace(/:/g,"."),ee=X.replace(/:/g,".");let f=`--download-sections "*${q}-${X}"`;return t=="video"&&(f=`${f} --merge-output-format mp4 -o "${D}_${Z}-${ee}.mp4"`),t=="audio"&&(f=`${f} ${b} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${D}_${Z}-${ee}.mp3"`),f}async function c(){var t;const i=(t=s.data)==null?void 0:t.urls[0];if(!i){L("请先播放视频");return}try{await navigator.clipboard.writeText(i),J(`链接已复制：${i}`)}catch(a){console.error(a),L("复制失败，请手动复制")}}async function g(){var t;const i=(t=s.data)==null?void 0:t.id;if(!i){L("请先播放视频");return}try{await navigator.clipboard.writeText(i),J(`ID已复制：${i}`)}catch(a){console.error(a),L("ID失败，请手动复制")}}async function _(i,t,a){let b="";switch(t){case"dlp":b=R(i,a);break;case"seal":b=w(i,a);break}try{await navigator.clipboard.writeText(b),J(`命令已复制：${b}`)}catch(S){console.error(S),L("复制失败，请手动复制")}}const T=async i=>{const t=[];o.forEach((a,b)=>{console.log(`Index: ${b}`,a),t.push(R(b,i))});try{await navigator.clipboard.writeText(t.join(`
`)),J(`命令已复制：${t.join("<br/>")}`)}catch(a){console.error(a),L("复制失败，请手动复制")}},P=k(!1);async function O(){var d;let i=(d=s.data)==null?void 0:d.urls[0];if(!i){L("请先播放视频");return}const t=i.match(/\/([^\/]+)\.mp4$/),a=t?t[1]:(()=>{const D=new Date;return`${D.getFullYear()}${(D.getMonth()+1).toString().padStart(2,"0")}${D.getDate().toString().padStart(2,"0")}`})(),b=o.filter(D=>D.startTime<D.endTime).map((D,q)=>`${V(D.startTime)}-${V(D.endTime)}`);if(!b.length){L("请先至少设置一个开始和结束时间");return}const S=`dlp ${P.value?"keep":"delete"} '${i}' ${a} ${b.join(" ")}`;try{z(S),await navigator.clipboard.writeText(S),J(`命令已复制：${S}`)}catch(D){console.error(D),Q(D,"复制失败，请手动复制")}}async function z(i){try{const t=await fetch("http://localhost:8080/run",{method:"POST",headers:{"Content-Type":"text/plain"},body:i});if(!t.ok)throw new Error(`HTTP 错误: ${t.status}`);const b=(await t.json()).task_id;u(b)}catch(t){Q(t,"请求失败: ")}}function u(i){const t=setInterval(async()=>{var a;try{const b=await fetch(`http://localhost:8080/progress/${i}`);if(!b.ok)throw new Error(`进度查询失败: ${b.status}`);const S=await b.json(),d=(a=S.recent_log)!=null&&a.length?`

最近日志:
`+S.recent_log.join(`
`):"";Ae(d),S.status==="completed"&&(clearInterval(t),J(`处理完成✅ (状态: ${S.status})${d}`)),S.status==="failed"&&(clearInterval(t),L(`处理完成✅ (状态: ${S.status})${d}`))}catch(b){clearInterval(t),Q(b,"监控失败: ")}},1e3)}const l=k(!1),h=k("情感"),r=k(!1),C=`
从上面的对话提取有关${h.value}方面的内容，并给出出现的开始时间
`;async function G(i,t){const a=$.getSubtitles(i,t);let b="";a.value.map(S=>{const d=S.time.split(".")[0]+" "+S.text+`
`;b+=d}),b+=l.value?pt:r?C:"";try{await navigator.clipboard.writeText(b),J(`${a.value.length}条字幕已复制`)}catch(S){console.error(S),L("复制失败，请手动复制")}}return(i,t)=>{const a=x("el-button"),b=x("el-input"),S=x("DocumentCopy"),d=x("el-icon"),D=x("CaretLeft"),q=x("CaretRight"),X=x("Minus"),Z=x("Plus"),ee=x("el-card");return be((F(),ve(ee,{class:"segment-control-card"},{footer:n(()=>[I("div",mt,[e(a,{size:"small",onClick:c},{default:n(()=>t[16]||(t[16]=[j("复制链接")])),_:1}),e(a,{size:"small",onClick:g},{default:n(()=>t[17]||(t[17]=[j("复制ID")])),_:1}),e(a,{size:"small",onClick:O},{default:n(()=>t[18]||(t[18]=[j("下载片段")])),_:1}),e(a,{size:"small",onClick:t[3]||(t[3]=f=>T("video"))},{default:n(()=>t[19]||(t[19]=[j("复制命令")])),_:1})])]),default:n(()=>[I("div",rt,[e(a,{size:"small",type:l.value?"success":"info",onClick:t[0]||(t[0]=f=>{r.value=!1,l.value=!l.value})},{default:n(()=>t[4]||(t[4]=[j("取标题")])),_:1},8,["type"]),e(a,{size:"small",type:r.value?"success":"info",onClick:t[1]||(t[1]=f=>{l.value=!1,r.value=!r.value})},{default:n(()=>t[5]||(t[5]=[j("取内容")])),_:1},8,["type"]),e(b,{size:"small","model-value":h.value,"onUpdate:modelValue":t[2]||(t[2]=f=>h.value=f),disabled:!r.value,style:{flex:"1"}},null,8,["model-value","disabled"])]),I("div",it,[(F(!0),W(ye,null,Ce(o,(f,U)=>(F(),W("div",{key:f.id,class:"segment-item"},[I("div",ct,[e(a,{type:"primary",size:"small",onClick:M=>_(U,"seal","audio")},{default:n(()=>t[6]||(t[6]=[j("SA")])),_:2},1032,["onClick"]),e(a,{type:"primary",size:"small",onClick:M=>_(U,"seal","video")},{default:n(()=>t[7]||(t[7]=[j("SV")])),_:2},1032,["onClick"]),e(a,{type:"primary",size:"small",onClick:M=>_(U,"dlp","audio")},{default:n(()=>t[8]||(t[8]=[j("DA")])),_:2},1032,["onClick"]),e(a,{type:"primary",size:"small",onClick:M=>_(U,"dlp","video")},{default:n(()=>t[9]||(t[9]=[j("DV")])),_:2},1032,["onClick"]),e(b,{"model-value":m($).secondsToTime(f.endTime-f.startTime),size:"small",readonly:""},null,8,["model-value"]),e(a,{size:"small",type:f.isK?"success":"info",onClick:M=>f.isK=!f.isK},{default:n(()=>[j(Y(f.isK?"k开":"k关"),1)]),_:2},1032,["type","onClick"]),e(a,{size:"small",type:"success",onClick:M=>G(f.startTime,f.endTime)},{default:n(()=>[e(d,null,{default:n(()=>[e(S)]),_:1})]),_:2},1032,["onClick"])]),I("div",ut,[e(a,{type:"success",size:"small",onClick:M=>A(U)},{default:n(()=>t[10]||(t[10]=[j("S")])),_:2},1032,["onClick"]),e(a,{type:"success",size:"small",onClick:M=>m(s).jumpTo(m(V)(f.startTime))},{default:n(()=>t[11]||(t[11]=[j("J")])),_:2},1032,["onClick"]),e(a,{type:"success",size:"small",onClick:M=>f.startTime=f.startTime-.5},{default:n(()=>[e(d,null,{default:n(()=>[e(D)]),_:1})]),_:2},1032,["onClick"]),e(a,{type:"success",size:"small",onClick:M=>f.startTime=f.startTime+.5},{default:n(()=>[e(d,null,{default:n(()=>[e(q)]),_:1})]),_:2},1032,["onClick"]),e(b,{"model-value":m(V)(f.startTime),size:"small",readonly:""},null,8,["model-value"]),e(a,{size:"small",onClick:M=>N(U),disabled:U===0||o.length===1},{default:n(()=>t[12]||(t[12]=[j("↑")])),_:2},1032,["onClick","disabled"]),e(a,{size:"small",onClick:M=>E(U),disabled:o.length===1},{default:n(()=>[e(d,null,{default:n(()=>[e(X)]),_:1})]),_:2},1032,["onClick","disabled"])]),I("div",dt,[e(a,{type:"danger",size:"small",onClick:M=>B(U)},{default:n(()=>t[13]||(t[13]=[j("E")])),_:2},1032,["onClick"]),e(a,{type:"danger",size:"small",onClick:M=>m(s).jumpTo(m(V)(f.endTime))},{default:n(()=>t[14]||(t[14]=[j("J")])),_:2},1032,["onClick"]),e(a,{type:"danger",size:"small",onClick:M=>f.endTime=f.endTime-.5},{default:n(()=>[e(d,null,{default:n(()=>[e(D)]),_:1})]),_:2},1032,["onClick"]),e(a,{type:"danger",size:"small",onClick:M=>f.endTime=f.endTime+.5},{default:n(()=>[e(d,null,{default:n(()=>[e(q)]),_:1})]),_:2},1032,["onClick"]),e(b,{type:"danger","model-value":m(V)(f.endTime),size:"small",readonly:""},null,8,["model-value"]),e(a,{size:"small",onClick:M=>K(U),disabled:U===o.length-1||o.length===1},{default:n(()=>t[15]||(t[15]=[j("↓")])),_:2},1032,["onClick","disabled"]),e(a,{size:"small",onClick:M=>H(U)},{default:n(()=>[e(d,null,{default:n(()=>[e(Z)]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1},512)),[[Ve,m(p).open]])}}}),Se=(v,s)=>{const p=v.__vccOpts||v;for(const[$,o]of s)p[$]=o;return p},ke=Se(ft,[["__scopeId","data-v-a1c3ef2d"]]),vt={__name:"App",setup(v){return se(),(s,p)=>{const $=x("el-col"),o=x("el-row"),y=x("el-container");return F(),W(ye,null,[e(ke),e(y,{style:{height:"100vh"}},{default:n(()=>[e(o,{class:"grid-container"},{default:n(()=>[e($,{class:"grid-section top"},{default:n(()=>[e(Je)]),_:1}),e($,{class:"grid-section bottom"},{default:n(()=>[e(We),e(at),e(ke)]),_:1})]),_:1})]),_:1})],64)}}},yt=Se(vt,[["__scopeId","data-v-d44e3bc6"]]),ue=He(yt);ue.use(Ke());ue.use(ze);for(const[v,s]of Object.entries(Me))ue.component(v,s);ue.mount("#app");
