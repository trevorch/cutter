import{E as de,i as xe}from"./element-plus-DRLPWQh5.js";import{B as ze,l as Ee,w as Pe,Q as De,R as Me,S as Ie}from"./@element-plus-Dp6MuveI.js";import{r as y,j as pe,c as Z,o as Q,a as I,M as q,u as g,d as me,k as Ce,ag as z,aq as je,I as ue,G as be,H as s,P as t,L as M,S as Le,w as Ve,J as $e,O as se,a6 as Te,D as Oe,n as Ue,X as He,Q as he,at as Ke}from"./@vue-C01xNfPK.js";import{d as fe,c as Re}from"./pinia-CKuVeK4o.js";import{P as Ne}from"./plyr-CZIZ1zVJ.js";import{H as ie}from"./hls.js-DWnTp5j0.js";import{f as ke}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))_(i);new MutationObserver(i=>{for(const $ of i)if($.type==="childList")for(const j of $.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&_(j)}).observe(document,{childList:!0,subtree:!0});function r(i){const $={};return i.integrity&&($.integrity=i.integrity),i.referrerPolicy&&($.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?$.credentials="include":i.crossOrigin==="anonymous"?$.credentials="omit":$.credentials="same-origin",$}function _(i){if(i.ep)return;i.ep=!0;const $=r(i);fetch(i.href,$)}})();function Ae(m,n="未知错误"){if(m instanceof Error)return m.message;if(typeof m=="string")return m;if(typeof m=="object"&&m!==null&&"message"in m&&typeof m.message=="string")return m.message;try{return JSON.stringify(m)}catch{return n}}const ve={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},ye=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function te(m,n){const r=Ae(m),_=n?`${n}: ${r}`:r;de.error({...ve,message:`
    <div ${ye}>
      ${_}
    </div>
    `})}function K(m){de.error({...ve,message:`
    <div ${ye}>
      ${m}
    </div>
    `})}function ee(m){de.success({...ve,message:`
    <div ${ye}>
      ${m}
    </div>
    `})}const ne=m=>{try{const[n,r]=m.split("."),[_,i,$]=n.split(":").map(Number),j=r?parseInt(r.padEnd(3,"0")):0;return _*3600+i*60+$+j/1e3}catch{return 0}},N=m=>{const n=Math.round(m%1*1e3),r=Math.floor(m),_=Math.floor(r/3600),i=Math.floor(r%3600/60),$=r%60;return`${String(_).padStart(2,"0")}:${String(i).padStart(2,"0")}:${String($).padStart(2,"0")}.${String(n).padStart(3,"0")}`},le=fe("player",()=>{const m=y(""),n=y(null),r=y(null),_=y(null),i=y(null),$=y(null),j=a=>{n.value=new Ne(a,{hideControls:!1,controls:["play","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},E=a=>{R(a,!0)},B=a=>{R(a,!1)},R=(a,v)=>{i.value=a,m.value=a.date;const P=a.urls[0],U={type:"video",sources:[{src:P,type:A(P)}]};G(U).then(()=>{var f;v&&((f=n.value)==null||f.play())})},A=a=>a.includes(".m3u8")?"application/x-mpegURL":a.includes(".flv")?"video/x-flv":"video/mp4",G=async a=>{var P,U,f;(P=r.value)==null||P.destroy(),r.value=null,(U=_.value)==null||U.destroy(),_.value=null;const v=a.sources[0].src.includes(".m3u8")?"hls":a.sources[0].src.includes(".flv")?"flv":"html5";try{v!==$.value&&await((f=n.value)==null?void 0:f.stop()),n.value.source=a,v==="hls"&&ie.isSupported()?await W(a.sources[0].src):v==="flv"&&ke.isSupported()&&await h(a.sources[0].src),$.value=v}catch(O){console.error("源切换失败:",O)}},W=async a=>new Promise(v=>{r.value=new ie,r.value.loadSource(a),r.value.attachMedia(n.value.media),r.value.on(ie.Events.MANIFEST_PARSED,v)}),h=async a=>{_.value=ke.createPlayer({type:"flv",url:a}),_.value.attachMediaElement(n.value.media),_.value.load(),await _.value.play()},k=y(!1);return{player:n,initPlayer:j,switchSource:G,playStream:E,switchStream:B,title:m,data:i,autoPlay:k,jumpTo:a=>{const v=ne(a);if(n.value&&v>0)try{n.value.currentTime=v,k.value?n.value.play():n.value.pause()}catch(P){te(P,"跳转播放失败，请检查播放器状态")}}}}),Fe={class:"video-wrapper"},Be={class:"title"},qe={class:"plyr-container"},Je={__name:"Player",setup(m){const n=le(),r=y(null);return pe(()=>{n.initPlayer(r.value)}),(_,i)=>(Q(),Z("div",Fe,[I("h3",Be,q(g(n).title),1),I("div",qe,[I("video",{class:"player",ref_key:"videoRef",ref:r,playsinline:""},null,512)])]))}},ge=fe("editor",()=>{const m=y(!1),n=y(!1),r=y(""),_=y(null),i=5e3,$=y(i),j=S=>{n.value=!0,_.value=S,r.value=S.date,h()},E=y([]),B=S=>{try{const[a,v]=S.split("."),[P,U,f]=a.split(":").map(Number);return P*3600+U*60+f}catch(a){console.error(a)}},R=y(new Map),A=()=>{R.value.clear(),E.value.forEach((S,a)=>{try{const v=B(S.time);R.value.has(v)||R.value.set(v,a)}catch(v){console.error(`错误处理时间戳 ${S.time}（索引 ${a}）: ${v}`)}})},G=S=>{if(!E.value)return;const a=$.value+S;$.value=Math.max(a,0);const v=S/1e3;E.value=E.value.map(P=>{const f=ne(P.time)+v;return{...P,time:N(Math.max(f,0))}}),A()},W=()=>{if(!E.value)return;const a=($.value-i)/1e3;E.value=E.value.map(v=>{const U=ne(v.time)-a;return{...v,time:N(Math.max(U,0))}}),$.value=i,A()},h=async()=>{var S;m.value=!0;try{const a=await fetch(`srts/${(S=_.value)==null?void 0:S.id}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);E.value=await a.json();const v=$.value/1e3;E.value=E.value.map(P=>{const f=ne(P.time)+v;return{...P,time:N(Math.max(f,0))}}),A()}catch(a){console.error("数据获取失败:",a),te(a,"字幕数据加载失败，请稍后重试"),E.value=[]}finally{m.value=!1}};return{open:n,title:r,edit:j,data:_,timelineData:E,loading:m,shiftCount:$,shiftSubtitles:G,timeToSeconds:ne,secondsToTime:N,resetSubtitles:W,timeMap:R,timeToKey:B,getSubtitles:(S,a)=>{var p;const v=y([]);if(!((p=E.value)!=null&&p.length))return console.error("时间轴数据未加载"),v;const P=B(N(S)),U=B(N(a)),f=R.value.get(P),O=R.value.get(U);if(typeof f!="number"||typeof O!="number")return console.error("无法匹配有效的时间段"),v;const J=Math.max(0,f),u=Math.min(E.value.length-1,O),[l,w]=J<=u?[J,u]:[u,J];return v.value=E.value.slice(l,w+1),v}}}),Ye=["onClick"],Qe=["onClick"],Ge=["onClick"],We={style:{display:"flex",gap:"0","justify-content":"flex-end"}},Xe=me({__name:"Playlist",setup(m){const n=le(),r=ge(),_=y(""),i=y(!0),$=y([]),j=async()=>{try{const h=await fetch("video.json");if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);$.value=await h.json()}catch(h){te(h,"数据加载失败")}finally{i.value=!1}},E=Ce(()=>{const h=_.value.toLowerCase();return $.value.filter(k=>k.id.toLowerCase().includes(h)||k.date.toLowerCase().includes(h))}),B=async h=>{var k;((k=h.urls)==null?void 0:k.length)>0?await A(h.urls[0],"链接已复制到剪贴板","链接复制失败"):K("该记录没有可用的链接")},R=async h=>{h.id?await A(h.id,"ID已复制到剪贴板","ID复制失败"):K("该记录没有可用的ID")},A=async(h,k,S)=>{try{await navigator.clipboard.writeText(h),ee(k)}catch(a){te(a,S)}},G=h=>{var k;(k=h.urls)!=null&&k.length&&(h.urls[0],n.switchStream(h),r.edit(h))},W=h=>{var k;(k=h.urls)!=null&&k.length&&(h.urls[0],n.playStream(h))};return pe(()=>{j()}),(h,k)=>{const S=z("el-table-column"),a=z("el-input"),v=z("el-button"),P=z("el-table"),U=je("loading");return ue((Q(),be(P,{data:E.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:s(()=>[t(S,{fixed:"",label:"序号",width:"40"},{default:s(f=>[I("span",{class:"column-text",onClick:O=>R(f.row)},q((f.$index+1).toString().padStart(4,"0")),9,Ye)]),_:1}),t(S,{fixed:"",label:"日期",prop:"date",sortable:"",width:"130"},{default:s(f=>[I("span",{class:"column-text clickable-text",onClick:O=>B(f.row)},q(f.row.date),9,Qe)]),_:1}),t(S,{fixed:"",label:"ID",prop:"id",width:"180"},{default:s(f=>[I("span",{class:"column-text clickable-text",onClick:O=>R(f.row)},q(f.row.id),9,Ge)]),_:1}),t(S,{fixed:"right",align:"right",width:"115"},{header:s(()=>[t(a,{modelValue:_.value,"onUpdate:modelValue":k[0]||(k[0]=f=>_.value=f),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:s(f=>{var O,J;return[I("div",We,[t(v,{plain:"",size:"small",onClick:u=>G(f.row),type:f.row.hasSrt?"success":"warning",disabled:!f.row.hasSrt},{default:s(()=>k[1]||(k[1]=[M(" 切片 ")])),_:2},1032,["onClick","type","disabled"]),t(v,{plain:"",size:"small",onClick:u=>W(f.row),type:(O=f.row.urls)!=null&&O.length?"success":"warning",disabled:!((J=f.row.urls)!=null&&J.length)},{default:s(()=>k[2]||(k[2]=[M(" 播放 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[U,i.value]])}}}),_e=(m,n)=>{const r=m.__vccOpts||m;for(const[_,i]of n)r[_]=i;return r},Ze=_e(Xe,[["__scopeId","data-v-e9ca9c48"]]),Se=fe("picker",()=>{const m=y(!1),n=y(!1),r=y("");return y(null),y(0),{open:n,title:r,loading:m}}),et={style:{display:"flex",gap:"0","justify-content":"flex-start"}},tt={key:0,class:"loading-state"},nt={class:"srt-time"},lt=["onClick"],st={key:1,class:"empty-state"},ot={class:"footer-container"},at={class:"time-shift-controls"},it={class:"time-shift-controls"},rt={class:"time-shift-controls"},re=100,ce=5e3,ct=me({__name:"Editor",setup(m){const n=ge(),r=le(),_=Se(),i=y(!1),$=()=>{r.player&&(r.player.playing?r.player.pause():r.player.play())},j=y(1e3),E=u=>{const l=j.value+u;j.value=Math.max(re,Math.min(ce,l))},B=y(["你好","晚上好","拜拜","再见"]),R=u=>B.value.some(l=>u.includes(l)),A=Ce(()=>n.timelineData.map((u,l)=>({text:u.text,index:l})).filter(({text:u})=>R(u)).map(({index:u})=>u).sort((u,l)=>u-l)),G=()=>{const u=A.value;if(u.length===0){K("未找到包含关键字的字幕行");return}let l=0,w=u.length-1,p=-1;for(;l<=w;){const T=Math.floor((l+w)/2);u[T]<a.value?(p=u[T],l=T+1):w=T-1}p===-1&&(p=u[u.length-1]),P(p)},W=()=>{const u=A.value;if(u.length===0){K("未找到包含关键字的字幕行");return}let l=0,w=u.length-1,p=-1;for(;l<=w;){const T=Math.floor((l+w)/2);u[T]>a.value?(p=u[T],w=T-1):l=T+1}p===-1&&(p=u[0]),P(p)},h=y(),k=y([]),S=u=>{u instanceof HTMLElement&&k.value.push(u)},a=y(0),v=async u=>{const l=N(u),w=n.timeToKey(l),p=n.timeMap.get(w);typeof p=="number"&&p!==a.value&&(a.value=p,await Ue(),setTimeout(()=>P(p),50))},P=u=>{const l=h.value,w=k.value[u];if(w instanceof HTMLElement&&l){const T=w.offsetTop-l.clientHeight/2;l.scrollTo({top:T,behavior:"smooth"})}},U=y(595),f=y();let O=null;pe(()=>{f.value=document.querySelector(".grid-section.bottom"),f.value&&(O=new ResizeObserver(u=>{for(const l of u){const{height:w}=l.contentRect;U.value=w}}),O.observe(f.value)),r.player.on("timeupdate",()=>{v(r.player.currentTime)}),r.player.on("play",()=>{i.value=!0}),r.player.on("pause",()=>{i.value=!1})}),Le(()=>{O&&f.value&&O.unobserve(f.value),r.player.off("timeupdate",v),k.value=[]}),Ve(()=>n.timelineData,()=>{k.value=[]});const J=async()=>{var u,l;try{const w=(u=r.player)==null?void 0:u.media;if(!(w instanceof HTMLVideoElement)){K("无法获取视频元素");return}const p=document.createElement("canvas");p.width=w.videoWidth,p.height=w.videoHeight;const T=p.getContext("2d");if(!T){te("无法创建画布上下文");return}T.drawImage(w,0,0,p.width,p.height);const c=p.toDataURL("image/jpeg",.9),e=document.createElement("a"),o=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);e.download=`capture_${(l=n.data)==null?void 0:l.id}_${o}.jpg`,e.href=c,document.body.appendChild(e),e.click(),document.body.removeChild(e),ee("截图已保存")}catch(w){te(`截图失败: ${w instanceof Error?w.message:w}`)}};return(u,l)=>{const w=z("Camera"),p=z("el-icon"),T=z("el-button"),c=z("el-text"),e=z("Top"),o=z("Bottom"),C=z("el-space"),D=z("el-affix"),x=z("Expand"),V=z("Minus"),Y=z("el-drawer");return Q(),be(Y,{modelValue:g(n).open,"onUpdate:modelValue":l[10]||(l[10]=b=>g(n).open=b),direction:"btt",modal:!1,size:U.value,onOpened:l[11]||(l[11]=b=>g(n).shiftSubtitles(0))},{header:s(()=>[I("div",et,[t(T,{onClick:J,size:"small",circle:""},{default:s(()=>[t(p,null,{default:s(()=>[t(w)]),_:1})]),_:1}),t(c,{class:"mx-1",type:"warning"},{default:s(()=>{var b,F;return[M(q((b=g(n).data)==null?void 0:b.date)+" - "+q((F=g(n).data)==null?void 0:F.id),1)]}),_:1})])]),default:s(()=>[I("div",{class:"timeline-container",ref_key:"containerRef",ref:h},[g(n).loading?(Q(),Z("div",tt,[t(p,{class:"is-loading",color:"#409EFF",size:20},{default:s(()=>[t(g(Ee))]),_:1}),l[12]||(l[12]=I("span",null,"正在加载字幕数据...",-1))])):$e("",!0),(Q(!0),Z(se,null,Te(g(n).timelineData,(b,F)=>(Q(),Z("div",{key:F,class:"timeline-item",ref_for:!0,ref:S},[I("span",nt,q(b.time),1),I("span",{class:Oe(["srt-text",{highlight:F==a.value,keyword:R(b.text)}]),onClick:X=>{v(g(ne)(b.time)),g(r).jumpTo(b.time)}},q(b.text),11,lt)]))),128)),!g(n).loading&&g(n).timelineData.length===0?(Q(),Z("div",st,[t(p,null,{default:s(()=>[t(g(Pe))]),_:1}),l[13]||(l[13]=I("span",null,"暂无字幕数据",-1))])):$e("",!0)],512),t(D,{class:"floating-btn",position:"bottom",offset:200},{default:s(()=>[t(C,{direction:"vertical"},{default:s(()=>[t(T,{onClick:l[0]||(l[0]=b=>g(r).autoPlay=!g(r).autoPlay),type:g(r).autoPlay?"success":""},{default:s(()=>[t(p,null,{default:s(()=>l[14]||(l[14]=[M("A")])),_:1})]),_:1},8,["type"]),t(T,{onClick:G},{default:s(()=>[t(p,null,{default:s(()=>[t(e)]),_:1})]),_:1}),t(T,{onClick:W},{default:s(()=>[t(p,null,{default:s(()=>[t(o)]),_:1})]),_:1}),t(T,{onClick:$,icon:i.value?g(De):g(Me)},null,8,["icon"])]),_:1})]),_:1})]),footer:s(()=>[I("div",ot,[I("div",at,[t(T,{size:"small",type:g(_).open?"success":""},{default:s(()=>[t(p,{onClick:l[1]||(l[1]=b=>g(_).open=!g(_).open)},{default:s(()=>[t(x)]),_:1})]),_:1},8,["type"])]),I("div",it,[t(T,{onClick:l[2]||(l[2]=b=>g(n).shiftSubtitles(-j.value)),disabled:g(n).shiftCount===0,size:"small"},{default:s(()=>[t(p,null,{default:s(()=>[t(V)]),_:1})]),_:1},8,["disabled"]),I("span",{class:"count",onClick:l[3]||(l[3]=(...b)=>g(n).resetSubtitles&&g(n).resetSubtitles(...b))},q(g(n).shiftCount),1),t(T,{onClick:l[4]||(l[4]=b=>g(n).shiftSubtitles(j.value)),size:"small"},{default:s(()=>[t(p,null,{default:s(()=>[t(g(ze))]),_:1})]),_:1})]),I("div",rt,[t(T,{plain:"",type:"danger",onClick:l[5]||(l[5]=b=>E(-1e3)),disabled:j.value<=re,size:"small"},{default:s(()=>l[15]||(l[15]=[M(" <<1000 ")])),_:1},8,["disabled"]),t(T,{plain:"",type:"danger",onClick:l[6]||(l[6]=b=>E(-100)),disabled:j.value<=re,size:"small"},{default:s(()=>l[16]||(l[16]=[M(" <100 ")])),_:1},8,["disabled"]),I("span",{class:"count",onClick:l[7]||(l[7]=b=>j.value=1e3)},q(j.value),1),t(T,{plain:"",type:"success",onClick:l[8]||(l[8]=b=>E(100)),disabled:j.value>=ce,size:"small"},{default:s(()=>l[17]||(l[17]=[M(" 100> ")])),_:1},8,["disabled"]),t(T,{plain:"",type:"success",onClick:l[9]||(l[9]=b=>E(1e3)),disabled:j.value>=ce,size:"small"},{default:s(()=>l[18]||(l[18]=[M(" 1000>> ")])),_:1},8,["disabled"])])])]),_:1},8,["modelValue","size"])}}}),ut={class:"prompt-controls",style:{display:"flex",gap:"5px",margin:"5px","align-items":"center"}},dt={class:"segment-container"},pt={class:"time-controls"},mt={class:"time-controls"},ft={class:"time-controls"},vt={class:"card-footer"},yt=`
总结上面的对话内容，并参考下面的标题以及高点击率标题核心公式，运用马斯洛需求层次理论，为上面的对话内容起一个吸睛接地气的标题，不能夸大其词，不能包含不实内容，同时给出建议标签，标签要每行一个，标题和标签要方便复制：
一、参考标题
1、心智阳光健康，本科大二学生，聊天很是投缘，大冰不舍挂断
2、人为什么需要亲密关系？大冰深度分析，看完人都通透了
3、主动要礼物！聊天高端局，“泄露天机”太多，大冰“索要”礼物
4、如何把事情处理得圆润得体？大冰深度教学，家庭职场都受用
5、情侣裂痕是如何产生的？大冰深度分析，值得反复观看
6、光长年龄不长心智是一种什么体验？大冰对话32岁女画师，表现惊掉你下巴
7、颠覆你的认知：如何炼成顶级倾听力？大冰独家分享！带你突破沟通瓶颈！
8、如何把握相处的底层逻辑？大冰深度分析，职场婚姻都受用
9、精神未断奶是一种什么体验？大冰对话女硕士，思维表现大跌眼镜
10、如何克服自我否定的毛病？大冰深度教学，看完终身受益
二、高点击率标题核心公式
1、数字+痛点/利益
例：《月薪3千到3万，她靠这5个理财技巧逆袭，第3点人人可复制》。
2、疑问句+悬念
例：《为何日本核污水排海后，欧美集体沉默？背后真相远超想象》。
3、热点绑定+情绪词
例：《全网震怒！某顶流明星偷税细节曝光，经纪人一句话惹怒全网》。
4、挑战常识+颠覆认知
例：《喝粥不养胃！协和医生警告：这3种“健康习惯”反而致癌》。
5、本地化+紧迫感
例：《北京人注意！这趟地铁线路将停运3个月，明天起实施》。
`,gt=`
从上面的对话提取有关_P_方面的内容，并给出出现的开始时间
`,_t=me({__name:"Picker",setup(m){const n=le(),r=Se(),_=ge(),i=He([$()]);function $(){return{id:crypto.randomUUID(),startTime:0,endTime:0,duration:0,isK:!1}}const j=c=>{i.splice(c+1,0,$())},E=c=>{i.length>1&&i.splice(c,1)},B=c=>{if(c>0){const e=i.splice(c,1)[0];i.splice(c-1,0,e)}},R=c=>{if(c<i.length-1){const e=i.splice(c,1)[0];i.splice(c+1,0,e)}};function A(c){if(!n.player)return;const e=n.player.currentTime,o=i[c];o.startTime=e}function G(c){if(!n.player)return;const e=n.player.currentTime,o=i[c];o.endTime=e}function W(c,e){var L;const o=i[c],C=o.isK?"-k":"";let D=(L=n.data)==null?void 0:L.urls[0];if(!D)throw K("请先播放视频"),new Error("请先播放视频");const x=D.match(/\/([^\/]+)\.mp4$/),V=x?x[1]:(()=>{const ae=new Date;return`${ae.getFullYear()}${(ae.getMonth()+1).toString().padStart(2,"0")}${ae.getDate().toString().padStart(2,"0")}`})();if(!o.startTime||!o.endTime)throw K("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const Y=N(o.startTime),b=N(o.endTime),F=Y.replace(/:/g,"."),X=b.replace(/:/g,".");let d="yt-dlp --no-check-certificate";d=`${d} --concurrent-fragments 16 --throttled-rate 5M `,d=`${d} --download-sections "*${Y}-${b}"`;const H="~/storage/downloads/Reqable/";return e=="video"&&(d=`${d} --merge-output-format mp4 -o "${H}${V}_${F}-${X}.mp4"`),e=="audio"&&(d=`${d} ${C} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${H}${V}_${F}-${X}.mp3"`),d=`${d} '${D}' `,d}function h(c,e){var H;const o=i[c],C=o.isK?"-k":"";let D=(H=n.data)==null?void 0:H.urls[0];if(!D)throw K("请先播放视频"),new Error("请先播放视频");const x=D.match(/\/([^\/]+)\.mp4$/),V=x?x[1]:(()=>{const L=new Date;return`${L.getFullYear()}${(L.getMonth()+1).toString().padStart(2,"0")}${L.getDate().toString().padStart(2,"0")}`})();if(!o.startTime||!o.endTime)throw K("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const Y=N(o.startTime),b=N(o.endTime),F=Y.replace(/:/g,"."),X=b.replace(/:/g,".");let d=`--download-sections "*${Y}-${b}"`;return e=="video"&&(d=`${d} --merge-output-format mp4 -o "${V}_${F}-${X}.mp4"`),e=="audio"&&(d=`${d} ${C} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${V}_${F}-${X}.mp3"`),d}async function k(){var e;const c=(e=n.data)==null?void 0:e.urls[0];if(!c){K("请先播放视频");return}try{await navigator.clipboard.writeText(c),ee(`链接已复制：${c}`)}catch(o){console.error(o),K("复制失败，请手动复制")}}async function S(){var e;const c=(e=n.data)==null?void 0:e.id;if(!c){K("请先播放视频");return}try{await navigator.clipboard.writeText(c),ee(`ID已复制：${c}`)}catch(o){console.error(o),K("ID失败，请手动复制")}}async function a(c,e,o){let C="";switch(e){case"dlp":C=W(c,o);break;case"seal":C=h(c,o);break}try{await navigator.clipboard.writeText(C),ee(`命令已复制：${C}`)}catch(D){console.error(D),K("复制失败，请手动复制")}}const v=async c=>{const e=[];i.forEach((o,C)=>{console.log(`Index: ${C}`,o),e.push(W(C,c))});try{await navigator.clipboard.writeText(e.join(`
`)),ee(`命令已复制：${e.join("<br/>")}`)}catch(o){console.error(o),K("复制失败，请手动复制")}},P=y(!1);async function U(){var x;let c=(x=n.data)==null?void 0:x.urls[0];if(!c){K("请先播放视频");return}const e=c.match(/\/([^\/]+)\.mp4$/),o=e?e[1]:(()=>{const V=new Date;return`${V.getFullYear()}${(V.getMonth()+1).toString().padStart(2,"0")}${V.getDate().toString().padStart(2,"0")}`})(),C=i.filter(V=>V.startTime<V.endTime).map((V,Y)=>`${N(V.startTime)}-${N(V.endTime)}`);if(!C.length){K("请先至少设置一个开始和结束时间");return}const D=`dlp ${P.value?"keep":"delete"} '${c}' ${o} ${C.join(" ")}`;try{f(D),await navigator.clipboard.writeText(D),ee(`命令已复制：${D}`)}catch(V){console.error(V),te(V,"复制失败，请手动复制")}}async function f(c){try{const e=await fetch("http://localhost:8080/run",{method:"POST",headers:{"Content-Type":"text/plain"},body:c});if(!e.ok)throw new Error(`HTTP 错误: ${e.status}`);const C=(await e.json()).task_id;u(C)}catch(e){te(e,"请求失败: ")}}const O=y(!1),J=y("");function u(c){O.value=!0;const e=setInterval(async()=>{var C;let o="";try{const D=await fetch(`http://localhost:8080/progress/${c}`);if(!D.ok)throw new Error(`进度查询失败: ${D.status}`);const x=await D.json();o=(C=x.recent_log)!=null&&C.length?`

最近日志:
`+x.recent_log.join(`
`):"",x.status==="completed"&&(clearInterval(e),o=`处理完成✅ (状态: ${x.status})${o}`),x.status==="failed"&&(clearInterval(e),o=`处理完成✅ (状态: ${x.status})${o}`)}catch{clearInterval(e),o="监控失败: "}J.value=o},1e3)}const l=y(!1),w=y("情感"),p=y(!1);async function T(c,e){const o=_.getSubtitles(c,e);let C="";o.value.map(D=>{const x=D.time.split(".")[0]+" "+D.text+`
`;C+=x}),C+=l.value?yt:p.value?gt.replace("_P_",w.value):"";try{await navigator.clipboard.writeText(C),ee(`${o.value.length}条字幕已复制`)}catch(D){console.error(D),K("复制失败，请手动复制")}}return(c,e)=>{const o=z("el-button"),C=z("el-input"),D=z("DocumentCopy"),x=z("el-icon"),V=z("CaretLeft"),Y=z("CaretRight"),b=z("Plus"),F=z("Minus"),X=z("el-card");return Q(),Z(se,null,[ue(t(X,{class:"segment-control-card"},{footer:s(()=>[I("div",vt,[t(o,{plain:"",type:"success",size:"small",onClick:U},{default:s(()=>e[17]||(e[17]=[M("下载片段")])),_:1}),t(o,{plain:"",type:O.value?"warning":"primary",size:"small",onClick:e[3]||(e[3]=d=>O.value=!O.value)},{default:s(()=>e[18]||(e[18]=[M("显示日志")])),_:1},8,["type"]),t(o,{plain:"",type:"success",size:"small",onClick:k},{default:s(()=>e[19]||(e[19]=[M("复制链接")])),_:1}),t(o,{plain:"",type:"success",size:"small",onClick:S},{default:s(()=>e[20]||(e[20]=[M("复制ID")])),_:1}),t(o,{plain:"",type:"success",size:"small",onClick:e[4]||(e[4]=d=>v("video"))},{default:s(()=>e[21]||(e[21]=[M("复制命令")])),_:1})])]),default:s(()=>[I("div",ut,[t(o,{size:"small",type:l.value?"success":"info",onClick:e[0]||(e[0]=d=>{p.value=!1,l.value=!l.value})},{default:s(()=>e[5]||(e[5]=[M("取标题")])),_:1},8,["type"]),t(o,{size:"small",type:p.value?"success":"info",onClick:e[1]||(e[1]=d=>{l.value=!1,p.value=!p.value})},{default:s(()=>e[6]||(e[6]=[M("取内容")])),_:1},8,["type"]),t(C,{size:"small",modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=d=>w.value=d),disabled:!p.value,style:{flex:"1"}},null,8,["modelValue","disabled"])]),I("div",dt,[(Q(!0),Z(se,null,Te(i,(d,H)=>(Q(),Z("div",{key:d.id,class:"segment-item"},[I("div",pt,[t(o,{plain:"",type:"primary",size:"small",onClick:L=>a(H,"seal","audio")},{default:s(()=>e[7]||(e[7]=[M("SA")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"primary",size:"small",onClick:L=>a(H,"seal","video")},{default:s(()=>e[8]||(e[8]=[M("SV")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"primary",size:"small",onClick:L=>a(H,"dlp","audio")},{default:s(()=>e[9]||(e[9]=[M("DA")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"primary",size:"small",onClick:L=>a(H,"dlp","video")},{default:s(()=>e[10]||(e[10]=[M("DV")])),_:2},1032,["onClick"]),t(C,{"model-value":g(_).secondsToTime(d.endTime-d.startTime),size:"small",readonly:""},null,8,["model-value"]),t(o,{plain:"",size:"small",type:d.isK?"success":"info",onClick:L=>d.isK=!d.isK},{default:s(()=>[M(q(d.isK?"k开":"k关"),1)]),_:2},1032,["type","onClick"]),t(o,{plain:"",size:"small",type:"success",onClick:L=>T(d.startTime,d.endTime)},{default:s(()=>[t(x,null,{default:s(()=>[t(D)]),_:1})]),_:2},1032,["onClick"])]),I("div",mt,[t(o,{plain:"",type:"success",size:"small",onClick:L=>A(H)},{default:s(()=>e[11]||(e[11]=[M("S")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"success",size:"small",onClick:L=>g(n).jumpTo(g(N)(d.startTime))},{default:s(()=>e[12]||(e[12]=[M("J")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"success",size:"small",onClick:L=>d.startTime=d.startTime-.5},{default:s(()=>[t(x,null,{default:s(()=>[t(V)]),_:1})]),_:2},1032,["onClick"]),t(o,{plain:"",type:"success",size:"small",onClick:L=>d.startTime=d.startTime+.5},{default:s(()=>[t(x,null,{default:s(()=>[t(Y)]),_:1})]),_:2},1032,["onClick"]),t(C,{"model-value":g(N)(d.startTime),size:"small",readonly:""},null,8,["model-value"]),t(o,{plain:"",size:"small",onClick:L=>B(H),disabled:H===0||i.length===1},{default:s(()=>e[13]||(e[13]=[M("↑")])),_:2},1032,["onClick","disabled"]),t(o,{plain:"",type:"success",size:"small",onClick:L=>j(H)},{default:s(()=>[t(x,null,{default:s(()=>[t(b)]),_:1})]),_:2},1032,["onClick"])]),I("div",ft,[t(o,{plain:"",type:"danger",size:"small",onClick:L=>G(H)},{default:s(()=>e[14]||(e[14]=[M("E")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"danger",size:"small",onClick:L=>g(n).jumpTo(g(N)(d.endTime))},{default:s(()=>e[15]||(e[15]=[M("J")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"danger",size:"small",onClick:L=>d.endTime=d.endTime-.5},{default:s(()=>[t(x,null,{default:s(()=>[t(V)]),_:1})]),_:2},1032,["onClick"]),t(o,{plain:"",type:"danger",size:"small",onClick:L=>d.endTime=d.endTime+.5},{default:s(()=>[t(x,null,{default:s(()=>[t(Y)]),_:1})]),_:2},1032,["onClick"]),t(C,{type:"danger","model-value":g(N)(d.endTime),size:"small",readonly:""},null,8,["model-value"]),t(o,{plain:"",size:"small",onClick:L=>R(H),disabled:H===i.length-1||i.length===1},{default:s(()=>e[16]||(e[16]=[M("↓")])),_:2},1032,["onClick","disabled"]),t(o,{plain:"",type:"danger",size:"small",onClick:L=>E(H),disabled:i.length===1},{default:s(()=>[t(x,null,{default:s(()=>[t(F)]),_:1})]),_:2},1032,["onClick","disabled"])])]))),128))])]),_:1},512),[[he,g(r).open]]),ue(t(X,{class:"log-card",style:{"max-width":"480px","z-index":"1000000 !important"}},{default:s(()=>[I("p",null,q(J.value),1)]),_:1},512),[[he,O.value]])],64)}}}),we=_e(_t,[["__scopeId","data-v-452d4ae2"]]),$t={__name:"App",setup(m){return le(),(n,r)=>{const _=z("el-col"),i=z("el-row"),$=z("el-container");return Q(),Z(se,null,[t(we),t($,{style:{height:"100vh"}},{default:s(()=>[t(i,{class:"grid-container"},{default:s(()=>[t(_,{class:"grid-section top"},{default:s(()=>[t(Je)]),_:1}),t(_,{class:"grid-section bottom"},{default:s(()=>[t(Ze),t(ct),t(we)]),_:1})]),_:1})]),_:1})],64)}}},ht=_e($t,[["__scopeId","data-v-d44e3bc6"]]),oe=Ke(ht);oe.use(Re());oe.use(xe);for(const[m,n]of Object.entries(Ie))oe.component(m,n);oe.mount("#app");
