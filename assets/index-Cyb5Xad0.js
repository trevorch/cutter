import{E as Y,i as ue}from"./element-plus-CPntL8j2.js";import{f as N,g as V,B as ce,l as de,w as fe,Q as pe}from"./@element-plus-By79ymwD.js";import{r as _,j as J,c as H,o as D,a as C,M as I,u as f,d as Q,k as Z,ag as T,aq as me,I as ee,G as A,H as n,P as e,L as j,Q as ve,a6 as te,O as se,S as _e,w as ye,J as W,D as ge,n as he,at as be}from"./@vue-C01xNfPK.js";import{d as G,c as we}from"./pinia-CKuVeK4o.js";import{P as ke}from"./plyr-CZIZ1zVJ.js";import{H as q}from"./hls.js-DWnTp5j0.js";import{f as X}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const m of l)if(m.type==="childList")for(const h of m.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function d(l){const m={};return l.integrity&&(m.integrity=l.integrity),l.referrerPolicy&&(m.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?m.credentials="include":l.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function i(l){if(l.ep)return;l.ep=!0;const m=d(l);fetch(l.href,m)}})();const F=G("player",()=>{const c=_(""),s=_(null),d=_(null),i=_(null),l=_(null),m=_(null),h=b=>{s.value=new ke(b,{hideControls:!1,controls:["play-large","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},P=b=>{l.value=b,c.value=b.date;const o=b.urls[0],v={type:"video",sources:[{src:o,type:M(o)}]};z(v).then(()=>{var r;return(r=s.value)==null?void 0:r.play()})},M=b=>b.includes(".m3u8")?"application/x-mpegURL":b.includes(".flv")?"video/x-flv":"video/mp4",z=async b=>{var v,r,p;(v=d.value)==null||v.destroy(),d.value=null,(r=i.value)==null||r.destroy(),i.value=null;const o=b.sources[0].src.includes(".m3u8")?"hls":b.sources[0].src.includes(".flv")?"flv":"html5";try{o!==m.value&&await((p=s.value)==null?void 0:p.stop()),s.value.source=b,o==="hls"&&q.isSupported()?await E(b.sources[0].src):o==="flv"&&X.isSupported()&&await L(b.sources[0].src),m.value=o}catch(g){console.error("源切换失败:",g)}},E=async b=>new Promise(o=>{d.value=new q,d.value.loadSource(b),d.value.attachMedia(s.value.media),d.value.on(q.Events.MANIFEST_PARSED,o)}),L=async b=>{i.value=X.createPlayer({type:"flv",url:b}),i.value.attachMediaElement(s.value.media),i.value.load(),await i.value.play()};return{player:s,initPlayer:h,switchSource:z,playStream:P,title:c,data:l}}),Se={class:"video-wrapper"},Ce={class:"title"},xe={class:"plyr-container"},Te={__name:"Player",setup(c){const s=F(),d=_(null);return J(()=>{s.initPlayer(d.value)}),(i,l)=>(D(),H("div",Se,[C("h3",Ce,I(f(s).title),1),C("div",xe,[C("video",{class:"player",ref_key:"videoRef",ref:d,playsinline:""},null,512)])]))}};function $e(c,s="未知错误"){if(c instanceof Error)return c.message;if(typeof c=="string")return c;if(typeof c=="object"&&c!==null&&"message"in c&&typeof c.message=="string")return c.message;try{return JSON.stringify(c)}catch{return s}}function O(c,s){const d=$e(c),i=s?`${s}: ${d}`:d;Y.error({message:i,offset:600,duration:3e3})}function Me(c){Y.success({message:c,offset:600,duration:3e3})}const le=G("editor",()=>{const c=_(!1),s=_(!1),d=_(""),i=_(null),l=_(0),m=r=>{s.value=!0,i.value=r,d.value=r.date,v()},h=_([]),P=r=>{try{const[p,g]=r.split("."),[x,$,y]=p.split(":").map(Number),a=g?parseInt(g.padEnd(3,"0")):0;return x*3600+$*60+y+a/1e3}catch{return 0}},M=r=>{const p=Math.round(r%1*1e3),g=Math.floor(r),x=Math.floor(g/3600),$=Math.floor(g%3600/60),y=g%60;return`${String(x).padStart(2,"0")}:${String($).padStart(2,"0")}:${String(y).padStart(2,"0")}.${String(p).padStart(3,"0")}`},z=r=>{try{const[p,g]=r.split("."),[x,$,y]=p.split(":").map(Number);return x*3600+$*60+y}catch(p){console.error(p)}},E=_(new Map),L=()=>{E.value.clear(),h.value.forEach((r,p)=>{try{const g=z(r.time);E.value.has(g)||E.value.set(g,p)}catch(g){console.error(`错误处理时间戳 ${r.time}（索引 ${p}）: ${g}`)}})},b=r=>{if(!h.value)return;const p=l.value+r;l.value=Math.max(p,0);const g=r/1e3;h.value=h.value.map(x=>{const y=P(x.time)+g;return{...x,time:M(Math.max(y,0))}}),L()},o=()=>{if(h.value){if(l.value){const r=l.value/1e3;h.value=h.value.map(p=>{const x=P(p.time)-r;return{...p,time:M(Math.max(x,0))}})}l.value=0,L()}},v=async()=>{var r;c.value=!0;try{const p=await fetch(`srts/${(r=i.value)==null?void 0:r.id}`);if(!p.ok)throw new Error(`HTTP error! status: ${p.status}`);if(h.value=await p.json(),l.value){const g=l.value/1e3;h.value=h.value.map(x=>{const y=P(x.time)+g;return{...x,time:M(Math.max(y,0))}})}L()}catch(p){console.error("数据获取失败:",p),O(p,"字幕数据加载失败，请稍后重试"),h.value=[]}finally{c.value=!1}};return{open:s,title:d,edit:m,data:i,timelineData:h,loading:c,shiftCount:l,shiftSubtitles:b,timeToSeconds:P,secondsToTime:M,resetSubtitles:o,timeMap:E,timeToKey:z}}),Ee=(c,s)=>{const d=c.__vccOpts||c;for(const[i,l]of s)d[i]=l;return d},Pe=["onClick"],ze=["onClick"],De={style:{display:"flex",gap:"0","justify-content":"flex-end"}},Le=Q({__name:"Playlist",setup(c){const s=F(),d=le(),i=_(""),l=_(!0),m=_([]),h=async()=>{try{const o=await fetch("video.json");if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);m.value=await o.json()}catch(o){O(o,"数据加载失败")}finally{l.value=!1}},P=Z(()=>{const o=i.value.toLowerCase();return m.value.filter(v=>v.id.toLowerCase().includes(o)||v.date.toLowerCase().includes(o))}),M=async o=>{var v;((v=o.urls)==null?void 0:v.length)>0?await E(o.urls[0],"链接已复制到剪贴板","链接复制失败"):O("该记录没有可用的链接")},z=async o=>{o.id?await E(o.id,"ID已复制到剪贴板","ID复制失败"):O("该记录没有可用的ID")},E=async(o,v,r)=>{try{await navigator.clipboard.writeText(o),Me(v)}catch(p){O(p,r)}},L=o=>{var v;(v=o.urls)!=null&&v.length&&(o.urls[0],s.playStream(o),d.edit(o))},b=o=>{var v;(v=o.urls)!=null&&v.length&&(o.urls[0],s.playStream(o))};return J(()=>{h()}),(o,v)=>{const r=T("el-table-column"),p=T("el-input"),g=T("el-button"),x=T("el-table"),$=me("loading");return ee((D(),A(x,{data:P.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:n(()=>[e(r,{fixed:"",label:"日期",prop:"date",sortable:"",width:"140"},{default:n(y=>[C("span",{class:"clickable-text",onClick:a=>M(y.row)},I(y.row.date),9,Pe)]),_:1}),e(r,{fixed:"",label:"标识",prop:"id",width:"180"},{default:n(y=>[C("span",{class:"clickable-text",onClick:a=>z(y.row)},I(y.row.id),9,ze)]),_:1}),e(r,{fixed:"right",align:"right",width:"115"},{header:n(()=>[e(p,{modelValue:i.value,"onUpdate:modelValue":v[0]||(v[0]=y=>i.value=y),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:n(y=>{var a,t;return[C("div",De,[e(g,{size:"small",onClick:S=>L(y.row),disabled:!((a=y.row.urls)!=null&&a.length)},{default:n(()=>v[1]||(v[1]=[j(" 编辑 ")])),_:2},1032,["onClick","disabled"]),e(g,{size:"small",onClick:S=>b(y.row),disabled:!((t=y.row.urls)!=null&&t.length)},{default:n(()=>v[2]||(v[2]=[j(" 播放 ")])),_:2},1032,["onClick","disabled"])])]}),_:1})]),_:1},8,["data"])),[[$,l.value]])}}}),ne=G("picker",()=>{const c=_(!1),s=_(!1),d=_("");return _(null),_(0),{open:s,title:d,loading:c}}),Ie={style:{display:"flex",gap:"0","justify-content":"center"}},Oe=Q({__name:"Picker",setup(c){const s=ne();return(d,i)=>{const l=T("el-button"),m=T("el-card");return ee((D(),A(m,{style:{"max-width":"480px"}},{footer:n(()=>[C("div",Ie,[e(l,{size:"small",onClick:i[0]||(i[0]=()=>{})},{default:n(()=>i[3]||(i[3]=[j(" 加行 ")])),_:1}),e(l,{size:"small",onClick:i[1]||(i[1]=()=>{})},{default:n(()=>i[4]||(i[4]=[j(" 下载 ")])),_:1}),e(l,{size:"small",onClick:i[2]||(i[2]=()=>{})},{default:n(()=>i[5]||(i[5]=[j(" 复制 ")])),_:1})])]),default:n(()=>[(D(),H(se,null,te(40,h=>C("p",{key:h,class:"text item"},I("List item "+h),1)),64))]),_:1},512)),[[ve,f(s).open]])}}}),je={style:{display:"flex",gap:"5px","justify-content":"flex-start"}},Ne={key:0,class:"loading-state"},Ve={class:"time-label"},He=["onClick"],Re={key:1,class:"empty-state"},Be={class:"footer-container"},Ae={class:"time-shift-controls"},Fe={class:"time-shift-controls"},R=50,B=5e3,Ke=Q({__name:"Editor",setup(c){const s=le(),d=F(),i=ne(),l=_(1e3),m=a=>{const t=l.value+a;l.value=Math.max(R,Math.min(B,t))},h=a=>{const t=s.timeToSeconds(a);if(d.player&&t>0)try{d.player.currentTime=t,d.player.play()}catch(S){O(S,"跳转播放失败，请检查播放器状态")}},P=_(["你好","晚上好","拜拜","再见"]),M=a=>P.value.some(t=>a.includes(t)),z=Z(()=>s.timelineData.map((a,t)=>({text:a.text,index:t})).filter(({text:a})=>M(a)).map(({index:a})=>a).sort((a,t)=>a-t)),E=()=>{const a=z.value;if(a.length===0){O("未找到包含关键字的字幕行");return}let t=0,S=a.length-1,u=-1;for(;t<=S;){const w=Math.floor((t+S)/2);a[w]<r.value?(u=a[w],t=w+1):S=w-1}u===-1&&(u=a[a.length-1]),g(u)},L=()=>{const a=z.value;if(a.length===0){O("未找到包含关键字的字幕行");return}let t=0,S=a.length-1,u=-1;for(;t<=S;){const w=Math.floor((t+S)/2);a[w]>r.value?(u=a[w],S=w-1):t=w+1}u===-1&&(u=a[0]),g(u)},b=_(),o=_([]),v=a=>{a instanceof HTMLElement&&o.value.push(a)},r=_(0),p=async()=>{if(!d.player)return;const a=d.player.currentTime,t=s.secondsToTime(a),S=s.timeToKey(t),u=s.timeMap.get(S);typeof u=="number"&&u!==r.value&&(r.value=u,await he(),setTimeout(()=>g(u),50))},g=a=>{const t=b.value,S=o.value[a];if(S instanceof HTMLElement&&t){const w=S.offsetTop-t.clientHeight/2;t.scrollTo({top:w,behavior:"smooth"})}},x=_(595),$=_();let y=null;return J(()=>{$.value=document.querySelector(".grid-section.bottom"),$.value&&(y=new ResizeObserver(a=>{for(const t of a){const{height:S}=t.contentRect;x.value=S}}),y.observe($.value)),d.player.on("timeupdate",p)}),_e(()=>{y&&$.value&&y.unobserve($.value),d.player.off("timeupdate",p),o.value=[]}),ye(()=>s.timelineData,()=>{o.value=[]}),(a,t)=>{const S=T("Expand"),u=T("el-icon"),w=T("el-button"),oe=T("Top"),ae=T("Bottom"),ie=T("Minus"),re=T("el-drawer");return D(),A(re,{modelValue:f(s).open,"onUpdate:modelValue":t[11]||(t[11]=k=>f(s).open=k),direction:"btt",modal:!1,size:x.value,onOpened:t[12]||(t[12]=k=>f(s).shiftSubtitles(0))},{header:n(()=>{var k;return[C("div",je,[e(w,{size:"small",type:f(i).open?"danger":"",circle:""},{default:n(()=>[e(u,{onClick:t[0]||(t[0]=U=>f(i).open=!f(i).open)},{default:n(()=>[e(S)]),_:1})]),_:1},8,["type"]),e(w,{size:"small",circle:""},{default:n(()=>[e(u,{onClick:E},{default:n(()=>[e(oe)]),_:1})]),_:1}),e(w,{size:"small",circle:""},{default:n(()=>[e(u,{onClick:L},{default:n(()=>[e(ae)]),_:1})]),_:1}),j(" "+I((k=f(s).data)==null?void 0:k.id),1)])]}),default:n(()=>[e(Oe),C("div",{class:"timeline-container",ref_key:"containerRef",ref:b},[f(s).loading?(D(),H("div",Ne,[e(u,{class:"is-loading",color:"#409EFF",size:20},{default:n(()=>[e(f(de))]),_:1}),t[13]||(t[13]=C("span",null,"正在加载字幕数据...",-1))])):W("",!0),(D(!0),H(se,null,te(f(s).timelineData,(k,U)=>(D(),H("div",{key:U,class:"timeline-item",ref_for:!0,ref:v},[C("span",Ve,[e(w,{class:"left"}),e(w,{class:"right"}),j(" "+I(k.time),1)]),C("span",{class:ge(["content-text",{highlight:U==r.value,keyword:M(k.text)}]),onClick:Je=>h(k.time)},I(k.text),11,He)]))),128)),!f(s).loading&&f(s).timelineData.length===0?(D(),H("div",Re,[e(u,null,{default:n(()=>[e(f(fe))]),_:1}),t[14]||(t[14]=C("span",null,"暂无字幕数据",-1))])):W("",!0)],512)]),footer:n(()=>[C("div",Be,[C("div",Ae,[e(w,{onClick:t[1]||(t[1]=k=>m(-1e3)),disabled:l.value<=R,size:"small"},{default:n(()=>[e(u,null,{default:n(()=>[e(f(N))]),_:1}),e(u,null,{default:n(()=>[e(f(N))]),_:1}),e(u,null,{default:n(()=>[e(f(N))]),_:1})]),_:1},8,["disabled"]),e(w,{onClick:t[2]||(t[2]=k=>m(-500)),disabled:l.value<=R,size:"small"},{default:n(()=>[e(u,null,{default:n(()=>[e(f(N))]),_:1}),e(u,null,{default:n(()=>[e(f(N))]),_:1})]),_:1},8,["disabled"]),e(w,{onClick:t[3]||(t[3]=k=>m(-50)),disabled:l.value<=R,size:"small"},{default:n(()=>[e(u,null,{default:n(()=>[e(f(N))]),_:1})]),_:1},8,["disabled"]),C("span",{class:"count",onClick:t[4]||(t[4]=k=>l.value=50)},I(l.value),1),e(w,{onClick:t[5]||(t[5]=k=>m(50)),disabled:l.value>=B,size:"small"},{default:n(()=>[e(u,null,{default:n(()=>[e(f(V))]),_:1})]),_:1},8,["disabled"]),e(w,{onClick:t[6]||(t[6]=k=>m(500)),disabled:l.value>=B,size:"small"},{default:n(()=>[e(u,null,{default:n(()=>[e(f(V))]),_:1}),e(u,null,{default:n(()=>[e(f(V))]),_:1})]),_:1},8,["disabled"]),e(w,{onClick:t[7]||(t[7]=k=>m(1e3)),disabled:l.value>=B,size:"small"},{default:n(()=>[e(u,null,{default:n(()=>[e(f(V))]),_:1}),e(u,null,{default:n(()=>[e(f(V))]),_:1}),e(u,null,{default:n(()=>[e(f(V))]),_:1})]),_:1},8,["disabled"])]),C("div",Fe,[e(w,{onClick:t[8]||(t[8]=k=>f(s).shiftSubtitles(-l.value)),disabled:f(s).shiftCount===0},{default:n(()=>[e(u,null,{default:n(()=>[e(ie)]),_:1})]),_:1},8,["disabled"]),C("span",{class:"count",onClick:t[9]||(t[9]=(...k)=>f(s).resetSubtitles&&f(s).resetSubtitles(...k))},I(f(s).shiftCount),1),e(w,{onClick:t[10]||(t[10]=k=>f(s).shiftSubtitles(l.value))},{default:n(()=>[e(u,null,{default:n(()=>[e(f(ce))]),_:1})]),_:1})])])]),_:1},8,["modelValue","size"])}}}),Ue={__name:"App",setup(c){return F(),(s,d)=>{const i=T("el-col"),l=T("el-row"),m=T("el-container");return D(),A(m,{style:{height:"100vh"}},{default:n(()=>[e(l,{class:"grid-container"},{default:n(()=>[e(i,{class:"grid-section top"},{default:n(()=>[e(Te)]),_:1}),e(i,{class:"grid-section bottom"},{default:n(()=>[e(Le),e(Ke)]),_:1})]),_:1})]),_:1})}}},qe=Ee(Ue,[["__scopeId","data-v-e65bf119"]]),K=be(qe);K.use(we());K.use(ue);for(const[c,s]of Object.entries(pe))K.component(c,s);K.mount("#app");
