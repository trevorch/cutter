import{E as J,i as de}from"./element-plus-CRGBzuq5.js";import{f as I,g as O,B as fe,l as pe,w as me,Q as ve}from"./@element-plus-By79ymwD.js";import{r as v,j as G,c as j,o as D,a as k,M as L,u as f,d as te,k as se,ag as $,aq as _e,I as ye,G as le,H as a,P as e,L as A,S as he,w as ge,J as Z,O as ne,a6 as we,D as be,n as ke,at as Se}from"./@vue-C01xNfPK.js";import{d as Q,c as $e}from"./pinia-CKuVeK4o.js";import{P as Te}from"./plyr-CZIZ1zVJ.js";import{H as q}from"./hls.js-DWnTp5j0.js";import{f as ee}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))p(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const T of c.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&p(T)}).observe(document,{childList:!0,subtree:!0});function i(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function p(o){if(o.ep)return;o.ep=!0;const c=i(o);fetch(o.href,c)}})();function Ce(r,l="未知错误"){if(r instanceof Error)return r.message;if(typeof r=="string")return r;if(typeof r=="object"&&r!==null&&"message"in r&&typeof r.message=="string")return r.message;try{return JSON.stringify(r)}catch{return l}}const W={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},X=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function B(r,l){const i=Ce(r),p=l?`${l}: ${i}`:i;J.error({...W,message:`
    <div ${X}>
      ${p}
    </div>
    `})}function F(r){J.error({...W,message:`
    <div ${X}>
      ${r}
    </div>
    `})}function xe(r){J.success({...W,message:`
    <div ${X}>
      ${r}
    </div>
    `})}const N=r=>{try{const[l,i]=r.split("."),[p,o,c]=l.split(":").map(Number),T=i?parseInt(i.padEnd(3,"0")):0;return p*3600+o*60+c+T/1e3}catch{return 0}},H=r=>{const l=Math.round(r%1*1e3),i=Math.floor(r),p=Math.floor(i/3600),o=Math.floor(i%3600/60),c=i%60;return`${String(p).padStart(2,"0")}:${String(o).padStart(2,"0")}:${String(c).padStart(2,"0")}.${String(l).padStart(3,"0")}`},U=Q("player",()=>{const r=v(""),l=v(null),i=v(null),p=v(null),o=v(null),c=v(null),T=s=>{l.value=new Te(s,{hideControls:!1,controls:["play-large","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},w=s=>{o.value=s,r.value=s.date;const u=s.urls[0],_={type:"video",sources:[{src:u,type:E(u)}]};x(_).then(()=>{var g;return(g=l.value)==null?void 0:g.play()})},E=s=>s.includes(".m3u8")?"application/x-mpegURL":s.includes(".flv")?"video/x-flv":"video/mp4",x=async s=>{var _,g,S;(_=i.value)==null||_.destroy(),i.value=null,(g=p.value)==null||g.destroy(),p.value=null;const u=s.sources[0].src.includes(".m3u8")?"hls":s.sources[0].src.includes(".flv")?"flv":"html5";try{u!==c.value&&await((S=l.value)==null?void 0:S.stop()),l.value.source=s,u==="hls"&&q.isSupported()?await M(s.sources[0].src):u==="flv"&&ee.isSupported()&&await z(s.sources[0].src),c.value=u}catch(C){console.error("源切换失败:",C)}},M=async s=>new Promise(u=>{i.value=new q,i.value.loadSource(s),i.value.attachMedia(l.value.media),i.value.on(q.Events.MANIFEST_PARSED,u)}),z=async s=>{p.value=ee.createPlayer({type:"flv",url:s}),p.value.attachMediaElement(l.value.media),p.value.load(),await p.value.play()},P=v(!1);return{player:l,initPlayer:T,switchSource:x,playStream:w,title:r,data:o,autoPlay:P,jumpTo:s=>{const u=N(s);if(l.value&&u>0)try{l.value.currentTime=u,P.value?l.value.play():l.value.pause()}catch(_){B(_,"跳转播放失败，请检查播放器状态")}}}}),Pe={class:"video-wrapper"},Me={class:"title"},Ee={class:"plyr-container"},ze={__name:"Player",setup(r){const l=U(),i=v(null);return G(()=>{l.initPlayer(i.value)}),(p,o)=>(D(),j("div",Pe,[k("h3",Me,L(f(l).title),1),k("div",Ee,[k("video",{class:"player",ref_key:"videoRef",ref:i,playsinline:""},null,512)])]))}},oe=Q("editor",()=>{const r=v(!1),l=v(!1),i=v(""),p=v(null),o=5e3,c=v(o),T=s=>{l.value=!0,p.value=s,i.value=s.date,m()},w=v([]),E=s=>{try{const[u,_]=s.split("."),[g,S,C]=u.split(":").map(Number);return g*3600+S*60+C}catch(u){console.error(u)}},x=v(new Map),M=()=>{x.value.clear(),w.value.forEach((s,u)=>{try{const _=E(s.time);x.value.has(_)||x.value.set(_,u)}catch(_){console.error(`错误处理时间戳 ${s.time}（索引 ${u}）: ${_}`)}})},z=s=>{if(!w.value)return;const u=c.value+s;c.value=Math.max(u,0);const _=s/1e3;w.value=w.value.map(g=>{const C=N(g.time)+_;return{...g,time:H(Math.max(C,0))}}),M()},P=()=>{if(!w.value)return;const u=(c.value-o)/1e3;w.value=w.value.map(_=>{const S=N(_.time)-u;return{..._,time:H(Math.max(S,0))}}),c.value=o,M()},m=async()=>{var s;r.value=!0;try{const u=await fetch(`srts/${(s=p.value)==null?void 0:s.id}`);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);w.value=await u.json();const _=c.value/1e3;w.value=w.value.map(g=>{const C=N(g.time)+_;return{...g,time:H(Math.max(C,0))}}),M()}catch(u){console.error("数据获取失败:",u),B(u,"字幕数据加载失败，请稍后重试"),w.value=[]}finally{r.value=!1}};return{open:l,title:i,edit:T,data:p,timelineData:w,loading:r,shiftCount:c,shiftSubtitles:z,timeToSeconds:N,secondsToTime:H,resetSubtitles:P,timeMap:x,timeToKey:E}}),De=["onClick"],Le=["onClick"],Ie={style:{display:"flex",gap:"0","justify-content":"flex-end"}},Oe=te({__name:"Playlist",setup(r){const l=U(),i=oe(),p=v(""),o=v(!0),c=v([]),T=async()=>{try{const m=await fetch("video.json");if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);c.value=await m.json()}catch(m){B(m,"数据加载失败")}finally{o.value=!1}},w=se(()=>{const m=p.value.toLowerCase();return c.value.filter(s=>s.id.toLowerCase().includes(m)||s.date.toLowerCase().includes(m))}),E=async m=>{var s;((s=m.urls)==null?void 0:s.length)>0?await M(m.urls[0],"链接已复制到剪贴板","链接复制失败"):F("该记录没有可用的链接")},x=async m=>{m.id?await M(m.id,"ID已复制到剪贴板","ID复制失败"):F("该记录没有可用的ID")},M=async(m,s,u)=>{try{await navigator.clipboard.writeText(m),xe(s)}catch(_){B(_,u)}},z=m=>{var s;(s=m.urls)!=null&&s.length&&(m.urls[0],l.playStream(m),i.edit(m))},P=m=>{var s;(s=m.urls)!=null&&s.length&&(m.urls[0],l.playStream(m))};return G(()=>{T()}),(m,s)=>{const u=$("el-table-column"),_=$("el-input"),g=$("el-button"),S=$("el-table"),C=_e("loading");return ye((D(),le(S,{data:w.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:a(()=>[e(u,{fixed:"",label:"日期",prop:"date",sortable:"",width:"140"},{default:a(n=>[k("span",{class:"clickable-text",onClick:t=>E(n.row)},L(n.row.date),9,De)]),_:1}),e(u,{fixed:"",label:"标识",prop:"id",width:"180"},{default:a(n=>[k("span",{class:"clickable-text",onClick:t=>x(n.row)},L(n.row.id),9,Le)]),_:1}),e(u,{fixed:"right",align:"right",width:"115"},{header:a(()=>[e(_,{modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=n=>p.value=n),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:a(n=>{var t,b;return[k("div",Ie,[e(g,{plain:"",size:"small",onClick:d=>z(n.row),type:n.row.hasSrt?"success":"warning",disabled:!n.row.hasSrt},{default:a(()=>s[1]||(s[1]=[A(" 编辑 ")])),_:2},1032,["onClick","type","disabled"]),e(g,{plain:"",size:"small",onClick:d=>P(n.row),type:(t=n.row.urls)!=null&&t.length?"success":"warning",disabled:!((b=n.row.urls)!=null&&b.length)},{default:a(()=>s[2]||(s[2]=[A(" 播放 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[C,o.value]])}}}),je=Q("picker",()=>{const r=v(!1),l=v(!1),i=v("");return v(null),v(0),{open:l,title:i,loading:r}}),Ne={style:{display:"flex",gap:"0","justify-content":"flex-start"}},He={key:0,class:"loading-state"},Ve={class:"time-label"},Re=["onClick"],Ae={key:1,class:"empty-state"},Be={class:"footer-container"},Fe={class:"time-shift-controls"},Ue={class:"time-shift-controls"},V=50,R=5e3,Ke=te({__name:"Editor",setup(r){const l=oe(),i=U(),p=je(),o=v(1e3),c=n=>{const t=o.value+n;o.value=Math.max(V,Math.min(R,t))},T=v(["你好","晚上好","拜拜","再见"]),w=n=>T.value.some(t=>n.includes(t)),E=se(()=>l.timelineData.map((n,t)=>({text:n.text,index:t})).filter(({text:n})=>w(n)).map(({index:n})=>n).sort((n,t)=>n-t)),x=()=>{const n=E.value;if(n.length===0){F("未找到包含关键字的字幕行");return}let t=0,b=n.length-1,d=-1;for(;t<=b;){const y=Math.floor((t+b)/2);n[y]<s.value?(d=n[y],t=y+1):b=y-1}d===-1&&(d=n[n.length-1]),_(d)},M=()=>{const n=E.value;if(n.length===0){F("未找到包含关键字的字幕行");return}let t=0,b=n.length-1,d=-1;for(;t<=b;){const y=Math.floor((t+b)/2);n[y]>s.value?(d=n[y],b=y-1):t=y+1}d===-1&&(d=n[0]),_(d)},z=v(),P=v([]),m=n=>{n instanceof HTMLElement&&P.value.push(n)},s=v(0),u=async()=>{if(!i.player)return;const n=i.player.currentTime,t=H(n),b=l.timeToKey(t),d=l.timeMap.get(b);typeof d=="number"&&d!==s.value&&(s.value=d,await ke(),setTimeout(()=>_(d),50))},_=n=>{const t=z.value,b=P.value[n];if(b instanceof HTMLElement&&t){const y=b.offsetTop-t.clientHeight/2;t.scrollTo({top:y,behavior:"smooth"})}},g=v(595),S=v();let C=null;return G(()=>{S.value=document.querySelector(".grid-section.bottom"),S.value&&(C=new ResizeObserver(n=>{for(const t of n){const{height:b}=t.contentRect;g.value=b}}),C.observe(S.value)),i.player.on("timeupdate",u)}),he(()=>{C&&S.value&&C.unobserve(S.value),i.player.off("timeupdate",u),P.value=[]}),ge(()=>l.timelineData,()=>{P.value=[]}),(n,t)=>{const b=$("Expand"),d=$("el-icon"),y=$("el-button"),ae=$("Top"),ie=$("Bottom"),re=$("el-text"),ue=$("Minus"),ce=$("el-drawer");return D(),le(ce,{modelValue:f(l).open,"onUpdate:modelValue":t[12]||(t[12]=h=>f(l).open=h),direction:"btt",modal:!1,size:g.value,onOpened:t[13]||(t[13]=h=>f(l).shiftSubtitles(0))},{header:a(()=>[k("div",Ne,[e(y,{size:"small",type:f(p).open?"success":"",circle:""},{default:a(()=>[e(d,{onClick:t[0]||(t[0]=h=>f(p).open=!f(p).open)},{default:a(()=>[e(b)]),_:1})]),_:1},8,["type"]),e(y,{onClick:t[1]||(t[1]=h=>f(i).autoPlay=!f(i).autoPlay),type:f(i).autoPlay?"success":"",size:"small",circle:""},{default:a(()=>t[14]||(t[14]=[A("A")])),_:1},8,["type"]),e(y,{size:"small",circle:""},{default:a(()=>[e(d,{onClick:x},{default:a(()=>[e(ae)]),_:1})]),_:1}),e(y,{size:"small",circle:""},{default:a(()=>[e(d,{onClick:M},{default:a(()=>[e(ie)]),_:1})]),_:1}),e(re,{class:"mx-1",type:"warning"},{default:a(()=>{var h;return[A(L((h=f(l).data)==null?void 0:h.id),1)]}),_:1})])]),default:a(()=>[k("div",{class:"timeline-container",ref_key:"containerRef",ref:z},[f(l).loading?(D(),j("div",He,[e(d,{class:"is-loading",color:"#409EFF",size:20},{default:a(()=>[e(f(pe))]),_:1}),t[15]||(t[15]=k("span",null,"正在加载字幕数据...",-1))])):Z("",!0),(D(!0),j(ne,null,we(f(l).timelineData,(h,Y)=>(D(),j("div",{key:Y,class:"timeline-item",ref_for:!0,ref:m},[k("span",Ve,L(h.time),1),k("span",{class:be(["content-text",{highlight:Y==s.value,keyword:w(h.text)}]),onClick:Qe=>f(i).jumpTo(h.time)},L(h.text),11,Re)]))),128)),!f(l).loading&&f(l).timelineData.length===0?(D(),j("div",Ae,[e(d,null,{default:a(()=>[e(f(me))]),_:1}),t[16]||(t[16]=k("span",null,"暂无字幕数据",-1))])):Z("",!0)],512)]),footer:a(()=>[k("div",Be,[k("div",Fe,[e(y,{onClick:t[2]||(t[2]=h=>c(-1e3)),disabled:o.value<=V,size:"small"},{default:a(()=>[e(d,null,{default:a(()=>[e(f(I))]),_:1}),e(d,null,{default:a(()=>[e(f(I))]),_:1}),e(d,null,{default:a(()=>[e(f(I))]),_:1})]),_:1},8,["disabled"]),e(y,{onClick:t[3]||(t[3]=h=>c(-500)),disabled:o.value<=V,size:"small"},{default:a(()=>[e(d,null,{default:a(()=>[e(f(I))]),_:1}),e(d,null,{default:a(()=>[e(f(I))]),_:1})]),_:1},8,["disabled"]),e(y,{onClick:t[4]||(t[4]=h=>c(-50)),disabled:o.value<=V,size:"small"},{default:a(()=>[e(d,null,{default:a(()=>[e(f(I))]),_:1})]),_:1},8,["disabled"]),k("span",{class:"count",onClick:t[5]||(t[5]=h=>o.value=50)},L(o.value),1),e(y,{onClick:t[6]||(t[6]=h=>c(50)),disabled:o.value>=R,size:"small"},{default:a(()=>[e(d,null,{default:a(()=>[e(f(O))]),_:1})]),_:1},8,["disabled"]),e(y,{onClick:t[7]||(t[7]=h=>c(500)),disabled:o.value>=R,size:"small"},{default:a(()=>[e(d,null,{default:a(()=>[e(f(O))]),_:1}),e(d,null,{default:a(()=>[e(f(O))]),_:1})]),_:1},8,["disabled"]),e(y,{onClick:t[8]||(t[8]=h=>c(1e3)),disabled:o.value>=R,size:"small"},{default:a(()=>[e(d,null,{default:a(()=>[e(f(O))]),_:1}),e(d,null,{default:a(()=>[e(f(O))]),_:1}),e(d,null,{default:a(()=>[e(f(O))]),_:1})]),_:1},8,["disabled"])]),k("div",Ue,[e(y,{onClick:t[9]||(t[9]=h=>f(l).shiftSubtitles(-o.value)),disabled:f(l).shiftCount===0},{default:a(()=>[e(d,null,{default:a(()=>[e(ue)]),_:1})]),_:1},8,["disabled"]),k("span",{class:"count",onClick:t[10]||(t[10]=(...h)=>f(l).resetSubtitles&&f(l).resetSubtitles(...h))},L(f(l).shiftCount),1),e(y,{onClick:t[11]||(t[11]=h=>f(l).shiftSubtitles(o.value))},{default:a(()=>[e(d,null,{default:a(()=>[e(f(fe))]),_:1})]),_:1})])])]),_:1},8,["modelValue","size"])}}}),qe=(r,l)=>{const i=r.__vccOpts||r;for(const[p,o]of l)i[p]=o;return i},Je={__name:"App",setup(r){return U(),(l,i)=>{const p=$("Picker"),o=$("el-col"),c=$("el-row"),T=$("el-container");return D(),j(ne,null,[e(p),e(T,{style:{height:"100vh"}},{default:a(()=>[e(c,{class:"grid-container"},{default:a(()=>[e(o,{class:"grid-section top"},{default:a(()=>[e(ze)]),_:1}),e(o,{class:"grid-section bottom"},{default:a(()=>[e(Oe),e(Ke)]),_:1})]),_:1})]),_:1})],64)}}},Ge=qe(Je,[["__scopeId","data-v-ff8b06c5"]]),K=Se(Ge);K.use($e());K.use(de);for(const[r,l]of Object.entries(ve))K.component(r,l);K.mount("#app");
