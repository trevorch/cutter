import{E as de,i as xe}from"./element-plus-DRLPWQh5.js";import{B as ze,l as Ee,w as Me,Q as Pe,R as De,S as Ie}from"./@element-plus-Dp6MuveI.js";import{r as y,j as pe,c as Z,o as G,a as D,M as Q,u as g,d as me,k as we,ag as z,aq as je,I as ue,G as be,H as l,P as t,L as P,S as Le,w as Ve,J as _e,O as le,a6 as Ce,D as Oe,n as Ue,X as He,Q as $e,at as Ke}from"./@vue-C01xNfPK.js";import{d as fe,c as Re}from"./pinia-CKuVeK4o.js";import{P as Ne}from"./plyr-CZIZ1zVJ.js";import{H as re}from"./hls.js-DWnTp5j0.js";import{f as he}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))_(a);new MutationObserver(a=>{for(const $ of a)if($.type==="childList")for(const I of $.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&_(I)}).observe(document,{childList:!0,subtree:!0});function r(a){const $={};return a.integrity&&($.integrity=a.integrity),a.referrerPolicy&&($.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?$.credentials="include":a.crossOrigin==="anonymous"?$.credentials="omit":$.credentials="same-origin",$}function _(a){if(a.ep)return;a.ep=!0;const $=r(a);fetch(a.href,$)}})();function Ae(m,n="未知错误"){if(m instanceof Error)return m.message;if(typeof m=="string")return m;if(typeof m=="object"&&m!==null&&"message"in m&&typeof m.message=="string")return m.message;try{return JSON.stringify(m)}catch{return n}}const ve={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},ye=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function te(m,n){const r=Ae(m),_=n?`${n}: ${r}`:r;de.error({...ve,message:`
    <div ${ye}>
      ${_}
    </div>
    `})}function H(m){de.error({...ve,message:`
    <div ${ye}>
      ${m}
    </div>
    `})}function ee(m){de.success({...ve,message:`
    <div ${ye}>
      ${m}
    </div>
    `})}const ne=m=>{try{const[n,r]=m.split("."),[_,a,$]=n.split(":").map(Number),I=r?parseInt(r.padEnd(3,"0")):0;return _*3600+a*60+$+I/1e3}catch{return 0}},K=m=>{const n=Math.round(m%1*1e3),r=Math.floor(m),_=Math.floor(r/3600),a=Math.floor(r%3600/60),$=r%60;return`${String(_).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String($).padStart(2,"0")}.${String(n).padStart(3,"0")}`},se=fe("player",()=>{const m=y(""),n=y(null),r=y(null),_=y(null),a=y(null),$=y(null),I=i=>{n.value=new Ne(i,{hideControls:!1,controls:["play-large","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},E=i=>{a.value=i,m.value=i.date;const v=i.urls[0],f={type:"video",sources:[{src:v,type:B(v)}]};R(f).then(()=>{var k;return(k=n.value)==null?void 0:k.play()})},B=i=>i.includes(".m3u8")?"application/x-mpegURL":i.includes(".flv")?"video/x-flv":"video/mp4",R=async i=>{var f,k,V;(f=r.value)==null||f.destroy(),r.value=null,(k=_.value)==null||k.destroy(),_.value=null;const v=i.sources[0].src.includes(".m3u8")?"hls":i.sources[0].src.includes(".flv")?"flv":"html5";try{v!==$.value&&await((V=n.value)==null?void 0:V.stop()),n.value.source=i,v==="hls"&&re.isSupported()?await A(i.sources[0].src):v==="flv"&&he.isSupported()&&await W(i.sources[0].src),$.value=v}catch(N){console.error("源切换失败:",N)}},A=async i=>new Promise(v=>{r.value=new re,r.value.loadSource(i),r.value.attachMedia(n.value.media),r.value.on(re.Events.MANIFEST_PARSED,v)}),W=async i=>{_.value=he.createPlayer({type:"flv",url:i}),_.value.attachMediaElement(n.value.media),_.value.load(),await _.value.play()},q=y(!1);return{player:n,initPlayer:I,switchSource:R,playStream:E,title:m,data:a,autoPlay:q,jumpTo:i=>{const v=ne(i);if(n.value&&v>0)try{n.value.currentTime=v,q.value?n.value.play():n.value.pause()}catch(f){te(f,"跳转播放失败，请检查播放器状态")}}}}),Fe={class:"video-wrapper"},Be={class:"title"},qe={class:"plyr-container"},Je={__name:"Player",setup(m){const n=se(),r=y(null);return pe(()=>{n.initPlayer(r.value)}),(_,a)=>(G(),Z("div",Fe,[D("h3",Be,Q(g(n).title),1),D("div",qe,[D("video",{class:"player",ref_key:"videoRef",ref:r,playsinline:""},null,512)])]))}},ge=fe("editor",()=>{const m=y(!1),n=y(!1),r=y(""),_=y(null),a=5e3,$=y(a),I=v=>{n.value=!0,_.value=v,r.value=v.date,h()},E=y([]),B=v=>{try{const[f,k]=v.split("."),[V,N,w]=f.split(":").map(Number);return V*3600+N*60+w}catch(f){console.error(f)}},R=y(new Map),A=()=>{R.value.clear(),E.value.forEach((v,f)=>{try{const k=B(v.time);R.value.has(k)||R.value.set(k,f)}catch(k){console.error(`错误处理时间戳 ${v.time}（索引 ${f}）: ${k}`)}})},W=v=>{if(!E.value)return;const f=$.value+v;$.value=Math.max(f,0);const k=v/1e3;E.value=E.value.map(V=>{const w=ne(V.time)+k;return{...V,time:K(Math.max(w,0))}}),A()},q=()=>{if(!E.value)return;const f=($.value-a)/1e3;E.value=E.value.map(k=>{const N=ne(k.time)-f;return{...k,time:K(Math.max(N,0))}}),$.value=a,A()},h=async()=>{var v;m.value=!0;try{const f=await fetch(`srts/${(v=_.value)==null?void 0:v.id}`);if(!f.ok)throw new Error(`HTTP error! status: ${f.status}`);E.value=await f.json();const k=$.value/1e3;E.value=E.value.map(V=>{const w=ne(V.time)+k;return{...V,time:K(Math.max(w,0))}}),A()}catch(f){console.error("数据获取失败:",f),te(f,"字幕数据加载失败，请稍后重试"),E.value=[]}finally{m.value=!1}};return{open:n,title:r,edit:I,data:_,timelineData:E,loading:m,shiftCount:$,shiftSubtitles:W,timeToSeconds:ne,secondsToTime:K,resetSubtitles:q,timeMap:R,timeToKey:B,getSubtitles:(v,f)=>{var p;const k=y([]);if(!((p=E.value)!=null&&p.length))return console.error("时间轴数据未加载"),k;const V=B(K(v)),N=B(K(f)),w=R.value.get(V),O=R.value.get(N);if(typeof w!="number"||typeof O!="number")return console.error("无法匹配有效的时间段"),k;const J=Math.max(0,w),u=Math.min(E.value.length-1,O),[s,b]=J<=u?[J,u]:[u,J];return k.value=E.value.slice(s,b+1),k}}}),Ye=["onClick"],Qe=["onClick"],Ge={style:{display:"flex",gap:"0","justify-content":"flex-end"}},We=me({__name:"Playlist",setup(m){const n=se(),r=ge(),_=y(""),a=y(!0),$=y([]),I=async()=>{try{const h=await fetch("video.json");if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);$.value=await h.json()}catch(h){te(h,"数据加载失败")}finally{a.value=!1}},E=we(()=>{const h=_.value.toLowerCase();return $.value.filter(i=>i.id.toLowerCase().includes(h)||i.date.toLowerCase().includes(h))}),B=async h=>{var i;((i=h.urls)==null?void 0:i.length)>0?await A(h.urls[0],"链接已复制到剪贴板","链接复制失败"):H("该记录没有可用的链接")},R=async h=>{h.id?await A(h.id,"ID已复制到剪贴板","ID复制失败"):H("该记录没有可用的ID")},A=async(h,i,v)=>{try{await navigator.clipboard.writeText(h),ee(i)}catch(f){te(f,v)}},W=h=>{var i;(i=h.urls)!=null&&i.length&&(h.urls[0],n.playStream(h),r.edit(h))},q=h=>{var i;(i=h.urls)!=null&&i.length&&(h.urls[0],n.playStream(h))};return pe(()=>{I()}),(h,i)=>{const v=z("el-table-column"),f=z("el-input"),k=z("el-button"),V=z("el-table"),N=je("loading");return ue((G(),be(V,{data:E.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:l(()=>[t(v,{fixed:"",label:"日期",prop:"date",sortable:"",width:"140"},{default:l(w=>[D("span",{class:"clickable-text",onClick:O=>B(w.row)},Q(w.row.date),9,Ye)]),_:1}),t(v,{fixed:"",label:"标识",prop:"id",width:"180"},{default:l(w=>[D("span",{class:"clickable-text",onClick:O=>R(w.row)},Q(w.row.id),9,Qe)]),_:1}),t(v,{fixed:"right",align:"right",width:"115"},{header:l(()=>[t(f,{modelValue:_.value,"onUpdate:modelValue":i[0]||(i[0]=w=>_.value=w),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:l(w=>{var O,J;return[D("div",Ge,[t(k,{plain:"",size:"small",onClick:u=>W(w.row),type:w.row.hasSrt?"success":"warning",disabled:!w.row.hasSrt},{default:l(()=>i[1]||(i[1]=[P(" 切片 ")])),_:2},1032,["onClick","type","disabled"]),t(k,{plain:"",size:"small",onClick:u=>q(w.row),type:(O=w.row.urls)!=null&&O.length?"success":"warning",disabled:!((J=w.row.urls)!=null&&J.length)},{default:l(()=>i[2]||(i[2]=[P(" 播放 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[N,a.value]])}}}),Te=fe("picker",()=>{const m=y(!1),n=y(!1),r=y("");return y(null),y(0),{open:n,title:r,loading:m}}),Xe={style:{display:"flex",gap:"0","justify-content":"flex-start"}},Ze={key:0,class:"loading-state"},et={class:"srt-time"},tt=["onClick"],nt={key:1,class:"empty-state"},st={class:"footer-container"},lt={class:"time-shift-controls"},ot={class:"time-shift-controls"},at={class:"time-shift-controls"},ie=100,ce=5e3,rt=me({__name:"Editor",setup(m){const n=ge(),r=se(),_=Te(),a=y(!1),$=()=>{r.player&&(r.player.playing?r.player.pause():r.player.play())},I=y(1e3),E=u=>{const s=I.value+u;I.value=Math.max(ie,Math.min(ce,s))},B=y(["你好","晚上好","拜拜","再见"]),R=u=>B.value.some(s=>u.includes(s)),A=we(()=>n.timelineData.map((u,s)=>({text:u.text,index:s})).filter(({text:u})=>R(u)).map(({index:u})=>u).sort((u,s)=>u-s)),W=()=>{const u=A.value;if(u.length===0){H("未找到包含关键字的字幕行");return}let s=0,b=u.length-1,p=-1;for(;s<=b;){const S=Math.floor((s+b)/2);u[S]<f.value?(p=u[S],s=S+1):b=S-1}p===-1&&(p=u[u.length-1]),V(p)},q=()=>{const u=A.value;if(u.length===0){H("未找到包含关键字的字幕行");return}let s=0,b=u.length-1,p=-1;for(;s<=b;){const S=Math.floor((s+b)/2);u[S]>f.value?(p=u[S],b=S-1):s=S+1}p===-1&&(p=u[0]),V(p)},h=y(),i=y([]),v=u=>{u instanceof HTMLElement&&i.value.push(u)},f=y(0),k=async u=>{const s=K(u),b=n.timeToKey(s),p=n.timeMap.get(b);typeof p=="number"&&p!==f.value&&(f.value=p,await Ue(),setTimeout(()=>V(p),50))},V=u=>{const s=h.value,b=i.value[u];if(b instanceof HTMLElement&&s){const S=b.offsetTop-s.clientHeight/2;s.scrollTo({top:S,behavior:"smooth"})}},N=y(595),w=y();let O=null;pe(()=>{w.value=document.querySelector(".grid-section.bottom"),w.value&&(O=new ResizeObserver(u=>{for(const s of u){const{height:b}=s.contentRect;N.value=b}}),O.observe(w.value)),r.player.on("timeupdate",()=>{k(r.player.currentTime)}),r.player.on("play",()=>{a.value=!0}),r.player.on("pause",()=>{a.value=!1})}),Le(()=>{O&&w.value&&O.unobserve(w.value),r.player.off("timeupdate",k),i.value=[]}),Ve(()=>n.timelineData,()=>{i.value=[]});const J=async()=>{var u,s;try{const b=(u=r.player)==null?void 0:u.media;if(!(b instanceof HTMLVideoElement)){H("无法获取视频元素");return}const p=document.createElement("canvas");p.width=b.videoWidth,p.height=b.videoHeight;const S=p.getContext("2d");if(!S){te("无法创建画布上下文");return}S.drawImage(b,0,0,p.width,p.height);const c=p.toDataURL("image/jpeg",.9),e=document.createElement("a"),o=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);e.download=`capture_${(s=n.data)==null?void 0:s.id}_${o}.jpg`,e.href=c,document.body.appendChild(e),e.click(),document.body.removeChild(e),ee("截图已保存")}catch(b){te(`截图失败: ${b instanceof Error?b.message:b}`)}};return(u,s)=>{const b=z("Camera"),p=z("el-icon"),S=z("el-button"),c=z("el-text"),e=z("Top"),o=z("Bottom"),C=z("el-space"),M=z("el-affix"),x=z("Expand"),L=z("Minus"),Y=z("el-drawer");return G(),be(Y,{modelValue:g(n).open,"onUpdate:modelValue":s[10]||(s[10]=T=>g(n).open=T),direction:"btt",modal:!1,size:N.value,onOpened:s[11]||(s[11]=T=>g(n).shiftSubtitles(0))},{header:l(()=>[D("div",Xe,[t(S,{onClick:J,size:"small",circle:""},{default:l(()=>[t(p,null,{default:l(()=>[t(b)]),_:1})]),_:1}),t(c,{class:"mx-1",type:"warning"},{default:l(()=>{var T,F;return[P(Q((T=g(n).data)==null?void 0:T.date)+" - "+Q((F=g(n).data)==null?void 0:F.id),1)]}),_:1})])]),default:l(()=>[D("div",{class:"timeline-container",ref_key:"containerRef",ref:h},[g(n).loading?(G(),Z("div",Ze,[t(p,{class:"is-loading",color:"#409EFF",size:20},{default:l(()=>[t(g(Ee))]),_:1}),s[12]||(s[12]=D("span",null,"正在加载字幕数据...",-1))])):_e("",!0),(G(!0),Z(le,null,Ce(g(n).timelineData,(T,F)=>(G(),Z("div",{key:F,class:"timeline-item",ref_for:!0,ref:v},[D("span",et,Q(T.time),1),D("span",{class:Oe(["srt-text",{highlight:F==f.value,keyword:R(T.text)}]),onClick:X=>{k(g(ne)(T.time)),g(r).jumpTo(T.time)}},Q(T.text),11,tt)]))),128)),!g(n).loading&&g(n).timelineData.length===0?(G(),Z("div",nt,[t(p,null,{default:l(()=>[t(g(Me))]),_:1}),s[13]||(s[13]=D("span",null,"暂无字幕数据",-1))])):_e("",!0)],512),t(M,{class:"floating-btn",position:"bottom",offset:250},{default:l(()=>[t(C,{direction:"vertical"},{default:l(()=>[t(S,{onClick:s[0]||(s[0]=T=>g(r).autoPlay=!g(r).autoPlay),type:g(r).autoPlay?"success":""},{default:l(()=>[t(p,null,{default:l(()=>s[14]||(s[14]=[P("A")])),_:1})]),_:1},8,["type"]),t(S,{onClick:W},{default:l(()=>[t(p,null,{default:l(()=>[t(e)]),_:1})]),_:1}),t(S,{onClick:q},{default:l(()=>[t(p,null,{default:l(()=>[t(o)]),_:1})]),_:1}),t(S,{onClick:$,icon:a.value?g(Pe):g(De)},null,8,["icon"])]),_:1})]),_:1})]),footer:l(()=>[D("div",st,[D("div",lt,[t(S,{size:"small",type:g(_).open?"success":""},{default:l(()=>[t(p,{onClick:s[1]||(s[1]=T=>g(_).open=!g(_).open)},{default:l(()=>[t(x)]),_:1})]),_:1},8,["type"])]),D("div",ot,[t(S,{type:"danger",onClick:s[2]||(s[2]=T=>E(-1e3)),disabled:I.value<=ie,size:"small"},{default:l(()=>s[15]||(s[15]=[P(" <<1000 ")])),_:1},8,["disabled"]),t(S,{type:"danger",onClick:s[3]||(s[3]=T=>E(-100)),disabled:I.value<=ie,size:"small"},{default:l(()=>s[16]||(s[16]=[P(" <100 ")])),_:1},8,["disabled"]),D("span",{class:"count",onClick:s[4]||(s[4]=T=>I.value=1e3)},Q(I.value),1),t(S,{type:"success",onClick:s[5]||(s[5]=T=>E(100)),disabled:I.value>=ce,size:"small"},{default:l(()=>s[17]||(s[17]=[P(" 100> ")])),_:1},8,["disabled"]),t(S,{type:"success",onClick:s[6]||(s[6]=T=>E(1e3)),disabled:I.value>=ce,size:"small"},{default:l(()=>s[18]||(s[18]=[P(" 1000>> ")])),_:1},8,["disabled"])]),D("div",at,[t(S,{onClick:s[7]||(s[7]=T=>g(n).shiftSubtitles(-I.value)),disabled:g(n).shiftCount===0,size:"small"},{default:l(()=>[t(p,null,{default:l(()=>[t(L)]),_:1})]),_:1},8,["disabled"]),D("span",{class:"count",onClick:s[8]||(s[8]=(...T)=>g(n).resetSubtitles&&g(n).resetSubtitles(...T))},Q(g(n).shiftCount),1),t(S,{onClick:s[9]||(s[9]=T=>g(n).shiftSubtitles(I.value)),size:"small"},{default:l(()=>[t(p,null,{default:l(()=>[t(g(ze))]),_:1})]),_:1})])])]),_:1},8,["modelValue","size"])}}}),it={class:"prompt-controls",style:{display:"flex",gap:"5px",margin:"5px","align-items":"center"}},ct={class:"segment-container"},ut={class:"time-controls"},dt={class:"time-controls"},pt={class:"time-controls"},mt={class:"card-footer"},ft=`
总结上面的对话内容，并参考下面的标题，为上面的对话内容起一个吸睛接地气的标题，同时给出建议标签，标签要每行一个，标题和标签要方便复制：
1、心智阳光健康，本科大二学生，聊天很是投缘，大冰不舍挂断
2、人为什么需要亲密关系？大冰深度分析，看完人都通透了
3、主动要礼物！聊天高端局，“泄露天机”太多，大冰“索要”礼物
4、如何把事情处理得圆润得体？大冰深度教学，家庭职场都受用
5、情侣裂痕是如何产生的？大冰深度分析，值得反复观看
6、光长年龄不长心智是一种什么体验？大冰对话32岁女画师，表现惊掉你下巴
7、颠覆你的认知：如何炼成顶级倾听力？大冰独家分享！带你突破沟通瓶颈！
8、如何把握相处的底层逻辑？大冰深度分析，职场婚姻都受用
9、精神未断奶是一种什么体验？大冰对话女硕士，思维表现大跌眼镜
10、如何克服自我否定的毛病？大冰深度教学，看完终身受益
`,vt=`
从上面的对话提取有关_P_方面的内容，并给出出现的开始时间
`,yt=me({__name:"Picker",setup(m){const n=se(),r=Te(),_=ge(),a=He([$()]);function $(){return{id:crypto.randomUUID(),startTime:0,endTime:0,duration:0,isK:!1}}const I=c=>{a.splice(c+1,0,$())},E=c=>{a.length>1&&a.splice(c,1)},B=c=>{if(c>0){const e=a.splice(c,1)[0];a.splice(c-1,0,e)}},R=c=>{if(c<a.length-1){const e=a.splice(c,1)[0];a.splice(c+1,0,e)}};function A(c){if(!n.player)return;const e=n.player.currentTime,o=a[c];o.startTime=e}function W(c){if(!n.player)return;const e=n.player.currentTime,o=a[c];o.endTime=e}function q(c,e){var j;const o=a[c],C=o.isK?"-k":"";let M=(j=n.data)==null?void 0:j.urls[0];if(!M)throw H("请先播放视频"),new Error("请先播放视频");const x=M.match(/\/([^\/]+)\.mp4$/),L=x?x[1]:(()=>{const ae=new Date;return`${ae.getFullYear()}${(ae.getMonth()+1).toString().padStart(2,"0")}${ae.getDate().toString().padStart(2,"0")}`})();if(!o.startTime||!o.endTime)throw H("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const Y=K(o.startTime),T=K(o.endTime),F=Y.replace(/:/g,"."),X=T.replace(/:/g,".");let d="yt-dlp --no-check-certificate";d=`${d} --concurrent-fragments 16 --throttled-rate 5M `,d=`${d} --download-sections "*${Y}-${T}"`;const U="~/storage/downloads/Reqable/";return e=="video"&&(d=`${d} --merge-output-format mp4 -o "${U}${L}_${F}-${X}.mp4"`),e=="audio"&&(d=`${d} ${C} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${U}${L}_${F}-${X}.mp3"`),d=`${d} '${M}' `,d}function h(c,e){var U;const o=a[c],C=o.isK?"-k":"";let M=(U=n.data)==null?void 0:U.urls[0];if(!M)throw H("请先播放视频"),new Error("请先播放视频");const x=M.match(/\/([^\/]+)\.mp4$/),L=x?x[1]:(()=>{const j=new Date;return`${j.getFullYear()}${(j.getMonth()+1).toString().padStart(2,"0")}${j.getDate().toString().padStart(2,"0")}`})();if(!o.startTime||!o.endTime)throw H("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const Y=K(o.startTime),T=K(o.endTime),F=Y.replace(/:/g,"."),X=T.replace(/:/g,".");let d=`--download-sections "*${Y}-${T}"`;return e=="video"&&(d=`${d} --merge-output-format mp4 -o "${L}_${F}-${X}.mp4"`),e=="audio"&&(d=`${d} ${C} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${L}_${F}-${X}.mp3"`),d}async function i(){var e;const c=(e=n.data)==null?void 0:e.urls[0];if(!c){H("请先播放视频");return}try{await navigator.clipboard.writeText(c),ee(`链接已复制：${c}`)}catch(o){console.error(o),H("复制失败，请手动复制")}}async function v(){var e;const c=(e=n.data)==null?void 0:e.id;if(!c){H("请先播放视频");return}try{await navigator.clipboard.writeText(c),ee(`ID已复制：${c}`)}catch(o){console.error(o),H("ID失败，请手动复制")}}async function f(c,e,o){let C="";switch(e){case"dlp":C=q(c,o);break;case"seal":C=h(c,o);break}try{await navigator.clipboard.writeText(C),ee(`命令已复制：${C}`)}catch(M){console.error(M),H("复制失败，请手动复制")}}const k=async c=>{const e=[];a.forEach((o,C)=>{console.log(`Index: ${C}`,o),e.push(q(C,c))});try{await navigator.clipboard.writeText(e.join(`
`)),ee(`命令已复制：${e.join("<br/>")}`)}catch(o){console.error(o),H("复制失败，请手动复制")}},V=y(!1);async function N(){var x;let c=(x=n.data)==null?void 0:x.urls[0];if(!c){H("请先播放视频");return}const e=c.match(/\/([^\/]+)\.mp4$/),o=e?e[1]:(()=>{const L=new Date;return`${L.getFullYear()}${(L.getMonth()+1).toString().padStart(2,"0")}${L.getDate().toString().padStart(2,"0")}`})(),C=a.filter(L=>L.startTime<L.endTime).map((L,Y)=>`${K(L.startTime)}-${K(L.endTime)}`);if(!C.length){H("请先至少设置一个开始和结束时间");return}const M=`dlp ${V.value?"keep":"delete"} '${c}' ${o} ${C.join(" ")}`;try{w(M),await navigator.clipboard.writeText(M),ee(`命令已复制：${M}`)}catch(L){console.error(L),te(L,"复制失败，请手动复制")}}async function w(c){try{const e=await fetch("http://localhost:8080/run",{method:"POST",headers:{"Content-Type":"text/plain"},body:c});if(!e.ok)throw new Error(`HTTP 错误: ${e.status}`);const C=(await e.json()).task_id;u(C)}catch(e){te(e,"请求失败: ")}}const O=y(!1),J=y("");function u(c){O.value=!0;const e=setInterval(async()=>{var C;let o="";try{const M=await fetch(`http://localhost:8080/progress/${c}`);if(!M.ok)throw new Error(`进度查询失败: ${M.status}`);const x=await M.json();o=(C=x.recent_log)!=null&&C.length?`

最近日志:
`+x.recent_log.join(`
`):"",x.status==="completed"&&(clearInterval(e),o=`处理完成✅ (状态: ${x.status})${o}`),x.status==="failed"&&(clearInterval(e),o=`处理完成✅ (状态: ${x.status})${o}`)}catch{clearInterval(e),o="监控失败: "}J.value=o},1e3)}const s=y(!1),b=y("情感"),p=y(!1);async function S(c,e){const o=_.getSubtitles(c,e);let C="";o.value.map(M=>{const x=M.time.split(".")[0]+" "+M.text+`
`;C+=x}),C+=s.value?ft:p.value?vt.replace("_P_",b.value):"";try{await navigator.clipboard.writeText(C),ee(`${o.value.length}条字幕已复制`)}catch(M){console.error(M),H("复制失败，请手动复制")}}return(c,e)=>{const o=z("el-button"),C=z("el-input"),M=z("DocumentCopy"),x=z("el-icon"),L=z("CaretLeft"),Y=z("CaretRight"),T=z("Minus"),F=z("Plus"),X=z("el-card");return G(),Z(le,null,[ue(t(X,{class:"segment-control-card"},{footer:l(()=>[D("div",mt,[t(o,{size:"small",onClick:i},{default:l(()=>e[17]||(e[17]=[P("复制链接")])),_:1}),t(o,{size:"small",onClick:v},{default:l(()=>e[18]||(e[18]=[P("复制ID")])),_:1}),t(o,{size:"small",onClick:N},{default:l(()=>e[19]||(e[19]=[P("下载片段")])),_:1}),t(o,{size:"small",onClick:e[3]||(e[3]=d=>O.value=!O.value),type:O.value?"danger":""},{default:l(()=>e[20]||(e[20]=[P("显示日志")])),_:1},8,["type"]),t(o,{size:"small",onClick:e[4]||(e[4]=d=>k("video"))},{default:l(()=>e[21]||(e[21]=[P("复制命令")])),_:1})])]),default:l(()=>[D("div",it,[t(o,{size:"small",type:s.value?"success":"info",onClick:e[0]||(e[0]=d=>{p.value=!1,s.value=!s.value})},{default:l(()=>e[5]||(e[5]=[P("取标题")])),_:1},8,["type"]),t(o,{size:"small",type:p.value?"success":"info",onClick:e[1]||(e[1]=d=>{s.value=!1,p.value=!p.value})},{default:l(()=>e[6]||(e[6]=[P("取内容")])),_:1},8,["type"]),t(C,{size:"small",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=d=>b.value=d),disabled:!p.value,style:{flex:"1"}},null,8,["modelValue","disabled"])]),D("div",ct,[(G(!0),Z(le,null,Ce(a,(d,U)=>(G(),Z("div",{key:d.id,class:"segment-item"},[D("div",ut,[t(o,{type:"primary",size:"small",onClick:j=>f(U,"seal","audio")},{default:l(()=>e[7]||(e[7]=[P("SA")])),_:2},1032,["onClick"]),t(o,{type:"primary",size:"small",onClick:j=>f(U,"seal","video")},{default:l(()=>e[8]||(e[8]=[P("SV")])),_:2},1032,["onClick"]),t(o,{type:"primary",size:"small",onClick:j=>f(U,"dlp","audio")},{default:l(()=>e[9]||(e[9]=[P("DA")])),_:2},1032,["onClick"]),t(o,{type:"primary",size:"small",onClick:j=>f(U,"dlp","video")},{default:l(()=>e[10]||(e[10]=[P("DV")])),_:2},1032,["onClick"]),t(C,{"model-value":g(_).secondsToTime(d.endTime-d.startTime),size:"small",readonly:""},null,8,["model-value"]),t(o,{size:"small",type:d.isK?"success":"info",onClick:j=>d.isK=!d.isK},{default:l(()=>[P(Q(d.isK?"k开":"k关"),1)]),_:2},1032,["type","onClick"]),t(o,{size:"small",type:"success",onClick:j=>S(d.startTime,d.endTime)},{default:l(()=>[t(x,null,{default:l(()=>[t(M)]),_:1})]),_:2},1032,["onClick"])]),D("div",dt,[t(o,{type:"success",size:"small",onClick:j=>A(U)},{default:l(()=>e[11]||(e[11]=[P("S")])),_:2},1032,["onClick"]),t(o,{type:"success",size:"small",onClick:j=>g(n).jumpTo(g(K)(d.startTime))},{default:l(()=>e[12]||(e[12]=[P("J")])),_:2},1032,["onClick"]),t(o,{type:"success",size:"small",onClick:j=>d.startTime=d.startTime-.5},{default:l(()=>[t(x,null,{default:l(()=>[t(L)]),_:1})]),_:2},1032,["onClick"]),t(o,{type:"success",size:"small",onClick:j=>d.startTime=d.startTime+.5},{default:l(()=>[t(x,null,{default:l(()=>[t(Y)]),_:1})]),_:2},1032,["onClick"]),t(C,{"model-value":g(K)(d.startTime),size:"small",readonly:""},null,8,["model-value"]),t(o,{size:"small",onClick:j=>B(U),disabled:U===0||a.length===1},{default:l(()=>e[13]||(e[13]=[P("↑")])),_:2},1032,["onClick","disabled"]),t(o,{size:"small",onClick:j=>E(U),disabled:a.length===1},{default:l(()=>[t(x,null,{default:l(()=>[t(T)]),_:1})]),_:2},1032,["onClick","disabled"])]),D("div",pt,[t(o,{type:"danger",size:"small",onClick:j=>W(U)},{default:l(()=>e[14]||(e[14]=[P("E")])),_:2},1032,["onClick"]),t(o,{type:"danger",size:"small",onClick:j=>g(n).jumpTo(g(K)(d.endTime))},{default:l(()=>e[15]||(e[15]=[P("J")])),_:2},1032,["onClick"]),t(o,{type:"danger",size:"small",onClick:j=>d.endTime=d.endTime-.5},{default:l(()=>[t(x,null,{default:l(()=>[t(L)]),_:1})]),_:2},1032,["onClick"]),t(o,{type:"danger",size:"small",onClick:j=>d.endTime=d.endTime+.5},{default:l(()=>[t(x,null,{default:l(()=>[t(Y)]),_:1})]),_:2},1032,["onClick"]),t(C,{type:"danger","model-value":g(K)(d.endTime),size:"small",readonly:""},null,8,["model-value"]),t(o,{size:"small",onClick:j=>R(U),disabled:U===a.length-1||a.length===1},{default:l(()=>e[16]||(e[16]=[P("↓")])),_:2},1032,["onClick","disabled"]),t(o,{size:"small",onClick:j=>I(U)},{default:l(()=>[t(x,null,{default:l(()=>[t(F)]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1},512),[[$e,g(r).open]]),ue(t(X,{class:"log-card",style:{"max-width":"480px","z-index":"1000000 !important"}},{default:l(()=>[D("p",null,Q(J.value),1)]),_:1},512),[[$e,O.value]])],64)}}}),Se=(m,n)=>{const r=m.__vccOpts||m;for(const[_,a]of n)r[_]=a;return r},ke=Se(yt,[["__scopeId","data-v-1d66d95b"]]),gt={__name:"App",setup(m){return se(),(n,r)=>{const _=z("el-col"),a=z("el-row"),$=z("el-container");return G(),Z(le,null,[t(ke),t($,{style:{height:"100vh"}},{default:l(()=>[t(a,{class:"grid-container"},{default:l(()=>[t(_,{class:"grid-section top"},{default:l(()=>[t(Je)]),_:1}),t(_,{class:"grid-section bottom"},{default:l(()=>[t(We),t(rt),t(ke)]),_:1})]),_:1})]),_:1})],64)}}},_t=Se(gt,[["__scopeId","data-v-d44e3bc6"]]),oe=Ke(_t);oe.use(Re());oe.use(xe);for(const[m,n]of Object.entries(Ie))oe.component(m,n);oe.mount("#app");
