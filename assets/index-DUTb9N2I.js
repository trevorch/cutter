import{E as ye,i as Pe}from"./element-plus-DRLPWQh5.js";import{B as Ee,l as Me,w as Ie,Q as je,R as Le,S as Ue}from"./@element-plus-Dp6MuveI.js";import{r as $,j as ge,c as X,o as K,a as M,M as J,u as w,d as $e,k as xe,ag as E,aq as Ve,O as re,P as e,I as ve,H as l,L as C,G as ae,J as ie,S as Oe,w as Ke,a6 as ze,D as Re,n as He,X as Ae,Q as be,at as Ne}from"./@vue-C01xNfPK.js";import{d as _e,c as Fe}from"./pinia-CKuVeK4o.js";import{P as Be}from"./plyr-CZIZ1zVJ.js";import{H as pe}from"./hls.js-DWnTp5j0.js";import{f as Te}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))_(v);new MutationObserver(v=>{for(const r of v)if(r.type==="childList")for(const T of r.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&_(T)}).observe(document,{childList:!0,subtree:!0});function p(v){const r={};return v.integrity&&(r.integrity=v.integrity),v.referrerPolicy&&(r.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?r.credentials="include":v.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function _(v){if(v.ep)return;v.ep=!0;const r=p(v);fetch(v.href,r)}})();function qe(g,o="未知错误"){if(g instanceof Error)return g.message;if(typeof g=="string")return g;if(typeof g=="object"&&g!==null&&"message"in g&&typeof g.message=="string")return g.message;try{return JSON.stringify(g)}catch{return o}}const we={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},ke=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function ne(g,o){const p=qe(g),_=o?`${o}: ${p}`:p;ye.error({...we,message:`
    <div ${ke}>
      ${_}
    </div>
    `})}function L(g){ye.error({...we,message:`
    <div ${ke}>
      ${g}
    </div>
    `})}function ee(g){ye.success({...we,message:`
    <div ${ke}>
      ${g}
    </div>
    `})}const oe=g=>{try{const[o,p]=g.split("."),[_,v,r]=o.split(":").map(Number),T=p?parseInt(p.padEnd(3,"0")):0;return _*3600+v*60+r+T/1e3}catch{return 0}},U=g=>{const o=Math.round(g%1*1e3),p=Math.floor(g),_=Math.floor(p/3600),v=Math.floor(p%3600/60),r=p%60;return`${String(_).padStart(2,"0")}:${String(v).padStart(2,"0")}:${String(r).padStart(2,"0")}.${String(o).padStart(3,"0")}`},ce=_e("player",()=>{const g=$(""),o=$(null),p=$(null),_=$(null),v=$(null),r=$(null),T=d=>{o.value=new Be(d,{hideControls:!1,controls:["play","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},z=d=>{O(d,!0)},Y=d=>{O(d,!1)},O=(d,i)=>{v.value=d,g.value=d.date;const s=d.urls[0],D={type:"video",sources:[{src:s,type:N(s)}]};R(D).then(()=>{var S;i&&((S=o.value)==null||S.play())})},N=d=>d.includes(".m3u8")?"application/x-mpegURL":d.includes(".flv")?"video/x-flv":"video/mp4",R=async d=>{var s,D,S;(s=p.value)==null||s.destroy(),p.value=null,(D=_.value)==null||D.destroy(),_.value=null;const i=d.sources[0].src.includes(".m3u8")?"hls":d.sources[0].src.includes(".flv")?"flv":"html5";try{i!==r.value&&await((S=o.value)==null?void 0:S.stop()),o.value.source=d,i==="hls"&&pe.isSupported()?await Z(d.sources[0].src):i==="flv"&&Te.isSupported()&&await F(d.sources[0].src),r.value=i}catch(H){console.error("源切换失败:",H)}},Z=async d=>new Promise(i=>{p.value=new pe,p.value.loadSource(d),p.value.attachMedia(o.value.media),p.value.on(pe.Events.MANIFEST_PARSED,i)}),F=async d=>{_.value=Te.createPlayer({type:"flv",url:d}),_.value.attachMediaElement(o.value.media),_.value.load(),await _.value.play()},B=$(!1);return{player:o,initPlayer:T,switchSource:R,playStream:z,switchStream:Y,title:g,data:v,autoPlay:B,jumpTo:d=>{const i=oe(d);if(o.value&&i>0)try{o.value.currentTime=i,B.value?o.value.play():o.value.pause()}catch(s){ne(s,"跳转播放失败，请检查播放器状态")}}}}),Je={class:"video-wrapper"},Ye={class:"title"},Qe={class:"plyr-container"},Ge={__name:"Player",setup(g){const o=ce(),p=$(null);return ge(()=>{o.initPlayer(p.value)}),(_,v)=>(K(),X("div",Je,[M("h3",Ye,J(w(o).title),1),M("div",Qe,[M("video",{class:"player",ref_key:"videoRef",ref:p,playsinline:""},null,512)])]))}},he=_e("editor",()=>{const g=$(!1),o=$(!1),p=$(""),_=$(null),v=5e3,r=$(v),T=j=>{o.value=!0,_.value=j,p.value=j.date,F(j.dsource)},z=$([]),Y=j=>{try{const[d,i]=j.split("."),[s,D,S]=d.split(":").map(Number);return s*3600+D*60+S}catch(d){console.error(d)}},O=$(new Map),N=()=>{O.value.clear(),z.value.forEach((j,d)=>{try{const i=Y(j.time);O.value.has(i)||O.value.set(i,d)}catch(i){console.error(`错误处理时间戳 ${j.time}（索引 ${d}）: ${i}`)}})},R=j=>{if(!z.value)return;const d=r.value+j;r.value=Math.max(d,0);const i=j/1e3;z.value=z.value.map(s=>{const S=oe(s.time)+i;return{...s,time:U(Math.max(S,0))}}),N()},Z=()=>{if(!z.value)return;const d=(r.value-v)/1e3;z.value=z.value.map(i=>{const D=oe(i.time)-d;return{...i,time:U(Math.max(D,0))}}),r.value=v,N()},F=async j=>{var d;g.value=!0;try{const i=Date.now(),s=await fetch(j+`/srts/${(d=_.value)==null?void 0:d.id}?t=${i}`);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);z.value=await s.json();const D=r.value/1e3;z.value=z.value.map(S=>{const Q=oe(S.time)+D;return{...S,time:U(Math.max(Q,0))}}),N()}catch(i){console.error("数据获取失败:",i),ne(i,"字幕数据加载失败，请稍后重试"),z.value=[]}finally{g.value=!1}};return{open:o,title:p,edit:T,data:_,timelineData:z,loading:g,shiftCount:r,shiftSubtitles:R,timeToSeconds:oe,secondsToTime:U,resetSubtitles:Z,timeMap:O,timeToKey:Y,getSubtitles:(j,d)=>{var y;const i=$([]);if(!((y=z.value)!=null&&y.length))return console.error("时间轴数据未加载"),i;const s=Y(U(j)),D=Y(U(d)),S=O.value.get(s),H=O.value.get(D);if(typeof S!="number"||typeof H!="number")return console.error("无法匹配有效的时间段"),i;const Q=Math.max(0,S),m=Math.min(z.value.length-1,H),[t,h]=Q<=m?[Q,m]:[m,Q];return i.value=z.value.slice(t,h+1),i}}}),We=["onClick"],Xe=["onClick"],Ze=["onClick"],et={style:{display:"flex","justify-content":"flex-end","overflow-x":"auto","overflow-y":"hidden"}},tt=$e({__name:"Playlist",setup(g){const o=ce(),p=he(),_=$(""),v=$(!0),r=$([]),T=$("tube"),z=async i=>{console.log("url:"+i+"/video.json");try{const s=await fetch(i+"/video.json");if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);r.value=await s.json()}catch(s){console.log(s),ne(s,"数据加载失败")}finally{v.value=!1}},Y=xe(()=>{const i=_.value.toLowerCase();return r.value.filter(s=>s.id.toLowerCase().includes(i)||s.date.toLowerCase().includes(i))}),O=async i=>{var s;((s=i.urls)==null?void 0:s.length)>0?await R(i.urls[0],"链接已复制到剪贴板","链接复制失败"):L("该记录没有可用的链接")},N=async i=>{i.id?await R(i.id,"ID已复制到剪贴板","ID复制失败"):L("该记录没有可用的ID")},R=async(i,s,D)=>{try{await navigator.clipboard.writeText(i),ee(s)}catch(S){ne(S,D)}},Z=async i=>{await R(`ytmp4 ${i.id}`,"视频下载命令已复制到剪贴板","复制失败")},F=async i=>{await R(`gdmp3 '${i.urls[0]}' ${i.id}`,"音频下载命令已复制到剪贴板","复制失败")},B=async i=>{await R(`ytmp3 ${i.id}`,"音频下载命令已复制到剪贴板","复制失败")},j=i=>{var s;(s=i.urls)!=null&&s.length&&(i.urls[0],o.switchStream(i),p.edit(i))},d=i=>{var s;(s=i.urls)!=null&&s.length&&(i.urls[0],o.playStream(i))};return ge(()=>{z("tube")}),(i,s)=>{const D=E("el-button"),S=E("el-table-column"),H=E("el-input"),Q=E("el-table"),m=Ve("loading");return K(),X(re,null,[e(D,{type:T.value==="tube"?"danger":"default",size:"small",onClick:s[0]||(s[0]=t=>{T.value="tube",z("tube")})},{default:l(()=>s[4]||(s[4]=[C(" 馆长 ")])),_:1},8,["type"]),e(D,{type:T.value==="local"?"danger":"default",size:"small",onClick:s[1]||(s[1]=t=>{T.value="local",z("local")}),loading:v.value},{default:l(()=>s[5]||(s[5]=[C(" 本地 ")])),_:1},8,["type","loading"]),e(D,{type:T.value==="kwai"?"danger":"default",size:"small",onClick:s[2]||(s[2]=t=>{T.value="kwai",z("kwai")})},{default:l(()=>s[6]||(s[6]=[C(" 快手 ")])),_:1},8,["type"]),ve((K(),ae(Q,{data:Y.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:l(()=>[e(S,{fixed:"",label:"序号",width:"40"},{default:l(t=>[M("span",{class:"column-text",onClick:h=>N(t.row)},J((t.$index+1).toString().padStart(4,"0")),9,We)]),_:1}),e(S,{fixed:"",label:"日期",prop:"date",sortable:"",width:"100"},{default:l(t=>[M("span",{class:"column-text clickable-text",onClick:h=>O(t.row)},J(t.row.date),9,Xe)]),_:1}),e(S,{fixed:"",label:"ID",prop:"id",width:"130"},{default:l(t=>[M("span",{class:"column-text clickable-text",onClick:h=>N(t.row)},J(t.row.id),9,Ze)]),_:1}),e(S,{fixed:"right",align:"right",width:"200"},{header:l(()=>[e(H,{modelValue:_.value,"onUpdate:modelValue":s[3]||(s[3]=t=>_.value=t),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:l(t=>{var h,y;return[M("div",et,[t.row.dsource==="kwai"?(K(),ae(D,{key:0,plain:"",size:"small",onClick:k=>F(t.row),type:"primary"},{default:l(()=>s[7]||(s[7]=[C(" 下载 ")])),_:2},1032,["onClick"])):ie("",!0),t.row.dsource==="tube"?(K(),ae(D,{key:1,plain:"",size:"small",onClick:k=>Z(t.row),type:"primary"},{default:l(()=>s[8]||(s[8]=[C(" 下片 ")])),_:2},1032,["onClick"])):ie("",!0),t.row.dsource==="tube"?(K(),ae(D,{key:2,plain:"",size:"small",onClick:k=>B(t.row),type:"primary"},{default:l(()=>s[9]||(s[9]=[C(" 下音 ")])),_:2},1032,["onClick"])):ie("",!0),e(D,{plain:"",size:"small",onClick:k=>j(t.row),type:t.row.hasSrt?"success":"warning",disabled:!t.row.hasSrt},{default:l(()=>s[10]||(s[10]=[C(" 切 ")])),_:2},1032,["onClick","type","disabled"]),e(D,{plain:"",size:"small",onClick:k=>d(t.row),type:(h=t.row.urls)!=null&&h.length?"success":"warning",disabled:!((y=t.row.urls)!=null&&y.length)},{default:l(()=>s[11]||(s[11]=[C(" 播 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[m,v.value]])],64)}}}),Ce=(g,o)=>{const p=g.__vccOpts||g;for(const[_,v]of o)p[_]=v;return p},nt=Ce(tt,[["__scopeId","data-v-2ded0a97"]]),De=_e("picker",()=>{const g=$(!1),o=$(!1),p=$("");return $(null),$(0),{open:o,title:p,loading:g}}),lt={style:{display:"flex",gap:"0","justify-content":"flex-start"}},ot={key:0,class:"loading-state"},st={class:"srt-time"},at=["onClick"],it={key:1,class:"empty-state"},rt={class:"footer-container"},ct={class:"time-shift-controls"},ut={class:"time-shift-controls"},dt={class:"time-shift-controls"},me=100,fe=5e3,pt=$e({__name:"Editor",setup(g){const o=he(),p=ce(),_=De(),v=$(!1),r=()=>{p.player&&(p.player.playing?p.player.pause():p.player.play())},T=$(1e3),z=m=>{const t=T.value+m;T.value=Math.max(me,Math.min(fe,t))},Y=$(["你好","晚上好","拜拜","再见"]),O=m=>Y.value.some(t=>m.includes(t)),N=xe(()=>o.timelineData.map((m,t)=>({text:m.text,index:t})).filter(({text:m})=>O(m)).map(({index:m})=>m).sort((m,t)=>m-t)),R=()=>{const m=N.value;if(m.length===0){L("未找到包含关键字的字幕行");return}let t=0,h=m.length-1,y=-1;for(;t<=h;){const k=Math.floor((t+h)/2);m[k]<d.value?(y=m[k],t=k+1):h=k-1}y===-1&&(y=m[m.length-1]),s(y)},Z=()=>{const m=N.value;if(m.length===0){L("未找到包含关键字的字幕行");return}let t=0,h=m.length-1,y=-1;for(;t<=h;){const k=Math.floor((t+h)/2);m[k]>d.value?(y=m[k],h=k-1):t=k+1}y===-1&&(y=m[0]),s(y)},F=$(),B=$([]),j=m=>{m instanceof HTMLElement&&B.value.push(m)},d=$(0),i=async m=>{const t=U(m),h=o.timeToKey(t),y=o.timeMap.get(h);typeof y=="number"&&y!==d.value&&(d.value=y,await He(),setTimeout(()=>s(y),50))},s=m=>{const t=F.value,h=B.value[m];if(h instanceof HTMLElement&&t){const k=h.offsetTop-t.clientHeight/2;t.scrollTo({top:k,behavior:"smooth"})}},D=$(595),S=$();let H=null;ge(()=>{S.value=document.querySelector(".grid-section.bottom"),S.value&&(H=new ResizeObserver(m=>{for(const t of m){const{height:h}=t.contentRect;D.value=h}}),H.observe(S.value)),p.player.on("timeupdate",()=>{i(p.player.currentTime)}),p.player.on("play",()=>{v.value=!0}),p.player.on("pause",()=>{v.value=!1})}),Oe(()=>{H&&S.value&&H.unobserve(S.value),p.player.off("timeupdate",i),B.value=[]}),Ke(()=>o.timelineData,()=>{B.value=[]});const Q=async()=>{var m,t;try{const h=(m=p.player)==null?void 0:m.media;if(!(h instanceof HTMLVideoElement)){L("无法获取视频元素");return}const y=document.createElement("canvas");y.width=h.videoWidth,y.height=h.videoHeight;const k=y.getContext("2d");if(!k){ne("无法创建画布上下文");return}k.drawImage(h,0,0,y.width,y.height);const le=y.toDataURL("image/jpeg",.9),G=document.createElement("a"),se=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);G.download=`capture_${(t=o.data)==null?void 0:t.id}_${se}.jpg`,G.href=le,document.body.appendChild(G),G.click(),document.body.removeChild(G),ee("截图已保存")}catch(h){ne(`截图失败: ${h instanceof Error?h.message:h}`)}};return(m,t)=>{const h=E("Camera"),y=E("el-icon"),k=E("el-button"),le=E("el-text"),G=E("Top"),se=E("Bottom"),c=E("el-space"),n=E("el-affix"),a=E("Expand"),b=E("Minus"),P=E("el-drawer");return K(),ae(P,{modelValue:w(o).open,"onUpdate:modelValue":t[10]||(t[10]=u=>w(o).open=u),direction:"btt",modal:!1,size:D.value,onOpened:t[11]||(t[11]=u=>w(o).shiftSubtitles(0))},{header:l(()=>[M("div",lt,[e(k,{onClick:Q,size:"small",circle:""},{default:l(()=>[e(y,null,{default:l(()=>[e(h)]),_:1})]),_:1}),e(le,{class:"mx-1",type:"warning"},{default:l(()=>{var u,x;return[C(J((u=w(o).data)==null?void 0:u.date)+" - "+J((x=w(o).data)==null?void 0:x.id),1)]}),_:1})])]),default:l(()=>[M("div",{class:"timeline-container",ref_key:"containerRef",ref:F},[w(o).loading?(K(),X("div",ot,[e(y,{class:"is-loading",color:"#409EFF",size:20},{default:l(()=>[e(w(Me))]),_:1}),t[12]||(t[12]=M("span",null,"正在加载字幕数据...",-1))])):ie("",!0),(K(!0),X(re,null,ze(w(o).timelineData,(u,x)=>(K(),X("div",{key:x,class:"timeline-item",ref_for:!0,ref:j},[M("span",st,J(u.time),1),M("span",{class:Re(["srt-text",{highlight:x==d.value,keyword:O(u.text)}]),onClick:q=>{i(w(oe)(u.time)),w(p).jumpTo(u.time)}},J(u.text),11,at)]))),128)),!w(o).loading&&w(o).timelineData.length===0?(K(),X("div",it,[e(y,null,{default:l(()=>[e(w(Ie))]),_:1}),t[13]||(t[13]=M("span",null,"暂无字幕数据",-1))])):ie("",!0)],512),e(n,{class:"floating-btn",position:"bottom",offset:200},{default:l(()=>[e(c,{direction:"vertical"},{default:l(()=>[e(k,{onClick:t[0]||(t[0]=u=>w(p).autoPlay=!w(p).autoPlay),type:w(p).autoPlay?"success":""},{default:l(()=>[e(y,null,{default:l(()=>t[14]||(t[14]=[C("A")])),_:1})]),_:1},8,["type"]),e(k,{onClick:R},{default:l(()=>[e(y,null,{default:l(()=>[e(G)]),_:1})]),_:1}),e(k,{onClick:Z},{default:l(()=>[e(y,null,{default:l(()=>[e(se)]),_:1})]),_:1}),e(k,{onClick:r,icon:v.value?w(je):w(Le)},null,8,["icon"])]),_:1})]),_:1})]),footer:l(()=>[M("div",rt,[M("div",ct,[e(k,{size:"small",type:w(_).open?"success":""},{default:l(()=>[e(y,{onClick:t[1]||(t[1]=u=>w(_).open=!w(_).open)},{default:l(()=>[e(a)]),_:1})]),_:1},8,["type"])]),M("div",ut,[e(k,{onClick:t[2]||(t[2]=u=>w(o).shiftSubtitles(-T.value)),disabled:w(o).shiftCount===0,size:"small"},{default:l(()=>[e(y,null,{default:l(()=>[e(b)]),_:1})]),_:1},8,["disabled"]),M("span",{class:"count",onClick:t[3]||(t[3]=(...u)=>w(o).resetSubtitles&&w(o).resetSubtitles(...u))},J(w(o).shiftCount),1),e(k,{onClick:t[4]||(t[4]=u=>w(o).shiftSubtitles(T.value)),size:"small"},{default:l(()=>[e(y,null,{default:l(()=>[e(w(Ee))]),_:1})]),_:1})]),M("div",dt,[e(k,{plain:"",type:"danger",onClick:t[5]||(t[5]=u=>z(-1e3)),disabled:T.value<=me,size:"small"},{default:l(()=>t[15]||(t[15]=[C(" <<1000 ")])),_:1},8,["disabled"]),e(k,{plain:"",type:"danger",onClick:t[6]||(t[6]=u=>z(-100)),disabled:T.value<=me,size:"small"},{default:l(()=>t[16]||(t[16]=[C(" <100 ")])),_:1},8,["disabled"]),M("span",{class:"count",onClick:t[7]||(t[7]=u=>T.value=1e3)},J(T.value),1),e(k,{plain:"",type:"success",onClick:t[8]||(t[8]=u=>z(100)),disabled:T.value>=fe,size:"small"},{default:l(()=>t[17]||(t[17]=[C(" 100> ")])),_:1},8,["disabled"]),e(k,{plain:"",type:"success",onClick:t[9]||(t[9]=u=>z(1e3)),disabled:T.value>=fe,size:"small"},{default:l(()=>t[18]||(t[18]=[C(" 1000>> ")])),_:1},8,["disabled"])])])]),_:1},8,["modelValue","size"])}}}),mt={class:"prompt-controls",style:{display:"flex",gap:"5px",margin:"5px","align-items":"center"}},ft={class:"segment-container"},vt={class:"time-controls"},yt={class:"time-controls"},gt={class:"time-controls"},$t={class:"card-footer"},_t=`
总结上面的对话内容，并参考下面的标题以及高点击率标题核心公式，运用马斯洛需求层次理论，为上面的对话内容起一个容易引起讨论的标题，不能夸大其词，不能包含不实内容，同时给出建议标签，标签要每行一个，标题和标签要方便复制：
一、参考标题
1、心智阳光健康，本科大二学生，聊天很是投缘，大冰不舍挂断
2、人为什么需要亲密关系？大冰深度分析，看完人都通透了
3、主动要礼物！聊天高端局，“泄露天机”太多，大冰“索要”礼物
4、如何把事情处理得圆润得体？大冰深度教学，家庭职场都受用
5、情侣裂痕是如何产生的？大冰深度分析，值得反复观看
6、光长年龄不长心智是一种什么体验？大冰对话32岁女画师，表现惊掉你下巴
7、颠覆你的认知：如何炼成顶级倾听力？大冰独家分享！带你突破沟通瓶颈！
8、如何把握相处的底层逻辑？大冰深度分析，职场婚姻都受用
9、精神未断奶是一种什么体验？大冰对话女硕士，思维表现大跌眼镜
10、如何克服自我否定的毛病？大冰深度教学，看完终身受益
二、高点击率标题核心公式
1、数字+痛点/利益
例：《月薪3千到3万，她靠这5个理财技巧逆袭，第3点人人可复制》。
2、疑问句+悬念
例：《为何日本核污水排海后，欧美集体沉默？背后真相远超想象》。
3、热点绑定+情绪词
例：《全网震怒！某顶流明星偷税细节曝光，经纪人一句话惹怒全网》。
4、挑战常识+颠覆认知
例：《喝粥不养胃！协和医生警告：这3种“健康习惯”反而致癌》。
5、本地化+紧迫感
例：《北京人注意！这趟地铁线路将停运3个月，明天起实施》。
`,wt=`
对以上内容进出场景划分，每个场景都以“你好/晚上好”等类似问候语开始，
以“拜拜/再见/下一位”等类似问候语结束，
针对每个场景提取一个符合内容事实，反映核心矛盾冲突的标题，
标题分为大标题和小标题，大标题吸引眼球，大概13个字，小标题使用富含哲理的话术阐述事实，大概20-30个字，
并给出每个场景的开始和结束始时间，提取对话中最严厉的话作为为每个场景的开场白，并给出这句话出现的时间点。
同时为每个场景提取5个不会被b站限流的爆炸性词汇。
`,kt=`
对以上内容按如下要求处理：
1、按观点进行场景划分
2、每个场景约10至15分钟，要包含相对完整的叙事，总结每个观点的核心内容
3、针对每个场景提取一个符合内容事实，富含哲理且正面的标题，标题分为大标题和小标题，大标题吸引眼球，小标题简要阐述事实，但不能违反中国国家法律
4、给出每个场景的开始和结束始时间
5、请使用中文回答。
`,ht=$e({__name:"Picker",setup(g){const o=ce(),p=De(),_=he(),v=$(!1),r=Ae([T()]);function T(){return{id:crypto.randomUUID(),startTime:0,endTime:0,duration:0,isK:!1}}const z=c=>{r.splice(c+1,0,T())},Y=c=>{r.length>1&&r.splice(c,1)},O=c=>{if(c>0){const n=r.splice(c,1)[0];r.splice(c-1,0,n)}},N=c=>{if(c<r.length-1){const n=r.splice(c,1)[0];r.splice(c+1,0,n)}};function R(c){if(!o.player)return;const n=o.player.currentTime,a=r[c];a.startTime=n}function Z(c){if(!o.player)return;const n=o.player.currentTime,a=r[c];a.endTime=n}function F(c){var n,a;if(((n=o.data)==null?void 0:n.dsource)==="local"){const b=window.location.protocol,P=window.location.host;return`${`${b}//${P}`}/${c}`}if(!v.value){const b=window.location.protocol,P=window.location.host;return`${`${b}//${P}`}/local/${(a=o.data)==null?void 0:a.id}.mp4`}return c}function B(c,n){var I;const a=r[c],b=a.isK?"-k":"";let P=F((I=o.data)==null?void 0:I.urls[0]);if(!P)throw L("请先播放视频"),new Error("请先播放视频");const u=P.match(/\/([^\/]+)\.mp4$/),x=u?u[1]:(()=>{const de=new Date;return`${de.getFullYear()}${(de.getMonth()+1).toString().padStart(2,"0")}${de.getDate().toString().padStart(2,"0")}`})();if(!a.startTime||!a.endTime)throw L("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const q=U(a.startTime),A=U(a.endTime),W=q.replace(/:/g,"."),te=A.replace(/:/g,".");let f="yt-dlp --no-check-certificate";f=`${f} --concurrent-fragments 16 --throttled-rate 5M `,f=`${f} --download-sections "*${q}-${A}"`;const V="~/storage/downloads/Reqable/";return n=="video"&&(f=`${f} --merge-output-format mp4 -o "${V}${x}_${W}-${te}.mp4"`),n=="audio"&&(f=`${f} ${b} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${V}${x}_${W}-${te}.mp3"`),f=`${f} '${P}' `,f}function j(c,n){var V;const a=r[c],b=a.isK?"-k":"";let P=F((V=o.data)==null?void 0:V.urls[0]);if(!P)throw L("请先播放视频"),new Error("请先播放视频");const u=P.match(/\/([^\/]+)\.mp4$/),x=u?u[1]:(()=>{const I=new Date;return`${I.getFullYear()}${(I.getMonth()+1).toString().padStart(2,"0")}${I.getDate().toString().padStart(2,"0")}`})();if(!a.startTime||!a.endTime)throw L("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const q=U(a.startTime),A=U(a.endTime),W=q.replace(/:/g,"."),te=A.replace(/:/g,".");let f=`--download-sections "*${q}-${A}"`;return n=="video"&&(f=`${f} --merge-output-format mp4 -o "${x}_${W}-${te}.mp4"`),n=="audio"&&(f=`${f} ${b} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${x}_${W}-${te}.mp3"`),f}async function d(){var n;const c=F((n=o.data)==null?void 0:n.urls[0]);if(!c){L("请先播放视频");return}try{await navigator.clipboard.writeText(c),ee(`链接已复制：${c}`)}catch(a){console.error(a),L("复制失败，请手动复制")}}async function i(){var n;const c=(n=o.data)==null?void 0:n.id;if(!c){L("请先播放视频");return}try{await navigator.clipboard.writeText(c),ee(`ID已复制：${c}`)}catch(a){console.error(a),L("ID失败，请手动复制")}}async function s(c,n,a){let b="";switch(n){case"dlp":b=B(c,a);break;case"seal":b=j(c,a);break}try{await navigator.clipboard.writeText(b),ee(`命令已复制：${b}`)}catch(P){console.error(P),L("复制失败，请手动复制")}}const D=async c=>{const n=[];r.forEach((a,b)=>{console.log(`Index: ${b}`,a),n.push(B(b,c))});try{await navigator.clipboard.writeText(n.join(`
`)),ee(`命令已复制：${n.join("<br/>")}`)}catch(a){console.error(a),L("复制失败，请手动复制")}},S=$(!1);async function H(){var u;let c=F((u=o.data)==null?void 0:u.urls[0]);if(!c){L("请先播放视频");return}const n=c.match(/\/([^\/]+)\.mp4$/),a=n?n[1]:(()=>{const x=new Date;return`${x.getFullYear()}${(x.getMonth()+1).toString().padStart(2,"0")}${x.getDate().toString().padStart(2,"0")}`})(),b=r.filter(x=>x.startTime<x.endTime).map((x,q)=>`${U(x.startTime)}-${U(x.endTime)}`);if(!b.length){L("请先至少设置一个开始和结束时间");return}const P=`dlp ${S.value?"keep":"delete"} '${c}' '${a}' ${b.join(" ")}`;try{Q(P),await navigator.clipboard.writeText(P),ee(`命令已复制：${P}`)}catch(x){console.error(x),ne(x,"复制失败，请手动复制")}}async function Q(c){try{const n=await fetch("http://localhost:8080/run",{method:"POST",headers:{"Content-Type":"text/plain"},body:c});if(!n.ok)throw new Error(`HTTP 错误: ${n.status}`);const b=(await n.json()).task_id;h(b)}catch(n){ne(n,"请求失败: ")}}const m=$(!1),t=$("");function h(c){m.value=!0;const n=setInterval(async()=>{var b;let a="";try{const P=await fetch(`http://localhost:8080/progress/${c}`);if(!P.ok)throw new Error(`进度查询失败: ${P.status}`);const u=await P.json();a=(b=u.recent_log)!=null&&b.length?`

最近日志:
`+u.recent_log.join(`
`):"",u.status==="completed"&&(clearInterval(n),a=`处理完成✅ (状态: ${u.status})${a}`),u.status==="failed"&&(clearInterval(n),a=`处理完成✅ (状态: ${u.status})${a}`)}catch{clearInterval(n),a="监控失败: "}t.value=a},1e3)}const y=$(""),k=$("情感"),le=$("");async function G(c){y.value=c}async function se(c,n){var u,x,q;const a=y.value;if(a==="info"){let A=`${(u=_.data)==null?void 0:u.date}-${(x=_.data)==null?void 0:x.id} ${U(c)}-${U(n)}`;try{await navigator.clipboard.writeText(A),ee("切片信息已复制")}catch(W){console.error(W),L("复制失败，请手动复制")}return}const b=_.getSubtitles(c,n);let P="";switch(b.value.map(A=>{const W=A.time.split(".")[0]+" "+A.text+`
`;P+=W}),(q=o.data)==null?void 0:q.dsource){case"kwai":le.value=wt;break;default:le.value=kt}P+=a=="title"?_t:a=="target"?le.value.replace("_P_",k.value):"";try{await navigator.clipboard.writeText(P),ee(`${b.value.length}条字幕已复制`)}catch(A){console.error(A),L("复制失败，请手动复制")}}return(c,n)=>{const a=E("el-button"),b=E("el-input"),P=E("DocumentCopy"),u=E("el-icon"),x=E("CaretLeft"),q=E("CaretRight"),A=E("Plus"),W=E("Minus"),te=E("el-card");return K(),X(re,null,[ve(e(te,{class:"segment-control-card"},{footer:l(()=>[M("div",$t,[e(a,{plain:"",type:"success",size:"small",onClick:H},{default:l(()=>n[20]||(n[20]=[C("下载片段")])),_:1}),e(a,{plain:"",type:m.value?"warning":"primary",size:"small",onClick:n[5]||(n[5]=f=>m.value=!m.value)},{default:l(()=>n[21]||(n[21]=[C("显示日志")])),_:1},8,["type"]),e(a,{plain:"",type:"success",size:"small",onClick:d},{default:l(()=>n[22]||(n[22]=[C("复制链接")])),_:1}),e(a,{plain:"",type:"success",size:"small",onClick:i},{default:l(()=>n[23]||(n[23]=[C("复制ID")])),_:1}),e(a,{plain:"",type:"success",size:"small",onClick:n[6]||(n[6]=f=>D("video"))},{default:l(()=>n[24]||(n[24]=[C("复制命令")])),_:1})])]),default:l(()=>[M("div",mt,[e(a,{size:"small",onClick:n[0]||(n[0]=f=>v.value=!v.value),type:v.value?"success":"danger"},{default:l(()=>[C(J(v.value?"远程":"本地"),1)]),_:1},8,["type"]),e(a,{size:"small",type:y.value==="info"?"success":"info",onClick:n[1]||(n[1]=f=>G("info"))},{default:l(()=>n[7]||(n[7]=[C("取信息")])),_:1},8,["type"]),e(a,{size:"small",type:y.value==="title"?"success":"info",onClick:n[2]||(n[2]=f=>G("title"))},{default:l(()=>n[8]||(n[8]=[C("取标题")])),_:1},8,["type"]),e(a,{size:"small",type:y.value==="target"?"success":"info",onClick:n[3]||(n[3]=f=>G("target"))},{default:l(()=>n[9]||(n[9]=[C("取内容")])),_:1},8,["type"]),e(b,{size:"small",modelValue:k.value,"onUpdate:modelValue":n[4]||(n[4]=f=>k.value=f),disabled:y.value!=="target",style:{flex:"1"}},null,8,["modelValue","disabled"])]),M("div",ft,[(K(!0),X(re,null,ze(r,(f,V)=>(K(),X("div",{key:f.id,class:"segment-item"},[M("div",vt,[e(a,{plain:"",type:"primary",size:"small",onClick:I=>s(V,"seal","audio")},{default:l(()=>n[10]||(n[10]=[C("SA")])),_:2},1032,["onClick"]),e(a,{plain:"",type:"primary",size:"small",onClick:I=>s(V,"seal","video")},{default:l(()=>n[11]||(n[11]=[C("SV")])),_:2},1032,["onClick"]),e(a,{plain:"",type:"primary",size:"small",onClick:I=>s(V,"dlp","audio")},{default:l(()=>n[12]||(n[12]=[C("DA")])),_:2},1032,["onClick"]),e(a,{plain:"",type:"primary",size:"small",onClick:I=>s(V,"dlp","video")},{default:l(()=>n[13]||(n[13]=[C("DV")])),_:2},1032,["onClick"]),e(b,{"model-value":w(_).secondsToTime(f.endTime-f.startTime),size:"small",readonly:""},null,8,["model-value"]),e(a,{plain:"",size:"small",type:f.isK?"success":"info",onClick:I=>f.isK=!f.isK},{default:l(()=>[C(J(f.isK?"k开":"k关"),1)]),_:2},1032,["type","onClick"]),e(a,{plain:"",size:"small",type:"success",onClick:I=>se(f.startTime,f.endTime)},{default:l(()=>[e(u,null,{default:l(()=>[e(P)]),_:1})]),_:2},1032,["onClick"])]),M("div",yt,[e(a,{plain:"",type:"success",size:"small",onClick:I=>R(V)},{default:l(()=>n[14]||(n[14]=[C("S")])),_:2},1032,["onClick"]),e(a,{plain:"",type:"success",size:"small",onClick:I=>w(o).jumpTo(w(U)(f.startTime))},{default:l(()=>n[15]||(n[15]=[C("J")])),_:2},1032,["onClick"]),e(a,{plain:"",type:"success",size:"small",onClick:I=>f.startTime=f.startTime-.5},{default:l(()=>[e(u,null,{default:l(()=>[e(x)]),_:1})]),_:2},1032,["onClick"]),e(a,{plain:"",type:"success",size:"small",onClick:I=>f.startTime=f.startTime+.5},{default:l(()=>[e(u,null,{default:l(()=>[e(q)]),_:1})]),_:2},1032,["onClick"]),e(b,{"model-value":w(U)(f.startTime),size:"small",readonly:""},null,8,["model-value"]),e(a,{plain:"",size:"small",onClick:I=>O(V),disabled:V===0||r.length===1},{default:l(()=>n[16]||(n[16]=[C("↑")])),_:2},1032,["onClick","disabled"]),e(a,{plain:"",type:"success",size:"small",onClick:I=>z(V)},{default:l(()=>[e(u,null,{default:l(()=>[e(A)]),_:1})]),_:2},1032,["onClick"])]),M("div",gt,[e(a,{plain:"",type:"danger",size:"small",onClick:I=>Z(V)},{default:l(()=>n[17]||(n[17]=[C("E")])),_:2},1032,["onClick"]),e(a,{plain:"",type:"danger",size:"small",onClick:I=>w(o).jumpTo(w(U)(f.endTime))},{default:l(()=>n[18]||(n[18]=[C("J")])),_:2},1032,["onClick"]),e(a,{plain:"",type:"danger",size:"small",onClick:I=>f.endTime=f.endTime-.5},{default:l(()=>[e(u,null,{default:l(()=>[e(x)]),_:1})]),_:2},1032,["onClick"]),e(a,{plain:"",type:"danger",size:"small",onClick:I=>f.endTime=f.endTime+.5},{default:l(()=>[e(u,null,{default:l(()=>[e(q)]),_:1})]),_:2},1032,["onClick"]),e(b,{type:"danger","model-value":w(U)(f.endTime),size:"small",readonly:""},null,8,["model-value"]),e(a,{plain:"",size:"small",onClick:I=>N(V),disabled:V===r.length-1||r.length===1},{default:l(()=>n[19]||(n[19]=[C("↓")])),_:2},1032,["onClick","disabled"]),e(a,{plain:"",type:"danger",size:"small",onClick:I=>Y(V),disabled:r.length===1},{default:l(()=>[e(u,null,{default:l(()=>[e(W)]),_:1})]),_:2},1032,["onClick","disabled"])])]))),128))])]),_:1},512),[[be,w(p).open]]),ve(e(te,{class:"log-card",style:{"max-width":"480px","z-index":"1000000 !important"}},{default:l(()=>[M("p",null,J(t.value),1)]),_:1},512),[[be,m.value]])],64)}}}),Se=Ce(ht,[["__scopeId","data-v-efec280f"]]),Ct={__name:"App",setup(g){return ce(),(o,p)=>{const _=E("el-col"),v=E("el-row"),r=E("el-container");return K(),X(re,null,[e(Se),e(r,{style:{height:"100vh"}},{default:l(()=>[e(v,{class:"grid-container"},{default:l(()=>[e(_,{class:"grid-section top"},{default:l(()=>[e(Ge)]),_:1}),e(_,{class:"grid-section bottom"},{default:l(()=>[e(nt),e(pt),e(Se)]),_:1})]),_:1})]),_:1})],64)}}},bt=Ce(Ct,[["__scopeId","data-v-d44e3bc6"]]),ue=Ne(bt);ue.use(Fe());ue.use(Pe);for(const[g,o]of Object.entries(Ue))ue.component(g,o);ue.mount("#app");
