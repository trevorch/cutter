import{E as fe,i as Me}from"./element-plus-CRGBzuq5.js";import{f as le,g as ne,B as De,l as Pe,w as Ie,Q as je}from"./@element-plus-By79ymwD.js";import{r as $,j as ve,c as G,o as B,a as D,M as J,u as p,d as ye,k as Te,ag as x,aq as Le,I as pe,G as Se,H as l,P as e,L as I,S as Oe,w as Ue,J as ke,O as ce,a6 as ze,D as Ve,n as He,X as Ke,Q as we,at as Re}from"./@vue-C01xNfPK.js";import{d as ge,c as Ne}from"./pinia-CKuVeK4o.js";import{P as Ae}from"./plyr-CZIZ1zVJ.js";import{H as me}from"./hls.js-DWnTp5j0.js";import{f as be}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))h(a);new MutationObserver(a=>{for(const y of a)if(y.type==="childList")for(const H of y.addedNodes)H.tagName==="LINK"&&H.rel==="modulepreload"&&h(H)}).observe(document,{childList:!0,subtree:!0});function f(a){const y={};return a.integrity&&(y.integrity=a.integrity),a.referrerPolicy&&(y.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?y.credentials="include":a.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function h(a){if(a.ep)return;a.ep=!0;const y=f(a);fetch(a.href,y)}})();function Fe(v,n="未知错误"){if(v instanceof Error)return v.message;if(typeof v=="string")return v;if(typeof v=="object"&&v!==null&&"message"in v&&typeof v.message=="string")return v.message;try{return JSON.stringify(v)}catch{return n}}const _e={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},$e=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function Z(v,n){const f=Fe(v),h=n?`${n}: ${f}`:f;fe.error({..._e,message:`
    <div ${$e}>
      ${h}
    </div>
    `})}function U(v){fe.error({..._e,message:`
    <div ${$e}>
      ${v}
    </div>
    `})}function X(v){fe.success({..._e,message:`
    <div ${$e}>
      ${v}
    </div>
    `})}const oe=v=>{try{const[n,f]=v.split("."),[h,a,y]=n.split(":").map(Number),H=f?parseInt(f.padEnd(3,"0")):0;return h*3600+a*60+y+H/1e3}catch{return 0}},V=v=>{const n=Math.round(v%1*1e3),f=Math.floor(v),h=Math.floor(f/3600),a=Math.floor(f%3600/60),y=f%60;return`${String(h).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String(y).padStart(2,"0")}.${String(n).padStart(3,"0")}`},ae=ge("player",()=>{const v=$(""),n=$(null),f=$(null),h=$(null),a=$(null),y=$(null),H=c=>{n.value=new Ae(c,{hideControls:!1,controls:["play-large","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},E=c=>{a.value=c,v.value=c.date;const g=c.urls[0],_={type:"video",sources:[{src:g,type:N(g)}]};K(_).then(()=>{var C;return(C=n.value)==null?void 0:C.play()})},N=c=>c.includes(".m3u8")?"application/x-mpegURL":c.includes(".flv")?"video/x-flv":"video/mp4",K=async c=>{var _,C,P;(_=f.value)==null||_.destroy(),f.value=null,(C=h.value)==null||C.destroy(),h.value=null;const g=c.sources[0].src.includes(".m3u8")?"hls":c.sources[0].src.includes(".flv")?"flv":"html5";try{g!==y.value&&await((P=n.value)==null?void 0:P.stop()),n.value.source=c,g==="hls"&&me.isSupported()?await F(c.sources[0].src):g==="flv"&&be.isSupported()&&await q(c.sources[0].src),y.value=g}catch(L){console.error("源切换失败:",L)}},F=async c=>new Promise(g=>{f.value=new me,f.value.loadSource(c),f.value.attachMedia(n.value.media),f.value.on(me.Events.MANIFEST_PARSED,g)}),q=async c=>{h.value=be.createPlayer({type:"flv",url:c}),h.value.attachMediaElement(n.value.media),h.value.load(),await h.value.play()},R=$(!1);return{player:n,initPlayer:H,switchSource:K,playStream:E,title:v,data:a,autoPlay:R,jumpTo:c=>{const g=oe(c);if(n.value&&g>0)try{n.value.currentTime=g,R.value?n.value.play():n.value.pause()}catch(_){Z(_,"跳转播放失败，请检查播放器状态")}}}}),Be={class:"video-wrapper"},qe={class:"title"},Je={class:"plyr-container"},Ye={__name:"Player",setup(v){const n=ae(),f=$(null);return ve(()=>{n.initPlayer(f.value)}),(h,a)=>(B(),G("div",Be,[D("h3",qe,J(p(n).title),1),D("div",Je,[D("video",{class:"player",ref_key:"videoRef",ref:f,playsinline:""},null,512)])]))}},he=ge("editor",()=>{const v=$(!1),n=$(!1),f=$(""),h=$(null),a=5e3,y=$(a),H=g=>{n.value=!0,h.value=g,f.value=g.date,w()},E=$([]),N=g=>{try{const[_,C]=g.split("."),[P,L,T]=_.split(":").map(Number);return P*3600+L*60+T}catch(_){console.error(_)}},K=$(new Map),F=()=>{K.value.clear(),E.value.forEach((g,_)=>{try{const C=N(g.time);K.value.has(C)||K.value.set(C,_)}catch(C){console.error(`错误处理时间戳 ${g.time}（索引 ${_}）: ${C}`)}})},q=g=>{if(!E.value)return;const _=y.value+g;y.value=Math.max(_,0);const C=g/1e3;E.value=E.value.map(P=>{const T=oe(P.time)+C;return{...P,time:V(Math.max(T,0))}}),F()},R=()=>{if(!E.value)return;const _=(y.value-a)/1e3;E.value=E.value.map(C=>{const L=oe(C.time)-_;return{...C,time:V(Math.max(L,0))}}),y.value=a,F()},w=async()=>{var g;v.value=!0;try{const _=await fetch(`srts/${(g=h.value)==null?void 0:g.id}`);if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);E.value=await _.json();const C=y.value/1e3;E.value=E.value.map(P=>{const T=oe(P.time)+C;return{...P,time:V(Math.max(T,0))}}),F()}catch(_){console.error("数据获取失败:",_),Z(_,"字幕数据加载失败，请稍后重试"),E.value=[]}finally{v.value=!1}};return{open:n,title:f,edit:H,data:h,timelineData:E,loading:v,shiftCount:y,shiftSubtitles:q,timeToSeconds:oe,secondsToTime:V,resetSubtitles:R,timeMap:K,timeToKey:N,getSubtitles:(g,_)=>{var A;const C=$([]);if(!((A=E.value)!=null&&A.length))return console.error("时间轴数据未加载"),C;const P=N(V(g)),L=N(V(_)),T=K.value.get(P),u=K.value.get(L);if(typeof T!="number"||typeof u!="number")return console.error("无法匹配有效的时间段"),C;const s=Math.max(0,T),b=Math.min(E.value.length-1,u),[i,k]=s<=b?[s,b]:[b,s];return C.value=E.value.slice(i,k+1),C}}}),Qe=["onClick"],Ge=["onClick"],We={style:{display:"flex",gap:"0","justify-content":"flex-end"}},Xe=ye({__name:"Playlist",setup(v){const n=ae(),f=he(),h=$(""),a=$(!0),y=$([]),H=async()=>{try{const w=await fetch("video.json");if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);y.value=await w.json()}catch(w){Z(w,"数据加载失败")}finally{a.value=!1}},E=Te(()=>{const w=h.value.toLowerCase();return y.value.filter(c=>c.id.toLowerCase().includes(w)||c.date.toLowerCase().includes(w))}),N=async w=>{var c;((c=w.urls)==null?void 0:c.length)>0?await F(w.urls[0],"链接已复制到剪贴板","链接复制失败"):U("该记录没有可用的链接")},K=async w=>{w.id?await F(w.id,"ID已复制到剪贴板","ID复制失败"):U("该记录没有可用的ID")},F=async(w,c,g)=>{try{await navigator.clipboard.writeText(w),X(c)}catch(_){Z(_,g)}},q=w=>{var c;(c=w.urls)!=null&&c.length&&(w.urls[0],n.playStream(w),f.edit(w))},R=w=>{var c;(c=w.urls)!=null&&c.length&&(w.urls[0],n.playStream(w))};return ve(()=>{H()}),(w,c)=>{const g=x("el-table-column"),_=x("el-input"),C=x("el-button"),P=x("el-table"),L=Le("loading");return pe((B(),Se(P,{data:E.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:l(()=>[e(g,{fixed:"",label:"日期",prop:"date",sortable:"",width:"140"},{default:l(T=>[D("span",{class:"clickable-text",onClick:u=>N(T.row)},J(T.row.date),9,Qe)]),_:1}),e(g,{fixed:"",label:"标识",prop:"id",width:"180"},{default:l(T=>[D("span",{class:"clickable-text",onClick:u=>K(T.row)},J(T.row.id),9,Ge)]),_:1}),e(g,{fixed:"right",align:"right",width:"115"},{header:l(()=>[e(_,{modelValue:h.value,"onUpdate:modelValue":c[0]||(c[0]=T=>h.value=T),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:l(T=>{var u,s;return[D("div",We,[e(C,{plain:"",size:"small",onClick:b=>q(T.row),type:T.row.hasSrt?"success":"warning",disabled:!T.row.hasSrt},{default:l(()=>c[1]||(c[1]=[I(" 切片 ")])),_:2},1032,["onClick","type","disabled"]),e(C,{plain:"",size:"small",onClick:b=>R(T.row),type:(u=T.row.urls)!=null&&u.length?"success":"warning",disabled:!((s=T.row.urls)!=null&&s.length)},{default:l(()=>c[2]||(c[2]=[I(" 播放 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[L,a.value]])}}}),xe=ge("picker",()=>{const v=$(!1),n=$(!1),f=$("");return $(null),$(0),{open:n,title:f,loading:v}}),Ze={style:{display:"flex",gap:"0","justify-content":"flex-start"}},et={key:0,class:"loading-state"},tt={class:"time-label"},lt=["onClick"],nt={key:1,class:"empty-state"},st={class:"footer-container"},ot={class:"time-shift-controls"},at={class:"time-shift-controls"},re=50,ie=5e3,rt=ye({__name:"Editor",setup(v){const n=he(),f=ae(),h=xe(),a=$(1e3),y=u=>{const s=a.value+u;a.value=Math.max(re,Math.min(ie,s))},H=$(["你好","晚上好","拜拜","再见"]),E=u=>H.value.some(s=>u.includes(s)),N=Te(()=>n.timelineData.map((u,s)=>({text:u.text,index:s})).filter(({text:u})=>E(u)).map(({index:u})=>u).sort((u,s)=>u-s)),K=()=>{const u=N.value;if(u.length===0){U("未找到包含关键字的字幕行");return}let s=0,b=u.length-1,i=-1;for(;s<=b;){const k=Math.floor((s+b)/2);u[k]<c.value?(i=u[k],s=k+1):b=k-1}i===-1&&(i=u[u.length-1]),_(i)},F=()=>{const u=N.value;if(u.length===0){U("未找到包含关键字的字幕行");return}let s=0,b=u.length-1,i=-1;for(;s<=b;){const k=Math.floor((s+b)/2);u[k]>c.value?(i=u[k],b=k-1):s=k+1}i===-1&&(i=u[0]),_(i)},q=$(),R=$([]),w=u=>{u instanceof HTMLElement&&R.value.push(u)},c=$(0),g=async()=>{if(!f.player)return;const u=f.player.currentTime,s=V(u),b=n.timeToKey(s),i=n.timeMap.get(b);typeof i=="number"&&i!==c.value&&(c.value=i,await He(),setTimeout(()=>_(i),50))},_=u=>{const s=q.value,b=R.value[u];if(b instanceof HTMLElement&&s){const k=b.offsetTop-s.clientHeight/2;s.scrollTo({top:k,behavior:"smooth"})}},C=$(595),P=$();let L=null;ve(()=>{P.value=document.querySelector(".grid-section.bottom"),P.value&&(L=new ResizeObserver(u=>{for(const s of u){const{height:b}=s.contentRect;C.value=b}}),L.observe(P.value)),f.player.on("timeupdate",g)}),Oe(()=>{L&&P.value&&L.unobserve(P.value),f.player.off("timeupdate",g),R.value=[]}),Ue(()=>n.timelineData,()=>{R.value=[]});const T=async()=>{var u,s;try{const b=(u=f.player)==null?void 0:u.media;if(!(b instanceof HTMLVideoElement)){U("无法获取视频元素");return}const i=document.createElement("canvas");i.width=b.videoWidth,i.height=b.videoHeight;const k=i.getContext("2d");if(!k){Z("无法创建画布上下文");return}k.drawImage(b,0,0,i.width,i.height);const A=i.toDataURL("image/jpeg",.9),Y=document.createElement("a"),se=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);Y.download=`capture_${(s=n.data)==null?void 0:s.id}_${se}.jpg`,Y.href=A,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),X("截图已保存")}catch(b){Z(`截图失败: ${b instanceof Error?b.message:b}`)}};return(u,s)=>{const b=x("Expand"),i=x("el-icon"),k=x("el-button"),A=x("Top"),Y=x("Bottom"),se=x("Camera"),d=x("el-text"),t=x("Minus"),o=x("el-drawer");return B(),Se(o,{modelValue:p(n).open,"onUpdate:modelValue":s[12]||(s[12]=r=>p(n).open=r),direction:"btt",modal:!1,size:C.value,onOpened:s[13]||(s[13]=r=>p(n).shiftSubtitles(0))},{header:l(()=>[D("div",Ze,[e(k,{size:"small",type:p(h).open?"success":"",circle:""},{default:l(()=>[e(i,{onClick:s[0]||(s[0]=r=>p(h).open=!p(h).open)},{default:l(()=>[e(b)]),_:1})]),_:1},8,["type"]),e(k,{onClick:s[1]||(s[1]=r=>p(f).autoPlay=!p(f).autoPlay),type:p(f).autoPlay?"success":"",size:"small",circle:""},{default:l(()=>s[14]||(s[14]=[I("A")])),_:1},8,["type"]),e(k,{size:"small",circle:""},{default:l(()=>[e(i,{onClick:K},{default:l(()=>[e(A)]),_:1})]),_:1}),e(k,{size:"small",circle:""},{default:l(()=>[e(i,{onClick:F},{default:l(()=>[e(Y)]),_:1})]),_:1}),e(k,{size:"small",circle:""},{default:l(()=>[e(i,{onClick:T},{default:l(()=>[e(se)]),_:1})]),_:1}),e(d,{class:"mx-1",type:"warning"},{default:l(()=>{var r;return[I(J((r=p(n).data)==null?void 0:r.id),1)]}),_:1})])]),default:l(()=>[D("div",{class:"timeline-container",ref_key:"containerRef",ref:q},[p(n).loading?(B(),G("div",et,[e(i,{class:"is-loading",color:"#409EFF",size:20},{default:l(()=>[e(p(Pe))]),_:1}),s[15]||(s[15]=D("span",null,"正在加载字幕数据...",-1))])):ke("",!0),(B(!0),G(ce,null,ze(p(n).timelineData,(r,S)=>(B(),G("div",{key:S,class:"timeline-item",ref_for:!0,ref:w},[D("span",tt,J(r.time),1),D("span",{class:Ve(["content-text",{highlight:S==c.value,keyword:E(r.text)}]),onClick:z=>p(f).jumpTo(r.time)},J(r.text),11,lt)]))),128)),!p(n).loading&&p(n).timelineData.length===0?(B(),G("div",nt,[e(i,null,{default:l(()=>[e(p(Ie))]),_:1}),s[16]||(s[16]=D("span",null,"暂无字幕数据",-1))])):ke("",!0)],512)]),footer:l(()=>[D("div",st,[D("div",ot,[e(k,{onClick:s[2]||(s[2]=r=>y(-1e3)),disabled:a.value<=re,size:"small"},{default:l(()=>[e(i,null,{default:l(()=>[e(p(le))]),_:1}),e(i,null,{default:l(()=>[e(p(le))]),_:1}),e(i,null,{default:l(()=>[e(p(le))]),_:1})]),_:1},8,["disabled"]),e(k,{onClick:s[3]||(s[3]=r=>y(-500)),disabled:a.value<=re,size:"small"},{default:l(()=>[e(i,null,{default:l(()=>[e(p(le))]),_:1}),e(i,null,{default:l(()=>[e(p(le))]),_:1})]),_:1},8,["disabled"]),e(k,{onClick:s[4]||(s[4]=r=>y(-50)),disabled:a.value<=re,size:"small"},{default:l(()=>[e(i,null,{default:l(()=>[e(p(le))]),_:1})]),_:1},8,["disabled"]),D("span",{class:"count",onClick:s[5]||(s[5]=r=>a.value=50)},J(a.value),1),e(k,{onClick:s[6]||(s[6]=r=>y(50)),disabled:a.value>=ie,size:"small"},{default:l(()=>[e(i,null,{default:l(()=>[e(p(ne))]),_:1})]),_:1},8,["disabled"]),e(k,{onClick:s[7]||(s[7]=r=>y(500)),disabled:a.value>=ie,size:"small"},{default:l(()=>[e(i,null,{default:l(()=>[e(p(ne))]),_:1}),e(i,null,{default:l(()=>[e(p(ne))]),_:1})]),_:1},8,["disabled"]),e(k,{onClick:s[8]||(s[8]=r=>y(1e3)),disabled:a.value>=ie,size:"small"},{default:l(()=>[e(i,null,{default:l(()=>[e(p(ne))]),_:1}),e(i,null,{default:l(()=>[e(p(ne))]),_:1}),e(i,null,{default:l(()=>[e(p(ne))]),_:1})]),_:1},8,["disabled"])]),D("div",at,[e(k,{onClick:s[9]||(s[9]=r=>p(n).shiftSubtitles(-a.value)),disabled:p(n).shiftCount===0},{default:l(()=>[e(i,null,{default:l(()=>[e(t)]),_:1})]),_:1},8,["disabled"]),D("span",{class:"count",onClick:s[10]||(s[10]=(...r)=>p(n).resetSubtitles&&p(n).resetSubtitles(...r))},J(p(n).shiftCount),1),e(k,{onClick:s[11]||(s[11]=r=>p(n).shiftSubtitles(a.value))},{default:l(()=>[e(i,null,{default:l(()=>[e(p(De))]),_:1})]),_:1})])])]),_:1},8,["modelValue","size"])}}}),it={class:"prompt-controls",style:{display:"flex",gap:"5px",margin:"5px","align-items":"center"}},ct={class:"segment-container"},ut={class:"time-controls"},dt={class:"time-controls"},mt={class:"time-controls"},pt={class:"card-footer"},ft=`
总结上面的对话内容，并参考下面的标题，为上面的对话内容起一个吸睛接地气的标题，同时给出建议标签，标签要每行一个，标题和标签要方便复制：
1、心智阳光健康，本科大二学生，聊天很是投缘，大冰不舍挂断
2、人为什么需要亲密关系？大冰深度分析，看完人都通透了
3、主动要礼物！聊天高端局，“泄露天机”太多，大冰“索要”礼物
4、如何把事情处理得圆润得体？大冰深度教学，家庭职场都受用
5、情侣裂痕是如何产生的？大冰深度分析，值得反复观看
6、光长年龄不长心智是一种什么体验？大冰对话32岁女画师，表现惊掉你下巴
7、颠覆你的认知：如何炼成顶级倾听力？大冰独家分享！带你突破沟通瓶颈！
8、如何把握相处的底层逻辑？大冰深度分析，职场婚姻都受用
9、精神未断奶是一种什么体验？大冰对话女硕士，思维表现大跌眼镜
10、如何克服自我否定的毛病？大冰深度教学，看完终身受益
`,vt=ye({__name:"Picker",setup(v){const n=ae(),f=xe(),h=he(),a=Ke([y()]);function y(){return{id:crypto.randomUUID(),startTime:0,endTime:0,duration:0,isK:!1}}const H=d=>{a.splice(d+1,0,y())},E=d=>{a.length>1&&a.splice(d,1)},N=d=>{if(d>0){const t=a.splice(d,1)[0];a.splice(d-1,0,t)}},K=d=>{if(d<a.length-1){const t=a.splice(d,1)[0];a.splice(d+1,0,t)}};function F(d){if(!n.player)return;const t=n.player.currentTime,o=a[d];o.startTime=t}function q(d){if(!n.player)return;const t=n.player.currentTime,o=a[d];o.endTime=t}function R(d,t){var M;const o=a[d],r=o.isK?"-k":"";let S=(M=n.data)==null?void 0:M.urls[0];if(!S)throw U("请先播放视频"),new Error("请先播放视频");const z=S.match(/\/([^\/]+)\.mp4$/),j=z?z[1]:(()=>{const de=new Date;return`${de.getFullYear()}${(de.getMonth()+1).toString().padStart(2,"0")}${de.getDate().toString().padStart(2,"0")}`})();if(!o.startTime||!o.endTime)throw U("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const Q=V(o.startTime),ee=V(o.endTime),te=Q.replace(/:/g,"."),W=ee.replace(/:/g,".");let m="yt-dlp --no-check-certificate";m=`${m} --concurrent-fragments 16 --throttled-rate 5M `,m=`${m} --download-sections "*${Q}-${ee}"`;const O="~/storage/downloads/Reqable/";return t=="video"&&(m=`${m} --merge-output-format mp4 -o "${O}${j}_${te}-${W}.mp4"`),t=="audio"&&(m=`${m} ${r} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${O}${j}_${te}-${W}.mp3"`),m=`${m} '${S}' `,m}function w(d,t){var O;const o=a[d],r=o.isK?"-k":"";let S=(O=n.data)==null?void 0:O.urls[0];if(!S)throw U("请先播放视频"),new Error("请先播放视频");const z=S.match(/\/([^\/]+)\.mp4$/),j=z?z[1]:(()=>{const M=new Date;return`${M.getFullYear()}${(M.getMonth()+1).toString().padStart(2,"0")}${M.getDate().toString().padStart(2,"0")}`})();if(!o.startTime||!o.endTime)throw U("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const Q=V(o.startTime),ee=V(o.endTime),te=Q.replace(/:/g,"."),W=ee.replace(/:/g,".");let m=`--download-sections "*${Q}-${ee}"`;return t=="video"&&(m=`${m} --merge-output-format mp4 -o "${j}_${te}-${W}.mp4"`),t=="audio"&&(m=`${m} ${r} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${j}_${te}-${W}.mp3"`),m}async function c(){var t;const d=(t=n.data)==null?void 0:t.urls[0];if(!d){U("请先播放视频");return}try{await navigator.clipboard.writeText(d),X(`链接已复制：${d}`)}catch(o){console.error(o),U("复制失败，请手动复制")}}async function g(){var t;const d=(t=n.data)==null?void 0:t.id;if(!d){U("请先播放视频");return}try{await navigator.clipboard.writeText(d),X(`ID已复制：${d}`)}catch(o){console.error(o),U("ID失败，请手动复制")}}async function _(d,t,o){let r="";switch(t){case"dlp":r=R(d,o);break;case"seal":r=w(d,o);break}try{await navigator.clipboard.writeText(r),X(`命令已复制：${r}`)}catch(S){console.error(S),U("复制失败，请手动复制")}}const C=async d=>{const t=[];a.forEach((o,r)=>{console.log(`Index: ${r}`,o),t.push(R(r,d))});try{await navigator.clipboard.writeText(t.join(`
`)),X(`命令已复制：${t.join("<br/>")}`)}catch(o){console.error(o),U("复制失败，请手动复制")}},P=$(!1);async function L(){var z;let d=(z=n.data)==null?void 0:z.urls[0];if(!d){U("请先播放视频");return}const t=d.match(/\/([^\/]+)\.mp4$/),o=t?t[1]:(()=>{const j=new Date;return`${j.getFullYear()}${(j.getMonth()+1).toString().padStart(2,"0")}${j.getDate().toString().padStart(2,"0")}`})(),r=a.filter(j=>j.startTime<j.endTime).map((j,Q)=>`${V(j.startTime)}-${V(j.endTime)}`);if(!r.length){U("请先至少设置一个开始和结束时间");return}const S=`dlp ${P.value?"keep":"delete"} '${d}' ${o} ${r.join(" ")}`;try{T(S),await navigator.clipboard.writeText(S),X(`命令已复制：${S}`)}catch(j){console.error(j),Z(j,"复制失败，请手动复制")}}async function T(d){try{const t=await fetch("http://localhost:8080/run",{method:"POST",headers:{"Content-Type":"text/plain"},body:d});if(!t.ok)throw new Error(`HTTP 错误: ${t.status}`);const r=(await t.json()).task_id;b(r)}catch(t){Z(t,"请求失败: ")}}const u=$(!1),s=$("");function b(d){u.value=!0;const t=setInterval(async()=>{var r;let o="";try{const S=await fetch(`http://localhost:8080/progress/${d}`);if(!S.ok)throw new Error(`进度查询失败: ${S.status}`);const z=await S.json();o=(r=z.recent_log)!=null&&r.length?`

最近日志:
`+z.recent_log.join(`
`):"",z.status==="completed"&&(clearInterval(t),o=`处理完成✅ (状态: ${z.status})${o}`),z.status==="failed"&&(clearInterval(t),o=`处理完成✅ (状态: ${z.status})${o}`)}catch{clearInterval(t),o="监控失败: "}s.value=o},1e3)}const i=$(!1),k=$("情感"),A=$(!1),Y=`
从上面的对话提取有关${k.value}方面的内容，并给出出现的开始时间
`;async function se(d,t){const o=h.getSubtitles(d,t);let r="";o.value.map(S=>{const z=S.time.split(".")[0]+" "+S.text+`
`;r+=z}),r+=i.value?ft:A?Y:"";try{await navigator.clipboard.writeText(r),X(`${o.value.length}条字幕已复制`)}catch(S){console.error(S),U("复制失败，请手动复制")}}return(d,t)=>{const o=x("el-button"),r=x("el-input"),S=x("DocumentCopy"),z=x("el-icon"),j=x("CaretLeft"),Q=x("CaretRight"),ee=x("Minus"),te=x("Plus"),W=x("el-card");return B(),G(ce,null,[pe(e(W,{class:"segment-control-card"},{footer:l(()=>[D("div",pt,[e(o,{size:"small",onClick:c},{default:l(()=>t[17]||(t[17]=[I("链接")])),_:1}),e(o,{size:"small",onClick:g},{default:l(()=>t[18]||(t[18]=[I("ID")])),_:1}),e(o,{size:"small",onClick:L},{default:l(()=>t[19]||(t[19]=[I("下载片段")])),_:1}),e(o,{size:"small",onClick:t[3]||(t[3]=m=>u.value=!u.value)},{default:l(()=>t[20]||(t[20]=[I("日志")])),_:1}),e(o,{size:"small",onClick:t[4]||(t[4]=m=>C("video"))},{default:l(()=>t[21]||(t[21]=[I("复制命令")])),_:1})])]),default:l(()=>[D("div",it,[e(o,{size:"small",type:i.value?"success":"info",onClick:t[0]||(t[0]=m=>{A.value=!1,i.value=!i.value})},{default:l(()=>t[5]||(t[5]=[I("取标题")])),_:1},8,["type"]),e(o,{size:"small",type:A.value?"success":"info",onClick:t[1]||(t[1]=m=>{i.value=!1,A.value=!A.value})},{default:l(()=>t[6]||(t[6]=[I("取内容")])),_:1},8,["type"]),e(r,{size:"small","model-value":k.value,"onUpdate:modelValue":t[2]||(t[2]=m=>k.value=m),disabled:!A.value,style:{flex:"1"}},null,8,["model-value","disabled"])]),D("div",ct,[(B(!0),G(ce,null,ze(a,(m,O)=>(B(),G("div",{key:m.id,class:"segment-item"},[D("div",ut,[e(o,{type:"primary",size:"small",onClick:M=>_(O,"seal","audio")},{default:l(()=>t[7]||(t[7]=[I("SA")])),_:2},1032,["onClick"]),e(o,{type:"primary",size:"small",onClick:M=>_(O,"seal","video")},{default:l(()=>t[8]||(t[8]=[I("SV")])),_:2},1032,["onClick"]),e(o,{type:"primary",size:"small",onClick:M=>_(O,"dlp","audio")},{default:l(()=>t[9]||(t[9]=[I("DA")])),_:2},1032,["onClick"]),e(o,{type:"primary",size:"small",onClick:M=>_(O,"dlp","video")},{default:l(()=>t[10]||(t[10]=[I("DV")])),_:2},1032,["onClick"]),e(r,{"model-value":p(h).secondsToTime(m.endTime-m.startTime),size:"small",readonly:""},null,8,["model-value"]),e(o,{size:"small",type:m.isK?"success":"info",onClick:M=>m.isK=!m.isK},{default:l(()=>[I(J(m.isK?"k开":"k关"),1)]),_:2},1032,["type","onClick"]),e(o,{size:"small",type:"success",onClick:M=>se(m.startTime,m.endTime)},{default:l(()=>[e(z,null,{default:l(()=>[e(S)]),_:1})]),_:2},1032,["onClick"])]),D("div",dt,[e(o,{type:"success",size:"small",onClick:M=>F(O)},{default:l(()=>t[11]||(t[11]=[I("S")])),_:2},1032,["onClick"]),e(o,{type:"success",size:"small",onClick:M=>p(n).jumpTo(p(V)(m.startTime))},{default:l(()=>t[12]||(t[12]=[I("J")])),_:2},1032,["onClick"]),e(o,{type:"success",size:"small",onClick:M=>m.startTime=m.startTime-.5},{default:l(()=>[e(z,null,{default:l(()=>[e(j)]),_:1})]),_:2},1032,["onClick"]),e(o,{type:"success",size:"small",onClick:M=>m.startTime=m.startTime+.5},{default:l(()=>[e(z,null,{default:l(()=>[e(Q)]),_:1})]),_:2},1032,["onClick"]),e(r,{"model-value":p(V)(m.startTime),size:"small",readonly:""},null,8,["model-value"]),e(o,{size:"small",onClick:M=>N(O),disabled:O===0||a.length===1},{default:l(()=>t[13]||(t[13]=[I("↑")])),_:2},1032,["onClick","disabled"]),e(o,{size:"small",onClick:M=>E(O),disabled:a.length===1},{default:l(()=>[e(z,null,{default:l(()=>[e(ee)]),_:1})]),_:2},1032,["onClick","disabled"])]),D("div",mt,[e(o,{type:"danger",size:"small",onClick:M=>q(O)},{default:l(()=>t[14]||(t[14]=[I("E")])),_:2},1032,["onClick"]),e(o,{type:"danger",size:"small",onClick:M=>p(n).jumpTo(p(V)(m.endTime))},{default:l(()=>t[15]||(t[15]=[I("J")])),_:2},1032,["onClick"]),e(o,{type:"danger",size:"small",onClick:M=>m.endTime=m.endTime-.5},{default:l(()=>[e(z,null,{default:l(()=>[e(j)]),_:1})]),_:2},1032,["onClick"]),e(o,{type:"danger",size:"small",onClick:M=>m.endTime=m.endTime+.5},{default:l(()=>[e(z,null,{default:l(()=>[e(Q)]),_:1})]),_:2},1032,["onClick"]),e(r,{type:"danger","model-value":p(V)(m.endTime),size:"small",readonly:""},null,8,["model-value"]),e(o,{size:"small",onClick:M=>K(O),disabled:O===a.length-1||a.length===1},{default:l(()=>t[16]||(t[16]=[I("↓")])),_:2},1032,["onClick","disabled"]),e(o,{size:"small",onClick:M=>H(O)},{default:l(()=>[e(z,null,{default:l(()=>[e(te)]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1},512),[[we,p(f).open]]),pe(e(W,{class:"log-card",style:{"max-width":"480px","z-index":"1000000 !important"}},{default:l(()=>[D("p",null,J(s.value),1)]),_:1},512),[[we,u.value]])],64)}}}),Ee=(v,n)=>{const f=v.__vccOpts||v;for(const[h,a]of n)f[h]=a;return f},Ce=Ee(vt,[["__scopeId","data-v-64f9de3e"]]),yt={__name:"App",setup(v){return ae(),(n,f)=>{const h=x("el-col"),a=x("el-row"),y=x("el-container");return B(),G(ce,null,[e(Ce),e(y,{style:{height:"100vh"}},{default:l(()=>[e(a,{class:"grid-container"},{default:l(()=>[e(h,{class:"grid-section top"},{default:l(()=>[e(Ye)]),_:1}),e(h,{class:"grid-section bottom"},{default:l(()=>[e(Xe),e(rt),e(Ce)]),_:1})]),_:1})]),_:1})],64)}}},gt=Ee(yt,[["__scopeId","data-v-d44e3bc6"]]),ue=Re(gt);ue.use(Ne());ue.use(Me);for(const[v,n]of Object.entries(je))ue.component(v,n);ue.mount("#app");
