import{E as Z,i as ce}from"./element-plus-CRGBzuq5.js";import{f as V,g as H,B as de,l as fe,w as pe,Q as me}from"./@element-plus-By79ymwD.js";import{r as _,j as Q,c as R,o as L,a as C,M as O,u as p,d as G,k as ee,ag as x,aq as ve,I as te,G as K,H as n,P as e,L as N,Q as _e,a6 as le,O as se,S as ye,w as ge,J as X,D as he,n as be,at as we}from"./@vue-C01xNfPK.js";import{d as W,c as ke}from"./pinia-CKuVeK4o.js";import{P as Se}from"./plyr-CZIZ1zVJ.js";import{H as J}from"./hls.js-DWnTp5j0.js";import{f as Y}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const v of s)if(v.type==="childList")for(const y of v.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&o(y)}).observe(document,{childList:!0,subtree:!0});function r(s){const v={};return s.integrity&&(v.integrity=s.integrity),s.referrerPolicy&&(v.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?v.credentials="include":s.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function o(s){if(s.ep)return;s.ep=!0;const v=r(s);fetch(s.href,v)}})();const U=W("player",()=>{const d=_(""),l=_(null),r=_(null),o=_(null),s=_(null),v=_(null),y=b=>{l.value=new Se(b,{hideControls:!1,controls:["play-large","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},E=b=>{s.value=b,d.value=b.date;const a=b.urls[0],m={type:"video",sources:[{src:a,type:z(a)}]};D(m).then(()=>{var f;return(f=l.value)==null?void 0:f.play()})},z=b=>b.includes(".m3u8")?"application/x-mpegURL":b.includes(".flv")?"video/x-flv":"video/mp4",D=async b=>{var m,f,u;(m=r.value)==null||m.destroy(),r.value=null,(f=o.value)==null||f.destroy(),o.value=null;const a=b.sources[0].src.includes(".m3u8")?"hls":b.sources[0].src.includes(".flv")?"flv":"html5";try{a!==v.value&&await((u=l.value)==null?void 0:u.stop()),l.value.source=b,a==="hls"&&J.isSupported()?await $(b.sources[0].src):a==="flv"&&Y.isSupported()&&await I(b.sources[0].src),v.value=a}catch(h){console.error("源切换失败:",h)}},$=async b=>new Promise(a=>{r.value=new J,r.value.loadSource(b),r.value.attachMedia(l.value.media),r.value.on(J.Events.MANIFEST_PARSED,a)}),I=async b=>{o.value=Y.createPlayer({type:"flv",url:b}),o.value.attachMediaElement(l.value.media),o.value.load(),await o.value.play()};return{player:l,initPlayer:y,switchSource:D,playStream:E,title:d,data:s}}),Ce={class:"video-wrapper"},Te={class:"title"},xe={class:"plyr-container"},$e={__name:"Player",setup(d){const l=U(),r=_(null);return Q(()=>{l.initPlayer(r.value)}),(o,s)=>(L(),R("div",Ce,[C("h3",Te,O(p(l).title),1),C("div",xe,[C("video",{class:"player",ref_key:"videoRef",ref:r,playsinline:""},null,512)])]))}};function Me(d,l="未知错误"){if(d instanceof Error)return d.message;if(typeof d=="string")return d;if(typeof d=="object"&&d!==null&&"message"in d&&typeof d.message=="string")return d.message;try{return JSON.stringify(d)}catch{return l}}function j(d,l){const r=Me(d),o=l?`${l}: ${r}`:r;Z.error({message:o,offset:600,duration:3e3})}function Pe(d){Z.success({message:d,offset:600,duration:3e3})}const ne=W("editor",()=>{const d=_(!1),l=_(!1),r=_(""),o=_(null),s=_(0),v=f=>{l.value=!0,o.value=f,r.value=f.date,m()},y=_([]),E=f=>{try{const[u,h]=f.split("."),[S,M,g]=u.split(":").map(Number),P=h?parseInt(h.padEnd(3,"0")):0;return S*3600+M*60+g+P/1e3}catch{return 0}},z=f=>{const u=Math.round(f%1*1e3),h=Math.floor(f),S=Math.floor(h/3600),M=Math.floor(h%3600/60),g=h%60;return`${String(S).padStart(2,"0")}:${String(M).padStart(2,"0")}:${String(g).padStart(2,"0")}.${String(u).padStart(3,"0")}`},D=f=>{try{const[u,h]=f.split("."),[S,M,g]=u.split(":").map(Number);return S*3600+M*60+g}catch(u){console.error(u)}},$=_(new Map),I=()=>{$.value.clear(),y.value.forEach((f,u)=>{try{const h=D(f.time);$.value.has(h)||$.value.set(h,u)}catch(h){console.error(`错误处理时间戳 ${f.time}（索引 ${u}）: ${h}`)}})},b=f=>{if(!y.value)return;const u=s.value+f;s.value=Math.max(u,0);const h=f/1e3;y.value=y.value.map(S=>{const g=E(S.time)+h;return{...S,time:z(Math.max(g,0))}}),I()},a=()=>{if(y.value){if(s.value){const f=s.value/1e3;y.value=y.value.map(u=>{const S=E(u.time)-f;return{...u,time:z(Math.max(S,0))}})}s.value=0,I()}},m=async()=>{var f;d.value=!0;try{const u=await fetch(`srts/${(f=o.value)==null?void 0:f.id}`);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);if(y.value=await u.json(),s.value){const h=s.value/1e3;y.value=y.value.map(S=>{const g=E(S.time)+h;return{...S,time:z(Math.max(g,0))}})}I()}catch(u){console.error("数据获取失败:",u),j(u,"字幕数据加载失败，请稍后重试"),y.value=[]}finally{d.value=!1}};return{open:l,title:r,edit:v,data:o,timelineData:y,loading:d,shiftCount:s,shiftSubtitles:b,timeToSeconds:E,secondsToTime:z,resetSubtitles:a,timeMap:$,timeToKey:D}}),Ee=(d,l)=>{const r=d.__vccOpts||d;for(const[o,s]of l)r[o]=s;return r},ze=["onClick"],De=["onClick"],Le={style:{display:"flex",gap:"0","justify-content":"flex-end"}},Ie=G({__name:"Playlist",setup(d){const l=U(),r=ne(),o=_(""),s=_(!0),v=_([]),y=async()=>{try{const a=await fetch("video.json");if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);v.value=await a.json()}catch(a){j(a,"数据加载失败")}finally{s.value=!1}},E=ee(()=>{const a=o.value.toLowerCase();return v.value.filter(m=>m.id.toLowerCase().includes(a)||m.date.toLowerCase().includes(a))}),z=async a=>{var m;((m=a.urls)==null?void 0:m.length)>0?await $(a.urls[0],"链接已复制到剪贴板","链接复制失败"):j("该记录没有可用的链接")},D=async a=>{a.id?await $(a.id,"ID已复制到剪贴板","ID复制失败"):j("该记录没有可用的ID")},$=async(a,m,f)=>{try{await navigator.clipboard.writeText(a),Pe(m)}catch(u){j(u,f)}},I=a=>{var m;(m=a.urls)!=null&&m.length&&(a.urls[0],l.playStream(a),r.edit(a))},b=a=>{var m;(m=a.urls)!=null&&m.length&&(a.urls[0],l.playStream(a))};return Q(()=>{y()}),(a,m)=>{const f=x("el-table-column"),u=x("el-input"),h=x("el-button"),S=x("el-table"),M=ve("loading");return te((L(),K(S,{data:E.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:n(()=>[e(f,{fixed:"",label:"日期",prop:"date",sortable:"",width:"140"},{default:n(g=>[C("span",{class:"clickable-text",onClick:P=>z(g.row)},O(g.row.date),9,ze)]),_:1}),e(f,{fixed:"",label:"标识",prop:"id",width:"180"},{default:n(g=>[C("span",{class:"clickable-text",onClick:P=>D(g.row)},O(g.row.id),9,De)]),_:1}),e(f,{fixed:"right",align:"right",width:"115"},{header:n(()=>[e(u,{modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=g=>o.value=g),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:n(g=>{var P,i;return[C("div",Le,[e(h,{size:"small",onClick:t=>I(g.row),disabled:!((P=g.row.urls)!=null&&P.length)},{default:n(()=>m[1]||(m[1]=[N(" 编辑 ")])),_:2},1032,["onClick","disabled"]),e(h,{size:"small",onClick:t=>b(g.row),disabled:!((i=g.row.urls)!=null&&i.length)},{default:n(()=>m[2]||(m[2]=[N(" 播放 ")])),_:2},1032,["onClick","disabled"])])]}),_:1})]),_:1},8,["data"])),[[M,s.value]])}}}),oe=W("picker",()=>{const d=_(!1),l=_(!1),r=_("");return _(null),_(0),{open:l,title:r,loading:d}}),Oe={style:{display:"flex",gap:"0","justify-content":"center"}},je=G({__name:"Picker",setup(d){const l=oe();return(r,o)=>{const s=x("el-button"),v=x("el-card");return te((L(),K(v,{style:{"max-width":"480px"}},{footer:n(()=>[C("div",Oe,[e(s,{size:"small",onClick:o[0]||(o[0]=()=>{})},{default:n(()=>o[3]||(o[3]=[N(" 加行 ")])),_:1}),e(s,{size:"small",onClick:o[1]||(o[1]=()=>{})},{default:n(()=>o[4]||(o[4]=[N(" 下载 ")])),_:1}),e(s,{size:"small",onClick:o[2]||(o[2]=()=>{})},{default:n(()=>o[5]||(o[5]=[N(" 复制 ")])),_:1})])]),default:n(()=>[(L(),R(se,null,le(40,y=>C("p",{key:y,class:"text item"},O("List item "+y),1)),64))]),_:1},512)),[[_e,p(l).open]])}}}),Ne={style:{display:"flex",gap:"0","justify-content":"flex-start"}},Ve={key:0,class:"loading-state"},He={class:"time-label"},Re=["onClick"],Ae={key:1,class:"empty-state"},Be={class:"footer-container"},Fe={class:"time-shift-controls"},Ke={class:"time-shift-controls"},B=50,F=5e3,Ue=G({__name:"Editor",setup(d){const l=ne(),r=U(),o=oe(),s=_(1e3),v=i=>{const t=s.value+i;s.value=Math.max(B,Math.min(F,t))},y=_(!1),E=i=>{const t=l.timeToSeconds(i);if(r.player&&t>0)try{r.player.currentTime=t,y.value?r.player.play():r.player.pause()}catch(T){j(T,"跳转播放失败，请检查播放器状态")}},z=_(["你好","晚上好","拜拜","再见"]),D=i=>z.value.some(t=>i.includes(t)),$=ee(()=>l.timelineData.map((i,t)=>({text:i.text,index:t})).filter(({text:i})=>D(i)).map(({index:i})=>i).sort((i,t)=>i-t)),I=()=>{const i=$.value;if(i.length===0){j("未找到包含关键字的字幕行");return}let t=0,T=i.length-1,c=-1;for(;t<=T;){const w=Math.floor((t+T)/2);i[w]<u.value?(c=i[w],t=w+1):T=w-1}c===-1&&(c=i[i.length-1]),S(c)},b=()=>{const i=$.value;if(i.length===0){j("未找到包含关键字的字幕行");return}let t=0,T=i.length-1,c=-1;for(;t<=T;){const w=Math.floor((t+T)/2);i[w]>u.value?(c=i[w],T=w-1):t=w+1}c===-1&&(c=i[0]),S(c)},a=_(),m=_([]),f=i=>{i instanceof HTMLElement&&m.value.push(i)},u=_(0),h=async()=>{if(!r.player)return;const i=r.player.currentTime,t=l.secondsToTime(i),T=l.timeToKey(t),c=l.timeMap.get(T);typeof c=="number"&&c!==u.value&&(u.value=c,await be(),setTimeout(()=>S(c),50))},S=i=>{const t=a.value,T=m.value[i];if(T instanceof HTMLElement&&t){const w=T.offsetTop-t.clientHeight/2;t.scrollTo({top:w,behavior:"smooth"})}},M=_(595),g=_();let P=null;return Q(()=>{g.value=document.querySelector(".grid-section.bottom"),g.value&&(P=new ResizeObserver(i=>{for(const t of i){const{height:T}=t.contentRect;M.value=T}}),P.observe(g.value)),r.player.on("timeupdate",h)}),ye(()=>{P&&g.value&&P.unobserve(g.value),r.player.off("timeupdate",h),m.value=[]}),ge(()=>l.timelineData,()=>{m.value=[]}),(i,t)=>{const T=x("Expand"),c=x("el-icon"),w=x("el-button"),ae=x("Top"),ie=x("Bottom"),re=x("Minus"),ue=x("el-drawer");return L(),K(ue,{modelValue:p(l).open,"onUpdate:modelValue":t[12]||(t[12]=k=>p(l).open=k),direction:"btt",modal:!1,size:M.value,onOpened:t[13]||(t[13]=k=>p(l).shiftSubtitles(0))},{header:n(()=>{var k;return[C("div",Ne,[e(w,{size:"small",type:p(o).open?"success":"",circle:""},{default:n(()=>[e(c,{onClick:t[0]||(t[0]=A=>p(o).open=!p(o).open)},{default:n(()=>[e(T)]),_:1})]),_:1},8,["type"]),e(w,{onClick:t[1]||(t[1]=A=>y.value=!y.value),type:y.value?"success":"",size:"small",circle:""},{default:n(()=>t[14]||(t[14]=[N("A")])),_:1},8,["type"]),e(w,{size:"small",circle:""},{default:n(()=>[e(c,{onClick:I},{default:n(()=>[e(ae)]),_:1})]),_:1}),e(w,{size:"small",circle:""},{default:n(()=>[e(c,{onClick:b},{default:n(()=>[e(ie)]),_:1})]),_:1}),N(" "+O((k=p(l).data)==null?void 0:k.id),1)])]}),default:n(()=>[e(je),C("div",{class:"timeline-container",ref_key:"containerRef",ref:a},[p(l).loading?(L(),R("div",Ve,[e(c,{class:"is-loading",color:"#409EFF",size:20},{default:n(()=>[e(p(fe))]),_:1}),t[15]||(t[15]=C("span",null,"正在加载字幕数据...",-1))])):X("",!0),(L(!0),R(se,null,le(p(l).timelineData,(k,A)=>(L(),R("div",{key:A,class:"timeline-item",ref_for:!0,ref:f},[C("span",He,O(k.time),1),C("span",{class:he(["content-text",{highlight:A==u.value,keyword:D(k.text)}]),onClick:Qe=>E(k.time)},O(k.text),11,Re)]))),128)),!p(l).loading&&p(l).timelineData.length===0?(L(),R("div",Ae,[e(c,null,{default:n(()=>[e(p(pe))]),_:1}),t[16]||(t[16]=C("span",null,"暂无字幕数据",-1))])):X("",!0)],512)]),footer:n(()=>[C("div",Be,[C("div",Fe,[e(w,{onClick:t[2]||(t[2]=k=>v(-1e3)),disabled:s.value<=B,size:"small"},{default:n(()=>[e(c,null,{default:n(()=>[e(p(V))]),_:1}),e(c,null,{default:n(()=>[e(p(V))]),_:1}),e(c,null,{default:n(()=>[e(p(V))]),_:1})]),_:1},8,["disabled"]),e(w,{onClick:t[3]||(t[3]=k=>v(-500)),disabled:s.value<=B,size:"small"},{default:n(()=>[e(c,null,{default:n(()=>[e(p(V))]),_:1}),e(c,null,{default:n(()=>[e(p(V))]),_:1})]),_:1},8,["disabled"]),e(w,{onClick:t[4]||(t[4]=k=>v(-50)),disabled:s.value<=B,size:"small"},{default:n(()=>[e(c,null,{default:n(()=>[e(p(V))]),_:1})]),_:1},8,["disabled"]),C("span",{class:"count",onClick:t[5]||(t[5]=k=>s.value=50)},O(s.value),1),e(w,{onClick:t[6]||(t[6]=k=>v(50)),disabled:s.value>=F,size:"small"},{default:n(()=>[e(c,null,{default:n(()=>[e(p(H))]),_:1})]),_:1},8,["disabled"]),e(w,{onClick:t[7]||(t[7]=k=>v(500)),disabled:s.value>=F,size:"small"},{default:n(()=>[e(c,null,{default:n(()=>[e(p(H))]),_:1}),e(c,null,{default:n(()=>[e(p(H))]),_:1})]),_:1},8,["disabled"]),e(w,{onClick:t[8]||(t[8]=k=>v(1e3)),disabled:s.value>=F,size:"small"},{default:n(()=>[e(c,null,{default:n(()=>[e(p(H))]),_:1}),e(c,null,{default:n(()=>[e(p(H))]),_:1}),e(c,null,{default:n(()=>[e(p(H))]),_:1})]),_:1},8,["disabled"])]),C("div",Ke,[e(w,{onClick:t[9]||(t[9]=k=>p(l).shiftSubtitles(-s.value)),disabled:p(l).shiftCount===0},{default:n(()=>[e(c,null,{default:n(()=>[e(re)]),_:1})]),_:1},8,["disabled"]),C("span",{class:"count",onClick:t[10]||(t[10]=(...k)=>p(l).resetSubtitles&&p(l).resetSubtitles(...k))},O(p(l).shiftCount),1),e(w,{onClick:t[11]||(t[11]=k=>p(l).shiftSubtitles(s.value))},{default:n(()=>[e(c,null,{default:n(()=>[e(p(de))]),_:1})]),_:1})])])]),_:1},8,["modelValue","size"])}}}),qe={__name:"App",setup(d){return U(),(l,r)=>{const o=x("el-col"),s=x("el-row"),v=x("el-container");return L(),K(v,{style:{height:"100vh"}},{default:n(()=>[e(s,{class:"grid-container"},{default:n(()=>[e(o,{class:"grid-section top"},{default:n(()=>[e($e)]),_:1}),e(o,{class:"grid-section bottom"},{default:n(()=>[e(Ie),e(Ue)]),_:1})]),_:1})]),_:1})}}},Je=Ee(qe,[["__scopeId","data-v-6dd2b251"]]),q=we(Je);q.use(ke());q.use(ce);for(const[d,l]of Object.entries(me))q.component(d,l);q.mount("#app");
