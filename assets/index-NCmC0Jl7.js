import{E as de,i as xe}from"./element-plus-DRLPWQh5.js";import{B as ze,l as Ee,w as De,Q as Me,R as Pe,S as Ie}from"./@element-plus-Dp6MuveI.js";import{r as _,j as pe,c as ee,o as Q,a as I,M as J,u as g,d as me,k as Ce,ag as E,aq as je,I as ue,G as be,H as l,P as t,L as z,S as Le,w as Ve,J as $e,O as se,a6 as Te,D as Oe,n as Ue,X as He,Q as he,at as Ke}from"./@vue-C01xNfPK.js";import{d as fe,c as Re}from"./pinia-CKuVeK4o.js";import{P as Ne}from"./plyr-CZIZ1zVJ.js";import{H as ie}from"./hls.js-DWnTp5j0.js";import{f as ke}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))v(i);new MutationObserver(i=>{for(const $ of i)if($.type==="childList")for(const L of $.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&v(L)}).observe(document,{childList:!0,subtree:!0});function c(i){const $={};return i.integrity&&($.integrity=i.integrity),i.referrerPolicy&&($.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?$.credentials="include":i.crossOrigin==="anonymous"?$.credentials="omit":$.credentials="same-origin",$}function v(i){if(i.ep)return;i.ep=!0;const $=c(i);fetch(i.href,$)}})();function Ae(p,s="未知错误"){if(p instanceof Error)return p.message;if(typeof p=="string")return p;if(typeof p=="object"&&p!==null&&"message"in p&&typeof p.message=="string")return p.message;try{return JSON.stringify(p)}catch{return s}}const ve={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},ye=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function te(p,s){const c=Ae(p),v=s?`${s}: ${c}`:c;de.error({...ve,message:`
    <div ${ye}>
      ${v}
    </div>
    `})}function H(p){de.error({...ve,message:`
    <div ${ye}>
      ${p}
    </div>
    `})}function Z(p){de.success({...ve,message:`
    <div ${ye}>
      ${p}
    </div>
    `})}const ne=p=>{try{const[s,c]=p.split("."),[v,i,$]=s.split(":").map(Number),L=c?parseInt(c.padEnd(3,"0")):0;return v*3600+i*60+$+L/1e3}catch{return 0}},K=p=>{const s=Math.round(p%1*1e3),c=Math.floor(p),v=Math.floor(c/3600),i=Math.floor(c%3600/60),$=c%60;return`${String(v).padStart(2,"0")}:${String(i).padStart(2,"0")}:${String($).padStart(2,"0")}.${String(s).padStart(3,"0")}`},le=fe("player",()=>{const p=_(""),s=_(null),c=_(null),v=_(null),i=_(null),$=_(null),L=a=>{s.value=new Ne(a,{hideControls:!1,controls:["play","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},D=a=>{A(a,!0)},q=a=>{A(a,!1)},A=(a,y)=>{i.value=a,p.value=a.date;const M=a.urls[0],U={type:"video",sources:[{src:M,type:F(M)}]};G(U).then(()=>{var m;y&&((m=s.value)==null||m.play())})},F=a=>a.includes(".m3u8")?"application/x-mpegURL":a.includes(".flv")?"video/x-flv":"video/mp4",G=async a=>{var M,U,m;(M=c.value)==null||M.destroy(),c.value=null,(U=v.value)==null||U.destroy(),v.value=null;const y=a.sources[0].src.includes(".m3u8")?"hls":a.sources[0].src.includes(".flv")?"flv":"html5";try{y!==$.value&&await((m=s.value)==null?void 0:m.stop()),s.value.source=a,y==="hls"&&ie.isSupported()?await W(a.sources[0].src):y==="flv"&&ke.isSupported()&&await h(a.sources[0].src),$.value=y}catch(O){console.error("源切换失败:",O)}},W=async a=>new Promise(y=>{c.value=new ie,c.value.loadSource(a),c.value.attachMedia(s.value.media),c.value.on(ie.Events.MANIFEST_PARSED,y)}),h=async a=>{v.value=ke.createPlayer({type:"flv",url:a}),v.value.attachMediaElement(s.value.media),v.value.load(),await v.value.play()},w=_(!1);return{player:s,initPlayer:L,switchSource:G,playStream:D,switchStream:q,title:p,data:i,autoPlay:w,jumpTo:a=>{const y=ne(a);if(s.value&&y>0)try{s.value.currentTime=y,w.value?s.value.play():s.value.pause()}catch(M){te(M,"跳转播放失败，请检查播放器状态")}}}}),Fe={class:"video-wrapper"},Be={class:"title"},qe={class:"plyr-container"},Je={__name:"Player",setup(p){const s=le(),c=_(null);return pe(()=>{s.initPlayer(c.value)}),(v,i)=>(Q(),ee("div",Fe,[I("h3",Be,J(g(s).title),1),I("div",qe,[I("video",{class:"player",ref_key:"videoRef",ref:c,playsinline:""},null,512)])]))}},ge=fe("editor",()=>{const p=_(!1),s=_(!1),c=_(""),v=_(null),i=5e3,$=_(i),L=S=>{s.value=!0,v.value=S,c.value=S.date,h()},D=_([]),q=S=>{try{const[a,y]=S.split("."),[M,U,m]=a.split(":").map(Number);return M*3600+U*60+m}catch(a){console.error(a)}},A=_(new Map),F=()=>{A.value.clear(),D.value.forEach((S,a)=>{try{const y=q(S.time);A.value.has(y)||A.value.set(y,a)}catch(y){console.error(`错误处理时间戳 ${S.time}（索引 ${a}）: ${y}`)}})},G=S=>{if(!D.value)return;const a=$.value+S;$.value=Math.max(a,0);const y=S/1e3;D.value=D.value.map(M=>{const m=ne(M.time)+y;return{...M,time:K(Math.max(m,0))}}),F()},W=()=>{if(!D.value)return;const a=($.value-i)/1e3;D.value=D.value.map(y=>{const U=ne(y.time)-a;return{...y,time:K(Math.max(U,0))}}),$.value=i,F()},h=async()=>{var S;p.value=!0;try{const a=await fetch(`srts/${(S=v.value)==null?void 0:S.id}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);D.value=await a.json();const y=$.value/1e3;D.value=D.value.map(M=>{const m=ne(M.time)+y;return{...M,time:K(Math.max(m,0))}}),F()}catch(a){console.error("数据获取失败:",a),te(a,"字幕数据加载失败，请稍后重试"),D.value=[]}finally{p.value=!1}};return{open:s,title:c,edit:L,data:v,timelineData:D,loading:p,shiftCount:$,shiftSubtitles:G,timeToSeconds:ne,secondsToTime:K,resetSubtitles:W,timeMap:A,timeToKey:q,getSubtitles:(S,a)=>{var f;const y=_([]);if(!((f=D.value)!=null&&f.length))return console.error("时间轴数据未加载"),y;const M=q(K(S)),U=q(K(a)),m=A.value.get(M),O=A.value.get(U);if(typeof m!="number"||typeof O!="number")return console.error("无法匹配有效的时间段"),y;const Y=Math.max(0,m),d=Math.min(D.value.length-1,O),[n,C]=Y<=d?[Y,d]:[d,Y];return y.value=D.value.slice(n,C+1),y}}}),Ye=["onClick"],Qe=["onClick"],Ge=["onClick"],We={style:{display:"flex",gap:"0","justify-content":"flex-end"}},Xe=me({__name:"Playlist",setup(p){const s=le(),c=ge(),v=_(""),i=_(!0),$=_([]),L=async()=>{try{const h=await fetch("video.json");if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);$.value=await h.json()}catch(h){te(h,"数据加载失败")}finally{i.value=!1}},D=Ce(()=>{const h=v.value.toLowerCase();return $.value.filter(w=>w.id.toLowerCase().includes(h)||w.date.toLowerCase().includes(h))}),q=async h=>{var w;((w=h.urls)==null?void 0:w.length)>0?await F(h.urls[0],"链接已复制到剪贴板","链接复制失败"):H("该记录没有可用的链接")},A=async h=>{h.id?await F(h.id,"ID已复制到剪贴板","ID复制失败"):H("该记录没有可用的ID")},F=async(h,w,S)=>{try{await navigator.clipboard.writeText(h),Z(w)}catch(a){te(a,S)}},G=h=>{var w;(w=h.urls)!=null&&w.length&&(h.urls[0],s.switchStream(h),c.edit(h))},W=h=>{var w;(w=h.urls)!=null&&w.length&&(h.urls[0],s.playStream(h))};return pe(()=>{L()}),(h,w)=>{const S=E("el-table-column"),a=E("el-input"),y=E("el-button"),M=E("el-table"),U=je("loading");return ue((Q(),be(M,{data:D.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:l(()=>[t(S,{fixed:"",label:"序号",width:"40"},{default:l(m=>[I("span",{class:"column-text",onClick:O=>A(m.row)},J((m.$index+1).toString().padStart(4,"0")),9,Ye)]),_:1}),t(S,{fixed:"",label:"日期",prop:"date",sortable:"",width:"130"},{default:l(m=>[I("span",{class:"column-text clickable-text",onClick:O=>q(m.row)},J(m.row.date),9,Qe)]),_:1}),t(S,{fixed:"",label:"ID",prop:"id",width:"180"},{default:l(m=>[I("span",{class:"column-text clickable-text",onClick:O=>A(m.row)},J(m.row.id),9,Ge)]),_:1}),t(S,{fixed:"right",align:"right",width:"115"},{header:l(()=>[t(a,{modelValue:v.value,"onUpdate:modelValue":w[0]||(w[0]=m=>v.value=m),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:l(m=>{var O,Y;return[I("div",We,[t(y,{plain:"",size:"small",onClick:d=>G(m.row),type:m.row.hasSrt?"success":"warning",disabled:!m.row.hasSrt},{default:l(()=>w[1]||(w[1]=[z(" 切片 ")])),_:2},1032,["onClick","type","disabled"]),t(y,{plain:"",size:"small",onClick:d=>W(m.row),type:(O=m.row.urls)!=null&&O.length?"success":"warning",disabled:!((Y=m.row.urls)!=null&&Y.length)},{default:l(()=>w[2]||(w[2]=[z(" 播放 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[U,i.value]])}}}),_e=(p,s)=>{const c=p.__vccOpts||p;for(const[v,i]of s)c[v]=i;return c},Ze=_e(Xe,[["__scopeId","data-v-e9ca9c48"]]),Se=fe("picker",()=>{const p=_(!1),s=_(!1),c=_("");return _(null),_(0),{open:s,title:c,loading:p}}),et={style:{display:"flex",gap:"0","justify-content":"flex-start"}},tt={key:0,class:"loading-state"},nt={class:"srt-time"},lt=["onClick"],st={key:1,class:"empty-state"},ot={class:"footer-container"},at={class:"time-shift-controls"},it={class:"time-shift-controls"},rt={class:"time-shift-controls"},re=100,ce=5e3,ct=me({__name:"Editor",setup(p){const s=ge(),c=le(),v=Se(),i=_(!1),$=()=>{c.player&&(c.player.playing?c.player.pause():c.player.play())},L=_(1e3),D=d=>{const n=L.value+d;L.value=Math.max(re,Math.min(ce,n))},q=_(["你好","晚上好","拜拜","再见"]),A=d=>q.value.some(n=>d.includes(n)),F=Ce(()=>s.timelineData.map((d,n)=>({text:d.text,index:n})).filter(({text:d})=>A(d)).map(({index:d})=>d).sort((d,n)=>d-n)),G=()=>{const d=F.value;if(d.length===0){H("未找到包含关键字的字幕行");return}let n=0,C=d.length-1,f=-1;for(;n<=C;){const b=Math.floor((n+C)/2);d[b]<a.value?(f=d[b],n=b+1):C=b-1}f===-1&&(f=d[d.length-1]),M(f)},W=()=>{const d=F.value;if(d.length===0){H("未找到包含关键字的字幕行");return}let n=0,C=d.length-1,f=-1;for(;n<=C;){const b=Math.floor((n+C)/2);d[b]>a.value?(f=d[b],C=b-1):n=b+1}f===-1&&(f=d[0]),M(f)},h=_(),w=_([]),S=d=>{d instanceof HTMLElement&&w.value.push(d)},a=_(0),y=async d=>{const n=K(d),C=s.timeToKey(n),f=s.timeMap.get(C);typeof f=="number"&&f!==a.value&&(a.value=f,await Ue(),setTimeout(()=>M(f),50))},M=d=>{const n=h.value,C=w.value[d];if(C instanceof HTMLElement&&n){const b=C.offsetTop-n.clientHeight/2;n.scrollTo({top:b,behavior:"smooth"})}},U=_(595),m=_();let O=null;pe(()=>{m.value=document.querySelector(".grid-section.bottom"),m.value&&(O=new ResizeObserver(d=>{for(const n of d){const{height:C}=n.contentRect;U.value=C}}),O.observe(m.value)),c.player.on("timeupdate",()=>{y(c.player.currentTime)}),c.player.on("play",()=>{i.value=!0}),c.player.on("pause",()=>{i.value=!1})}),Le(()=>{O&&m.value&&O.unobserve(m.value),c.player.off("timeupdate",y),w.value=[]}),Ve(()=>s.timelineData,()=>{w.value=[]});const Y=async()=>{var d,n;try{const C=(d=c.player)==null?void 0:d.media;if(!(C instanceof HTMLVideoElement)){H("无法获取视频元素");return}const f=document.createElement("canvas");f.width=C.videoWidth,f.height=C.videoHeight;const b=f.getContext("2d");if(!b){te("无法创建画布上下文");return}b.drawImage(C,0,0,f.width,f.height);const r=f.toDataURL("image/jpeg",.9),e=document.createElement("a"),o=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);e.download=`capture_${(n=s.data)==null?void 0:n.id}_${o}.jpg`,e.href=r,document.body.appendChild(e),e.click(),document.body.removeChild(e),Z("截图已保存")}catch(C){te(`截图失败: ${C instanceof Error?C.message:C}`)}};return(d,n)=>{const C=E("Camera"),f=E("el-icon"),b=E("el-button"),r=E("el-text"),e=E("Top"),o=E("Bottom"),T=E("el-space"),j=E("el-affix"),x=E("Expand"),P=E("Minus"),R=E("el-drawer");return Q(),be(R,{modelValue:g(s).open,"onUpdate:modelValue":n[10]||(n[10]=k=>g(s).open=k),direction:"btt",modal:!1,size:U.value,onOpened:n[11]||(n[11]=k=>g(s).shiftSubtitles(0))},{header:l(()=>[I("div",et,[t(b,{onClick:Y,size:"small",circle:""},{default:l(()=>[t(f,null,{default:l(()=>[t(C)]),_:1})]),_:1}),t(r,{class:"mx-1",type:"warning"},{default:l(()=>{var k,B;return[z(J((k=g(s).data)==null?void 0:k.date)+" - "+J((B=g(s).data)==null?void 0:B.id),1)]}),_:1})])]),default:l(()=>[I("div",{class:"timeline-container",ref_key:"containerRef",ref:h},[g(s).loading?(Q(),ee("div",tt,[t(f,{class:"is-loading",color:"#409EFF",size:20},{default:l(()=>[t(g(Ee))]),_:1}),n[12]||(n[12]=I("span",null,"正在加载字幕数据...",-1))])):$e("",!0),(Q(!0),ee(se,null,Te(g(s).timelineData,(k,B)=>(Q(),ee("div",{key:B,class:"timeline-item",ref_for:!0,ref:S},[I("span",nt,J(k.time),1),I("span",{class:Oe(["srt-text",{highlight:B==a.value,keyword:A(k.text)}]),onClick:X=>{y(g(ne)(k.time)),g(c).jumpTo(k.time)}},J(k.text),11,lt)]))),128)),!g(s).loading&&g(s).timelineData.length===0?(Q(),ee("div",st,[t(f,null,{default:l(()=>[t(g(De))]),_:1}),n[13]||(n[13]=I("span",null,"暂无字幕数据",-1))])):$e("",!0)],512),t(j,{class:"floating-btn",position:"bottom",offset:200},{default:l(()=>[t(T,{direction:"vertical"},{default:l(()=>[t(b,{onClick:n[0]||(n[0]=k=>g(c).autoPlay=!g(c).autoPlay),type:g(c).autoPlay?"success":""},{default:l(()=>[t(f,null,{default:l(()=>n[14]||(n[14]=[z("A")])),_:1})]),_:1},8,["type"]),t(b,{onClick:G},{default:l(()=>[t(f,null,{default:l(()=>[t(e)]),_:1})]),_:1}),t(b,{onClick:W},{default:l(()=>[t(f,null,{default:l(()=>[t(o)]),_:1})]),_:1}),t(b,{onClick:$,icon:i.value?g(Me):g(Pe)},null,8,["icon"])]),_:1})]),_:1})]),footer:l(()=>[I("div",ot,[I("div",at,[t(b,{size:"small",type:g(v).open?"success":""},{default:l(()=>[t(f,{onClick:n[1]||(n[1]=k=>g(v).open=!g(v).open)},{default:l(()=>[t(x)]),_:1})]),_:1},8,["type"])]),I("div",it,[t(b,{onClick:n[2]||(n[2]=k=>g(s).shiftSubtitles(-L.value)),disabled:g(s).shiftCount===0,size:"small"},{default:l(()=>[t(f,null,{default:l(()=>[t(P)]),_:1})]),_:1},8,["disabled"]),I("span",{class:"count",onClick:n[3]||(n[3]=(...k)=>g(s).resetSubtitles&&g(s).resetSubtitles(...k))},J(g(s).shiftCount),1),t(b,{onClick:n[4]||(n[4]=k=>g(s).shiftSubtitles(L.value)),size:"small"},{default:l(()=>[t(f,null,{default:l(()=>[t(g(ze))]),_:1})]),_:1})]),I("div",rt,[t(b,{plain:"",type:"danger",onClick:n[5]||(n[5]=k=>D(-1e3)),disabled:L.value<=re,size:"small"},{default:l(()=>n[15]||(n[15]=[z(" <<1000 ")])),_:1},8,["disabled"]),t(b,{plain:"",type:"danger",onClick:n[6]||(n[6]=k=>D(-100)),disabled:L.value<=re,size:"small"},{default:l(()=>n[16]||(n[16]=[z(" <100 ")])),_:1},8,["disabled"]),I("span",{class:"count",onClick:n[7]||(n[7]=k=>L.value=1e3)},J(L.value),1),t(b,{plain:"",type:"success",onClick:n[8]||(n[8]=k=>D(100)),disabled:L.value>=ce,size:"small"},{default:l(()=>n[17]||(n[17]=[z(" 100> ")])),_:1},8,["disabled"]),t(b,{plain:"",type:"success",onClick:n[9]||(n[9]=k=>D(1e3)),disabled:L.value>=ce,size:"small"},{default:l(()=>n[18]||(n[18]=[z(" 1000>> ")])),_:1},8,["disabled"])])])]),_:1},8,["modelValue","size"])}}}),ut={class:"prompt-controls",style:{display:"flex",gap:"5px",margin:"5px","align-items":"center"}},dt={class:"segment-container"},pt={class:"time-controls"},mt={class:"time-controls"},ft={class:"time-controls"},vt={class:"card-footer"},yt=`
总结上面的对话内容，并参考下面的标题以及高点击率标题核心公式，运用马斯洛需求层次理论，为上面的对话内容起一个容易引起讨论的标题，不能夸大其词，不能包含不实内容，同时给出建议标签，标签要每行一个，标题和标签要方便复制：
一、参考标题
1、心智阳光健康，本科大二学生，聊天很是投缘，大冰不舍挂断
2、人为什么需要亲密关系？大冰深度分析，看完人都通透了
3、主动要礼物！聊天高端局，“泄露天机”太多，大冰“索要”礼物
4、如何把事情处理得圆润得体？大冰深度教学，家庭职场都受用
5、情侣裂痕是如何产生的？大冰深度分析，值得反复观看
6、光长年龄不长心智是一种什么体验？大冰对话32岁女画师，表现惊掉你下巴
7、颠覆你的认知：如何炼成顶级倾听力？大冰独家分享！带你突破沟通瓶颈！
8、如何把握相处的底层逻辑？大冰深度分析，职场婚姻都受用
9、精神未断奶是一种什么体验？大冰对话女硕士，思维表现大跌眼镜
10、如何克服自我否定的毛病？大冰深度教学，看完终身受益
二、高点击率标题核心公式
1、数字+痛点/利益
例：《月薪3千到3万，她靠这5个理财技巧逆袭，第3点人人可复制》。
2、疑问句+悬念
例：《为何日本核污水排海后，欧美集体沉默？背后真相远超想象》。
3、热点绑定+情绪词
例：《全网震怒！某顶流明星偷税细节曝光，经纪人一句话惹怒全网》。
4、挑战常识+颠覆认知
例：《喝粥不养胃！协和医生警告：这3种“健康习惯”反而致癌》。
5、本地化+紧迫感
例：《北京人注意！这趟地铁线路将停运3个月，明天起实施》。
`,gt=`
对以上内容进出场景划分，每个场景都以“你好/晚上好”等类似问候语开始，以“拜拜/再见/下一位”等类似问候语结束，请总结每个场景的大概内容，取一个吸睛炸裂的标题，并给每个场景的开始和结束始时间
`,_t=me({__name:"Picker",setup(p){const s=le(),c=Se(),v=ge(),i=He([$()]);function $(){return{id:crypto.randomUUID(),startTime:0,endTime:0,duration:0,isK:!1}}const L=r=>{i.splice(r+1,0,$())},D=r=>{i.length>1&&i.splice(r,1)},q=r=>{if(r>0){const e=i.splice(r,1)[0];i.splice(r-1,0,e)}},A=r=>{if(r<i.length-1){const e=i.splice(r,1)[0];i.splice(r+1,0,e)}};function F(r){if(!s.player)return;const e=s.player.currentTime,o=i[r];o.startTime=e}function G(r){if(!s.player)return;const e=s.player.currentTime,o=i[r];o.endTime=e}function W(r,e){var V;const o=i[r],T=o.isK?"-k":"";let j=(V=s.data)==null?void 0:V.urls[0];if(!j)throw H("请先播放视频"),new Error("请先播放视频");const x=j.match(/\/([^\/]+)\.mp4$/),P=x?x[1]:(()=>{const ae=new Date;return`${ae.getFullYear()}${(ae.getMonth()+1).toString().padStart(2,"0")}${ae.getDate().toString().padStart(2,"0")}`})();if(!o.startTime||!o.endTime)throw H("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const R=K(o.startTime),k=K(o.endTime),B=R.replace(/:/g,"."),X=k.replace(/:/g,".");let u="yt-dlp --no-check-certificate";u=`${u} --concurrent-fragments 16 --throttled-rate 5M `,u=`${u} --download-sections "*${R}-${k}"`;const N="~/storage/downloads/Reqable/";return e=="video"&&(u=`${u} --merge-output-format mp4 -o "${N}${P}_${B}-${X}.mp4"`),e=="audio"&&(u=`${u} ${T} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${N}${P}_${B}-${X}.mp3"`),u=`${u} '${j}' `,u}function h(r,e){var N;const o=i[r],T=o.isK?"-k":"";let j=(N=s.data)==null?void 0:N.urls[0];if(!j)throw H("请先播放视频"),new Error("请先播放视频");const x=j.match(/\/([^\/]+)\.mp4$/),P=x?x[1]:(()=>{const V=new Date;return`${V.getFullYear()}${(V.getMonth()+1).toString().padStart(2,"0")}${V.getDate().toString().padStart(2,"0")}`})();if(!o.startTime||!o.endTime)throw H("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const R=K(o.startTime),k=K(o.endTime),B=R.replace(/:/g,"."),X=k.replace(/:/g,".");let u=`--download-sections "*${R}-${k}"`;return e=="video"&&(u=`${u} --merge-output-format mp4 -o "${P}_${B}-${X}.mp4"`),e=="audio"&&(u=`${u} ${T} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${P}_${B}-${X}.mp3"`),u}async function w(){var e;const r=(e=s.data)==null?void 0:e.urls[0];if(!r){H("请先播放视频");return}try{await navigator.clipboard.writeText(r),Z(`链接已复制：${r}`)}catch(o){console.error(o),H("复制失败，请手动复制")}}async function S(){var e;const r=(e=s.data)==null?void 0:e.id;if(!r){H("请先播放视频");return}try{await navigator.clipboard.writeText(r),Z(`ID已复制：${r}`)}catch(o){console.error(o),H("ID失败，请手动复制")}}async function a(r,e,o){let T="";switch(e){case"dlp":T=W(r,o);break;case"seal":T=h(r,o);break}try{await navigator.clipboard.writeText(T),Z(`命令已复制：${T}`)}catch(j){console.error(j),H("复制失败，请手动复制")}}const y=async r=>{const e=[];i.forEach((o,T)=>{console.log(`Index: ${T}`,o),e.push(W(T,r))});try{await navigator.clipboard.writeText(e.join(`
`)),Z(`命令已复制：${e.join("<br/>")}`)}catch(o){console.error(o),H("复制失败，请手动复制")}},M=_(!1);async function U(){var x;let r=(x=s.data)==null?void 0:x.urls[0];if(!r){H("请先播放视频");return}const e=r.match(/\/([^\/]+)\.mp4$/),o=e?e[1]:(()=>{const P=new Date;return`${P.getFullYear()}${(P.getMonth()+1).toString().padStart(2,"0")}${P.getDate().toString().padStart(2,"0")}`})(),T=i.filter(P=>P.startTime<P.endTime).map((P,R)=>`${K(P.startTime)}-${K(P.endTime)}`);if(!T.length){H("请先至少设置一个开始和结束时间");return}const j=`dlp ${M.value?"keep":"delete"} '${r}' ${o} ${T.join(" ")}`;try{m(j),await navigator.clipboard.writeText(j),Z(`命令已复制：${j}`)}catch(P){console.error(P),te(P,"复制失败，请手动复制")}}async function m(r){try{const e=await fetch("http://localhost:8080/run",{method:"POST",headers:{"Content-Type":"text/plain"},body:r});if(!e.ok)throw new Error(`HTTP 错误: ${e.status}`);const T=(await e.json()).task_id;d(T)}catch(e){te(e,"请求失败: ")}}const O=_(!1),Y=_("");function d(r){O.value=!0;const e=setInterval(async()=>{var T;let o="";try{const j=await fetch(`http://localhost:8080/progress/${r}`);if(!j.ok)throw new Error(`进度查询失败: ${j.status}`);const x=await j.json();o=(T=x.recent_log)!=null&&T.length?`

最近日志:
`+x.recent_log.join(`
`):"",x.status==="completed"&&(clearInterval(e),o=`处理完成✅ (状态: ${x.status})${o}`),x.status==="failed"&&(clearInterval(e),o=`处理完成✅ (状态: ${x.status})${o}`)}catch{clearInterval(e),o="监控失败: "}Y.value=o},1e3)}const n=_(""),C=_("情感");async function f(r){n.value=r}async function b(r,e){var x,P;const o=n.value;if(o==="info"){let R=`${(x=v.data)==null?void 0:x.date}-${(P=v.data)==null?void 0:P.id} ${K(r)}-${K(e)}`;try{await navigator.clipboard.writeText(R),Z("切片信息已复制")}catch(k){console.error(k),H("复制失败，请手动复制")}return}const T=v.getSubtitles(r,e);let j="";T.value.map(R=>{const k=R.time.split(".")[0]+" "+R.text+`
`;j+=k}),j+=o=="title"?yt:o=="target"?gt.replace("_P_",C.value):"";try{await navigator.clipboard.writeText(j),Z(`${T.value.length}条字幕已复制`)}catch(R){console.error(R),H("复制失败，请手动复制")}}return(r,e)=>{const o=E("el-button"),T=E("el-input"),j=E("DocumentCopy"),x=E("el-icon"),P=E("CaretLeft"),R=E("CaretRight"),k=E("Plus"),B=E("Minus"),X=E("el-card");return Q(),ee(se,null,[ue(t(X,{class:"segment-control-card"},{footer:l(()=>[I("div",vt,[t(o,{plain:"",type:"success",size:"small",onClick:U},{default:l(()=>e[19]||(e[19]=[z("下载片段")])),_:1}),t(o,{plain:"",type:O.value?"warning":"primary",size:"small",onClick:e[4]||(e[4]=u=>O.value=!O.value)},{default:l(()=>e[20]||(e[20]=[z("显示日志")])),_:1},8,["type"]),t(o,{plain:"",type:"success",size:"small",onClick:w},{default:l(()=>e[21]||(e[21]=[z("复制链接")])),_:1}),t(o,{plain:"",type:"success",size:"small",onClick:S},{default:l(()=>e[22]||(e[22]=[z("复制ID")])),_:1}),t(o,{plain:"",type:"success",size:"small",onClick:e[5]||(e[5]=u=>y("video"))},{default:l(()=>e[23]||(e[23]=[z("复制命令")])),_:1})])]),default:l(()=>[I("div",ut,[t(o,{size:"small",type:n.value==="info"?"success":"info",onClick:e[0]||(e[0]=u=>f("info"))},{default:l(()=>e[6]||(e[6]=[z("取信息")])),_:1},8,["type"]),t(o,{size:"small",type:n.value==="title"?"success":"info",onClick:e[1]||(e[1]=u=>f("title"))},{default:l(()=>e[7]||(e[7]=[z("取标题")])),_:1},8,["type"]),t(o,{size:"small",type:n.value==="target"?"success":"info",onClick:e[2]||(e[2]=u=>f("target"))},{default:l(()=>e[8]||(e[8]=[z("取内容")])),_:1},8,["type"]),t(T,{size:"small",modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=u=>C.value=u),disabled:n.value!=="target",style:{flex:"1"}},null,8,["modelValue","disabled"])]),I("div",dt,[(Q(!0),ee(se,null,Te(i,(u,N)=>(Q(),ee("div",{key:u.id,class:"segment-item"},[I("div",pt,[t(o,{plain:"",type:"primary",size:"small",onClick:V=>a(N,"seal","audio")},{default:l(()=>e[9]||(e[9]=[z("SA")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"primary",size:"small",onClick:V=>a(N,"seal","video")},{default:l(()=>e[10]||(e[10]=[z("SV")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"primary",size:"small",onClick:V=>a(N,"dlp","audio")},{default:l(()=>e[11]||(e[11]=[z("DA")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"primary",size:"small",onClick:V=>a(N,"dlp","video")},{default:l(()=>e[12]||(e[12]=[z("DV")])),_:2},1032,["onClick"]),t(T,{"model-value":g(v).secondsToTime(u.endTime-u.startTime),size:"small",readonly:""},null,8,["model-value"]),t(o,{plain:"",size:"small",type:u.isK?"success":"info",onClick:V=>u.isK=!u.isK},{default:l(()=>[z(J(u.isK?"k开":"k关"),1)]),_:2},1032,["type","onClick"]),t(o,{plain:"",size:"small",type:"success",onClick:V=>b(u.startTime,u.endTime)},{default:l(()=>[t(x,null,{default:l(()=>[t(j)]),_:1})]),_:2},1032,["onClick"])]),I("div",mt,[t(o,{plain:"",type:"success",size:"small",onClick:V=>F(N)},{default:l(()=>e[13]||(e[13]=[z("S")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"success",size:"small",onClick:V=>g(s).jumpTo(g(K)(u.startTime))},{default:l(()=>e[14]||(e[14]=[z("J")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"success",size:"small",onClick:V=>u.startTime=u.startTime-.5},{default:l(()=>[t(x,null,{default:l(()=>[t(P)]),_:1})]),_:2},1032,["onClick"]),t(o,{plain:"",type:"success",size:"small",onClick:V=>u.startTime=u.startTime+.5},{default:l(()=>[t(x,null,{default:l(()=>[t(R)]),_:1})]),_:2},1032,["onClick"]),t(T,{"model-value":g(K)(u.startTime),size:"small",readonly:""},null,8,["model-value"]),t(o,{plain:"",size:"small",onClick:V=>q(N),disabled:N===0||i.length===1},{default:l(()=>e[15]||(e[15]=[z("↑")])),_:2},1032,["onClick","disabled"]),t(o,{plain:"",type:"success",size:"small",onClick:V=>L(N)},{default:l(()=>[t(x,null,{default:l(()=>[t(k)]),_:1})]),_:2},1032,["onClick"])]),I("div",ft,[t(o,{plain:"",type:"danger",size:"small",onClick:V=>G(N)},{default:l(()=>e[16]||(e[16]=[z("E")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"danger",size:"small",onClick:V=>g(s).jumpTo(g(K)(u.endTime))},{default:l(()=>e[17]||(e[17]=[z("J")])),_:2},1032,["onClick"]),t(o,{plain:"",type:"danger",size:"small",onClick:V=>u.endTime=u.endTime-.5},{default:l(()=>[t(x,null,{default:l(()=>[t(P)]),_:1})]),_:2},1032,["onClick"]),t(o,{plain:"",type:"danger",size:"small",onClick:V=>u.endTime=u.endTime+.5},{default:l(()=>[t(x,null,{default:l(()=>[t(R)]),_:1})]),_:2},1032,["onClick"]),t(T,{type:"danger","model-value":g(K)(u.endTime),size:"small",readonly:""},null,8,["model-value"]),t(o,{plain:"",size:"small",onClick:V=>A(N),disabled:N===i.length-1||i.length===1},{default:l(()=>e[18]||(e[18]=[z("↓")])),_:2},1032,["onClick","disabled"]),t(o,{plain:"",type:"danger",size:"small",onClick:V=>D(N),disabled:i.length===1},{default:l(()=>[t(x,null,{default:l(()=>[t(B)]),_:1})]),_:2},1032,["onClick","disabled"])])]))),128))])]),_:1},512),[[he,g(c).open]]),ue(t(X,{class:"log-card",style:{"max-width":"480px","z-index":"1000000 !important"}},{default:l(()=>[I("p",null,J(Y.value),1)]),_:1},512),[[he,O.value]])],64)}}}),we=_e(_t,[["__scopeId","data-v-6fe82cf9"]]),$t={__name:"App",setup(p){return le(),(s,c)=>{const v=E("el-col"),i=E("el-row"),$=E("el-container");return Q(),ee(se,null,[t(we),t($,{style:{height:"100vh"}},{default:l(()=>[t(i,{class:"grid-container"},{default:l(()=>[t(v,{class:"grid-section top"},{default:l(()=>[t(Je)]),_:1}),t(v,{class:"grid-section bottom"},{default:l(()=>[t(Ze),t(ct),t(we)]),_:1})]),_:1})]),_:1})],64)}}},ht=_e($t,[["__scopeId","data-v-d44e3bc6"]]),oe=Ke(ht);oe.use(Re());oe.use(xe);for(const[p,s]of Object.entries(Ie))oe.component(p,s);oe.mount("#app");
