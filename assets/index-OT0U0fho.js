import{E as pe,i as Ee}from"./element-plus-CRGBzuq5.js";import{f as le,g as ne,B as Me,l as De,w as Pe,Q as Ie}from"./@element-plus-By79ymwD.js";import{r as $,j as fe,c as G,o as B,a as D,M as J,u as p,d as ve,k as Ce,ag as x,aq as je,I as me,G as Te,H as l,P as e,L as j,S as Le,w as Ve,J as he,O as ie,a6 as Se,D as Oe,n as Ue,X as He,Q as ke,at as Ke}from"./@vue-C01xNfPK.js";import{d as ye,c as Re}from"./pinia-CKuVeK4o.js";import{P as Ne}from"./plyr-CZIZ1zVJ.js";import{H as de}from"./hls.js-DWnTp5j0.js";import{f as we}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))h(a);new MutationObserver(a=>{for(const y of a)if(y.type==="childList")for(const H of y.addedNodes)H.tagName==="LINK"&&H.rel==="modulepreload"&&h(H)}).observe(document,{childList:!0,subtree:!0});function f(a){const y={};return a.integrity&&(y.integrity=a.integrity),a.referrerPolicy&&(y.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?y.credentials="include":a.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function h(a){if(a.ep)return;a.ep=!0;const y=f(a);fetch(a.href,y)}})();function Ae(v,n="未知错误"){if(v instanceof Error)return v.message;if(typeof v=="string")return v;if(typeof v=="object"&&v!==null&&"message"in v&&typeof v.message=="string")return v.message;try{return JSON.stringify(v)}catch{return n}}const ge={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},_e=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function Z(v,n){const f=Ae(v),h=n?`${n}: ${f}`:f;pe.error({...ge,message:`
    <div ${_e}>
      ${h}
    </div>
    `})}function O(v){pe.error({...ge,message:`
    <div ${_e}>
      ${v}
    </div>
    `})}function X(v){pe.success({...ge,message:`
    <div ${_e}>
      ${v}
    </div>
    `})}const se=v=>{try{const[n,f]=v.split("."),[h,a,y]=n.split(":").map(Number),H=f?parseInt(f.padEnd(3,"0")):0;return h*3600+a*60+y+H/1e3}catch{return 0}},U=v=>{const n=Math.round(v%1*1e3),f=Math.floor(v),h=Math.floor(f/3600),a=Math.floor(f%3600/60),y=f%60;return`${String(h).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String(y).padStart(2,"0")}.${String(n).padStart(3,"0")}`},oe=ye("player",()=>{const v=$(""),n=$(null),f=$(null),h=$(null),a=$(null),y=$(null),H=i=>{n.value=new Ne(i,{hideControls:!1,controls:["play-large","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},E=i=>{a.value=i,v.value=i.date;const g=i.urls[0],_={type:"video",sources:[{src:g,type:N(g)}]};K(_).then(()=>{var C;return(C=n.value)==null?void 0:C.play()})},N=i=>i.includes(".m3u8")?"application/x-mpegURL":i.includes(".flv")?"video/x-flv":"video/mp4",K=async i=>{var _,C,P;(_=f.value)==null||_.destroy(),f.value=null,(C=h.value)==null||C.destroy(),h.value=null;const g=i.sources[0].src.includes(".m3u8")?"hls":i.sources[0].src.includes(".flv")?"flv":"html5";try{g!==y.value&&await((P=n.value)==null?void 0:P.stop()),n.value.source=i,g==="hls"&&de.isSupported()?await F(i.sources[0].src):g==="flv"&&we.isSupported()&&await q(i.sources[0].src),y.value=g}catch(L){console.error("源切换失败:",L)}},F=async i=>new Promise(g=>{f.value=new de,f.value.loadSource(i),f.value.attachMedia(n.value.media),f.value.on(de.Events.MANIFEST_PARSED,g)}),q=async i=>{h.value=we.createPlayer({type:"flv",url:i}),h.value.attachMediaElement(n.value.media),h.value.load(),await h.value.play()},R=$(!1);return{player:n,initPlayer:H,switchSource:K,playStream:E,title:v,data:a,autoPlay:R,jumpTo:i=>{const g=se(i);if(n.value&&g>0)try{n.value.currentTime=g,R.value?n.value.play():n.value.pause()}catch(_){Z(_,"跳转播放失败，请检查播放器状态")}}}}),Fe={class:"video-wrapper"},Be={class:"title"},qe={class:"plyr-container"},Je={__name:"Player",setup(v){const n=oe(),f=$(null);return fe(()=>{n.initPlayer(f.value)}),(h,a)=>(B(),G("div",Fe,[D("h3",Be,J(p(n).title),1),D("div",qe,[D("video",{class:"player",ref_key:"videoRef",ref:f,playsinline:""},null,512)])]))}},$e=ye("editor",()=>{const v=$(!1),n=$(!1),f=$(""),h=$(null),a=5e3,y=$(a),H=g=>{n.value=!0,h.value=g,f.value=g.date,w()},E=$([]),N=g=>{try{const[_,C]=g.split("."),[P,L,z]=_.split(":").map(Number);return P*3600+L*60+z}catch(_){console.error(_)}},K=$(new Map),F=()=>{K.value.clear(),E.value.forEach((g,_)=>{try{const C=N(g.time);K.value.has(C)||K.value.set(C,_)}catch(C){console.error(`错误处理时间戳 ${g.time}（索引 ${_}）: ${C}`)}})},q=g=>{if(!E.value)return;const _=y.value+g;y.value=Math.max(_,0);const C=g/1e3;E.value=E.value.map(P=>{const z=se(P.time)+C;return{...P,time:U(Math.max(z,0))}}),F()},R=()=>{if(!E.value)return;const _=(y.value-a)/1e3;E.value=E.value.map(C=>{const L=se(C.time)-_;return{...C,time:U(Math.max(L,0))}}),y.value=a,F()},w=async()=>{var g;v.value=!0;try{const _=await fetch(`srts/${(g=h.value)==null?void 0:g.id}`);if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);E.value=await _.json();const C=y.value/1e3;E.value=E.value.map(P=>{const z=se(P.time)+C;return{...P,time:U(Math.max(z,0))}}),F()}catch(_){console.error("数据获取失败:",_),Z(_,"字幕数据加载失败，请稍后重试"),E.value=[]}finally{v.value=!1}};return{open:n,title:f,edit:H,data:h,timelineData:E,loading:v,shiftCount:y,shiftSubtitles:q,timeToSeconds:se,secondsToTime:U,resetSubtitles:R,timeMap:K,timeToKey:N,getSubtitles:(g,_)=>{var A;const C=$([]);if(!((A=E.value)!=null&&A.length))return console.error("时间轴数据未加载"),C;const P=N(U(g)),L=N(U(_)),z=K.value.get(P),c=K.value.get(L);if(typeof z!="number"||typeof c!="number")return console.error("无法匹配有效的时间段"),C;const s=Math.max(0,z),b=Math.min(E.value.length-1,c),[r,k]=s<=b?[s,b]:[b,s];return C.value=E.value.slice(r,k+1),C}}}),Ye=["onClick"],Qe=["onClick"],Ge={style:{display:"flex",gap:"0","justify-content":"flex-end"}},We=ve({__name:"Playlist",setup(v){const n=oe(),f=$e(),h=$(""),a=$(!0),y=$([]),H=async()=>{try{const w=await fetch("video.json");if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);y.value=await w.json()}catch(w){Z(w,"数据加载失败")}finally{a.value=!1}},E=Ce(()=>{const w=h.value.toLowerCase();return y.value.filter(i=>i.id.toLowerCase().includes(w)||i.date.toLowerCase().includes(w))}),N=async w=>{var i;((i=w.urls)==null?void 0:i.length)>0?await F(w.urls[0],"链接已复制到剪贴板","链接复制失败"):O("该记录没有可用的链接")},K=async w=>{w.id?await F(w.id,"ID已复制到剪贴板","ID复制失败"):O("该记录没有可用的ID")},F=async(w,i,g)=>{try{await navigator.clipboard.writeText(w),X(i)}catch(_){Z(_,g)}},q=w=>{var i;(i=w.urls)!=null&&i.length&&(w.urls[0],n.playStream(w),f.edit(w))},R=w=>{var i;(i=w.urls)!=null&&i.length&&(w.urls[0],n.playStream(w))};return fe(()=>{H()}),(w,i)=>{const g=x("el-table-column"),_=x("el-input"),C=x("el-button"),P=x("el-table"),L=je("loading");return me((B(),Te(P,{data:E.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:l(()=>[e(g,{fixed:"",label:"日期",prop:"date",sortable:"",width:"140"},{default:l(z=>[D("span",{class:"clickable-text",onClick:c=>N(z.row)},J(z.row.date),9,Ye)]),_:1}),e(g,{fixed:"",label:"标识",prop:"id",width:"180"},{default:l(z=>[D("span",{class:"clickable-text",onClick:c=>K(z.row)},J(z.row.id),9,Qe)]),_:1}),e(g,{fixed:"right",align:"right",width:"115"},{header:l(()=>[e(_,{modelValue:h.value,"onUpdate:modelValue":i[0]||(i[0]=z=>h.value=z),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:l(z=>{var c,s;return[D("div",Ge,[e(C,{plain:"",size:"small",onClick:b=>q(z.row),type:z.row.hasSrt?"success":"warning",disabled:!z.row.hasSrt},{default:l(()=>i[1]||(i[1]=[j(" 切片 ")])),_:2},1032,["onClick","type","disabled"]),e(C,{plain:"",size:"small",onClick:b=>R(z.row),type:(c=z.row.urls)!=null&&c.length?"success":"warning",disabled:!((s=z.row.urls)!=null&&s.length)},{default:l(()=>i[2]||(i[2]=[j(" 播放 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[L,a.value]])}}}),ze=ye("picker",()=>{const v=$(!1),n=$(!1),f=$("");return $(null),$(0),{open:n,title:f,loading:v}}),Xe={style:{display:"flex",gap:"0","justify-content":"flex-start"}},Ze={key:0,class:"loading-state"},et={class:"time-label"},tt=["onClick"],lt={key:1,class:"empty-state"},nt={class:"footer-container"},st={class:"time-shift-controls"},ot={class:"time-shift-controls"},ae=50,re=5e3,at=ve({__name:"Editor",setup(v){const n=$e(),f=oe(),h=ze(),a=$(1e3),y=c=>{const s=a.value+c;a.value=Math.max(ae,Math.min(re,s))},H=$(["你好","晚上好","拜拜","再见"]),E=c=>H.value.some(s=>c.includes(s)),N=Ce(()=>n.timelineData.map((c,s)=>({text:c.text,index:s})).filter(({text:c})=>E(c)).map(({index:c})=>c).sort((c,s)=>c-s)),K=()=>{const c=N.value;if(c.length===0){O("未找到包含关键字的字幕行");return}let s=0,b=c.length-1,r=-1;for(;s<=b;){const k=Math.floor((s+b)/2);c[k]<i.value?(r=c[k],s=k+1):b=k-1}r===-1&&(r=c[c.length-1]),_(r)},F=()=>{const c=N.value;if(c.length===0){O("未找到包含关键字的字幕行");return}let s=0,b=c.length-1,r=-1;for(;s<=b;){const k=Math.floor((s+b)/2);c[k]>i.value?(r=c[k],b=k-1):s=k+1}r===-1&&(r=c[0]),_(r)},q=$(),R=$([]),w=c=>{c instanceof HTMLElement&&R.value.push(c)},i=$(0),g=async()=>{if(!f.player)return;const c=f.player.currentTime,s=U(c),b=n.timeToKey(s),r=n.timeMap.get(b);typeof r=="number"&&r!==i.value&&(i.value=r,await Ue(),setTimeout(()=>_(r),50))},_=c=>{const s=q.value,b=R.value[c];if(b instanceof HTMLElement&&s){const k=b.offsetTop-s.clientHeight/2;s.scrollTo({top:k,behavior:"smooth"})}},C=$(595),P=$();let L=null;fe(()=>{P.value=document.querySelector(".grid-section.bottom"),P.value&&(L=new ResizeObserver(c=>{for(const s of c){const{height:b}=s.contentRect;C.value=b}}),L.observe(P.value)),f.player.on("timeupdate",g)}),Le(()=>{L&&P.value&&L.unobserve(P.value),f.player.off("timeupdate",g),R.value=[]}),Ve(()=>n.timelineData,()=>{R.value=[]});const z=async()=>{var c,s;try{const b=(c=f.player)==null?void 0:c.media;if(!(b instanceof HTMLVideoElement)){O("无法获取视频元素");return}const r=document.createElement("canvas");r.width=b.videoWidth,r.height=b.videoHeight;const k=r.getContext("2d");if(!k){Z("无法创建画布上下文");return}k.drawImage(b,0,0,r.width,r.height);const A=r.toDataURL("image/jpeg",.9),Y=document.createElement("a"),d=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);Y.download=`capture_${(s=n.data)==null?void 0:s.id}_${d}.jpg`,Y.href=A,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),X("截图已保存")}catch(b){Z(`截图失败: ${b instanceof Error?b.message:b}`)}};return(c,s)=>{const b=x("Expand"),r=x("el-icon"),k=x("el-button"),A=x("Top"),Y=x("Bottom"),d=x("Camera"),t=x("el-text"),o=x("Minus"),T=x("el-drawer");return B(),Te(T,{modelValue:p(n).open,"onUpdate:modelValue":s[12]||(s[12]=u=>p(n).open=u),direction:"btt",modal:!1,size:C.value,onOpened:s[13]||(s[13]=u=>p(n).shiftSubtitles(0))},{header:l(()=>[D("div",Xe,[e(k,{size:"small",type:p(h).open?"success":"",circle:""},{default:l(()=>[e(r,{onClick:s[0]||(s[0]=u=>p(h).open=!p(h).open)},{default:l(()=>[e(b)]),_:1})]),_:1},8,["type"]),e(k,{onClick:s[1]||(s[1]=u=>p(f).autoPlay=!p(f).autoPlay),type:p(f).autoPlay?"success":"",size:"small",circle:""},{default:l(()=>s[14]||(s[14]=[j("A")])),_:1},8,["type"]),e(k,{size:"small",circle:""},{default:l(()=>[e(r,{onClick:K},{default:l(()=>[e(A)]),_:1})]),_:1}),e(k,{size:"small",circle:""},{default:l(()=>[e(r,{onClick:F},{default:l(()=>[e(Y)]),_:1})]),_:1}),e(k,{size:"small",circle:""},{default:l(()=>[e(r,{onClick:z},{default:l(()=>[e(d)]),_:1})]),_:1}),e(t,{class:"mx-1",type:"warning"},{default:l(()=>{var u;return[j(J((u=p(n).data)==null?void 0:u.id),1)]}),_:1})])]),default:l(()=>[D("div",{class:"timeline-container",ref_key:"containerRef",ref:q},[p(n).loading?(B(),G("div",Ze,[e(r,{class:"is-loading",color:"#409EFF",size:20},{default:l(()=>[e(p(De))]),_:1}),s[15]||(s[15]=D("span",null,"正在加载字幕数据...",-1))])):he("",!0),(B(!0),G(ie,null,Se(p(n).timelineData,(u,S)=>(B(),G("div",{key:S,class:"timeline-item",ref_for:!0,ref:w},[D("span",et,J(u.time),1),D("span",{class:Oe(["content-text",{highlight:S==i.value,keyword:E(u.text)}]),onClick:I=>p(f).jumpTo(u.time)},J(u.text),11,tt)]))),128)),!p(n).loading&&p(n).timelineData.length===0?(B(),G("div",lt,[e(r,null,{default:l(()=>[e(p(Pe))]),_:1}),s[16]||(s[16]=D("span",null,"暂无字幕数据",-1))])):he("",!0)],512)]),footer:l(()=>[D("div",nt,[D("div",st,[e(k,{onClick:s[2]||(s[2]=u=>y(-1e3)),disabled:a.value<=ae,size:"small"},{default:l(()=>[e(r,null,{default:l(()=>[e(p(le))]),_:1}),e(r,null,{default:l(()=>[e(p(le))]),_:1}),e(r,null,{default:l(()=>[e(p(le))]),_:1})]),_:1},8,["disabled"]),e(k,{onClick:s[3]||(s[3]=u=>y(-500)),disabled:a.value<=ae,size:"small"},{default:l(()=>[e(r,null,{default:l(()=>[e(p(le))]),_:1}),e(r,null,{default:l(()=>[e(p(le))]),_:1})]),_:1},8,["disabled"]),e(k,{onClick:s[4]||(s[4]=u=>y(-50)),disabled:a.value<=ae,size:"small"},{default:l(()=>[e(r,null,{default:l(()=>[e(p(le))]),_:1})]),_:1},8,["disabled"]),D("span",{class:"count",onClick:s[5]||(s[5]=u=>a.value=50)},J(a.value),1),e(k,{onClick:s[6]||(s[6]=u=>y(50)),disabled:a.value>=re,size:"small"},{default:l(()=>[e(r,null,{default:l(()=>[e(p(ne))]),_:1})]),_:1},8,["disabled"]),e(k,{onClick:s[7]||(s[7]=u=>y(500)),disabled:a.value>=re,size:"small"},{default:l(()=>[e(r,null,{default:l(()=>[e(p(ne))]),_:1}),e(r,null,{default:l(()=>[e(p(ne))]),_:1})]),_:1},8,["disabled"]),e(k,{onClick:s[8]||(s[8]=u=>y(1e3)),disabled:a.value>=re,size:"small"},{default:l(()=>[e(r,null,{default:l(()=>[e(p(ne))]),_:1}),e(r,null,{default:l(()=>[e(p(ne))]),_:1}),e(r,null,{default:l(()=>[e(p(ne))]),_:1})]),_:1},8,["disabled"])]),D("div",ot,[e(k,{onClick:s[9]||(s[9]=u=>p(n).shiftSubtitles(-a.value)),disabled:p(n).shiftCount===0},{default:l(()=>[e(r,null,{default:l(()=>[e(o)]),_:1})]),_:1},8,["disabled"]),D("span",{class:"count",onClick:s[10]||(s[10]=(...u)=>p(n).resetSubtitles&&p(n).resetSubtitles(...u))},J(p(n).shiftCount),1),e(k,{onClick:s[11]||(s[11]=u=>p(n).shiftSubtitles(a.value))},{default:l(()=>[e(r,null,{default:l(()=>[e(p(Me))]),_:1})]),_:1})])])]),_:1},8,["modelValue","size"])}}}),rt={class:"prompt-controls",style:{display:"flex",gap:"5px",margin:"5px","align-items":"center"}},it={class:"segment-container"},ct={class:"time-controls"},ut={class:"time-controls"},dt={class:"time-controls"},mt={class:"card-footer"},pt=`
总结上面的对话内容，并参考下面的标题，为上面的对话内容起一个吸睛接地气的标题，同时给出建议标签，标签要每行一个，标题和标签要方便复制：
1、心智阳光健康，本科大二学生，聊天很是投缘，大冰不舍挂断
2、人为什么需要亲密关系？大冰深度分析，看完人都通透了
3、主动要礼物！聊天高端局，“泄露天机”太多，大冰“索要”礼物
4、如何把事情处理得圆润得体？大冰深度教学，家庭职场都受用
5、情侣裂痕是如何产生的？大冰深度分析，值得反复观看
6、光长年龄不长心智是一种什么体验？大冰对话32岁女画师，表现惊掉你下巴
7、颠覆你的认知：如何炼成顶级倾听力？大冰独家分享！带你突破沟通瓶颈！
8、如何把握相处的底层逻辑？大冰深度分析，职场婚姻都受用
9、精神未断奶是一种什么体验？大冰对话女硕士，思维表现大跌眼镜
10、如何克服自我否定的毛病？大冰深度教学，看完终身受益
`,ft=`
从上面的对话提取有关_P_方面的内容，并给出出现的开始时间
`,vt=ve({__name:"Picker",setup(v){const n=oe(),f=ze(),h=$e(),a=He([y()]);function y(){return{id:crypto.randomUUID(),startTime:0,endTime:0,duration:0,isK:!1}}const H=d=>{a.splice(d+1,0,y())},E=d=>{a.length>1&&a.splice(d,1)},N=d=>{if(d>0){const t=a.splice(d,1)[0];a.splice(d-1,0,t)}},K=d=>{if(d<a.length-1){const t=a.splice(d,1)[0];a.splice(d+1,0,t)}};function F(d){if(!n.player)return;const t=n.player.currentTime,o=a[d];o.startTime=t}function q(d){if(!n.player)return;const t=n.player.currentTime,o=a[d];o.endTime=t}function R(d,t){var M;const o=a[d],T=o.isK?"-k":"";let u=(M=n.data)==null?void 0:M.urls[0];if(!u)throw O("请先播放视频"),new Error("请先播放视频");const S=u.match(/\/([^\/]+)\.mp4$/),I=S?S[1]:(()=>{const ue=new Date;return`${ue.getFullYear()}${(ue.getMonth()+1).toString().padStart(2,"0")}${ue.getDate().toString().padStart(2,"0")}`})();if(!o.startTime||!o.endTime)throw O("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const Q=U(o.startTime),ee=U(o.endTime),te=Q.replace(/:/g,"."),W=ee.replace(/:/g,".");let m="yt-dlp --no-check-certificate";m=`${m} --concurrent-fragments 16 --throttled-rate 5M `,m=`${m} --download-sections "*${Q}-${ee}"`;const V="~/storage/downloads/Reqable/";return t=="video"&&(m=`${m} --merge-output-format mp4 -o "${V}${I}_${te}-${W}.mp4"`),t=="audio"&&(m=`${m} ${T} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${V}${I}_${te}-${W}.mp3"`),m=`${m} '${u}' `,m}function w(d,t){var V;const o=a[d],T=o.isK?"-k":"";let u=(V=n.data)==null?void 0:V.urls[0];if(!u)throw O("请先播放视频"),new Error("请先播放视频");const S=u.match(/\/([^\/]+)\.mp4$/),I=S?S[1]:(()=>{const M=new Date;return`${M.getFullYear()}${(M.getMonth()+1).toString().padStart(2,"0")}${M.getDate().toString().padStart(2,"0")}`})();if(!o.startTime||!o.endTime)throw O("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const Q=U(o.startTime),ee=U(o.endTime),te=Q.replace(/:/g,"."),W=ee.replace(/:/g,".");let m=`--download-sections "*${Q}-${ee}"`;return t=="video"&&(m=`${m} --merge-output-format mp4 -o "${I}_${te}-${W}.mp4"`),t=="audio"&&(m=`${m} ${T} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${I}_${te}-${W}.mp3"`),m}async function i(){var t;const d=(t=n.data)==null?void 0:t.urls[0];if(!d){O("请先播放视频");return}try{await navigator.clipboard.writeText(d),X(`链接已复制：${d}`)}catch(o){console.error(o),O("复制失败，请手动复制")}}async function g(){var t;const d=(t=n.data)==null?void 0:t.id;if(!d){O("请先播放视频");return}try{await navigator.clipboard.writeText(d),X(`ID已复制：${d}`)}catch(o){console.error(o),O("ID失败，请手动复制")}}async function _(d,t,o){let T="";switch(t){case"dlp":T=R(d,o);break;case"seal":T=w(d,o);break}try{await navigator.clipboard.writeText(T),X(`命令已复制：${T}`)}catch(u){console.error(u),O("复制失败，请手动复制")}}const C=async d=>{const t=[];a.forEach((o,T)=>{console.log(`Index: ${T}`,o),t.push(R(T,d))});try{await navigator.clipboard.writeText(t.join(`
`)),X(`命令已复制：${t.join("<br/>")}`)}catch(o){console.error(o),O("复制失败，请手动复制")}},P=$(!1);async function L(){var S;let d=(S=n.data)==null?void 0:S.urls[0];if(!d){O("请先播放视频");return}const t=d.match(/\/([^\/]+)\.mp4$/),o=t?t[1]:(()=>{const I=new Date;return`${I.getFullYear()}${(I.getMonth()+1).toString().padStart(2,"0")}${I.getDate().toString().padStart(2,"0")}`})(),T=a.filter(I=>I.startTime<I.endTime).map((I,Q)=>`${U(I.startTime)}-${U(I.endTime)}`);if(!T.length){O("请先至少设置一个开始和结束时间");return}const u=`dlp ${P.value?"keep":"delete"} '${d}' ${o} ${T.join(" ")}`;try{z(u),await navigator.clipboard.writeText(u),X(`命令已复制：${u}`)}catch(I){console.error(I),Z(I,"复制失败，请手动复制")}}async function z(d){try{const t=await fetch("http://localhost:8080/run",{method:"POST",headers:{"Content-Type":"text/plain"},body:d});if(!t.ok)throw new Error(`HTTP 错误: ${t.status}`);const T=(await t.json()).task_id;b(T)}catch(t){Z(t,"请求失败: ")}}const c=$(!1),s=$("");function b(d){c.value=!0;const t=setInterval(async()=>{var T;let o="";try{const u=await fetch(`http://localhost:8080/progress/${d}`);if(!u.ok)throw new Error(`进度查询失败: ${u.status}`);const S=await u.json();o=(T=S.recent_log)!=null&&T.length?`

最近日志:
`+S.recent_log.join(`
`):"",S.status==="completed"&&(clearInterval(t),o=`处理完成✅ (状态: ${S.status})${o}`),S.status==="failed"&&(clearInterval(t),o=`处理完成✅ (状态: ${S.status})${o}`)}catch{clearInterval(t),o="监控失败: "}s.value=o},1e3)}const r=$(!1),k=$("情感"),A=$(!1);async function Y(d,t){const o=h.getSubtitles(d,t);let T="";o.value.map(u=>{const S=u.time.split(".")[0]+" "+u.text+`
`;T+=S}),T+=r.value?pt:A.value?ft.replace("_P_",k.value):"";try{await navigator.clipboard.writeText(T),X(`${o.value.length}条字幕已复制`)}catch(u){console.error(u),O("复制失败，请手动复制")}}return(d,t)=>{const o=x("el-button"),T=x("el-input"),u=x("DocumentCopy"),S=x("el-icon"),I=x("CaretLeft"),Q=x("CaretRight"),ee=x("Minus"),te=x("Plus"),W=x("el-card");return B(),G(ie,null,[me(e(W,{class:"segment-control-card"},{footer:l(()=>[D("div",mt,[e(o,{size:"small",onClick:i},{default:l(()=>t[17]||(t[17]=[j("链接")])),_:1}),e(o,{size:"small",onClick:g},{default:l(()=>t[18]||(t[18]=[j("ID")])),_:1}),e(o,{size:"small",onClick:L},{default:l(()=>t[19]||(t[19]=[j("下载片段")])),_:1}),e(o,{size:"small",onClick:t[3]||(t[3]=m=>c.value=!c.value)},{default:l(()=>t[20]||(t[20]=[j("日志")])),_:1}),e(o,{size:"small",onClick:t[4]||(t[4]=m=>C("video"))},{default:l(()=>t[21]||(t[21]=[j("复制命令")])),_:1})])]),default:l(()=>[D("div",rt,[e(o,{size:"small",type:r.value?"success":"info",onClick:t[0]||(t[0]=m=>{A.value=!1,r.value=!r.value})},{default:l(()=>t[5]||(t[5]=[j("取标题")])),_:1},8,["type"]),e(o,{size:"small",type:A.value?"success":"info",onClick:t[1]||(t[1]=m=>{r.value=!1,A.value=!A.value})},{default:l(()=>t[6]||(t[6]=[j("取内容")])),_:1},8,["type"]),e(T,{size:"small",modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=m=>k.value=m),disabled:!A.value,style:{flex:"1"}},null,8,["modelValue","disabled"])]),D("div",it,[(B(!0),G(ie,null,Se(a,(m,V)=>(B(),G("div",{key:m.id,class:"segment-item"},[D("div",ct,[e(o,{type:"primary",size:"small",onClick:M=>_(V,"seal","audio")},{default:l(()=>t[7]||(t[7]=[j("SA")])),_:2},1032,["onClick"]),e(o,{type:"primary",size:"small",onClick:M=>_(V,"seal","video")},{default:l(()=>t[8]||(t[8]=[j("SV")])),_:2},1032,["onClick"]),e(o,{type:"primary",size:"small",onClick:M=>_(V,"dlp","audio")},{default:l(()=>t[9]||(t[9]=[j("DA")])),_:2},1032,["onClick"]),e(o,{type:"primary",size:"small",onClick:M=>_(V,"dlp","video")},{default:l(()=>t[10]||(t[10]=[j("DV")])),_:2},1032,["onClick"]),e(T,{"model-value":p(h).secondsToTime(m.endTime-m.startTime),size:"small",readonly:""},null,8,["model-value"]),e(o,{size:"small",type:m.isK?"success":"info",onClick:M=>m.isK=!m.isK},{default:l(()=>[j(J(m.isK?"k开":"k关"),1)]),_:2},1032,["type","onClick"]),e(o,{size:"small",type:"success",onClick:M=>Y(m.startTime,m.endTime)},{default:l(()=>[e(S,null,{default:l(()=>[e(u)]),_:1})]),_:2},1032,["onClick"])]),D("div",ut,[e(o,{type:"success",size:"small",onClick:M=>F(V)},{default:l(()=>t[11]||(t[11]=[j("S")])),_:2},1032,["onClick"]),e(o,{type:"success",size:"small",onClick:M=>p(n).jumpTo(p(U)(m.startTime))},{default:l(()=>t[12]||(t[12]=[j("J")])),_:2},1032,["onClick"]),e(o,{type:"success",size:"small",onClick:M=>m.startTime=m.startTime-.5},{default:l(()=>[e(S,null,{default:l(()=>[e(I)]),_:1})]),_:2},1032,["onClick"]),e(o,{type:"success",size:"small",onClick:M=>m.startTime=m.startTime+.5},{default:l(()=>[e(S,null,{default:l(()=>[e(Q)]),_:1})]),_:2},1032,["onClick"]),e(T,{"model-value":p(U)(m.startTime),size:"small",readonly:""},null,8,["model-value"]),e(o,{size:"small",onClick:M=>N(V),disabled:V===0||a.length===1},{default:l(()=>t[13]||(t[13]=[j("↑")])),_:2},1032,["onClick","disabled"]),e(o,{size:"small",onClick:M=>E(V),disabled:a.length===1},{default:l(()=>[e(S,null,{default:l(()=>[e(ee)]),_:1})]),_:2},1032,["onClick","disabled"])]),D("div",dt,[e(o,{type:"danger",size:"small",onClick:M=>q(V)},{default:l(()=>t[14]||(t[14]=[j("E")])),_:2},1032,["onClick"]),e(o,{type:"danger",size:"small",onClick:M=>p(n).jumpTo(p(U)(m.endTime))},{default:l(()=>t[15]||(t[15]=[j("J")])),_:2},1032,["onClick"]),e(o,{type:"danger",size:"small",onClick:M=>m.endTime=m.endTime-.5},{default:l(()=>[e(S,null,{default:l(()=>[e(I)]),_:1})]),_:2},1032,["onClick"]),e(o,{type:"danger",size:"small",onClick:M=>m.endTime=m.endTime+.5},{default:l(()=>[e(S,null,{default:l(()=>[e(Q)]),_:1})]),_:2},1032,["onClick"]),e(T,{type:"danger","model-value":p(U)(m.endTime),size:"small",readonly:""},null,8,["model-value"]),e(o,{size:"small",onClick:M=>K(V),disabled:V===a.length-1||a.length===1},{default:l(()=>t[16]||(t[16]=[j("↓")])),_:2},1032,["onClick","disabled"]),e(o,{size:"small",onClick:M=>H(V)},{default:l(()=>[e(S,null,{default:l(()=>[e(te)]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1},512),[[ke,p(f).open]]),me(e(W,{class:"log-card",style:{"max-width":"480px","z-index":"1000000 !important"}},{default:l(()=>[D("p",null,J(s.value),1)]),_:1},512),[[ke,c.value]])],64)}}}),xe=(v,n)=>{const f=v.__vccOpts||v;for(const[h,a]of n)f[h]=a;return f},be=xe(vt,[["__scopeId","data-v-1aea8eb3"]]),yt={__name:"App",setup(v){return oe(),(n,f)=>{const h=x("el-col"),a=x("el-row"),y=x("el-container");return B(),G(ie,null,[e(be),e(y,{style:{height:"100vh"}},{default:l(()=>[e(a,{class:"grid-container"},{default:l(()=>[e(h,{class:"grid-section top"},{default:l(()=>[e(Je)]),_:1}),e(h,{class:"grid-section bottom"},{default:l(()=>[e(We),e(at),e(be)]),_:1})]),_:1})]),_:1})],64)}}},gt=xe(yt,[["__scopeId","data-v-d44e3bc6"]]),ce=Ke(gt);ce.use(Re());ce.use(Ee);for(const[v,n]of Object.entries(Ie))ce.component(v,n);ce.mount("#app");
