import{E as se,i as be}from"./element-plus-CRGBzuq5.js";import{f as W,g as X,B as Ce,l as Te,w as Se,Q as ze}from"./@element-plus-By79ymwD.js";import{r as k,j as ce,c as Q,o as N,a as D,M as B,u,d as ue,k as ge,ag as z,aq as xe,I as he,G as de,H as s,P as t,L as I,S as Ee,w as Me,J as ve,O as me,a6 as $e,D as De,n as Pe,X as Ie,Q as je,at as Le}from"./@vue-C01xNfPK.js";import{d as pe,c as Oe}from"./pinia-CKuVeK4o.js";import{P as He}from"./plyr-CZIZ1zVJ.js";import{H as ie}from"./hls.js-DWnTp5j0.js";import{f as _e}from"./flv.js-HEV2ctDJ.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-ZGnAJoZm.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-NaOncrXL.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-DwceP2Gb.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))g(r);new MutationObserver(r=>{for(const p of r)if(p.type==="childList")for(const H of p.addedNodes)H.tagName==="LINK"&&H.rel==="modulepreload"&&g(H)}).observe(document,{childList:!0,subtree:!0});function d(r){const p={};return r.integrity&&(p.integrity=r.integrity),r.referrerPolicy&&(p.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?p.credentials="include":r.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function g(r){if(r.ep)return;r.ep=!0;const p=d(r);fetch(r.href,p)}})();function Ke(m,o="未知错误"){if(m instanceof Error)return m.message;if(typeof m=="string")return m;if(typeof m=="object"&&m!==null&&"message"in m&&typeof m.message=="string")return m.message;try{return JSON.stringify(m)}catch{return o}}const le={showClose:!0,dangerouslyUseHTMLString:!0,duration:3e3},oe=`style="
      width: 500px; 
      word-wrap: break-word;
      word-break: break-all;
      white-space: normal;
      overflow-wrap: anywhere;
    "`;function Y(m,o){const d=Ke(m),g=o?`${o}: ${d}`:d;se.error({...le,message:`
    <div ${oe}>
      ${g}
    </div>
    `})}function j(m){se.error({...le,message:`
    <div ${oe}>
      ${m}
    </div>
    `})}function Ue(m){se.info({...le,message:`
    <div ${oe}>
      ${m}
    </div>
    `})}function J(m){se.success({...le,message:`
    <div ${oe}>
      ${m}
    </div>
    `})}const Z=m=>{try{const[o,d]=m.split("."),[g,r,p]=o.split(":").map(Number),H=d?parseInt(d.padEnd(3,"0")):0;return g*3600+r*60+p+H/1e3}catch{return 0}},O=m=>{const o=Math.round(m%1*1e3),d=Math.floor(m),g=Math.floor(d/3600),r=Math.floor(d%3600/60),p=d%60;return`${String(g).padStart(2,"0")}:${String(r).padStart(2,"0")}:${String(p).padStart(2,"0")}.${String(o).padStart(3,"0")}`},ee=pe("player",()=>{const m=k(""),o=k(null),d=k(null),g=k(null),r=k(null),p=k(null),H=i=>{o.value=new He(i,{hideControls:!1,controls:["play-large","current-time","progress","duration","mute","volume","fullscreen","settings"],blankVideo:"https://cdn.plyr.io/static/blank.mp4"})},S=i=>{r.value=i,m.value=i.date;const f=i.urls[0],_={type:"video",sources:[{src:f,type:V(f)}]};K(_).then(()=>{var w;return(w=o.value)==null?void 0:w.play()})},V=i=>i.includes(".m3u8")?"application/x-mpegURL":i.includes(".flv")?"video/x-flv":"video/mp4",K=async i=>{var _,w,x;(_=d.value)==null||_.destroy(),d.value=null,(w=g.value)==null||w.destroy(),g.value=null;const f=i.sources[0].src.includes(".m3u8")?"hls":i.sources[0].src.includes(".flv")?"flv":"html5";try{f!==p.value&&await((x=o.value)==null?void 0:x.stop()),o.value.source=i,f==="hls"&&ie.isSupported()?await R(i.sources[0].src):f==="flv"&&_e.isSupported()&&await A(i.sources[0].src),p.value=f}catch(L){console.error("源切换失败:",L)}},R=async i=>new Promise(f=>{d.value=new ie,d.value.loadSource(i),d.value.attachMedia(o.value.media),d.value.on(ie.Events.MANIFEST_PARSED,f)}),A=async i=>{g.value=_e.createPlayer({type:"flv",url:i}),g.value.attachMediaElement(o.value.media),g.value.load(),await g.value.play()},U=k(!1);return{player:o,initPlayer:H,switchSource:K,playStream:S,title:m,data:r,autoPlay:U,jumpTo:i=>{const f=Z(i);if(o.value&&f>0)try{o.value.currentTime=f,U.value?o.value.play():o.value.pause()}catch(_){Y(_,"跳转播放失败，请检查播放器状态")}}}}),Ve={class:"video-wrapper"},Re={class:"title"},Ne={class:"plyr-container"},Ae={__name:"Player",setup(m){const o=ee(),d=k(null);return ce(()=>{o.initPlayer(d.value)}),(g,r)=>(N(),Q("div",Ve,[D("h3",Re,B(u(o).title),1),D("div",Ne,[D("video",{class:"player",ref_key:"videoRef",ref:d,playsinline:""},null,512)])]))}},fe=pe("editor",()=>{const m=k(!1),o=k(!1),d=k(""),g=k(null),r=5e3,p=k(r),H=f=>{o.value=!0,g.value=f,d.value=f.date,h()},S=k([]),V=f=>{try{const[_,w]=f.split("."),[x,L,T]=_.split(":").map(Number);return x*3600+L*60+T}catch(_){console.error(_)}},K=k(new Map),R=()=>{K.value.clear(),S.value.forEach((f,_)=>{try{const w=V(f.time);K.value.has(w)||K.value.set(w,_)}catch(w){console.error(`错误处理时间戳 ${f.time}（索引 ${_}）: ${w}`)}})},A=f=>{if(!S.value)return;const _=p.value+f;p.value=Math.max(_,0);const w=f/1e3;S.value=S.value.map(x=>{const T=Z(x.time)+w;return{...x,time:O(Math.max(T,0))}}),R()},U=()=>{if(!S.value)return;const _=(p.value-r)/1e3;S.value=S.value.map(w=>{const L=Z(w.time)-_;return{...w,time:O(Math.max(L,0))}}),p.value=r,R()},h=async()=>{var f;m.value=!0;try{const _=await fetch(`srts/${(f=g.value)==null?void 0:f.id}`);if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);S.value=await _.json();const w=p.value/1e3;S.value=S.value.map(x=>{const T=Z(x.time)+w;return{...x,time:O(Math.max(T,0))}}),R()}catch(_){console.error("数据获取失败:",_),Y(_,"字幕数据加载失败，请稍后重试"),S.value=[]}finally{m.value=!1}};return{open:o,title:d,edit:H,data:g,timelineData:S,loading:m,shiftCount:p,shiftSubtitles:A,timeToSeconds:Z,secondsToTime:O,resetSubtitles:U,timeMap:K,timeToKey:V,getSubtitles:(f,_)=>{var y;const w=k([]);if(!((y=S.value)!=null&&y.length))return console.error("时间轴数据未加载"),w;const x=V(O(f)),L=V(O(_)),T=K.value.get(x),c=K.value.get(L);if(typeof T!="number"||typeof c!="number")return console.error("无法匹配有效的时间段"),w;const a=Math.max(0,T),l=Math.min(S.value.length-1,c),[e,n]=a<=l?[a,l]:[l,a];return w.value=S.value.slice(e,n+1),w}}}),Fe=["onClick"],Be=["onClick"],qe={style:{display:"flex",gap:"0","justify-content":"flex-end"}},Je=ue({__name:"Playlist",setup(m){const o=ee(),d=fe(),g=k(""),r=k(!0),p=k([]),H=async()=>{try{const h=await fetch("video.json");if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);p.value=await h.json()}catch(h){Y(h,"数据加载失败")}finally{r.value=!1}},S=ge(()=>{const h=g.value.toLowerCase();return p.value.filter(i=>i.id.toLowerCase().includes(h)||i.date.toLowerCase().includes(h))}),V=async h=>{var i;((i=h.urls)==null?void 0:i.length)>0?await R(h.urls[0],"链接已复制到剪贴板","链接复制失败"):j("该记录没有可用的链接")},K=async h=>{h.id?await R(h.id,"ID已复制到剪贴板","ID复制失败"):j("该记录没有可用的ID")},R=async(h,i,f)=>{try{await navigator.clipboard.writeText(h),J(i)}catch(_){Y(_,f)}},A=h=>{var i;(i=h.urls)!=null&&i.length&&(h.urls[0],o.playStream(h),d.edit(h))},U=h=>{var i;(i=h.urls)!=null&&i.length&&(h.urls[0],o.playStream(h))};return ce(()=>{H()}),(h,i)=>{const f=z("el-table-column"),_=z("el-input"),w=z("el-button"),x=z("el-table"),L=xe("loading");return he((N(),de(x,{data:S.value,"default-sort":{prop:"date",order:"descending"},height:"100%",style:{width:"100%"}},{default:s(()=>[t(f,{fixed:"",label:"日期",prop:"date",sortable:"",width:"140"},{default:s(T=>[D("span",{class:"clickable-text",onClick:c=>V(T.row)},B(T.row.date),9,Fe)]),_:1}),t(f,{fixed:"",label:"标识",prop:"id",width:"180"},{default:s(T=>[D("span",{class:"clickable-text",onClick:c=>K(T.row)},B(T.row.id),9,Be)]),_:1}),t(f,{fixed:"right",align:"right",width:"115"},{header:s(()=>[t(_,{modelValue:g.value,"onUpdate:modelValue":i[0]||(i[0]=T=>g.value=T),size:"small",placeholder:"输入关键词搜索"},null,8,["modelValue"])]),default:s(T=>{var c,a;return[D("div",qe,[t(w,{plain:"",size:"small",onClick:l=>A(T.row),type:T.row.hasSrt?"success":"warning",disabled:!T.row.hasSrt},{default:s(()=>i[1]||(i[1]=[I(" 编辑 ")])),_:2},1032,["onClick","type","disabled"]),t(w,{plain:"",size:"small",onClick:l=>U(T.row),type:(c=T.row.urls)!=null&&c.length?"success":"warning",disabled:!((a=T.row.urls)!=null&&a.length)},{default:s(()=>i[2]||(i[2]=[I(" 播放 ")])),_:2},1032,["onClick","type","disabled"])])]}),_:1})]),_:1},8,["data"])),[[L,r.value]])}}}),ke=pe("picker",()=>{const m=k(!1),o=k(!1),d=k("");return k(null),k(0),{open:o,title:d,loading:m}}),Ye={style:{display:"flex",gap:"0","justify-content":"flex-start"}},Qe={key:0,class:"loading-state"},Ge={class:"time-label"},We=["onClick"],Xe={key:1,class:"empty-state"},Ze={class:"footer-container"},et={class:"time-shift-controls"},tt={class:"time-shift-controls"},te=50,ne=5e3,nt=ue({__name:"Editor",setup(m){const o=fe(),d=ee(),g=ke(),r=k(1e3),p=c=>{const a=r.value+c;r.value=Math.max(te,Math.min(ne,a))},H=k(["你好","晚上好","拜拜","再见"]),S=c=>H.value.some(a=>c.includes(a)),V=ge(()=>o.timelineData.map((c,a)=>({text:c.text,index:a})).filter(({text:c})=>S(c)).map(({index:c})=>c).sort((c,a)=>c-a)),K=()=>{const c=V.value;if(c.length===0){j("未找到包含关键字的字幕行");return}let a=0,l=c.length-1,e=-1;for(;a<=l;){const n=Math.floor((a+l)/2);c[n]<i.value?(e=c[n],a=n+1):l=n-1}e===-1&&(e=c[c.length-1]),_(e)},R=()=>{const c=V.value;if(c.length===0){j("未找到包含关键字的字幕行");return}let a=0,l=c.length-1,e=-1;for(;a<=l;){const n=Math.floor((a+l)/2);c[n]>i.value?(e=c[n],l=n-1):a=n+1}e===-1&&(e=c[0]),_(e)},A=k(),U=k([]),h=c=>{c instanceof HTMLElement&&U.value.push(c)},i=k(0),f=async()=>{if(!d.player)return;const c=d.player.currentTime,a=O(c),l=o.timeToKey(a),e=o.timeMap.get(l);typeof e=="number"&&e!==i.value&&(i.value=e,await Pe(),setTimeout(()=>_(e),50))},_=c=>{const a=A.value,l=U.value[c];if(l instanceof HTMLElement&&a){const n=l.offsetTop-a.clientHeight/2;a.scrollTo({top:n,behavior:"smooth"})}},w=k(595),x=k();let L=null;ce(()=>{x.value=document.querySelector(".grid-section.bottom"),x.value&&(L=new ResizeObserver(c=>{for(const a of c){const{height:l}=a.contentRect;w.value=l}}),L.observe(x.value)),d.player.on("timeupdate",f)}),Ee(()=>{L&&x.value&&L.unobserve(x.value),d.player.off("timeupdate",f),U.value=[]}),Me(()=>o.timelineData,()=>{U.value=[]});const T=async()=>{var c,a;try{const l=(c=d.player)==null?void 0:c.media;if(!(l instanceof HTMLVideoElement)){j("无法获取视频元素");return}const e=document.createElement("canvas");e.width=l.videoWidth,e.height=l.videoHeight;const n=e.getContext("2d");if(!n){Y("无法创建画布上下文");return}n.drawImage(l,0,0,e.width,e.height);const y=e.toDataURL("image/jpeg",.9),v=document.createElement("a"),P=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);v.download=`capture_${(a=o.data)==null?void 0:a.id}_${P}.jpg`,v.href=y,document.body.appendChild(v),v.click(),document.body.removeChild(v),J("截图已保存")}catch(l){Y(`截图失败: ${l instanceof Error?l.message:l}`)}};return(c,a)=>{const l=z("Expand"),e=z("el-icon"),n=z("el-button"),y=z("Top"),v=z("Bottom"),P=z("Camera"),E=z("el-text"),F=z("Minus"),q=z("el-drawer");return N(),de(q,{modelValue:u(o).open,"onUpdate:modelValue":a[12]||(a[12]=b=>u(o).open=b),direction:"btt",modal:!1,size:w.value,onOpened:a[13]||(a[13]=b=>u(o).shiftSubtitles(0))},{header:s(()=>[D("div",Ye,[t(n,{size:"small",type:u(g).open?"success":"",circle:""},{default:s(()=>[t(e,{onClick:a[0]||(a[0]=b=>u(g).open=!u(g).open)},{default:s(()=>[t(l)]),_:1})]),_:1},8,["type"]),t(n,{onClick:a[1]||(a[1]=b=>u(d).autoPlay=!u(d).autoPlay),type:u(d).autoPlay?"success":"",size:"small",circle:""},{default:s(()=>a[14]||(a[14]=[I("A")])),_:1},8,["type"]),t(n,{size:"small",circle:""},{default:s(()=>[t(e,{onClick:K},{default:s(()=>[t(y)]),_:1})]),_:1}),t(n,{size:"small",circle:""},{default:s(()=>[t(e,{onClick:R},{default:s(()=>[t(v)]),_:1})]),_:1}),t(n,{size:"small",circle:""},{default:s(()=>[t(e,{onClick:T},{default:s(()=>[t(P)]),_:1})]),_:1}),t(E,{class:"mx-1",type:"warning"},{default:s(()=>{var b;return[I(B((b=u(o).data)==null?void 0:b.id),1)]}),_:1})])]),default:s(()=>[D("div",{class:"timeline-container",ref_key:"containerRef",ref:A},[u(o).loading?(N(),Q("div",Qe,[t(e,{class:"is-loading",color:"#409EFF",size:20},{default:s(()=>[t(u(Te))]),_:1}),a[15]||(a[15]=D("span",null,"正在加载字幕数据...",-1))])):ve("",!0),(N(!0),Q(me,null,$e(u(o).timelineData,(b,C)=>(N(),Q("div",{key:C,class:"timeline-item",ref_for:!0,ref:h},[D("span",Ge,B(b.time),1),D("span",{class:De(["content-text",{highlight:C==i.value,keyword:S(b.text)}]),onClick:$=>u(d).jumpTo(b.time)},B(b.text),11,We)]))),128)),!u(o).loading&&u(o).timelineData.length===0?(N(),Q("div",Xe,[t(e,null,{default:s(()=>[t(u(Se))]),_:1}),a[16]||(a[16]=D("span",null,"暂无字幕数据",-1))])):ve("",!0)],512)]),footer:s(()=>[D("div",Ze,[D("div",et,[t(n,{onClick:a[2]||(a[2]=b=>p(-1e3)),disabled:r.value<=te,size:"small"},{default:s(()=>[t(e,null,{default:s(()=>[t(u(W))]),_:1}),t(e,null,{default:s(()=>[t(u(W))]),_:1}),t(e,null,{default:s(()=>[t(u(W))]),_:1})]),_:1},8,["disabled"]),t(n,{onClick:a[3]||(a[3]=b=>p(-500)),disabled:r.value<=te,size:"small"},{default:s(()=>[t(e,null,{default:s(()=>[t(u(W))]),_:1}),t(e,null,{default:s(()=>[t(u(W))]),_:1})]),_:1},8,["disabled"]),t(n,{onClick:a[4]||(a[4]=b=>p(-50)),disabled:r.value<=te,size:"small"},{default:s(()=>[t(e,null,{default:s(()=>[t(u(W))]),_:1})]),_:1},8,["disabled"]),D("span",{class:"count",onClick:a[5]||(a[5]=b=>r.value=50)},B(r.value),1),t(n,{onClick:a[6]||(a[6]=b=>p(50)),disabled:r.value>=ne,size:"small"},{default:s(()=>[t(e,null,{default:s(()=>[t(u(X))]),_:1})]),_:1},8,["disabled"]),t(n,{onClick:a[7]||(a[7]=b=>p(500)),disabled:r.value>=ne,size:"small"},{default:s(()=>[t(e,null,{default:s(()=>[t(u(X))]),_:1}),t(e,null,{default:s(()=>[t(u(X))]),_:1})]),_:1},8,["disabled"]),t(n,{onClick:a[8]||(a[8]=b=>p(1e3)),disabled:r.value>=ne,size:"small"},{default:s(()=>[t(e,null,{default:s(()=>[t(u(X))]),_:1}),t(e,null,{default:s(()=>[t(u(X))]),_:1}),t(e,null,{default:s(()=>[t(u(X))]),_:1})]),_:1},8,["disabled"])]),D("div",tt,[t(n,{onClick:a[9]||(a[9]=b=>u(o).shiftSubtitles(-r.value)),disabled:u(o).shiftCount===0},{default:s(()=>[t(e,null,{default:s(()=>[t(F)]),_:1})]),_:1},8,["disabled"]),D("span",{class:"count",onClick:a[10]||(a[10]=(...b)=>u(o).resetSubtitles&&u(o).resetSubtitles(...b))},B(u(o).shiftCount),1),t(n,{onClick:a[11]||(a[11]=b=>u(o).shiftSubtitles(r.value))},{default:s(()=>[t(e,null,{default:s(()=>[t(u(Ce))]),_:1})]),_:1})])])]),_:1},8,["modelValue","size"])}}}),st={class:"segment-container"},lt={class:"time-controls"},ot={class:"time-controls"},at={class:"time-controls"},rt={class:"card-footer"},it=ue({__name:"Picker",setup(m){const o=ee(),d=ke(),g=fe(),r=Ie([p()]);function p(){return{id:crypto.randomUUID(),startTime:0,endTime:0,duration:0,isK:!1}}const H=l=>{r.splice(l+1,0,p())},S=l=>{r.length>1&&r.splice(l,1)},V=l=>{if(l>0){const e=r.splice(l,1)[0];r.splice(l-1,0,e)}},K=l=>{if(l<r.length-1){const e=r.splice(l,1)[0];r.splice(l+1,0,e)}};function R(l){if(!o.player)return;const e=o.player.currentTime,n=r[l];n.startTime=e}function A(l){if(!o.player)return;const e=o.player.currentTime,n=r[l];n.endTime=e}function U(l,e){var G;const n=r[l],y=n.isK?"-k":"";let v=(G=o.data)==null?void 0:G.urls[0];if(!v)throw j("请先播放视频"),new Error("请先播放视频");const P=v.match(/\/([^\/]+)\.mp4$/),E=P?P[1]:(()=>{const re=new Date;return`${re.getFullYear()}${(re.getMonth()+1).toString().padStart(2,"0")}${re.getDate().toString().padStart(2,"0")}`})();if(!n.startTime||!n.endTime)throw j("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const F=O(n.startTime),q=O(n.endTime),b=F.replace(/:/g,"."),C=q.replace(/:/g,".");let $="yt-dlp --no-check-certificate";$=`${$} --download-sections "*${F}-${q}"`,$=`${$} --force-keyframes-at-cuts`;const M="~/storage/downloads/Reqable/";return e=="video"&&($=`${$} --merge-output-format mp4 -o "${M}${E}_${b}-${C}.mp4"`),e=="audio"&&($=`${$} ${y} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${M}${E}_${b}-${C}.mp3"`),$=`${$} '${v}' `,$}function h(l,e){var M;const n=r[l],y=n.isK?"-k":"";let v=(M=o.data)==null?void 0:M.urls[0];if(!v)throw j("请先播放视频"),new Error("请先播放视频");const P=v.match(/\/([^\/]+)\.mp4$/),E=P?P[1]:(()=>{const G=new Date;return`${G.getFullYear()}${(G.getMonth()+1).toString().padStart(2,"0")}${G.getDate().toString().padStart(2,"0")}`})();if(!n.startTime||!n.endTime)throw j("请先设置开始和结束时间"),new Error("请先设置开始和结束时间");const F=O(n.startTime),q=O(n.endTime),b=F.replace(/:/g,"."),C=q.replace(/:/g,".");let $=`--download-sections "*${F}-${q}"`;return e=="video"&&($=`${$} --merge-output-format mp4 -o "${E}_${b}-${C}.mp4"`),e=="audio"&&($=`${$} ${y} -x --audio-format mp3 --postprocessor-args "ffmpeg:-c:a libmp3lame -b:a 32k -minrate 32k -maxrate 32k -bufsize 64k -ac 1 -ar 22050" -o "${E}_${b}-${C}.mp3"`),$}async function i(){var e;const l=(e=o.data)==null?void 0:e.urls[0];if(!l){j("请先播放视频");return}try{await navigator.clipboard.writeText(l),J(`链接已复制：${l}`)}catch(n){console.error(n),j("复制失败，请手动复制")}}async function f(){var e;const l=(e=o.data)==null?void 0:e.id;if(!l){j("请先播放视频");return}try{await navigator.clipboard.writeText(l),J(`ID已复制：${l}`)}catch(n){console.error(n),j("ID失败，请手动复制")}}async function _(l,e,n){let y="";switch(e){case"dlp":y=U(l,n);break;case"seal":y=h(l,n);break}try{await navigator.clipboard.writeText(y),J(`命令已复制：${y}`)}catch(v){console.error(v),j("复制失败，请手动复制")}}const w=async l=>{const e=[];r.forEach((n,y)=>{console.log(`Index: ${y}`,n),e.push(U(y,l))});try{await navigator.clipboard.writeText(e.join(`
`)),J(`命令已复制：${e.join("<br/>")}`)}catch(n){console.error(n),j("复制失败，请手动复制")}},x=k(!1);async function L(){var P;let l=(P=o.data)==null?void 0:P.urls[0];if(!l){j("请先播放视频");return}const e=l.match(/\/([^\/]+)\.mp4$/),n=e?e[1]:(()=>{const E=new Date;return`${E.getFullYear()}${(E.getMonth()+1).toString().padStart(2,"0")}${E.getDate().toString().padStart(2,"0")}`})(),y=r.filter(E=>E.startTime<E.endTime).map((E,F)=>`${O(E.startTime)}-${O(E.endTime)}`);if(!y.length){j("请先至少设置一个开始和结束时间");return}const v=`dlp ${x.value?"keep":"delete"} '${l}' ${n} ${y.join(" ")}`;try{T(v),await navigator.clipboard.writeText(v),J(`命令已复制：${v}`)}catch(E){console.error(E),Y(E,"复制失败，请手动复制")}}async function T(l){try{const e=await fetch("http://localhost:8080/run",{method:"POST",headers:{"Content-Type":"text/plain"},body:l});if(!e.ok)throw new Error(`HTTP 错误: ${e.status}`);const y=(await e.json()).task_id;c(y)}catch(e){Y(e,"请求失败: ")}}function c(l){const e=setInterval(async()=>{var n;try{const y=await fetch(`http://localhost:8080/progress/${l}`);if(!y.ok)throw new Error(`进度查询失败: ${y.status}`);const v=await y.json(),P=(n=v.recent_log)!=null&&n.length?`

最近日志:
`+v.recent_log.join(`
`):"";Ue(P),v.status==="completed"&&(clearInterval(e),J(`处理完成✅ (状态: ${v.status})${P}`)),v.status==="failed"&&(clearInterval(e),j(`处理完成✅ (状态: ${v.status})${P}`))}catch(y){clearInterval(e),Y(y,"监控失败: ")}},1e3)}async function a(l,e){const n=g.getSubtitles(l,e);let y="";n.value.map(v=>{const P=v.time.split(".")[0]+" "+v.text+`
`;y+=P}),y+="总结以上内容，提取一个核心标题，要吸睛符合正向传播要求";try{await navigator.clipboard.writeText(y),J(`${n.value.length}条字幕已复制`)}catch(v){console.error(v),j("复制失败，请手动复制")}}return(l,e)=>{const n=z("el-button"),y=z("el-input"),v=z("el-icon"),P=z("CaretLeft"),E=z("CaretRight"),F=z("Minus"),q=z("Plus"),b=z("el-card");return he((N(),de(b,{class:"segment-control-card"},{footer:s(()=>[D("div",rt,[t(n,{size:"small",onClick:i},{default:s(()=>e[11]||(e[11]=[I("复制链接")])),_:1}),t(n,{size:"small",onClick:f},{default:s(()=>e[12]||(e[12]=[I("复制ID")])),_:1}),t(n,{size:"small",onClick:L},{default:s(()=>e[13]||(e[13]=[I("下载片段")])),_:1}),t(n,{size:"small",onClick:e[0]||(e[0]=C=>w("video"))},{default:s(()=>e[14]||(e[14]=[I("复制命令")])),_:1})])]),default:s(()=>[D("div",st,[(N(!0),Q(me,null,$e(r,(C,$)=>(N(),Q("div",{key:C.id,class:"segment-item"},[D("div",lt,[t(n,{type:"primary",size:"small",onClick:M=>_($,"seal","audio")},{default:s(()=>e[1]||(e[1]=[I("SA")])),_:2},1032,["onClick"]),t(n,{type:"primary",size:"small",onClick:M=>_($,"seal","video")},{default:s(()=>e[2]||(e[2]=[I("SV")])),_:2},1032,["onClick"]),t(n,{type:"primary",size:"small",onClick:M=>_($,"dlp","audio")},{default:s(()=>e[3]||(e[3]=[I("DA")])),_:2},1032,["onClick"]),t(n,{type:"primary",size:"small",onClick:M=>_($,"dlp","video")},{default:s(()=>e[4]||(e[4]=[I("DV")])),_:2},1032,["onClick"]),t(y,{"model-value":u(g).secondsToTime(C.endTime-C.startTime),size:"small",readonly:""},null,8,["model-value"]),t(n,{size:"small",type:C.isK?"success":"info",onClick:M=>C.isK=!C.isK},{default:s(()=>[I(B(C.isK?"-k开":"-k关"),1)]),_:2},1032,["type","onClick"]),t(n,{size:"small",circle:"",type:"success",onClick:M=>a(C.startTime,C.endTime)},{default:s(()=>[t(v,null,{default:s(()=>[I(B($+1),1)]),_:2},1024)]),_:2},1032,["onClick"])]),D("div",ot,[t(n,{type:"success",size:"small",onClick:M=>R($)},{default:s(()=>e[5]||(e[5]=[I("S")])),_:2},1032,["onClick"]),t(n,{type:"success",size:"small",onClick:M=>u(o).jumpTo(u(O)(C.startTime))},{default:s(()=>e[6]||(e[6]=[I("J")])),_:2},1032,["onClick"]),t(n,{type:"success",size:"small",onClick:M=>C.startTime=C.startTime-.5},{default:s(()=>[t(v,null,{default:s(()=>[t(P)]),_:1})]),_:2},1032,["onClick"]),t(n,{type:"success",size:"small",onClick:M=>C.startTime=C.startTime+.5},{default:s(()=>[t(v,null,{default:s(()=>[t(E)]),_:1})]),_:2},1032,["onClick"]),t(y,{"model-value":u(O)(C.startTime),size:"small",readonly:""},null,8,["model-value"]),t(n,{size:"small",onClick:M=>V($),disabled:$===0||r.length===1},{default:s(()=>e[7]||(e[7]=[I("↑")])),_:2},1032,["onClick","disabled"]),t(n,{size:"small",onClick:M=>S($),disabled:r.length===1},{default:s(()=>[t(v,null,{default:s(()=>[t(F)]),_:1})]),_:2},1032,["onClick","disabled"])]),D("div",at,[t(n,{type:"danger",size:"small",onClick:M=>A($)},{default:s(()=>e[8]||(e[8]=[I("E")])),_:2},1032,["onClick"]),t(n,{type:"danger",size:"small",onClick:M=>u(o).jumpTo(u(O)(C.endTime))},{default:s(()=>e[9]||(e[9]=[I("J")])),_:2},1032,["onClick"]),t(n,{type:"danger",size:"small",onClick:M=>C.endTime=C.endTime-.5},{default:s(()=>[t(v,null,{default:s(()=>[t(P)]),_:1})]),_:2},1032,["onClick"]),t(n,{type:"danger",size:"small",onClick:M=>C.endTime=C.endTime+.5},{default:s(()=>[t(v,null,{default:s(()=>[t(E)]),_:1})]),_:2},1032,["onClick"]),t(y,{type:"danger","model-value":u(O)(C.endTime),size:"small",readonly:""},null,8,["model-value"]),t(n,{size:"small",onClick:M=>K($),disabled:$===r.length-1||r.length===1},{default:s(()=>e[10]||(e[10]=[I("↓")])),_:2},1032,["onClick","disabled"]),t(n,{size:"small",onClick:M=>H($)},{default:s(()=>[t(v,null,{default:s(()=>[t(q)]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1},512)),[[je,u(d).open]])}}}),we=(m,o)=>{const d=m.__vccOpts||m;for(const[g,r]of o)d[g]=r;return d},ye=we(it,[["__scopeId","data-v-89aa02d8"]]),ct={__name:"App",setup(m){return ee(),(o,d)=>{const g=z("el-col"),r=z("el-row"),p=z("el-container");return N(),Q(me,null,[t(ye),t(p,{style:{height:"100vh"}},{default:s(()=>[t(r,{class:"grid-container"},{default:s(()=>[t(g,{class:"grid-section top"},{default:s(()=>[t(Ae)]),_:1}),t(g,{class:"grid-section bottom"},{default:s(()=>[t(Je),t(nt),t(ye)]),_:1})]),_:1})]),_:1})],64)}}},ut=we(ct,[["__scopeId","data-v-d44e3bc6"]]),ae=Le(ut);ae.use(Oe());ae.use(be);for(const[m,o]of Object.entries(ze))ae.component(m,o);ae.mount("#app");
